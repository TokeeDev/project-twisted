"use strict";(()=>{var e={};e.id=811,e.ids=[811],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},928:(e,t,r)=>{let n,i,s,a,o,l,c,u,h,p,f,d,m,g,b,x,y,v,_,S;r.r(t),r.d(t,{originalPathname:()=>JY,patchFetch:()=>JQ,requestAsyncStorage:()=>JW,routeModule:()=>JK,serverHooks:()=>JG,staticGenerationAsyncStorage:()=>JV});var w,k,C={};r.r(C),r.d(C,{LoggerTypeId:()=>BL,add:()=>BU,addEffect:()=>Bq,addScoped:()=>BB,batched:()=>BV,defaultLogger:()=>Jr,filterLogLevel:()=>BK,isLogger:()=>Jm,json:()=>Ju,jsonLogger:()=>Jn,logFmt:()=>Jh,logfmtLogger:()=>Ji,make:()=>B$,map:()=>BW,mapInput:()=>BJ,mapInputOptions:()=>BH,minimumLogLevel:()=>Jd,none:()=>BZ,pretty:()=>Jp,prettyLogger:()=>Ja,prettyLoggerDefault:()=>Jo,remove:()=>BX,replace:()=>B0,replaceEffect:()=>B1,replaceScoped:()=>B2,simple:()=>B3,stringLogger:()=>Js,structured:()=>Jf,structuredLogger:()=>Jl,succeed:()=>B5,sync:()=>B4,test:()=>B6,tracerLogger:()=>Jc,withConsoleError:()=>BQ,withConsoleLog:()=>BG,withLeveledConsole:()=>BY,withMinimumLogLevel:()=>B8,withSpanAnnotations:()=>B7,zip:()=>B9,zipLeft:()=>Je,zipRight:()=>Jt});var E={};r.r(E),r.d(E,{GET:()=>JJ,POST:()=>JH});var O=r(9303),I=r(8716),F=r(670);let R=function(e,t){if("function"==typeof e)return function(){return e(arguments)?t.apply(this,arguments):e=>t(e,...arguments)};switch(e){case 0:case 1:throw RangeError(`Invalid arity ${e}`);case 2:return function(e,r){return arguments.length>=2?t(e,r):function(r){return t(r,e)}};case 3:return function(e,r,n){return arguments.length>=3?t(e,r,n):function(n){return t(n,e,r)}};case 4:return function(e,r,n,i){return arguments.length>=4?t(e,r,n,i):function(i){return t(i,e,r,n)}};case 5:return function(e,r,n,i,s){return arguments.length>=5?t(e,r,n,i,s):function(s){return t(s,e,r,n,i)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);let r=arguments;return function(e){return t(e,...r)}}}},T=e=>e,N=e=>()=>e,A=N(!0),M=N(!1),j=N(void 0);function z(e,t,r,n,i,s,a,o,l){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return i(n(r(t(e))));case 6:return s(i(n(r(t(e)))));case 7:return a(s(i(n(r(t(e))))));case 8:return o(a(s(i(n(r(t(e)))))));case 9:return l(o(a(s(i(n(r(t(e))))))));default:{let e=arguments[0];for(let t=1;t<arguments.length;t++)e=arguments[t](e);return e}}}let P=()=>"3.12.0",D=Symbol.for(`effect/GlobalValue/globalStoreId/${P()}`);D in globalThis||(globalThis[D]=new Map);let L=globalThis[D],$=(e,t)=>(L.has(e)||L.set(e,t()),L.get(e)),U=e=>"string"==typeof e,q=e=>"number"==typeof e,B=e=>"boolean"==typeof e,J=e=>"bigint"==typeof e,H=e=>"symbol"==typeof e,K=e=>"function"==typeof e,W=e=>void 0===e,V=e=>void 0!==e,G=e=>null!==e,Y=e=>!1,Q=e=>"object"==typeof e&&null!==e,Z=e=>Q(e)||K(e),X=R(2,(e,t)=>Z(e)&&t in e),ee=R(2,(e,t)=>X(e,"_tag")&&e._tag===t),et=e=>null==e,er=e=>null!=e,en=e=>e instanceof Date,ei=e=>X(e,Symbol.iterator),es=e=>Q(e)&&!Array.isArray(e),ea=e=>X(e,"then")&&K(e.then),eo=((e,t)=>r=>e(r)||t(r),e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`);Symbol.iterator;class el{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new el(this.self)}}class ec{_state;constructor(e,t,r,n){return et(t)&&et(e)?(t=4294967295*Math.random()>>>0,e=0):et(t)&&(t=e,e=0),et(n)&&et(r)?(n=this._state?this._state[3]:4150755663,r=this._state?this._state[2]:335903614):et(n)&&(n=r,r=0),this._state=new Int32Array([0,0,r>>>0,(1|(n||0))>>>0]),this._next(),eu(this._state,this._state[0],this._state[1],e>>>0,t>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=1|e[3]}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){return((67108863&this._next())*134217728+(134217727&this._next())*1)/9007199254740992}_next(){var e;let t,r,n,i;let s=this._state[0]>>>0,a=this._state[1]>>>0;e=this._state,t=(a>>>16)*32557>>>0,r=(65535&a)*19605>>>0,n=(65535&a)*32557>>>0,i=(a>>>16)*19605+((r>>>16)+(t>>>16))>>>0,(n=n+(r=r<<16>>>0)>>>0)>>>0<r>>>0&&(i=i+1>>>0),(n=n+(t=t<<16>>>0)>>>0)>>>0<t>>>0&&(i=i+1>>>0),i=(i=i+Math.imul(a,1481765933)>>>0)+Math.imul(s,1284865837)>>>0,e[0]=i,e[1]=n,eu(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let o=s>>>18,l=(a>>>18|s<<14)>>>0;o=(o^s)>>>0;let c=((l=(l^a)>>>0)>>>27|o<<5)>>>0,u=s>>>27;return(c>>>u|c<<((-u>>>0&31)>>>0))>>>0}}function eu(e,t,r,n,i){let s=t+n>>>0,a=r+i>>>0;a>>>0<r>>>0&&(s=s+1|0),e[0]=s,e[1]=a}let eh=Symbol.for("effect/Utils/YieldWrap");class ep{#e;constructor(e){this.#e=e}[eh](){return this.#e}}function ef(e){if("object"==typeof e&&null!==e&&eh in e)return e[eh]();throw Error(eo("yieldWrapGet"))}let ed=$("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),em=(e=>{let t={[e]:e=>e()};return function(r){return t[e](r)}})("effect_internal_function"),eg=(function*(){}).constructor,eb=e=>Z(e)&&e.constructor===eg,ex=$(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),ey=Symbol.for("effect/Hash"),ev=e=>{if(!0===ed.enabled)return 0;switch(typeof e){case"number":return eC(e);case"bigint":return eE(e.toString(10));case"boolean":case"symbol":return eE(String(e));case"string":return eE(e);case"undefined":return eE("undefined");case"function":case"object":if(null===e)return eE("null");if(e instanceof Date)return ev(e.toISOString());if(ek(e))return e[ey]();return e_(e);default:throw Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},e_=e=>(ex.has(e)||ex.set(e,eC(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),ex.get(e)),eS=e=>t=>53*t^e,ew=e=>3221225471&e|e>>>1&1073741824,ek=e=>X(e,ey),eC=e=>{if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295;return ew(t)},eE=e=>{let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return ew(t)},eO=(e,t)=>{let r=12289;for(let n=0;n<t.length;n++)r^=z(eE(t[n]),eS(ev(e[t[n]])));return ew(r)},eI=e=>eO(e,Object.keys(e)),eF=e=>{let t=6151;for(let r=0;r<e.length;r++)t=z(t,eS(ev(e[r])));return ew(t)},eR=function(){if(1==arguments.length){let e=arguments[0];return function(t){return Object.defineProperty(e,ey,{value:()=>t,enumerable:!1}),t}}let e=arguments[0],t=arguments[1];return Object.defineProperty(e,ey,{value:()=>t,enumerable:!1}),t},eT=Symbol.for("effect/Equal");function eN(){return 1==arguments.length?e=>eA(e,arguments[0]):eA(arguments[0],arguments[1])}function eA(e,t){if(e===t)return!0;let r=typeof e;if(r!==typeof t)return!1;if("object"===r||"function"===r){if(null!==e&&null!==t){if(eM(e)&&eM(t))return!!(ev(e)===ev(t)&&e[eT](t))||!!ed.enabled&&!!ed.tester&&ed.tester(e,t);if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(ed.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,r)=>eA(e,t[r]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){let r=Object.keys(e),n=Object.keys(t);if(r.length===n.length){for(let n of r)if(!(n in t&&eA(e[n],t[n])))return!!ed.tester&&ed.tester(e,t);return!0}}return!!ed.tester&&ed.tester(e,t)}}return!!ed.enabled&&!!ed.tester&&ed.tester(e,t)}let eM=e=>X(e,eT),ej=()=>eN,ez=Symbol.for("nodejs.util.inspect.custom"),eP=e=>{try{if(X(e,"toJSON")&&K(e.toJSON)&&0===e.toJSON.length)return e.toJSON();if(Array.isArray(e))return e.map(eP)}catch(e){return{}}return eW(e)},eD=e=>JSON.stringify(e,null,2),eL={toJSON(){return eP(this)},[ez](){return this.toJSON()},toString(){return eD(this.toJSON())}};class e${[ez](){return this.toJSON()}toString(){return eD(this.toJSON())}}let eU=(e,t=2)=>{if("string"==typeof e)return e;try{return"object"==typeof e?eq(e,t):String(e)}catch(t){return String(e)}},eq=(e,t)=>{let r=[],n=JSON.stringify(e,(e,t)=>"object"==typeof t&&null!==t?r.includes(t)?void 0:r.push(t)&&(void 0!==eH.fiberRefs&&eJ(t)?t[eB](eH.fiberRefs):t):t,t);return r=void 0,n},eB=Symbol.for("effect/Inspectable/Redactable"),eJ=e=>"object"==typeof e&&null!==e&&eB in e,eH=$("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),eK=(e,t)=>{let r=eH.fiberRefs;eH.fiberRefs=e;try{return t()}finally{eH.fiberRefs=r}},eW=e=>eJ(e)&&void 0!==eH.fiberRefs?e[eB](eH.fiberRefs):e,eV=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let r=e;for(let e=0,n=t.length;e<n;e++)r=t[e](r);return r}}},eG="Async",eY="Commit",eQ="Failure",eZ="OnFailure",eX="OnSuccess",e0="OnSuccessAndFailure",e1="Success",e2="Sync",e3="UpdateRuntimeFlags",e5="While",e4="Iterator",e6="WithRuntime",e8="Yield",e7="RevertFlags",e9=Symbol.for("effect/Effect"),te=Symbol.for("effect/Stream"),tt=Symbol.for("effect/Sink"),tr=Symbol.for("effect/Channel"),tn={_R:e=>e,_E:e=>e,_A:e=>e,_V:P()},ti={[e9]:tn,[te]:tn,[tt]:{_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},[tr]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},[eT](e){return this===e},[ey](){return eR(this,e_(this))},[Symbol.iterator](){return new el(new ep(this))},pipe(){return eV(this,arguments)}},ts={[ey](){return eR(this,eI(this))},[eT](e){let t=Object.keys(this),r=Object.keys(e);if(t.length!==r.length)return!1;for(let r of t)if(!(r in e&&eN(this[r],e[r])))return!1;return!0}},ta={...ti,_op:eY},to={...ta,...ts},tl=function(){function e(){}return e.prototype=ta,e}(),tc=function(){function e(){}return e.prototype=to,e}(),tu=Symbol.for("effect/Option"),th={...ti,[tu]:{_A:e=>e},[ez](){return this.toJSON()},toString(){return eD(this.toJSON())}},tp=Object.assign(Object.create(th),{_tag:"Some",_op:"Some",[eT](e){return tm(e)&&tb(e)&&eN(this.value,e.value)},[ey](){return eR(this,eS(ev(this._tag))(ev(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:eP(this.value)}}}),tf=ev("None"),td=Object.assign(Object.create(th),{_tag:"None",_op:"None",[eT]:e=>tm(e)&&tg(e),[ey]:()=>tf,toJSON(){return{_id:"Option",_tag:this._tag}}}),tm=e=>X(e,tu),tg=e=>"None"===e._tag,tb=e=>"Some"===e._tag,tx=Object.create(td),ty=e=>{let t=Object.create(tp);return t.value=e,t},tv=Symbol.for("effect/Either"),t_={...ti,[tv]:{_R:e=>e},[ez](){return this.toJSON()},toString(){return eD(this.toJSON())}},tS=Object.assign(Object.create(t_),{_tag:"Right",_op:"Right",[eT](e){return tk(e)&&tE(e)&&eN(this.right,e.right)},[ey](){return eS(ev(this._tag))(ev(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:eP(this.right)}}}),tw=Object.assign(Object.create(t_),{_tag:"Left",_op:"Left",[eT](e){return tk(e)&&tC(e)&&eN(this.left,e.left)},[ey](){return eS(ev(this._tag))(ev(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:eP(this.left)}}}),tk=e=>X(e,tv),tC=e=>"Left"===e._tag,tE=e=>"Right"===e._tag,tO=e=>{let t=Object.create(tw);return t.left=e,t},tI=e=>{let t=Object.create(tS);return t.right=e,t},tF=R(2,(e,t)=>tg(e)?tO(t()):tI(e.value)),tR=e=>{if(K(e))try{return tI(e())}catch(e){return tO(e)}else try{return tI(e.try())}catch(t){return tO(e.catch(t))}},tT=R(2,(e,t)=>tC(e)?tO(t(e.left)):tI(e.right)),tN=R(2,(e,t)=>tE(e)?tI(t(e.right)):tO(e.left)),tA=R(2,(e,{onLeft:t,onRight:r})=>tC(e)?t(e.left):r(e.right)),tM=tA({onLeft:T,onRight:T}),tj=R(2,(e,t)=>{if(tE(e))return e.right;throw t(e.left)}),tz=tj(()=>Error("getOrThrow called on a Left")),tP=e=>(t,r)=>t===r||e(t,r),tD=R(2,(e,t)=>tP((r,n)=>e(t(r),t(n)))),tL=e=>tP((t,r)=>{if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}),t$=e=>e.length>0,tU=()=>tx,tq=R(2,(e,{onNone:t,onSome:r})=>tg(e)?t():r(e.value)),tB=R(2,(e,t)=>tg(e)?t():e.value),tJ=R(2,(e,t)=>tg(e)?t():e),tH=R(2,(e,t)=>tg(e)?ty(t()):e),tK=e=>null==e?tU():ty(e),tW=tB(j),tV=e=>(...t)=>{try{return ty(e(...t))}catch(e){return tU()}},tG=R(2,(e,t)=>{if(tb(e))return e.value;throw t()})(()=>Error("getOrThrow called on a None")),tY=R(2,(e,t)=>tg(e)?tU():ty(t(e.value))),tQ=R(2,(e,t)=>tg(e)?tU():t(e.value)),tZ=e=>{if(Symbol.iterator in e){let t=[];for(let r of e){if(tg(r))return tU();t.push(r.value)}return ty(t)}let t={};for(let r of Object.keys(e)){let n=e[r];if(tg(n))return tU();t[r]=n.value}return ty(t)},tX=R(2,(e,t)=>tg(e)?tU():t(e.value)),t0=R(2,(e,t)=>tX(e,e=>t(e)?ty(e):tx)),t1=e=>tP((t,r)=>tg(t)?tg(r):!tg(r)&&e(t.value,r.value)),t2=(n=ej(),R(2,(e,t)=>!tg(e)&&n(e.value,t))),t3=R(2,(e,t)=>!tg(e)&&t(e.value)),t5=e=>{let t=e[Symbol.iterator]().next();if(t.done)throw Error("unsafeHead: empty iterable");return t.value};Symbol.iterator,()=>t4;let t4={next:()=>({done:!0,value:void 0})},t6=e=>(t,r)=>t===r?0:e(t,r),t8=t6((e,t)=>e<t?-1:1),t7=((e,t)=>e<t?-1:1,R(2,(e,t)=>t6((r,n)=>e(t(r),t(n))))),t9=e=>0===rn(e).length;Object.fromEntries,(e,t)=>{let r=[];for(let n of rn(e))r.push(t(n,e[n]));return r};let re=R(2,(e,t)=>Object.prototype.hasOwnProperty.call(e,t)),rt=R(2,(e,t)=>{if(!re(e,t))return{...e};let r={...e};return delete r[t],r}),rr=R(2,(e,t)=>{let r={...e};for(let n of rn(e))r[n]=t(e[n],n);return r}),rn=e=>Object.keys(e),ri=R(3,(e,t,r)=>({...e,[t]:r})),rs=(...e)=>e,ra=(...e)=>e,ro=e=>Array(e),rl=(e,t)=>{let r=Math.max(1,Math.floor(e)),n=Array(r);for(let e=0;e<r;e++)n[e]=t(e);return n},rc=e=>Array.isArray(e)?e:Array.from(e),ru=e=>Array.isArray(e)?e:[e],rh=R(2,(e,{onEmpty:t,onNonEmpty:r})=>rx(e)?r(e):t()),rp=R(2,(e,{onEmpty:t,onNonEmpty:r})=>rx(e)?r(rk(e),rO(e)):t()),rf=R(2,(e,t)=>[t,...e]),rd=R(2,(e,t)=>[...e,t]),rm=R(2,(e,t)=>rc(e).concat(rc(t))),rg=Array.isArray,rb=e=>0===e.length,rx=t$,ry=(e,t)=>e<0||e>=t.length,rv=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),r_=R(2,(e,t)=>{let r=Math.floor(t);return ry(r,e)?tU():ty(e[r])}),rS=R(2,(e,t)=>{let r=Math.floor(t);if(ry(r,e))throw Error(`Index ${r} out of bounds`);return e[r]}),rw=r_(0),rk=rS(0),rC=e=>rx(e)?ty(rE(e)):tU(),rE=e=>e[e.length-1],rO=e=>e.slice(1),rI=(e,t)=>{let r=0;for(let n of e){if(!t(n,r))break;r++}return r},rF=R(2,(e,t)=>rz(e,rI(e,t))),rR=R(2,(e,t)=>{let r=rc(e);return r.slice(rv(t,r),r.length)}),rT=((e,t)=>{let r=rc(e);for(let e=r.length-1;e>=0;e--){let n=r[e],i=t(n,e);if(B(i)){if(i)return ty(n)}else if(tb(i))return i}return tU()},e=>Array.from(e).reverse()),rN=R(2,(e,t)=>{let r=Array.from(e);return r.sort(t),r}),rA=R(2,(e,t)=>rM(e,t,rs)),rM=R(3,(e,t,r)=>{let n=rc(e),i=rc(t);if(rx(n)&&rx(i)){let e=[r(rk(n),rk(i))],t=Math.min(n.length,i.length);for(let s=1;s<t;s++)e[s]=r(n[s],i[s]);return e}return[]}),rj=ej(),rz=R(2,(e,t)=>{let r=Array.from(e),n=Math.floor(t);return rx(r)?n>=1?rP(r,n):[[],r]:[r,[]]}),rP=R(2,(e,t)=>{let r=Math.max(1,Math.floor(t));return r>=e.length?[rD(e),[]]:[rf(e.slice(1,r),rk(e)),e.slice(r)]}),rD=e=>e.slice(),rL=R(3,(e,t,r)=>{let n=rc(e),i=rc(t);return rx(n)?rx(i)?r0(r)(rm(n,i)):n:i}),r$=R(2,(e,t)=>rL(e,t,rj)),rU=()=>[],rq=e=>[e],rB=R(2,(e,t)=>e.map(t)),rJ=R(2,(e,t)=>{if(rb(e))return[];let r=[];for(let n=0;n<e.length;n++){let i=t(e[n],n);for(let e=0;e<i.length;e++)r.push(i[e])}return r}),rH=rJ(T),rK=R(2,(e,t)=>{let r=rc(e),n=[];for(let e=0;e<r.length;e++){let i=t(r[e],e);tb(i)&&n.push(i.value)}return n}),rW=R(2,(e,t)=>{let r=0,n=[];for(let i of e){let e=t(i,r);if(tb(e))n.push(e.value);else break;r++}return n}),rV=R(2,(e,t)=>{let r=[],n=[],i=rc(e);for(let e=0;e<i.length;e++){let s=t(i[e],e);tC(s)?r.push(s.left):n.push(s.right)}return[r,n]}),rG=rK(T),rY=R(2,(e,t)=>{let r=rc(e),n=[];for(let e=0;e<r.length;e++)t(r[e],e)&&n.push(r[e]);return n}),rQ=R(3,(e,t,r)=>rc(e).reduce((e,t,n)=>r(e,t,n),t)),rZ=R(3,(e,t,r)=>rc(e).reduceRight((e,t,n)=>r(e,t,n),t)),rX=((e,t)=>e.every(t),(e,t)=>{let r;let n=[],i=e;for(;tb(r=t(i));){let[e,t]=r.value;n.push(e),i=t}return n}),r0=R(2,(e,t)=>{let r=rc(e);if(rx(r)){let e=[rk(r)];for(let n of rO(r))e.every(e=>!t(n,e))&&e.push(n);return e}return[]}),r1=e=>r0(e,ej()),r2=R(2,(e,t)=>rc(e).join(t)),r3=R(3,(e,t,r)=>{let n=0,i=t,s=[];for(let t of e){let e=r(i,t,n);i=e[0],s.push(e[1]),n++}return[i,s]}),r5=Symbol.for("effect/Chunk"),r4=[],r6=tP((e,t)=>e.length===t.length&&na(e).every((e,r)=>eN(e,nh(t,r)))),r8={[r5]:{_A:e=>e},toString(){return eD(this.toJSON())},toJSON(){return{_id:"Chunk",values:na(this).map(eP)}},[ez](){return this.toJSON()},[eT](e){return r9(e)&&r6(this,e)},[ey](){return eR(this,eF(na(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return r4[Symbol.iterator]();default:return na(this)[Symbol.iterator]()}},pipe(){return eV(this,arguments)}},r7=e=>{let t=Object.create(r8);switch(t.backing=e,e._tag){case"IEmpty":t.length=0,t.depth=0,t.left=t,t.right=t;break;case"IConcat":t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break;case"IArray":t.length=e.array.length,t.depth=0,t.left=ne,t.right=ne;break;case"ISingleton":t.length=1,t.depth=0,t.left=ne,t.right=ne;break;case"ISlice":t.length=e.length,t.depth=e.chunk.depth+1,t.left=ne,t.right=ne}return t},r9=e=>X(e,r5),ne=r7({_tag:"IEmpty"}),nt=()=>ne,nr=(...e)=>1===e.length?nn(e[0]):nu(e),nn=e=>r7({_tag:"ISingleton",a:e}),ni=e=>r9(e)?e:r7({_tag:"IArray",array:rc(e)}),ns=(e,t,r)=>{switch(e.backing._tag){case"IArray":!function(e,t,r,n,i){for(let t=0;t<Math.min(e.length,0+i);t++)r[n+t-0]=e[t]}(e.backing.array,0,t,r,e.length);break;case"IConcat":ns(e.left,t,r),ns(e.right,t,r+e.left.length);break;case"ISingleton":t[r]=e.backing.a;break;case"ISlice":{let n=0,i=r;for(;n<e.length;)t[i]=nh(e,n),n+=1,i+=1}}},na=e=>{switch(e.backing._tag){case"IEmpty":return r4;case"IArray":return e.backing.array;default:{let t=Array(e.length);return ns(e,t,0),e.backing={_tag:"IArray",array:t},e.left=ne,e.right=ne,e.depth=0,t}}},no=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return r7({_tag:"IArray",array:rT(e.backing.array)});case"IConcat":return r7({_tag:"IConcat",left:no(e.backing.right),right:no(e.backing.left)});case"ISlice":return nc(rT(na(e)))}},nl=R(2,(e,t)=>t<0||t>=e.length?tU():ty(nh(e,t))),nc=e=>r7({_tag:"IArray",array:e}),nu=e=>nc(e),nh=R(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw Error("Index out of bounds");case"ISingleton":if(0!==t)throw Error("Index out of bounds");return e.backing.a;case"IArray":if(t>=e.length||t<0)throw Error("Index out of bounds");return e.backing.array[t];case"IConcat":return t<e.left.length?nh(e.left,t):nh(e.right,t-e.left.length);case"ISlice":return nh(e.backing.chunk,t+e.backing.offset)}}),np=R(2,(e,t)=>nb(e,nn(t))),nf=R(2,(e,t)=>nb(nn(t),e)),nd=R(2,(e,t)=>{if(t<=0)return ne;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return r7({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":if(t>e.left.length)return r7({_tag:"IConcat",left:e.left,right:nd(e.right,t-e.left.length)});return nd(e.left,t);default:return r7({_tag:"ISlice",chunk:e,offset:0,length:t})}}),nm=R(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return ne;switch(e.backing._tag){case"ISlice":return r7({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":if(t>e.left.length)return nm(e.right,t-e.left.length);return r7({_tag:"IConcat",left:nm(e.left,t),right:e.right});default:return r7({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),ng=R(2,(e,t)=>{let r=na(e),n=r.length,i=0;for(;i<n&&t(r[i]);)i++;return nm(e,i)}),nb=R(2,(e,t)=>{if("IEmpty"===e.backing._tag)return t;if("IEmpty"===t.backing._tag)return e;let r=t.depth-e.depth;if(1>=Math.abs(r))return r7({_tag:"IConcat",left:e,right:t});if(r<-1){if(e.left.depth>=e.right.depth){let r=nb(e.right,t);return r7({_tag:"IConcat",left:e.left,right:r})}{let r=nb(e.right.right,t);if(r.depth===e.depth-3){let t=r7({_tag:"IConcat",left:e.right.left,right:r});return r7({_tag:"IConcat",left:e.left,right:t})}{let t=r7({_tag:"IConcat",left:e.left,right:e.right.left});return r7({_tag:"IConcat",left:t,right:r})}}}if(t.right.depth>=t.left.depth)return r7({_tag:"IConcat",left:nb(e,t.left),right:t.right});{let r=nb(e,t.left.left);if(r.depth===t.depth-3){let e=r7({_tag:"IConcat",left:r,right:t.left.right});return r7({_tag:"IConcat",left:e,right:t.right})}{let e=r7({_tag:"IConcat",left:t.left.right,right:t.right});return r7({_tag:"IConcat",left:r,right:e})}}}),nx=R(2,(e,t)=>nc(rK(e,t))),ny=R(2,(e,t)=>nc(rY(e,t))),nv=((e,t)=>nc(rW(e,t)),R(2,(e,t)=>{if("ISingleton"===e.backing._tag)return t(e.backing.a,0);let r=ne,n=0;for(let i of e)r=nb(r,t(i,n++));return r})),n_=R(2,(e,t)=>na(e).forEach(t)),nS=nv(T),nw=e=>0===e.length,nk=e=>e.length>0,nC=nl(0),nE=e=>nh(e,0),nO=e=>nh(e,e.length-1),nI=R(2,(e,t)=>"ISingleton"===e.backing._tag?nn(t(e.backing.a,0)):nc(z(na(e),rB((e,r)=>t(e,r))))),nF=((e,t,r)=>{let[n,i]=r3(e,t,r);return[n,nc(i)]},R(2,(e,t)=>[nd(e,t),nm(e,t)])),nR=R(2,(e,t)=>{let r=0;for(let n of na(e)){if(t(n))break;r++}return nF(e,r)}),nT=e=>nm(e,1),nN=R(2,(e,t)=>nm(e,e.length-t)),nA=R(2,(e,t)=>{let r=[];for(let n of na(e))if(t(n))r.push(n);else break;return nc(r)}),nM=R(3,(e,t,r)=>nc(rM(e,t,r))),nj=R(2,(e,t)=>ni(rl(e,t))),nz=(e,t)=>e<=t?nj(t-e+1,t=>e+t):nn(e),nP=R(2,(e,t)=>rc(e).some(t));function nD(e,t){var r;return r=e&t-1,r-=r>>1&1431655765,r=(r=(858993459&r)+(r>>2&858993459))+(r>>4)&252645135,r+=r>>8,127&(r+=r>>16)}let nL=(e,t)=>({value:e,previous:t});function n$(e,t,r,n){let i=n;if(!e){let e=n.length;i=Array(e);for(let t=0;t<e;++t)i[t]=n[t]}return i[t]=r,i}function nU(e,t,r){let n=r.length-1,i=0,s=0,a=r;if(e)i=s=t;else for(a=Array(n);i<t;)a[s++]=r[i++];for(++i;i<=n;)a[s++]=r[i++];return e&&(a.length=n),a}class nq{_tag="EmptyNode";modify(e,t,r,n,i,s){let a=r(tU());return tg(a)?new nq:(++s.value,new nH(e,n,i,a))}}function nB(e){return ee(e,"EmptyNode")}function nJ(e,t){return!nB(e)&&t===e.edit}class nH{edit;hash;key;value;_tag="LeafNode";constructor(e,t,r,n){this.edit=e,this.hash=t,this.key=r,this.value=n}modify(e,t,r,n,i,s){if(eN(i,this.key)){let t=r(this.value);return t===this.value?this:tg(t)?(--s.value,new nq):nJ(this,e)?(this.value=t,this):new nH(e,n,i,t)}let a=r(tU());return tg(a)?this:(++s.value,nG(e,t,this.hash,this,n,new nH(e,n,i,a)))}}class nK{edit;hash;children;_tag="CollisionNode";constructor(e,t,r){this.edit=e,this.hash=t,this.children=r}modify(e,t,r,n,i,s){if(n===this.hash){let t=nJ(this,e),n=this.updateCollisionList(t,e,this.hash,this.children,r,i,s);return n===this.children?this:n.length>1?new nK(e,this.hash,n):n[0]}let a=r(tU());return tg(a)?this:(++s.value,nG(e,t,this.hash,this,n,new nH(e,n,i,a)))}updateCollisionList(e,t,r,n,i,s,a){let o=n.length;for(let l=0;l<o;++l){let o=n[l];if("key"in o&&eN(s,o.key)){let c=o.value,u=i(c);if(u===c)return n;if(tg(u))return--a.value,nU(e,l,n);return n$(e,l,new nH(t,r,s,u),n)}}let l=i(tU());return tg(l)?n:(++a.value,n$(e,o,new nH(t,r,s,l),n))}}class nW{edit;mask;children;_tag="IndexedNode";constructor(e,t,r){this.edit=e,this.mask=t,this.children=r}modify(e,t,r,n,i,s){let a;let o=this.mask,l=this.children,c=n>>>t&31,u=1<<c,h=nD(o,u),p=o&u,f=nJ(this,e);if(!p){let a=new nq().modify(e,t+5,r,n,i,s);return a?l.length>=16?function(e,t,r,n,i){let s=[],a=n,o=0;for(let e=0;a;++e)1&a&&(s[e]=i[o++]),a>>>=1;return s[t]=r,new nV(e,o+1,s)}(e,c,a,o,l):new nW(e,o|u,function(e,t,r,n){let i=n.length;if(e){let e=i;for(;e>=t;)n[e--]=n[e];return n[t]=r,n}let s=0,a=0,o=Array(i+1);for(;s<t;)o[a++]=n[s++];for(o[t]=r;s<i;)o[++a]=n[s++];return o}(f,h,a,l)):this}let d=l[h],m=d.modify(e,t+5,r,n,i,s);if(d===m)return this;let g=o;if(nB(m)){var b;if(!(g&=~u))return new nq;if(l.length<=2&&(nB(b=l[1^h])||"LeafNode"===b._tag||"CollisionNode"===b._tag))return l[1^h];a=nU(f,h,l)}else a=n$(f,h,m,l);return f?(this.mask=g,this.children=a,this):new nW(e,g,a)}}class nV{edit;size;children;_tag="ArrayNode";constructor(e,t,r){this.edit=e,this.size=t,this.children=r}modify(e,t,r,n,i,s){let a,o=this.size,l=this.children,c=n>>>t&31,u=l[c],h=(u||new nq).modify(e,t+5,r,n,i,s);if(u===h)return this;let p=nJ(this,e);if(nB(u)&&!nB(h))++o,a=n$(p,c,h,l);else if(!nB(u)&&nB(h)){if(--o<=8)return function(e,t,r,n){let i=Array(t-1),s=0,a=0;for(let e=0,t=n.length;e<t;++e)if(e!==r){let t=n[e];t&&!nB(t)&&(i[s++]=t,a|=1<<e)}return new nW(e,a,i)}(e,o,c,l);a=n$(p,c,new nq,l)}else a=n$(p,c,h,l);return p?(this.size=o,this.children=a,this):new nV(e,o,a)}}function nG(e,t,r,n,i,s){let a;let o=t;for(;;){let t=function(e,t,r,n,i,s){if(r===i)return new nK(e,r,[s,n]);let a=r>>>t&31,o=i>>>t&31;return a===o?t=>new nW(e,1<<a|1<<o,[t]):new nW(e,1<<a|1<<o,a<o?[n,s]:[s,n])}(e,o,r,n,i,s);if("function"==typeof t)a=nL(t,a),o+=5;else{let e=t;for(;null!=a;)e=a.value(e),a=a.previous;return e}}}let nY="effect/HashMap",nQ=Symbol.for(nY),nZ={[nQ]:nQ,[Symbol.iterator](){return new n0(this,(e,t)=>[e,t])},[ey](){let e=ev(nY);for(let t of this)e^=z(ev(t[0]),eS(ev(t[1])));return eR(this,e)},[eT](e){if(n6(e)){if(e._size!==this._size)return!1;for(let t of this){let r=z(e,n7(t[0],ev(t[0])));if(tg(r)||!eN(t[1],r.value))return!1}return!0}return!1},toString(){return eD(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(eP)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},nX=(e,t,r,n)=>{let i=Object.create(nZ);return i._editable=e,i._edit=t,i._root=r,i._size=n,i};class n0{map;f;v;constructor(e,t){this.map=e,this.f=t,this.v=n2(this.map._root,this.f,void 0)}next(){if(tg(this.v))return{done:!0,value:void 0};let e=this.v.value;return this.v=n1(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new n0(this.map,this.f)}}let n1=e=>e?n3(e[0],e[1],e[2],e[3],e[4]):tU(),n2=(e,t,r)=>{switch(e._tag){case"LeafNode":if(tb(e.value))return ty({value:t(e.key,e.value.value),cont:r});return n1(r);case"CollisionNode":case"ArrayNode":case"IndexedNode":{let n=e.children;return n3(n.length,n,0,t,r)}default:return n1(r)}},n3=(e,t,r,n,i)=>{for(;r<e;){let s=t[r++];if(s&&!nB(s))return n2(s,n,[e,t,r,n,i])}return n1(i)},n5=nX(!1,0,new nq,0),n4=()=>n5,n6=e=>X(e,nQ),n8=R(2,(e,t)=>n7(e,t,ev(t))),n7=R(3,(e,t,r)=>{let n=e._root,i=0;for(;;)switch(n._tag){case"LeafNode":return eN(t,n.key)?n.value:tU();case"CollisionNode":if(r===n.hash){let e=n.children;for(let r=0,n=e.length;r<n;++r){let n=e[r];if("key"in n&&eN(t,n.key))return n.value}}return tU();case"IndexedNode":{let e=1<<(r>>>i&31);if(n.mask&e){n=n.children[nD(n.mask,e)],i+=5;break}return tU()}case"ArrayNode":if(n=n.children[r>>>i&31]){i+=5;break}return tU();default:return tU()}}),n9=R(2,(e,t)=>tb(n7(e,t,ev(t)))),ie=R(3,(e,t,r)=>io(e,t,()=>ty(r))),it=R(3,(e,t,r)=>e._editable?(e._root=t,e._size=r,e):t===e._root?e:nX(e._editable,e._edit,t,r)),ir=e=>new n0(e,e=>e),ii=e=>e._size,is=e=>nX(!0,e._edit+1,e._root,e._size),ia=e=>(e._editable=!1,e),io=((e,t)=>{let r=is(e);return t(r),ia(r)},R(3,(e,t,r)=>il(e,t,ev(t),r))),il=R(4,(e,t,r,n)=>{let i={value:e._size},s=e._root.modify(e._editable?e._edit:NaN,0,n,r,t,i);return z(e,it(s,i.value))}),ic=R(2,(e,t)=>io(e,t,tU)),iu=R(2,(e,t)=>ip(e,n4(),(e,r,n)=>ie(e,n,t(r,n)))),ih=R(2,(e,t)=>ip(e,void 0,(e,r,n)=>t(r,n))),ip=R(3,(e,t,r)=>{let n;let i=e._root;if("LeafNode"===i._tag)return tb(i.value)?r(t,i.value.value,i.key):t;if("EmptyNode"===i._tag)return t;let s=[i.children];for(;n=s.pop();)for(let e=0,i=n.length;e<i;){let i=n[e++];i&&!nB(i)&&("LeafNode"===i._tag?tb(i.value)&&(t=r(t,i.value.value,i.key)):s.push(i.children))}return t}),id="effect/HashSet",im=Symbol.for(id),ig={[im]:im,[Symbol.iterator](){return ir(this._keyMap)},[ey](){return eR(this,eS(ev(this._keyMap))(ev(id)))},[eT](e){return!!ix(e)&&ii(this._keyMap)===ii(e._keyMap)&&eN(this._keyMap,e._keyMap)},toString(){return eD(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(eP)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},ib=e=>{let t=Object.create(ig);return t._keyMap=e,t},ix=e=>X(e,im),iy=ib(n4()),iv=()=>iy,i_=R(2,(e,t)=>n9(e._keyMap,t)),iS=R(2,(e,t)=>{let r=!1;for(let n of e)if(r=t(n))break;return r}),iw=R(2,(e,t)=>!iS(e,e=>!t(e))),ik=e=>ib(is(e._keyMap)),iC=e=>(e._keyMap._editable=!1,e),iE=R(2,(e,t)=>{let r=ik(e);return t(r),iC(r)}),iO=R(2,(e,t)=>e._keyMap._editable?(ie(t,!0)(e._keyMap),e):ib(ie(t,!0)(e._keyMap))),iI=R(2,(e,t)=>e._keyMap._editable?(ic(t)(e._keyMap),e):ib(ic(t)(e._keyMap))),iF=R(2,(e,t)=>iE(e,e=>{for(let r of t)iI(e,r)})),iR=R(2,(e,t)=>iE(iv(),r=>{for(let n of(iT(e,e=>iO(r,e)),t))iO(r,n)})),iT=R(2,(e,t)=>ih(e._keyMap,(e,r)=>t(r))),iN=R(3,(e,t,r)=>ip(e._keyMap,t,(e,t,n)=>r(e,n))),iA=e=>{let t=ik(iv());for(let r of e)iO(t,r);return iC(t)},iM=(...e)=>{let t=ik(iv());for(let r of e)iO(t,r);return iC(t)},ij=e=>ii(e._keyMap),iz="Empty",iP="Fail",iD="Interrupt",iL="Parallel",i$="Sequential",iU="effect/Cause",iq=Symbol.for(iU),iB={[iq]:{_E:e=>e},[ey](){return z(ev(iU),eS(ev(si(this))),eR(this))},[eT](e){return iY(e)&&sn(this,e)},pipe(){return eV(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:eP(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:eP(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:eP(this.left),right:eP(this.right)}}},toString(){return sd(this)},[ez](){return this.toJSON()}},iJ=(()=>{let e=Object.create(iB);return e._tag=iz,e})(),iH=e=>{let t=Object.create(iB);return t._tag=iP,t.error=e,t},iK=e=>{let t=Object.create(iB);return t._tag="Die",t.defect=e,t},iW=e=>{let t=Object.create(iB);return t._tag=iD,t.fiberId=e,t},iV=(e,t)=>{let r=Object.create(iB);return r._tag=iL,r.left=e,r.right=t,r},iG=(e,t)=>{let r=Object.create(iB);return r._tag=i$,r.left=e,r.right=t,r},iY=e=>X(e,iq),iQ=e=>"Die"===e._tag,iZ=e=>e._tag===iz||sp(e,!0,(e,t)=>{switch(t._tag){case iz:return ty(e);case"Die":case iP:case iD:return ty(!1);default:return tU()}}),iX=e=>tb(i6(e)),i0=e=>sf(void 0,sl)(e),i1=e=>no(sp(e,nt(),(e,t)=>t._tag===iP?ty(z(e,nf(t.error))):tU())),i2=e=>no(sp(e,nt(),(e,t)=>"Die"===t._tag?ty(z(e,nf(t.defect))):tU())),i3=e=>sp(e,iv(),(e,t)=>t._tag===iD?ty(z(e,iO(t.fiberId))):tU()),i5=e=>sa(e,e=>e._tag===iP?ty(e.error):tU()),i4=e=>{let t=i5(e);switch(t._tag){case"None":return tI(e);case"Some":return tO(t.value)}},i6=e=>sa(e,e=>e._tag===iD?ty(e.fiberId):tU()),i8=e=>sh(e,{onEmpty:tU(),onFail:e=>ty(iK(e)),onDie:e=>ty(iK(e)),onInterrupt:()=>tU(),onSequential:(e,t)=>tb(e)&&tb(t)?ty(iG(e.value,t.value)):tb(e)&&tg(t)?ty(e.value):tg(e)&&tb(t)?ty(t.value):tU(),onParallel:(e,t)=>tb(e)&&tb(t)?ty(iV(e.value,t.value)):tb(e)&&tg(t)?ty(e.value):tg(e)&&tb(t)?ty(t.value):tU()}),i7=e=>sh(e,{onEmpty:iJ,onFail:()=>iJ,onDie:e=>iK(e),onInterrupt:e=>iW(e),onSequential:iG,onParallel:iV}),i9=e=>sh(e,{onEmpty:iJ,onFail:e=>iK(e),onDie:e=>iK(e),onInterrupt:e=>iW(e),onSequential:(e,t)=>iG(e,t),onParallel:(e,t)=>iV(e,t)}),se=R(2,(e,t)=>sh(e,{onEmpty:ty(iJ),onFail:e=>ty(iH(e)),onDie:e=>tb(t(e))?tU():ty(iK(e)),onInterrupt:e=>ty(iW(e)),onSequential:(e,t)=>tb(e)&&tb(t)?ty(iG(e.value,t.value)):tb(e)&&tg(t)?ty(e.value):tg(e)&&tb(t)?ty(t.value):tU(),onParallel:(e,t)=>tb(e)&&tb(t)?ty(iV(e.value,t.value)):tb(e)&&tg(t)?ty(e.value):tg(e)&&tb(t)?ty(t.value):tU()})),st=R(2,(e,t)=>sr(e,e=>iH(t(e)))),sr=R(2,(e,t)=>sh(e,{onEmpty:iJ,onFail:e=>t(e),onDie:e=>iK(e),onInterrupt:e=>iW(e),onSequential:(e,t)=>iG(e,t),onParallel:(e,t)=>iV(e,t)})),sn=(e,t)=>{let r=nn(e),n=nn(t);for(;nk(r)&&nk(n);){let[e,t]=z(nE(r),sp([iv(),nt()],([e,t],r)=>{let[n,i]=so(r);return ty([z(e,iR(n)),z(t,nb(i))])})),[i,s]=z(nE(n),sp([iv(),nt()],([e,t],r)=>{let[n,i]=so(r);return ty([z(e,iR(n)),z(t,nb(i))])}));if(!eN(e,i))return!1;r=t,n=s}return!0},si=e=>ss(nn(e),nt()),ss=(e,t)=>{for(;;){let[r,n]=z(e,rQ([iv(),nt()],([e,t],r)=>{let[n,i]=so(r);return[z(e,iR(n)),z(t,nb(i))]})),i=ij(r)>0?z(t,nf(r)):t;if(nw(n))return no(i);e=n,t=i}throw Error(eo("Cause.flattenCauseLoop"))},sa=R(2,(e,t)=>{let r=[e];for(;r.length>0;){let e=r.pop(),n=t(e);switch(n._tag){case"None":switch(e._tag){case i$:case iL:r.push(e.right),r.push(e.left)}break;case"Some":return n}}return tU()}),so=e=>{let t=e,r=[],n=iv(),i=nt();for(;void 0!==t;)switch(t._tag){case iz:if(0===r.length)return[n,i];t=r.pop();break;case iP:if(n=iO(n,nr(t._tag,t.error)),0===r.length)return[n,i];t=r.pop();break;case"Die":if(n=iO(n,nr(t._tag,t.defect)),0===r.length)return[n,i];t=r.pop();break;case iD:if(n=iO(n,nr(t._tag,t.fiberId)),0===r.length)return[n,i];t=r.pop();break;case i$:switch(t.left._tag){case iz:t=t.right;break;case i$:t=iG(t.left.left,iG(t.left.right,t.right));break;case iL:t=iV(iG(t.left.left,t.right),iG(t.left.right,t.right));break;default:i=nf(i,t.right),t=t.left}break;case iL:r.push(t.right),t=t.left}throw Error(eo("Cause.evaluateCauseLoop"))},sl={emptyCase:A,failCase:M,dieCase:M,interruptCase:A,sequentialCase:(e,t,r)=>t&&r,parallelCase:(e,t,r)=>t&&r},sc="SequentialCase",su="ParallelCase",sh=R(2,(e,{onDie:t,onEmpty:r,onFail:n,onInterrupt:i,onParallel:s,onSequential:a})=>sf(e,void 0,{emptyCase:()=>r,failCase:(e,t)=>n(t),dieCase:(e,r)=>t(r),interruptCase:(e,t)=>i(t),sequentialCase:(e,t,r)=>a(t,r),parallelCase:(e,t,r)=>s(t,r)})),sp=R(3,(e,t,r)=>{let n=t,i=e,s=[];for(;void 0!==i;){let e=r(n,i);switch(n=tb(e)?e.value:n,i._tag){case i$:case iL:s.push(i.right),i=i.left;break;default:i=void 0}void 0===i&&s.length>0&&(i=s.pop())}return n}),sf=R(3,(e,t,r)=>{let n=[e],i=[];for(;n.length>0;){let e=n.pop();switch(e._tag){case iz:i.push(tI(r.emptyCase(t)));break;case iP:i.push(tI(r.failCase(t,e.error)));break;case"Die":i.push(tI(r.dieCase(t,e.defect)));break;case iD:i.push(tI(r.interruptCase(t,e.fiberId)));break;case i$:n.push(e.right),n.push(e.left),i.push(tO({_tag:sc}));break;case iL:n.push(e.right),n.push(e.left),i.push(tO({_tag:su}))}}let s=[];for(;i.length>0;){let e=i.pop();switch(e._tag){case"Left":switch(e.left._tag){case sc:{let e=s.pop(),n=s.pop(),i=r.sequentialCase(t,e,n);s.push(i);break}case su:{let e=s.pop(),n=s.pop(),i=r.parallelCase(t,e,n);s.push(i)}}break;case"Right":s.push(e.right)}}if(0===s.length)throw Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return s.pop()}),sd=(e,t)=>i0(e)?"All fibers interrupted without errors.":sS(e).map(function(e){return t?.renderErrorCause!==!0||void 0===e.cause?e.stack:`${e.stack} {
${sm(e.cause,"  ")}
}`}).join("\n"),sm=(e,t)=>{let r=e.stack.split("\n"),n=`${t}[cause]: ${r[0]}`;for(let e=1,i=r.length;e<i;e++)n+=`
${t}${r[e]}`;return e.cause&&(n+=` {
${sm(e.cause,`${t}  `)}
${t}}`),n};class sg extends globalThis.Error{span=void 0;constructor(e){let t="object"==typeof e&&null!==e,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(sb(e),t&&"cause"in e&&void 0!==e.cause?{cause:new sg(e.cause)}:void 0),""===this.message&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=e instanceof Error?e.name:"Error",t&&(s_ in e&&(this.span=e[s_]),Object.keys(e).forEach(t=>{t in this||(this[t]=e[t])})),this.stack=sv(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}let sb=e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&e instanceof Error)return e.message;try{if(X(e,"toString")&&K(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return eq(e)},sx=/\((.*)\)/g,sy=$("effect/Tracer/spanToTrace",()=>new WeakMap),sv=(e,t,r)=>{let n=[e],i=t.startsWith(e)?t.slice(e.length).split("\n"):t.split("\n");for(let e=1;e<i.length&&!i[e].includes("Generator.next");e++){if(i[e].includes("effect_internal_function")){n.pop();break}n.push(i[e].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(r){let e=r,t=0;for(;e&&"Span"===e._tag&&t<10;){let r=sy.get(e);if("function"==typeof r){let t=r();if("string"==typeof t){let r=t.matchAll(sx),i=!1;for(let[,t]of r)i=!0,n.push(`    at ${e.name} (${t})`);i||n.push(`    at ${e.name} (${t.replace(/^at /,"")})`)}else n.push(`    at ${e.name}`)}else n.push(`    at ${e.name}`);e=tW(e.parent),t++}}return n.join("\n")},s_=Symbol.for("effect/SpanAnnotation"),sS=e=>sf(e,void 0,{emptyCase:()=>[],dieCase:(e,t)=>[new sg(t)],failCase:(e,t)=>[new sg(t)],interruptCase:()=>[],parallelCase:(e,t,r)=>[...t,...r],sequentialCase:(e,t,r)=>[...t,...r]}),sw=Symbol.for("effect/Context/Tag"),sk=Symbol.for("effect/Context/Reference"),sC=Symbol.for("effect/STM"),sE={...ti,_op:"Tag",[sC]:tn,[sw]:{_Service:e=>e,_Identifier:e=>e},toString(){return eD(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[ez](){return this.toJSON()},of:e=>e,context(e){return sj(this,e)}},sO={...sE,[sk]:sk},sI=Symbol.for("effect/Context"),sF={[sI]:{_Services:e=>e},[eT](e){if(sN(e)&&this.unsafeMap.size===e.unsafeMap.size){for(let t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!eN(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[ey](){return eR(this,eC(this.unsafeMap.size))},pipe(){return eV(this,arguments)},toString(){return eD(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(eP)}},[ez](){return this.toJSON()}},sR=e=>{let t=Object.create(sF);return t.unsafeMap=e,t},sT=e=>{let t=Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){let r=e.stack.split("\n");if(r.length>2){let e=r[2].match(/at (.*)/);e&&(t.message=t.message+` (defined at ${e[1]})`)}}if(t.stack){let e=t.stack.split("\n");e.splice(1,3),t.stack=e.join("\n")}return t},sN=e=>X(e,sI),sA=e=>X(e,sk),sM=sR(new Map),sj=(e,t)=>sR(new Map([[e.key,t]])),sz=R(3,(e,t,r)=>{let n=new Map(e.unsafeMap);return n.set(t.key,r),sR(n)}),sP=$("effect/Context/defaultValueCache",()=>new Map),sD=e=>{if(sP.has(e.key))return sP.get(e.key);let t=e.defaultValue();return sP.set(e.key,t),t},sL=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):sD(t),s$=R(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(sk in t)return sD(t);throw sT(t)}return e.unsafeMap.get(t.key)}),sU=R(2,(e,t)=>e.unsafeMap.has(t.key)?ty(e.unsafeMap.get(t.key)):sA(t)?ty(sD(t)):tx),sq=R(2,(e,t)=>{let r=new Map(e.unsafeMap);for(let[e,n]of t.unsafeMap)r.set(e,n);return sR(r)}),sB=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let r=Error();Error.stackTraceLimit=t;let n=Object.create(sE);return Object.defineProperty(n,"stack",{get:()=>r.stack}),n.key=e,n},sJ=e=>X(e,sw),sH=()=>sM,sK=e=>()=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let r=Error();function n(){}return Error.stackTraceLimit=t,Object.setPrototypeOf(n,sE),n.key=e,Object.defineProperty(n,"stack",{get:()=>r.stack}),n},sW=()=>(e,t)=>{let r=Error.stackTraceLimit;Error.stackTraceLimit=2;let n=Error();function i(){}return Error.stackTraceLimit=r,Object.setPrototypeOf(i,sO),i.key=e,i.defaultValue=t.defaultValue,Object.defineProperty(i,"stack",{get:()=>n.stack}),i},sV=Symbol.for("effect/Duration"),sG=BigInt(0),sY=BigInt(24),sQ=BigInt(60),sZ=BigInt(1e3),sX=BigInt(1e6),s0=BigInt(1e9),s1=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,s2=e=>{if(s8(e))return e;if(q(e))return ar(e);if(J(e))return ae(e);if(Array.isArray(e)){if(2===e.length&&q(e[0])&&q(e[1]))return ae(BigInt(e[0])*s0+BigInt(e[1]))}else if(U(e)){s1.lastIndex=0;let t=s1.exec(e);if(t){let[e,r,n]=t,i=Number(r);switch(n){case"nano":case"nanos":return ae(BigInt(r));case"micro":case"micros":return at(BigInt(r));case"milli":case"millis":return ar(i);case"second":case"seconds":return an(i);case"minute":case"minutes":return ai(i);case"hour":case"hours":return as(i);case"day":case"days":return aa(i);case"week":case"weeks":return ao(i)}}}throw Error("Invalid DurationInput")},s3={_tag:"Millis",millis:0},s5={_tag:"Infinity"},s4={[sV]:sV,[ey](){return eR(this,eI(this.value))},[eT](e){return s8(e)&&ax(this,e)},toString(){return`Duration(${av(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:ah(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},s6=e=>{let t=Object.create(s4);return q(e)?isNaN(e)||e<=0?t.value=s3:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(1e6*e))}:t.value=s5:e<=sG?t.value=s3:t.value={_tag:"Nanos",nanos:e},t},s8=e=>X(e,sV),s7=e=>"Infinity"!==e.value._tag,s9=s6(0),ae=e=>s6(e),at=e=>s6(e*sZ),ar=e=>s6(e),an=e=>s6(1e3*e),ai=e=>s6(6e4*e),as=e=>s6(36e5*e),aa=e=>s6(864e5*e),ao=e=>s6(6048e5*e),al=e=>ap(e,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),ac=e=>ap(e,{onMillis:e=>e/1e3,onNanos:e=>Number(e)/1e9}),au=e=>{let t=s2(e);switch(t.value._tag){case"Infinity":throw Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(1e6*t.value.millis))}},ah=e=>{let t=s2(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/s0),Number(t.value.nanos%s0)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},ap=R(2,(e,t)=>{let r=s2(e);switch(r.value._tag){case"Nanos":return t.onNanos(r.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(r.value.millis)}}),af=R(3,(e,t,r)=>{let n=s2(e),i=s2(t);if("Infinity"===n.value._tag||"Infinity"===i.value._tag)return r.onMillis(al(n),al(i));if("Nanos"===n.value._tag||"Nanos"===i.value._tag){let e="Nanos"===n.value._tag?n.value.nanos:BigInt(Math.round(1e6*n.value.millis)),t="Nanos"===i.value._tag?i.value.nanos:BigInt(Math.round(1e6*i.value.millis));return r.onNanos(e,t)}return r.onMillis(n.value.millis,i.value.millis)}),ad=(e,t)=>af(e,t,{onMillis:(e,t)=>e===t,onNanos:(e,t)=>e===t}),am=R(2,(e,t)=>af(e,t,{onMillis:(e,t)=>s6(e+t),onNanos:(e,t)=>s6(e+t)})),ag=((e,t)=>af(e,t,{onMillis:(e,t)=>e<t,onNanos:(e,t)=>e<t}),R(2,(e,t)=>af(e,t,{onMillis:(e,t)=>e>t,onNanos:(e,t)=>e>t}))),ab=R(2,(e,t)=>af(e,t,{onMillis:(e,t)=>e>=t,onNanos:(e,t)=>e>=t})),ax=R(2,(e,t)=>ad(s2(e),s2(t))),ay=e=>{let t=s2(e);if("Infinity"===t.value._tag)return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};let r=au(t),n=r/sX,i=n/sZ,s=i/sQ,a=s/sQ;return{days:Number(a/sY),hours:Number(a%sY),minutes:Number(s%sQ),seconds:Number(i%sQ),millis:Number(n%sZ),nanos:Number(r%sX)}},av=e=>{let t=s2(e);if("Infinity"===t.value._tag)return"Infinity";let r=ay(t),n=[];return 0!==r.days&&n.push(`${r.days}d`),0!==r.hours&&n.push(`${r.hours}h`),0!==r.minutes&&n.push(`${r.minutes}m`),0!==r.seconds&&n.push(`${r.seconds}s`),0!==r.millis&&n.push(`${r.millis}ms`),0!==r.nanos&&n.push(`${r.nanos}ns`),n.join(" ")},a_=Symbol.for("effect/MutableRef"),aS={[a_]:a_,toString(){return eD(this.toJSON())},toJSON(){return{_id:"MutableRef",current:eP(this.current)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},aw=e=>{let t=Object.create(aS);return t.current=e,t},ak=R(3,(e,t,r)=>!!eN(t,e.current)&&(e.current=r,!0)),aC=e=>e.current,aE=R(2,(e,t)=>(e.current=t,e)),aO="effect/FiberId",aI=Symbol.for(aO),aF="None",aR="Runtime",aT="Composite",aN=eE(`${aO}-${aF}`);class aA{[aI]=aI;_tag=aF;id=-1;startTimeMillis=-1;[ey](){return aN}[eT](e){return aP(e)&&e._tag===aF}toString(){return eD(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[ez](){return this.toJSON()}}class aM{id;startTimeMillis;[aI]=aI;_tag=aR;constructor(e,t){this.id=e,this.startTimeMillis=t}[ey](){return eR(this,eE(`${aO}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[eT](e){return aP(e)&&e._tag===aR&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return eD(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[ez](){return this.toJSON()}}class aj{left;right;[aI]=aI;_tag=aT;constructor(e,t){this.left=e,this.right=t}_hash;[ey](){return z(eE(`${aO}-${this._tag}`),eS(ev(this.left)),eS(ev(this.right)),eR(this))}[eT](e){return aP(e)&&e._tag===aT&&eN(this.left,e.left)&&eN(this.right,e.right)}toString(){return eD(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:eP(this.left),right:eP(this.right)}}[ez](){return this.toJSON()}}let az=new aA,aP=e=>X(e,aI),aD=e=>e._tag===aF||z(aJ(e),iw(e=>aD(e))),aL=R(2,(e,t)=>e._tag===aF?t:t._tag===aF?e:new aj(e,t)),a$=R(2,(e,t)=>aD(e)?t:e),aU=e=>{switch(e._tag){case aF:return iv();case aR:return iM(e.id);case aT:return z(aU(e.left),iR(aU(e.right)))}},aq=$(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>aw(0)),aB=e=>Array.from(aU(e)).map(e=>`#${e}`).join(","),aJ=e=>{switch(e._tag){case aF:return iv();case aR:return iM(e);case aT:return z(aJ(e.left),iR(aJ(e.right)))}},aH=az,aK=(e,t)=>new aM(e,t),aW=(e,t)=>new aj(e,t),aV=()=>{let e=aC(aq);return z(aq,aE(e+1)),new aM(e,Date.now())},aG=e=>{let t=is(n4());for(let r of e)ie(t,r[0],r[1]);return ia(t)},aY=e=>e&&nB(e._root),aQ=Symbol.for("effect/List"),aZ=e=>rc(e),aX=tD(tL(eN),aZ),a0={[aQ]:aQ,_tag:"Cons",toString(){return eD(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:aZ(this).map(eP)}},[ez](){return this.toJSON()},[eT](e){return a5(e)&&this._tag===e._tag&&aX(this,e)},[ey](){return eR(this,eF(aZ(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if("Nil"===t._tag)return e=!0,this.return();let r=t.head;return t=t.tail,{done:e,value:r}},return:t=>(e||(e=!0),{done:!0,value:t})}},pipe(){return eV(this,arguments)}},a1=(e,t)=>{let r=Object.create(a0);return r.head=e,r.tail=t,r},a2=eE("Nil"),a3=Object.create({[aQ]:aQ,_tag:"Nil",toString(){return eD(this.toJSON())},toJSON:()=>({_id:"List",_tag:"Nil"}),[ez](){return this.toJSON()},[ey]:()=>a2,[eT](e){return a5(e)&&this._tag===e._tag},[Symbol.iterator]:()=>({next:()=>({done:!0,value:void 0})}),pipe(){return eV(this,arguments)}}),a5=e=>X(e,aQ),a4=e=>"Nil"===e._tag,a6=e=>"Cons"===e._tag,a8=(e,t)=>a1(e,t),a7=()=>a3,a9=e=>a1(e,a3),oe=R(2,(e,t)=>or(t,e)),ot=R(2,(e,t)=>a8(t,e)),or=R(2,(e,t)=>{if(a4(e))return t;if(a4(t))return e;{let r=a1(t.head,e),n=r,i=t.tail;for(;!a4(i);){let t=a1(i.head,e);n.tail=t,n=t,i=i.tail}return r}}),on=R(3,(e,t,r)=>{let n=t,i=e;for(;!a4(i);)n=r(n,i.head),i=i.tail;return n}),oi=e=>{let t=a7(),r=e;for(;!a4(r);)t=ot(t,r.head),r=r.tail;return t},os="Expected List to be non-empty",oa=e=>{if(a4(e))throw Error(os);return e.head},oo=e=>{if(a4(e))throw Error(os);return e.tail};Array.prototype;let ol=function(){function e(e){e&&Object.assign(this,e)}return e.prototype=ts,e}(),oc=e=>Object.assign(Object.create(ts),e),ou=Symbol.for("effect/DifferChunkPatch");function oh(e){return e}({...ol.prototype,[ou]:{_Value:oh,_Patch:oh}});let op=Symbol.for("effect/DifferContextPatch");function of(e){return e}let od={...ol.prototype,[op]:{_Value:of,_Patch:of}},om=Object.create(Object.assign(Object.create(od),{_tag:"Empty"})),og=()=>om,ob=Object.assign(Object.create(od),{_tag:"AndThen"}),ox=(e,t)=>{let r=Object.create(ob);return r.first=e,r.second=t,r},oy=Object.assign(Object.create(od),{_tag:"AddService"}),ov=(e,t)=>{let r=Object.create(oy);return r.key=e,r.service=t,r},o_=Object.assign(Object.create(od),{_tag:"RemoveService"}),oS=e=>{let t=Object.create(o_);return t.key=e,t},ow=Object.assign(Object.create(od),{_tag:"UpdateService"}),ok=(e,t)=>{let r=Object.create(ow);return r.key=e,r.update=t,r},oC=(e,t)=>{let r=new Map(e.unsafeMap),n=og();for(let[e,i]of t.unsafeMap.entries())if(r.has(e)){let t=r.get(e);r.delete(e),eN(t,i)||(n=oE(ok(e,()=>i))(n))}else r.delete(e),n=oE(ov(e,i))(n);for(let[e]of r.entries())n=oE(oS(e))(n);return n},oE=R(2,(e,t)=>ox(e,t)),oO=R(2,(e,t)=>{if("Empty"===e._tag)return t;let r=!1,n=nn(e),i=new Map(t.unsafeMap);for(;nk(n);){let e=nE(n),t=nT(n);switch(e._tag){case"Empty":n=t;break;case"AddService":i.set(e.key,e.service),n=t;break;case"AndThen":n=nf(nf(t,e.second),e.first);break;case"RemoveService":i.delete(e.key),n=t;break;case"UpdateService":i.set(e.key,e.update(i.get(e.key))),r=!0,n=t}}if(!r)return sR(i);let s=new Map;for(let[e]of t.unsafeMap)i.has(e)&&(s.set(e,i.get(e)),i.delete(e));for(let[e,t]of i)s.set(e,t);return sR(s)}),oI=Symbol.for("effect/DifferHashMapPatch");function oF(e){return e}({...ol.prototype,[oI]:{_Value:oF,_Key:oF,_Patch:oF}});let oR=Symbol.for("effect/DifferHashSetPatch");function oT(e){return e}let oN={...ol.prototype,[oR]:{_Value:oT,_Key:oT,_Patch:oT}},oA=Object.create(Object.assign(Object.create(oN),{_tag:"Empty"})),oM=()=>oA,oj=Object.assign(Object.create(oN),{_tag:"AndThen"}),oz=(e,t)=>{let r=Object.create(oj);return r.first=e,r.second=t,r},oP=Object.assign(Object.create(oN),{_tag:"Add"}),oD=e=>{let t=Object.create(oP);return t.value=e,t},oL=Object.assign(Object.create(oN),{_tag:"Remove"}),o$=e=>{let t=Object.create(oL);return t.value=e,t},oU=(e,t)=>{let[r,n]=iN([e,oM()],([e,t],r)=>i_(r)(e)?[iI(r)(e),t]:[e,oq(oD(r))(t)])(t);return iN(n,(e,t)=>oq(o$(t))(e))(r)},oq=R(2,(e,t)=>oz(e,t)),oB=R(2,(e,t)=>{if("Empty"===e._tag)return t;let r=t,n=nn(e);for(;nk(n);){let e=nE(n),t=nT(n);switch(e._tag){case"Empty":n=t;break;case"AndThen":n=nf(e.first)(nf(e.second)(t));break;case"Add":r=iO(e.value)(r),n=t;break;case"Remove":r=iI(e.value)(r),n=t}}return r}),oJ=Symbol.for("effect/DifferOrPatch");function oH(e){return e}let oK={...ol.prototype,[oJ]:{_Value:oH,_Key:oH,_Patch:oH}},oW=Object.create(Object.assign(Object.create(oK),{_tag:"Empty"})),oV=Object.assign(Object.create(oK),{_tag:"AndThen"}),oG=(e,t)=>{let r=Object.create(oV);return r.first=e,r.second=t,r},oY=Object.assign(Object.create(oK),{_tag:"SetLeft"}),oQ=Object.assign(Object.create(oK),{_tag:"SetRight"}),oZ=Object.assign(Object.create(oK),{_tag:"UpdateLeft"}),oX=Object.assign(Object.create(oK),{_tag:"UpdateRight"}),o0=((e,t)=>oG(e,t),Symbol.for("effect/DifferReadonlyArrayPatch"));function o1(e){return e}let o2={...ol.prototype,[o0]:{_Value:o1,_Patch:o1}},o3=Object.create(Object.assign(Object.create(o2),{_tag:"Empty"})),o5=()=>o3,o4=Object.assign(Object.create(o2),{_tag:"AndThen"}),o6=(e,t)=>{let r=Object.create(o4);return r.first=e,r.second=t,r},o8=Object.assign(Object.create(o2),{_tag:"Append"}),o7=e=>{let t=Object.create(o8);return t.values=e,t},o9=Object.assign(Object.create(o2),{_tag:"Slice"}),le=(e,t)=>{let r=Object.create(o9);return r.from=e,r.until=t,r},lt=Object.assign(Object.create(o2),{_tag:"Update"}),lr=(e,t)=>{let r=Object.create(lt);return r.index=e,r.patch=t,r},ln=e=>{let t=0,r=o5();for(;t<e.oldValue.length&&t<e.newValue.length;){let n=e.oldValue[t],i=e.newValue[t],s=e.differ.diff(n,i);eN(s,e.differ.empty)||(r=li(r,lr(t,s))),t+=1}return t<e.oldValue.length&&(r=li(r,le(0,t))),t<e.newValue.length&&(r=li(r,o7(rR(t)(e.newValue)))),r},li=R(2,(e,t)=>o6(e,t)),ls=R(3,(e,t,r)=>{if("Empty"===e._tag)return t;let n=t.slice(),i=rq(e);for(;t$(i);){let e=rk(i),t=rO(i);switch(e._tag){case"Empty":i=t;break;case"AndThen":t.unshift(e.first,e.second),i=t;break;case"Append":for(let t of e.values)n.push(t);i=t;break;case"Slice":n=n.slice(e.from,e.until),i=t;break;case"Update":n[e.index]=r.patch(e.patch,n[e.index]),i=t}}return n}),la={[Symbol.for("effect/Differ")]:{_P:T,_V:T}},lo=e=>{let t=Object.create(la);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},ll=()=>lo({empty:og(),combine:(e,t)=>oE(t)(e),diff:(e,t)=>oC(e,t),patch:(e,t)=>oO(t)(e)}),lc=()=>lo({empty:oM(),combine:(e,t)=>oq(t)(e),diff:(e,t)=>oU(e,t),patch:(e,t)=>oB(t)(e)}),lu=e=>lo({empty:o5(),combine:(e,t)=>li(e,t),diff:(t,r)=>ln({oldValue:t,newValue:r,differ:e}),patch:(t,r)=>ls(t,r,e)}),lh=()=>lp((e,t)=>t),lp=e=>lo({empty:T,combine:(e,t)=>e===T?t:t===T?e:r=>t(e(r)),diff:(e,t)=>eN(e,t)?T:N(t),patch:(t,r)=>e(r,t(r))}),lf=e=>255&e,ld=e=>e>>8&255,lm=(e,t)=>(255&e)+((t&e&255)<<8),lg=lm(0,0),lb=R(2,(e,t)=>lm(lf(e)&~t,ld(e))),lx=R(2,(e,t)=>e|t),ly=e=>~e>>>0&255,lv=e=>lk(e,32),l_=((e,t)=>e&~t,R(2,(e,t)=>e|t)),lS=e=>lw(e)&&!lI(e),lw=e=>lk(e,1),lk=R(2,(e,t)=>(e&t)!=0),lC=(...e)=>e.reduce((e,t)=>e|t,0),lE=lC(0),lO=e=>lk(e,4),lI=e=>lk(e,16),lF=R(2,(e,t)=>lm(e^t,t)),lR=R(2,(e,t)=>e&(ly(lf(t))|ld(t))|lf(t)&ld(t)),lT=lo({empty:lg,diff:(e,t)=>lF(e,t),combine:(e,t)=>lx(t)(e),patch:(e,t)=>lR(t,e)}),lN=e=>lm(e,e),lA=e=>lm(e,0),lM="Pending",lj="Done",lz=Symbol.for("effect/Deferred"),lP={_E:e=>e,_A:e=>e},lD=e=>({_tag:lM,joiners:e}),lL=e=>({_tag:lj,effect:e});class l${self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new l$(this.self)}}let lU=Symbol.for("effect/EffectError"),lq=e=>X(e,lU),lB=e=>({[lU]:lU,_tag:"EffectError",cause:e}),lJ=(e,t)=>{let r=new lV("Blocked");return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r},lH=e=>{let t=new lV("RunBlocked");return t.effect_instruction_i0=e,t},lK=Symbol.for("effect/Effect");class lW{patch;op;_op=e7;constructor(e,t){this.patch=e,this.op=t}}class lV{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[lK]=tn;constructor(e){this._op=e}[eT](e){return this===e}[ey](){return eR(this,e_(this))}pipe(){return eV(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:eP(this.effect_instruction_i0),effect_instruction_i1:eP(this.effect_instruction_i1),effect_instruction_i2:eP(this.effect_instruction_i2)}}toString(){return eD(this.toJSON())}[ez](){return this.toJSON()}[Symbol.iterator](){return new l$(new ep(this))}}class lG{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[lK]=tn;constructor(e){this._op=e,this._tag=e}[eT](e){return u4(e)&&"Failure"===e._op&&eN(this.effect_instruction_i0,e.effect_instruction_i0)}[ey](){return z(eE(this._tag),eS(ev(this.effect_instruction_i0)),eR(this))}get cause(){return this.effect_instruction_i0}pipe(){return eV(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return eD(this.toJSON())}[ez](){return this.toJSON()}[Symbol.iterator](){return new l$(new ep(this))}}class lY{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[lK]=tn;constructor(e){this._op=e,this._tag=e}[eT](e){return u4(e)&&"Success"===e._op&&eN(this.effect_instruction_i0,e.effect_instruction_i0)}[ey](){return z(eE(this._tag),eS(ev(this.effect_instruction_i0)),eR(this))}get value(){return this.effect_instruction_i0}pipe(){return eV(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:eP(this.value)}}toString(){return eD(this.toJSON())}[ez](){return this.toJSON()}[Symbol.iterator](){return new l$(new ep(this))}}let lQ=e=>X(e,lK),lZ=e=>{let t=new lV(e6);return t.effect_instruction_i0=e,t},lX=R(3,(e,t,r)=>cq(n=>cp(e,e=>cp(cs(cz(()=>n(t(e)))),t=>cz(()=>r(e,t)).pipe(cb({onFailure:e=>{switch(t._tag){case eQ:return cl(iG(t.effect_instruction_i0,e));case e1:return cl(e)}},onSuccess:()=>t})))))),l0=R(2,(e,t)=>cp(e,()=>cj(t))),l1=e=>l0(e,void 0),l2=function(){let e=new lV(eY);switch(arguments.length){case 2:e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break;case 3:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break;case 4:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break;default:throw Error(eo("you're not supposed to end up here"))}return e},l3=(e,t=aH)=>{let r;let n=new lV(eG);return n.effect_instruction_i0=t=>{r=e(t)},n.effect_instruction_i1=t,cR(n,e=>lQ(r)?r:cB)},l5=(e,t=aH)=>cz(()=>l3(e,t)),l4=(e,t=aH)=>l2(e,function(){let e,r,n,i;function s(t){e?e(t):void 0===r&&(r=t)}let a=new lV(eG);return a.effect_instruction_i0=t=>{e=t,r&&t(r)},a.effect_instruction_i1=t,1!==this.effect_instruction_i0.length?(i=new AbortController,n=em(()=>this.effect_instruction_i0(s,i.signal))):n=em(()=>this.effect_instruction_i0(s)),n||i?cR(a,e=>(i&&i.abort(),n??cB)):a}),l6=R(2,(e,t)=>{let r=new lV(eZ);return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r}),l8=R(2,(e,t)=>cx(e,{onFailure:t,onSuccess:cj})),l7=R(3,(e,t,r)=>l6(e,e=>{let n=i4(e);switch(n._tag){case"Left":return t(n.left)?r(n.left):cl(e);case"Right":return cl(n.right)}})),l9=Symbol.for("effect/SpanAnnotation"),ce=Symbol.for("effect/OriginalAnnotation"),ct=(e,t)=>tb(t)?new Proxy(e,{has:(e,t)=>t===l9||t===ce||t in e,get:(r,n)=>n===l9?t.value:n===ce?e:r[n]}):e,cr=e=>!Z(e)||l9 in e?cl(iK(e)):lZ(t=>cl(iK(ct(e,hA(t))))),cn=e=>cc(()=>iK(new uK(e))),ci=e=>cx(e,{onFailure:e=>cj(tO(e)),onSuccess:e=>cj(tI(e))}),cs=e=>cg(e,{onFailure:hn,onSuccess:hu}),ca=e=>!Z(e)||l9 in e?cl(iH(e)):lZ(t=>cl(iH(ct(e,hA(t))))),co=e=>cp(cP(e),ca),cl=e=>{let t=new lG(eQ);return t.effect_instruction_i0=e,t},cc=e=>cp(cP(e),cl),cu=lZ(e=>cj(e.id())),ch=e=>lZ(t=>e(t.id())),cp=R(2,(e,t)=>{let r=new lV(eX);return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r}),cf=R(2,(e,t)=>cp(e,e=>{let r="function"==typeof t?t(e):t;return lQ(r)?r:ea(r)?l3(e=>{r.then(t=>e(cj(t)),t=>e(ca(new u5(t))))}):cj(r)})),cd=e=>{let t=new lV("OnStep");return t.effect_instruction_i0=e,t},cm=e=>cp(e,T),cg=R(2,(e,t)=>cb(e,{onFailure:e=>cj(t.onFailure(e)),onSuccess:e=>cj(t.onSuccess(e))})),cb=R(2,(e,t)=>{let r=new lV(e0);return r.effect_instruction_i0=e,r.effect_instruction_i1=t.onFailure,r.effect_instruction_i2=t.onSuccess,r}),cx=R(2,(e,t)=>cb(e,{onFailure:e=>{if(i2(e).length>0)return cl(i9(e));let r=i1(e);return r.length>0?t.onFailure(nE(r)):cl(e)},onSuccess:t.onSuccess})),cy=R(2,(e,t)=>cz(()=>{let r=rc(e),n=ro(r.length),i=0;return l0(cK({while:()=>i<r.length,body:()=>t(r[i],i),step:e=>{n[i++]=e}}),n)})),cv=R(2,(e,t)=>cz(()=>{let r=rc(e),n=0;return cK({while:()=>n<r.length,body:()=>t(r[n],n),step:()=>{n++}})})),c_=R(e=>"boolean"==typeof e[0]||lQ(e[0]),(e,t)=>lQ(e)?cp(e,e=>e?t.onTrue():t.onFalse()):e?t.onTrue():t.onFalse()),cS=cp(cu,e=>cw(e)),cw=e=>cl(iW(e)),ck=e=>{let t=new lV(e3);return t.effect_instruction_i0=lN(1),t.effect_instruction_i1=()=>e,t},cC=R(2,(e,t)=>cq(r=>cp(cs(r(e)),e=>h_(t,e)))),cE=R(2,(e,t)=>cp(e,e=>cP(()=>t(e)))),cO=R(2,(e,t)=>cx(e,{onFailure:e=>co(()=>t.onFailure(e)),onSuccess:e=>cP(()=>t.onSuccess(e))})),cI=R(2,(e,t)=>cb(e,{onFailure:e=>{let r=i4(e);switch(r._tag){case"Left":return co(()=>t(r.left));case"Right":return cl(r.right)}},onSuccess:cj})),cF=((e,t)=>cF(e,e=>u8(e)?cB:t(e.effect_instruction_i0)),R(2,(e,t)=>cq(r=>cb(r(e),{onFailure:e=>{let r=hn(e);return cb(t(r),{onFailure:t=>hn(iG(e,t)),onSuccess:()=>r})},onSuccess:e=>{let r=hu(e);return cZ(t(r),r)}})))),cR=R(2,(e,t)=>cF(e,hl({onFailure:e=>i0(e)?l1(t(i3(e))):cB,onSuccess:()=>cB}))),cT=R(2,(e,t)=>c$(e,t,cj)),cN=e=>cA(e,T),cA=R(2,(e,t)=>cx(e,{onFailure:e=>cr(t(e)),onSuccess:cj})),cM=lZ((e,t)=>cj(t.runtimeFlags)),cj=e=>{let t=new lY(e1);return t.effect_instruction_i0=e,t},cz=e=>{let t=new lV(eY);return t.commit=e,t},cP=e=>{let t=new lV(e2);return t.effect_instruction_i0=e,t},cD=R(e=>3===e.length||2===e.length&&!(Z(e[1])&&"onlyEffect"in e[1]),(e,t)=>cp(e,e=>{let r="function"==typeof t?t(e):t;return lQ(r)?l0(r,e):ea(r)?l3(t=>{r.then(r=>t(cj(e)),e=>t(ca(new u5(e))))}):cj(e)})),cL=e=>lZ(t=>{let r=z(t.getFiberRef(uR),tB(()=>t.scope()));return e(up(uR,ty(r)))}),c$=R(3,(e,t,r)=>cb(e,{onFailure:e=>i2(e).length>0?cl(tG(i8(e))):t(),onSuccess:r})),cU=e=>{let t=new lV(e3);return t.effect_instruction_i0=lA(1),t.effect_instruction_i1=()=>e,t},cq=e=>l2(e,function(){let e=new lV(e3);return e.effect_instruction_i0=lA(1),e.effect_instruction_i1=e=>lw(e)?em(()=>this.effect_instruction_i0(ck)):em(()=>this.effect_instruction_i0(cU)),e}),cB=cj(void 0),cJ=e=>{let t=new lV(e3);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},cH=R(2,(e,t)=>cp(t,t=>t?z(e,cE(ty)):cj(tU()))),cK=e=>{let t=new lV(e5);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},cW=e=>cz(()=>{let t=new lV(e4);return t.effect_instruction_i0=e(),t}),cV=R(2,(e,t)=>{let r=new lV(e3);return r.effect_instruction_i0=t,r.effect_instruction_i1=()=>e,r}),cG=e=>{let t=new lV(e8);return void 0!==e?.priority?uC(t,e.priority):t},cY=R(2,(e,t)=>cp(e,e=>cE(t,t=>[e,t]))),cQ=R(2,(e,t)=>cp(e,e=>l0(t,e))),cZ=R(2,(e,t)=>cp(e,()=>t)),cX=R(3,(e,t,r)=>cp(e,e=>cE(t,t=>r(e,t)))),c0=(()=>{let e=setInterval(()=>{},2147483648-1);return cP(()=>clearInterval(e))},e=>cp(cu,t=>z(e,c1(t)))),c1=R(2,(e,t)=>cp(e.interruptAsFork(t),()=>e.await)),c2={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return eV(this,arguments)}},c3={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return eV(this,arguments)}},c5={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return eV(this,arguments)}},c4={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return eV(this,arguments)}},c6={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return eV(this,arguments)}},c8={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return eV(this,arguments)}},c7={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return eV(this,arguments)}},c9={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return eV(this,arguments)}},ue=[c2,c7,c8,c6,c4,c5,c3,c9],ut=Symbol.for("effect/FiberRef"),ur={_A:e=>e},un=e=>lZ(t=>hu(t.getFiberRef(e))),ui=R(2,(e,t)=>cp(un(e),t)),us=R(2,(e,t)=>ua(e,()=>[void 0,t])),ua=R(2,(e,t)=>lZ(r=>{let[n,i]=t(r.getFiberRef(e));return r.setFiberRef(e,i),cj(n)})),uo=R(2,(e,t)=>ua(e,e=>[void 0,t(e)])),ul=Symbol.for("effect/RequestResolver"),uc={_A:e=>e,_R:e=>e};class uu{runAll;target;[ul]=uc;constructor(e,t){this.runAll=e,this.target=t}[ey](){return eR(this,this.target?ev(this.target):e_(this))}[eT](e){return this.target?uh(e)&&eN(this.target,e.target):this===e}identified(...e){return new uu(this.runAll,ni(e))}pipe(){return eV(this,arguments)}}let uh=e=>X(e,ul),up=R(3,(e,t,r)=>lX(cQ(un(t),us(t,r)),()=>e,e=>us(t,e))),uf=R(3,(e,t,r)=>ui(t,n=>up(e,t,r(n)))),ud=(e,t)=>ux(e,{differ:lh(),fork:t?.fork??T,join:t?.join}),um=e=>{let t=lc();return ux(e,{differ:t,fork:t.empty})},ug=e=>{let t=lu(lh());return ux(e,{differ:t,fork:t.empty})},ub=e=>{let t=ll();return ux(e,{differ:t,fork:t.empty})},ux=(e,t)=>({...ta,[ut]:ur,initial:e,commit(){return un(this)},diff:(e,r)=>t.differ.diff(e,r),combine:(e,r)=>t.differ.combine(e,r),patch:e=>r=>t.differ.patch(e,r),fork:t.fork,join:t.join??((e,t)=>t)}),uy=$(Symbol.for("effect/FiberRef/currentContext"),()=>ub(sH())),uv=$(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>ud(0)),u_=$(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>ud(2048)),uS=$(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>ud(n4())),uw=$(Symbol.for("effect/FiberRef/currentLogLevel"),()=>ud(c6)),uk=$(Symbol.for("effect/FiberRef/currentLogSpan"),()=>ud(a7())),uC=R(2,(e,t)=>up(e,uv,t)),uE=$(Symbol.for("effect/FiberRef/currentConcurrency"),()=>ud("unbounded")),uO=$(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>ud(!0)),uI=$(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>ud(ty(c8))),uF=$(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>ug(rU())),uR=$(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>ud(tU(),{fork:()=>tU(),join:(e,t)=>e})),uT=$(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>ud(iJ,{fork:()=>iJ,join:(e,t)=>e})),uN=$(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>ud(!0)),uA=$(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>ud(!0)),uM=$(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>ud(n4())),uj=$(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>ud(nt())),uz=Symbol.for("effect/Scope"),uP=Symbol.for("effect/CloseableScope"),uD=(e,t)=>e.addFinalizer(()=>l1(t)),uL=(e,t)=>e.addFinalizer(t),u$=(e,t)=>e.close(t),uU=(e,t)=>e.fork(t),uq=R(2,(e,t)=>{let r=z(e,i5,tY(t));switch(r._tag){case"None":return z(i2(e),nC,tq({onNone:()=>{let t=rc(i3(e)).flatMap(e=>rc(aU(e)).map(e=>`#${e}`));return new uV(t?`Interrupted by fibers: ${t.join(", ")}`:void 0)},onSome:T}));case"Some":return r.value}}),uB=function(){class e extends globalThis.Error{commit(){return ca(this)}toJSON(){return{...this}}[ez](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split("\n").slice(1).join("\n")}`:this.toString():"Bun"in globalThis?sd(iH(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,to),e}(),uJ=(e,t)=>{class r extends uB{_tag=t}return Object.assign(r.prototype,e),r.prototype.name=t,r},uH=Symbol.for("effect/Cause/errors/RuntimeException"),uK=uJ({[uH]:uH},"RuntimeException"),uW=Symbol.for("effect/Cause/errors/InterruptedException"),uV=uJ({[uW]:uW},"InterruptedException"),uG=e=>X(e,uW),uY=Symbol.for("effect/Cause/errors/IllegalArgument"),uQ=uJ({[uY]:uY},"IllegalArgumentException"),uZ=Symbol.for("effect/Cause/errors/NoSuchElement"),uX=uJ({[uZ]:uZ},"NoSuchElementException"),u0=Symbol.for("effect/Cause/errors/InvalidPubSubCapacityException"),u1=uJ({[u0]:u0},"InvalidPubSubCapacityException"),u2=Symbol.for("effect/Cause/errors/Timeout"),u3=Symbol.for("effect/Cause/errors/UnknownException"),u5=function(){class e extends uB{cause;_tag="UnknownException";error;constructor(e,t){super(t??"An unknown error occurred",{cause:e}),this.cause=e,this.error=e}}return Object.assign(e.prototype,{[u3]:u3,name:"UnknownException"}),e}(),u4=e=>lQ(e)&&"_tag"in e&&("Success"===e._tag||"Failure"===e._tag),u6=e=>"Failure"===e._tag,u8=e=>"Success"===e._tag,u7=R(2,(e,t)=>{switch(e._tag){case eQ:return hn(e.effect_instruction_i0);case e1:return hu(t)}}),u9=e=>u7(e,void 0),he=(e,t)=>hm(e,t?.parallel?iV:iG),ht=e=>hn(iK(e)),hr=e=>hn(iH(e)),hn=e=>{let t=new lG(eQ);return t.effect_instruction_i0=e,t},hi=R(2,(e,t)=>{switch(e._tag){case eQ:return hn(e.effect_instruction_i0);case e1:return t(e.effect_instruction_i0)}}),hs=R(2,(e,t)=>{switch(e._tag){case eQ:return cj(hn(e.effect_instruction_i0));case e1:return cs(t(e.effect_instruction_i0))}}),ha=e=>hn(iW(e)),ho=R(2,(e,t)=>{switch(e._tag){case eQ:return hn(e.effect_instruction_i0);case e1:return hu(t(e.effect_instruction_i0))}}),hl=R(2,(e,{onFailure:t,onSuccess:r})=>{switch(e._tag){case eQ:return t(e.effect_instruction_i0);case e1:return r(e.effect_instruction_i0)}}),hc=R(2,(e,{onFailure:t,onSuccess:r})=>{switch(e._tag){case eQ:return t(e.effect_instruction_i0);case e1:return r(e.effect_instruction_i0)}}),hu=e=>{let t=new lY(e1);return t.effect_instruction_i0=e,t},hh=hu(void 0),hp=R(2,(e,t)=>hd(e,t,{onSuccess:(e,t)=>[e,t],onFailure:iG})),hf=R(2,(e,t)=>hd(e,t,{onSuccess:(e,t)=>t,onFailure:iG})),hd=R(3,(e,t,{onFailure:r,onSuccess:n})=>{switch(e._tag){case eQ:switch(t._tag){case e1:return hn(e.effect_instruction_i0);case eQ:return hn(r(e.effect_instruction_i0,t.effect_instruction_i0))}case e1:switch(t._tag){case e1:return hu(n(e.effect_instruction_i0,t.effect_instruction_i0));case eQ:return hn(t.effect_instruction_i0)}}}),hm=(e,t)=>{let r=ni(e);return nk(r)?z(nT(r),rQ(z(nE(r),ho(nn)),(e,r)=>z(e,hd(r,{onSuccess:(e,t)=>z(e,nf(t)),onFailure:t}))),ho(no),ho(e=>na(e)),ty):tU()},hg=e=>({...ta,[lz]:lP,state:aw(lD([])),commit(){return hy(this)},blockingOn:e}),hb=()=>cp(cu,e=>hx(e)),hx=e=>cP(()=>hg(e)),hy=e=>l5(t=>{let r=aC(e.state);switch(r._tag){case lj:return t(r.effect);case lM:return r.joiners.push(t),hE(e,t)}},e.blockingOn),hv=R(2,(e,t)=>cP(()=>{let r=aC(e.state);switch(r._tag){case lj:return!1;case lM:aE(e.state,lL(t));for(let e=0,n=r.joiners.length;e<n;e++)r.joiners[e](t);return!0}})),h_=R(2,(e,t)=>hv(e,t)),hS=((e,t)=>hv(e,ca(t)),R(2,(e,t)=>hv(e,cl(t)))),hw=R(2,(e,t)=>hv(e,cw(t))),hk=R(2,(e,t)=>hv(e,cj(t))),hC=(e,t)=>{let r=aC(e.state);if(r._tag===lM){aE(e.state,lL(t));for(let e=0,n=r.joiners.length;e<n;e++)r.joiners[e](t)}},hE=(e,t)=>cP(()=>{let r=aC(e.state);if(r._tag===lM){let e=r.joiners.indexOf(t);e>=0&&r.joiners.splice(e,1)}}),hO=lZ(e=>hu(e.currentContext)),hI=()=>hO,hF=e=>cp(hI(),e),hR=R(2,(e,t)=>up(uy,t)(e)),hT=R(2,(e,t)=>uf(uy,e=>sq(e,t))(e)),hN=R(2,(e,t)=>hF(r=>hR(e,t(r)))),hA=e=>{let t=e.currentSpan;return void 0!==t&&"Span"===t._tag?ty(t):tU()},hM={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:hh},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},hj=e=>Object.assign(Object.create(hM),e),hz=Symbol.for("effect/Clock"),hP=sB("effect/Clock"),hD=2147483648-1,hL={unsafeSchedule(e,t){let r=al(t);if(r>hD)return M;let n=!1,i=setTimeout(()=>{n=!0,e()},r);return()=>(clearTimeout(i),!n)}},h$=function(){let e=BigInt(1e6);if("undefined"==typeof performance)return()=>BigInt(Date.now())*e;if("number"==typeof performance.timeOrigin&&0===performance.timeOrigin)return()=>BigInt(Math.round(1e6*performance.now()));let t=BigInt(Date.now())*e-BigInt(Math.round(1e6*performance.now()));return()=>t+BigInt(Math.round(1e6*performance.now()))}(),hU=function(){let e="object"==typeof process&&"hrtime"in process&&"function"==typeof process.hrtime.bigint?process.hrtime:void 0;if(!e)return h$;let t=h$()-e.bigint();return()=>t+e.bigint()}();class hq{[hz]=hz;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return hU()}currentTimeMillis=cP(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=cP(()=>this.unsafeCurrentTimeNanos());scheduler(){return cj(hL)}sleep(e){return l4(t=>l1(cP(hL.unsafeSchedule(()=>t(cB),e))))}}let hB=e=>Math.max(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))),2),hJ=e=>{if("NaN"===e)return ty(NaN);if("Infinity"===e)return ty(1/0);if("-Infinity"===e)return ty(-1/0);if(""===e.trim())return tx;let t=Number(e);return Number.isNaN(t)?tx:ty(t)},hH=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),hK="InvalidData",hW="MissingData",hV="SourceUnavailable",hG="Unsupported",hY=Symbol.for("effect/ConfigError"),hQ={_tag:"ConfigError",[hY]:hY},hZ=(e,t)=>{let r=Object.create(hQ);return r._op="And",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),r},hX=(e,t)=>{let r=Object.create(hQ);return r._op="Or",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),r},h0=(e,t,r={pathDelim:"."})=>{let n=Object.create(hQ);return n._op=hK,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){let e=z(this.path,r2(r.pathDelim));return`(Invalid data at ${e}: "${this.message}")`}}),n},h1=(e,t,r={pathDelim:"."})=>{let n=Object.create(hQ);return n._op=hW,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){let e=z(this.path,r2(r.pathDelim));return`(Missing data at ${e}: "${this.message}")`}}),n},h2=(e,t,r,n={pathDelim:"."})=>{let i=Object.create(hQ);return i._op=hV,i.path=e,i.message=t,i.cause=r,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=z(this.path,r2(n.pathDelim));return`(Source unavailable at ${e}: "${this.message}")`}}),i},h3=(e,t,r={pathDelim:"."})=>{let n=Object.create(hQ);return n._op=hG,n.path=e,n.message=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){let e=z(this.path,r2(r.pathDelim));return`(Unsupported operation at ${e}: "${this.message}")`}}),n},h5=R(2,(e,t)=>{switch(e._op){case"And":return hZ(h5(e.left,t),h5(e.right,t));case"Or":return hX(h5(e.left,t),h5(e.right,t));case hK:return h0([...t,...e.path],e.message);case hW:return h1([...t,...e.path],e.message);case hV:return h2([...t,...e.path],e.message,e.cause);case hG:return h3([...t,...e.path],e.message)}}),h4={andCase:(e,t,r)=>t&&r,orCase:(e,t,r)=>t&&r,invalidDataCase:M,missingDataCase:A,sourceUnavailableCase:M,unsupportedCase:M},h6=R(3,(e,t,r)=>{let n=[e],i=[];for(;n.length>0;){let e=n.pop();switch(e._op){case"And":n.push(e.right),n.push(e.left),i.push(tO({_op:"AndCase"}));break;case"Or":n.push(e.right),n.push(e.left),i.push(tO({_op:"OrCase"}));break;case hK:i.push(tI(r.invalidDataCase(t,e.path,e.message)));break;case hW:i.push(tI(r.missingDataCase(t,e.path,e.message)));break;case hV:i.push(tI(r.sourceUnavailableCase(t,e.path,e.message,e.cause)));break;case hG:i.push(tI(r.unsupportedCase(t,e.path,e.message)))}}let s=[];for(;i.length>0;){let e=i.pop();switch(e._op){case"Left":switch(e.left._op){case"AndCase":{let e=s.pop(),n=s.pop(),i=r.andCase(t,e,n);s.push(i);break}case"OrCase":{let e=s.pop(),n=s.pop(),i=r.orCase(t,e,n);s.push(i)}}break;case"Right":s.push(e.right)}}if(0===s.length)throw Error("BUG: ConfigError.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return s.pop()}),h8={_tag:"Empty"},h7=R(2,(e,t)=>({_tag:"AndThen",first:e,second:t})),h9=R(2,(e,t)=>h7(e,{_tag:"MapName",f:t})),pe=R(2,(e,t)=>h7(e,{_tag:"Nested",name:t})),pt=R(2,(e,t)=>h7(e,{_tag:"Unnested",name:t})),pr=R(2,(e,t)=>{let r=a9(t),n=e;for(;a6(r);){let e=r.head;switch(e._tag){case"Empty":r=r.tail;break;case"AndThen":r=a8(e.first,a8(e.second,r.tail));break;case"MapName":n=rB(n,e.f),r=r.tail;break;case"Nested":n=rf(n,e.name),r=r.tail;break;case"Unnested":if(!z(rw(n),t2(e.name)))return tO(h1(n,`Expected ${e.name} to be in path in ConfigProvider#unnested`));n=rO(n),r=r.tail}}return tI(n)}),pn="Constant",pi="Fallback",ps="Lazy",pa="MapOrFail",po="Nested",pl="Primitive",pc="ZipWith",pu=e=>e.toLowerCase(),ph=e=>e.toUpperCase(),pp=(e,t,r)=>t instanceof RegExp?e.replace(t,r):t.reduce((e,t)=>e.replace(t,r),e),pf=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],pd=/[^A-Z0-9]+/gi,pm=(e,t={})=>{let{delimiter:r=" ",splitRegexp:n=pf,stripRegexp:i=pd,transform:s=pu}=t,a=pp(pp(e,n,"$1\0$2"),i,"\0"),o=0,l=a.length;for(;"\0"===a.charAt(o);)o++;for(;"\0"===a.charAt(l-1);)l--;return a.slice(o,l).split("\0").map(s).join(r)},pg=(e,t)=>pm(e,{delimiter:"_",transform:ph,...t}),pb=(e,t)=>[...e,...t],px=Symbol.for("effect/ConfigProvider"),py=sB("effect/ConfigProvider"),pv=Symbol.for("effect/ConfigProviderFlat"),p_=e=>({[px]:px,pipe(){return eV(this,arguments)},...e}),pS=e=>({[pv]:pv,patch:e.patch,load:(t,r,n=!0)=>e.load(t,r,n),enumerateChildren:e.enumerateChildren}),pw=e=>p_({load:t=>cp(pI(e,rU(),t,!1),e=>tq(rw(e),{onNone:()=>ca(h1(rU(),`Expected a single value having structure: ${t}`)),onSome:cj})),flattened:e}),pk=e=>{let{pathDelim:t,seqDelim:r}=Object.assign({},{pathDelim:"_",seqDelim:","},e),n=e=>z(e,r2(t)),i=e=>e.split(t),s=()=>"undefined"!=typeof process&&"env"in process&&"object"==typeof process.env?process.env:{};return pw(pS({load:(e,t,i=!0)=>{let a=n(e),o=s();return z(a in o?ty(o[a]):tU(),cI(()=>h1(e,`Expected ${a} to exist in the process context`)),cp(n=>pz(n,e,t,r,i)))},enumerateChildren:e=>cP(()=>iA(Object.keys(s()).map(e=>i(e.toUpperCase())).filter(t=>{for(let r=0;r<e.length;r++){let n=z(e,rS(r)),i=t[r];if(void 0===i||n!==i)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:h8}))},pC=(e,t)=>{let{pathDelim:r,seqDelim:n}=Object.assign({seqDelim:",",pathDelim:"."},t),i=e=>z(e,r2(r)),s=e=>e.split(r),a=pq(e,e=>s(e),i);return pw(pS({load:(e,t,r=!0)=>{let s=i(e);return z(a.has(s)?ty(a.get(s)):tU(),cI(()=>h1(e,`Expected ${s} to exist in the provided map`)),cp(i=>pz(i,e,t,n,r)))},enumerateChildren:e=>cP(()=>iA(rc(a.keys()).map(s).filter(t=>{for(let r=0;r<e.length;r++){let n=z(e,rS(r)),i=t[r];if(void 0===i||n!==i)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:h8}))},pE=(e,t,r,n)=>{let i=rX(r.length,t=>t>=n.length?tU():ty([e(t),t+1])),s=rX(n.length,e=>e>=r.length?tU():ty([t(e),e+1]));return[pb(r,i),pb(n,s)]},pO=(e,t)=>{let r=t;if("Nested"===r._tag){let t=e.slice();for(;"Nested"===r._tag;)t.push(r.name),r=r.config;return t}return e},pI=(e,t,r,n)=>{switch(r._tag){case pn:return cj(rq(r.value));case"Described":return cz(()=>pI(e,t,r.config,n));case"Fail":return ca(h1(t,r.message));case pi:return z(cz(()=>pI(e,t,r.first,n)),l8(i=>r.condition(i)?z(pI(e,t,r.second,n),l8(e=>ca(hX(i,e)))):ca(i)));case ps:return cz(()=>pI(e,t,r.config(),n));case pa:return cz(()=>z(pI(e,t,r.original,n),cp(cy(e=>z(r.mapOrFail(e),cI(h5(pO(t,r.original))))))));case po:return cz(()=>pI(e,pb(t,rq(r.name)),r.config,n));case pl:return z(pr(t,e.patch),cp(t=>z(e.load(t,r,n),cp(e=>{if(0===e.length){let e=z(rC(t),tB(()=>"<n/a>"));return ca(h1([],`Expected ${r.description} with name ${e}`))}return cj(e)}))));case"Sequence":return z(pr(t,e.patch),cp(n=>z(e.enumerateChildren(n),cp(pD),cp(n=>0===n.length?cz(()=>cE(pI(e,t,r.config,!0),rq)):z(cy(n,n=>pI(e,rd(t,`[${n}]`),r.config,!0)),cE(e=>{let t=rH(e);return 0===t.length?rq(rU()):rq(t)}))))));case"HashMap":return cz(()=>z(pr(t,e.patch),cp(t=>z(e.enumerateChildren(t),cp(i=>z(i,cy(i=>pI(e,pb(t,rq(i)),r.valueConfig,n)),cE(e=>0===e.length?rq(n4()):z(pP(e),rB(e=>aG(rA(rc(i),e)))))))))));case pc:return cz(()=>z(pI(e,t,r.left,n),ci,cp(i=>z(pI(e,t,r.right,n),ci,cp(e=>{if(tC(i)&&tC(e))return ca(hZ(i.left,e.left));if(tC(i)&&tE(e))return ca(i.left);if(tE(i)&&tC(e))return ca(e.left);if(tE(i)&&tE(e)){let n=z(t,r2(".")),s=pF(t,n),[a,o]=pE(s,s,z(i.right,rB(tI)),z(e.right,rB(tI)));return z(a,rA(o),cy(([e,t])=>z(cY(e,t),cE(([e,t])=>r.zip(e,t)))))}throw Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},pF=(e,t)=>r=>tO(h1(e,`The element at index ${r} in a sequence at path "${t}" was missing`)),pR=R(2,(e,t)=>pw(pT(e.flattened,t))),pT=(e,t)=>pS({load:(t,r,n=!0)=>e.load(t,r,n),enumerateChildren:t=>e.enumerateChildren(t),patch:h9(e.patch,t)}),pN=R(2,(e,t)=>pw(pS({load:(t,r)=>e.flattened.load(t,r,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:pe(e.flattened.patch,t)}))),pA=((e,t)=>pw(pS({load:(t,r)=>e.flattened.load(t,r,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:pt(e.flattened.patch,t)})),R(2,(e,t)=>pw(pM(e.flattened,()=>t().flattened)))),pM=(e,t)=>pS({load:(r,n,i)=>z(pr(r,e.patch),cp(t=>e.load(t,n,i)),l8(e=>z(cP(t),cp(t=>z(pr(r,t.patch),cp(e=>t.load(e,n,i)),l8(t=>ca(hX(e,t)))))))),enumerateChildren:r=>z(pr(r,e.patch),cp(t=>e.enumerateChildren(t)),ci,cp(e=>z(cP(t),cp(t=>z(pr(r,t.patch),cp(e=>t.enumerateChildren(e)),ci,cp(t=>{if(tC(e)&&tC(t))return ca(hZ(e.left,t.left));if(tC(e)&&tE(t))return cj(t.right);if(tE(e)&&tC(t))return cj(e.right);if(tE(e)&&tE(t))return cj(z(e.right,iR(t.right)));throw Error("BUG: ConfigProvider.orElseFlat - please report an issue at https://github.com/Effect-TS/effect/issues")})))))),patch:h8}),pj=(e,t)=>e.split(RegExp(`\\s*${hH(t)}\\s*`)),pz=(e,t,r,n,i)=>i?z(pj(e,n),cy(e=>r.parse(e.trim())),cI(h5(t))):z(r.parse(e),cO({onFailure:h5(t),onSuccess:rq})),pP=e=>Object.keys(e[0]).map(t=>e.map(e=>e[t])),pD=e=>z(cy(e,pU),cO({onFailure:()=>rU(),onSuccess:rN(t8)}),ci,cE(tM)),pL=/(^.+)(\[(\d+)\])$/,p$=/^(\[(\d+)\])$/,pU=e=>{let t=e.match(p$);if(null!==t){let e=t[2];return z(void 0!==e&&e.length>0?ty(e):tU(),tQ(pJ))}return tU()},pq=(e,t,r)=>{let n=new Map;for(let[i,s]of e){let e=z(t(i),rJ(e=>tq(pB(e),{onNone:()=>rq(e),onSome:([e,t])=>ra(e,`[${t}]`)})));n.set(r(e),s)}return n},pB=e=>{let t=e.match(pL);if(null!==t){let e=t[1],r=t[3];return tZ([void 0!==e&&e.length>0?ty(e):tU(),z(void 0!==r&&r.length>0?ty(r):tU(),tQ(pJ))])}return tU()},pJ=e=>{let t=Number.parseInt(e);return Number.isNaN(t)?tU():ty(t)},pH=e=>({_tag:"KeyName",name:e}),pK=e=>({_tag:"KeyIndex",index:e}),pW=e=>{let t=[],r=0;for(;r<e.length;){let n=e[r];if("KeyName"===n._tag){if(r+1<e.length){let i=e[r+1];"KeyIndex"===i._tag?(t.push(`${n.name}[${i.index}]`),r+=2):(t.push(n.name),r+=1)}else t.push(n.name),r+=1}}return t},pV=e=>{let t=(e,t)=>"string"==typeof t?ra([e,t]):"number"==typeof t||"boolean"==typeof t?ra([e,String(t)]):rg(t)?r(e,t):"object"==typeof t&&null!==t?n(e,t):rU(),r=(e,r)=>rh(r,{onEmpty:()=>ra([e,"<nil>"]),onNonEmpty:rJ((r,n)=>t(rd(e,pK(n)),r))}),n=(e,r)=>Object.entries(r).filter(([,e])=>er(e)).flatMap(([r,n])=>{let i=rd(e,pH(r)),s=t(i,n);return rb(s)?ra([i,""]):s});return n(rU(),e)},pG=Symbol.for("effect/Console"),pY=sB("effect/Console"),pQ={[pG]:pG,assert:(e,...t)=>cP(()=>{console.assert(e,...t)}),clear:cP(()=>{console.clear()}),count:e=>cP(()=>{console.count(e)}),countReset:e=>cP(()=>{console.countReset(e)}),debug:(...e)=>cP(()=>{console.debug(...e)}),dir:(e,t)=>cP(()=>{console.dir(e,t)}),dirxml:(...e)=>cP(()=>{console.dirxml(...e)}),error:(...e)=>cP(()=>{console.error(...e)}),group:e=>e?.collapsed?cP(()=>console.groupCollapsed(e?.label)):cP(()=>console.group(e?.label)),groupEnd:cP(()=>{console.groupEnd()}),info:(...e)=>cP(()=>{console.info(...e)}),log:(...e)=>cP(()=>{console.log(...e)}),table:(e,t)=>cP(()=>{console.table(e,t)}),time:e=>cP(()=>console.time(e)),timeEnd:e=>cP(()=>console.timeEnd(e)),timeLog:(e,...t)=>cP(()=>{console.timeLog(e,...t)}),trace:(...e)=>cP(()=>{console.trace(...e)}),warn:(...e)=>cP(()=>{console.warn(...e)}),unsafe:console},pZ=Symbol.for("effect/Random"),pX=sB("effect/Random");class p0{seed;[pZ]=pZ;PRNG;constructor(e){this.seed=e,this.PRNG=new ec(e)}get next(){return cP(()=>this.PRNG.number())}get nextBoolean(){return cE(this.next,e=>e>.5)}get nextInt(){return cP(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,t){return cE(this.next,r=>(t-e)*r+e)}nextIntBetween(e,t){return cP(()=>this.PRNG.integer(t-e)+e)}shuffle(e){return p1(e,e=>this.nextIntBetween(0,e))}}let p1=(e,t)=>cz(()=>z(cP(()=>Array.from(e)),cp(e=>{let r=[];for(let t=e.length;t>=2;t-=1)r.push(t);return z(r,cv(r=>z(t(r),cE(t=>p2(e,r-1,t)))),l0(ni(e)))}))),p2=(e,t,r)=>{let n=e[t];return e[t]=e[r],e[r]=n,e},p3=Symbol.for("effect/Tracer"),p5=sB("effect/Tracer"),p4=sB("effect/ParentSpan"),p6=function(){let e="abcdef0123456789",t=e.length;return function(r){let n="";for(let i=0;i<r;i++)n+=e.charAt(Math.floor(Math.random()*t));return n}}();class p8{name;parent;context;links;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];constructor(e,t,r,n,i,s){this.name=e,this.parent=t,this.context=r,this.links=n,this.startTime=i,this.kind=s,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId="Some"===t._tag?t.value.traceId:p6(32),this.spanId=p6(16)}end(e,t){this.status={_tag:"Ended",endTime:e,exit:t,startTime:this.status.startTime}}attribute(e,t){this.attributes.set(e,t)}event(e,t,r){this.events.push([e,t,r??{}])}}let p7=e=>{if(e?.captureStackTrace===!1||e?.captureStackTrace!==void 0&&"boolean"!=typeof e.captureStackTrace)return e;let t=Error.stackTraceLimit;Error.stackTraceLimit=3;let r=Error();Error.stackTraceLimit=t;let n=!1;return{...e,captureStackTrace:()=>{if(!1!==n)return n;if(void 0!==r.stack){let e=r.stack.split("\n");if(void 0!==e[3])return n=e[3].trim()}}}},p9=sW()("effect/Tracer/DisablePropagation",{defaultValue:M}),fe=z(sH(),sz(hP,new hq),sz(pY,pQ),sz(pX,new p0(ev(Math.random()))),sz(py,pk()),sz(p5,{[p3]:p3,span:(e,t,r,n,i,s)=>new p8(e,t,r,n,i,s),context:e=>e()})),ft=$(Symbol.for("effect/DefaultServices/currentServices"),()=>ub(fe)),fr=e=>lZ(t=>e(t.currentDefaultServices)),fn=e=>fr(t=>e(t.unsafeMap.get(hP.key))),fi=fn(e=>e.currentTimeMillis),fs=e=>fr(t=>e(t.unsafeMap.get(py.key))),fa=e=>fs(t=>t.load(e));i=e=>e.next,fr(e=>i(e.unsafeMap.get(pX.key)));let fo=e=>!e,fl=e=>cp(cu,t=>hv(e,cw(t))),fc=e=>cP(()=>aC(e.state)._tag===lj),fu=tl,fh=tc;class fp extends fu{}class ff extends fh{}let fd="Sequential",fm="Parallel",fg={_tag:fd},fb=e=>e._tag===fd,fx=e=>e._tag===fm,fy={_tag:fm},fv=e=>({_tag:"ParallelN",parallelism:e});function f_(){return new fw(new Map)}let fS=Symbol.for("effect/FiberRefs");class fw{locals;[fS]=fS;constructor(e){this.locals=e}pipe(){return eV(this,arguments)}}let fk=(e,t,r,n=!1)=>{let i,s=t,a=r,o=n;for(;void 0===i;)if(rx(s)&&rx(a)){let e=rk(s)[0],t=rO(s),r=rk(a)[0],n=rk(a)[1],l=rO(a);e.startTimeMillis<r.startTimeMillis?(a=l,o=!0):e.startTimeMillis>r.startTimeMillis?s=t:e.id<r.id?(a=l,o=!0):e.id>r.id?s=t:i=[n,o]}else i=[e.initial,!0];return i},fC=R(3,(e,t,r)=>{let n=new Map(e.locals);return r.locals.forEach((e,r)=>{let i=e[0][1];if(!e[0][0][eT](t)){if(!n.has(r)){if(eN(i,r.initial))return;n.set(r,[[t,r.join(r.initial,i)]]);return}let s=n.get(r),[a,o]=fk(r,s,e);if(o){let e=r.diff(a,i),o=s[0][1],l=r.join(o,r.patch(e)(o));if(!eN(o,l)){let e;let i=s[0][0];e=i[eT](t)?[[i,l],...s.slice(1)]:[[t,l],...s],n.set(r,e)}}}}),new fw(n)}),fE=R(2,(e,t)=>{let r=new Map;return fO(e,r,t),new fw(r)}),fO=(e,t,r)=>{e.locals.forEach((e,n)=>{let i=e[0][1],s=n.patch(n.fork)(i);eN(i,s)?t.set(n,e):t.set(n,[[r,s],...e])})},fI=R(2,(e,t)=>{let r=new Map(e.locals);return r.delete(t),new fw(r)}),fF=R(2,(e,t)=>e.locals.has(t)?ty(rk(e.locals.get(t))[1]):tU()),fR=R(2,(e,t)=>z(fF(e,t),tB(()=>t.initial))),fT=R(2,(e,{fiberId:t,fiberRef:r,value:n})=>{if(0===e.locals.size)return new fw(new Map([[r,[[t,n]]]]));let i=new Map(e.locals);return fN(i,t,r,n),new fw(i)}),fN=(e,t,r,n)=>{let i;let s=e.get(r)??[];if(rx(s)){let[e,r]=rk(s);if(e[eT](t)){if(eN(r,n))return;i=[[t,n],...s.slice(1)]}else i=[[t,n],...s]}else i=[[t,n]];e.set(r,i)},fA=R(2,(e,{entries:t,forkAs:r})=>{if(0===e.locals.size)return new fw(new Map(t));let n=new Map(e.locals);return void 0!==r&&fO(e,n,r),t.forEach(([e,t])=>{1===t.length?fN(n,t[0][0],e,t[0][1]):t.forEach(([t,r])=>{fN(n,t,e,r)})}),new fw(n)}),fM="Empty",fj="Remove",fz="Update",fP="AndThen",fD={_tag:fM},fL=(e,t)=>{let r=new Map(e.locals),n=fD;for(let[e,i]of t.locals.entries()){let t=rk(i)[1],s=r.get(e);if(void 0!==s){let r=rk(s)[1];eN(r,t)||(n=f$({_tag:fz,fiberRef:e,patch:e.diff(r,t)})(n))}else n=f$({_tag:"Add",fiberRef:e,value:t})(n);r.delete(e)}for(let[e]of r.entries())n=f$({_tag:fj,fiberRef:e})(n);return n},f$=R(2,(e,t)=>({_tag:fP,first:e,second:t})),fU=R(3,(e,t,r)=>{let n=r,i=rq(e);for(;rx(i);){let e=rk(i),r=rO(i);switch(e._tag){case fM:i=r;break;case"Add":n=fT(n,{fiberId:t,fiberRef:e.fiberRef,value:e.value}),i=r;break;case fj:n=fI(n,e.fiberRef),i=r;break;case fz:{let s=fR(n,e.fiberRef);n=fT(n,{fiberId:t,fiberRef:e.fiberRef,value:e.fiberRef.patch(e.patch)(s)}),i=r;break}case fP:i=rf(e.first)(rf(e.second)(r))}}return n}),fq="effect/FiberStatus",fB=Symbol.for(fq),fJ="Done",fH="Running",fK="Suspended",fW=eE(`${fq}-${fJ}`);class fV{[fB]=fB;_tag=fJ;[ey](){return fW}[eT](e){return fZ(e)&&e._tag===fJ}}class fG{runtimeFlags;[fB]=fB;_tag=fH;constructor(e){this.runtimeFlags=e}[ey](){return z(ev(fq),eS(ev(this._tag)),eS(ev(this.runtimeFlags)),eR(this))}[eT](e){return fZ(e)&&e._tag===fH&&this.runtimeFlags===e.runtimeFlags}}class fY{runtimeFlags;blockingOn;[fB]=fB;_tag=fK;constructor(e,t){this.runtimeFlags=e,this.blockingOn=t}[ey](){return z(ev(fq),eS(ev(this._tag)),eS(ev(this.runtimeFlags)),eS(ev(this.blockingOn)),eR(this))}[eT](e){return fZ(e)&&e._tag===fK&&this.runtimeFlags===e.runtimeFlags&&eN(this.blockingOn,e.blockingOn)}}let fQ=new fV,fZ=e=>X(e,fB),fX=e=>new fG(e),f0=(e,t)=>new fY(e,t),f1=e=>e._tag===fJ,f2=(_=z(t8,t7(e=>e.ordinal)),R(2,(e,t)=>1===_(e,t))),f3=e=>{switch(e){case"All":return c2;case"Debug":return c8;case"Error":return c5;case"Fatal":return c3;case"Info":return c6;case"Trace":return c7;case"None":return c9;case"Warning":return c4}},f5=Symbol.for("effect/Micro"),f4=Symbol.for("effect/Micro/MicroExit"),f6=Symbol.for("effect/Micro/MicroCause"),f8={_E:T};class f7 extends globalThis.Error{_tag;traces;[f6];constructor(e,t,r){let n,i,s;let a=`MicroCause.${e}`;if(t instanceof globalThis.Error){n=`(${a}) ${t.name}`;let e=(i=t.message).split("\n").length;s=t.stack?`(${a}) ${t.stack.split("\n").slice(0,e+3).join("\n")}`:`${n}: ${i}`}else n=a,i=eU(t,0),s=`${n}: ${i}`;r.length>0&&(s+=`
    ${r.join("\n    ")}`),super(i),this._tag=e,this.traces=r,this[f6]=f8,this.name=n,this.stack=s}pipe(){return eV(this,arguments)}toString(){return this.stack}[ez](){return this.stack}}class f9 extends f7{error;constructor(e,t=[]){super("Fail",e,t),this.error=e}}let de=(e,t=[])=>new f9(e,t);class dt extends f7{defect;constructor(e,t=[]){super("Die",e,t),this.defect=e}}let dr=(e,t=[])=>new dt(e,t);class dn extends f7{constructor(e=[]){super("Interrupt","interrupted",e)}}let di=(e=[])=>new dn(e),ds=e=>"Fail"===e._tag,da=e=>"Interrupt"===e._tag,dl=R(2,(e,t)=>{let r=[...e.traces,t];switch(e._tag){case"Die":return dr(e.defect,r);case"Interrupt":return di(r);case"Fail":return de(e.error,r)}}),dc=Symbol.for("effect/Micro/MicroFiber"),du={_A:T,_E:T};class dh{context;interruptible;[dc];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(e,t=!0){this.context=e,this.interruptible=t,this[dc]=du}getRef(e){return sL(this.context,e)}addObserver(e){return this._exit?(e(this._exit),j):(this._observers.push(e),()=>{let t=this._observers.indexOf(e);t>=0&&this._observers.splice(t,1)})}_interrupted=!1;unsafeInterrupt(){!this._exit&&(this._interrupted=!0,this.interruptible&&this.evaluate(dY))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(void 0!==this._yielded){let e=this._yielded;this._yielded=void 0,e()}let t=this.runLoop(e);if(t===dv)return;let r=dp.interruptChildren&&dp.interruptChildren(this);if(void 0!==r)return this.evaluate(dJ(r,()=>t));this._exit=t;for(let e=0;e<this._observers.length;e++)this._observers[e](t);this._observers.length=0}runLoop(e){let t=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!t&&this.getRef(d8).shouldYield(this)){t=!0;let e=r;r=dJ(dT,()=>e)}if((r=r[dg](this))===dv){let e=this._yielded;if(f4 in e)return this._yielded=void 0,e;return dv}}}catch(e){if(!X(r,dg))return dQ(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`);return dQ(e)}}getCont(e){for(;;){let t=this._stack.pop();if(!t)return;let r=t[dy]&&t[dy](this);if(r)return{[e]:r};if(t[e])return t}}_yielded=void 0;yieldWith(e){return this._yielded=e,dv}children(){return this._children??=new Set}}let dp=$("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),df=e=>dR(()=>{for(let t of e)t.unsafeInterrupt();let t=e[Symbol.iterator](),r=dR(()=>{let e=t.next();for(;!e.done;){if(e.value.unsafePoll()){e=t.next();continue}let n=e.value;return d$(e=>{n.addObserver(t=>{e(r)})})}return dX});return r}),dd=Symbol.for("effect/Micro/identifier"),dm=Symbol.for("effect/Micro/args"),dg=Symbol.for("effect/Micro/evaluate"),db=Symbol.for("effect/Micro/successCont"),dx=Symbol.for("effect/Micro/failureCont"),dy=Symbol.for("effect/Micro/ensureCont"),dv=Symbol.for("effect/Micro/Yield"),d_={...ti,_op:"Micro",[f5]:{_A:T,_E:T,_R:T},pipe(){return eV(this,arguments)},[Symbol.iterator](){return new el(new ep(this))},toJSON(){return{_id:"Micro",op:this[dd],...dm in this?{args:this[dm]}:void 0}},toString(){return eD(this)},[ez](){return eD(this)}};function dS(e){return dQ("Micro.evaluate: Not implemented")}let dw=e=>({...d_,[dd]:e.op,[dg]:e.eval??dS,[db]:e.contA,[dx]:e.contE,[dy]:e.ensure}),dk=e=>{let t=dw(e);return function(){let r=Object.create(t);return r[dm]=!1===e.single?arguments:arguments[0],r}},dC=e=>{let t={...dw(e),[f4]:f4,_tag:e.op,get[e.prop](){return this[dm]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[dm]}},[eT](t){return dW(t)&&t._tag===e.op&&eN(this[dm],t[dm])},[ey](){return eR(this,eS(eE(e.op))(ev(this[dm])))}};return function(e){let r=Object.create(t);return r[dm]=e,r[db]=void 0,r[dx]=void 0,r[dy]=void 0,r}},dE=dC({op:"Success",prop:"value",eval(e){let t=e.getCont(db);return t?t[db](this[dm],e):e.yieldWith(this)}}),dO=dC({op:"Failure",prop:"cause",eval(e){let t=e.getCont(dx);for(;da(this[dm])&&t&&e.interruptible;)t=e.getCont(dx);return t?t[dx](this[dm],e):e.yieldWith(this)}}),dI=e=>dO(de(e)),dF=dk({op:"Sync",eval(e){let t=this[dm](),r=e.getCont(db);return r?r[db](t,e):e.yieldWith(dV(t))}}),dR=dk({op:"Suspend",eval(e){return this[dm]()}}),dT=dk({op:"Yield",eval(e){let t=!1;return e.getRef(d8).scheduleTask(()=>{t||e.evaluate(dX)},this[dm]??0),e.yieldWith(()=>{t=!0})}})(0),dN=e=>dQ(e),dA=e=>"Right"===e._tag?dE(e.right):dI(e.left),dM=dE(void 0),dj=e=>dD(function(t,r){e(r).then(e=>t(dE(e)),e=>t(dN(e)))},0!==e.length),dz=e=>dD(function(t,r){try{e.try(r).then(e=>t(dE(e)),r=>t(dI(e.catch(r))))}catch(r){t(dI(e.catch(r)))}},0!==e.try.length),dP=dk({op:"WithMicroFiber",eval(e){return this[dm](e)}}),dD=dk({op:"Async",single:!1,eval(e){let t=this[dm][0],r=!1,n=!1,i=this[dm][1]?new AbortController:void 0,s=t(t=>{r||(r=!0,n?e.evaluate(t):n=t)},i?.signal);return!1!==n?n:(n=!0,e._yielded=()=>{r=!0},void 0===i&&void 0===s||e._stack.push(dL(()=>(r=!0,i?.abort(),s??dX))),dv)}}),dL=dk({op:"AsyncFinalizer",ensure(e){e.interruptible&&(e.interruptible=!1,e._stack.push(mp(!0)))},contE(e,t){return da(e)?dJ(this[dm](),()=>dO(e)):dO(e)}}),d$=e=>dD(e,e.length>=2),dU=(...e)=>dR(()=>dq(1===e.length?e[0]():e[1].call(e[0]))),dq=dk({op:"Iterator",contA(e,t){let r=this[dm].next(e);return r.done?dE(r.value):(t._stack.push(this),ef(r.value))},eval(e){return this[db](void 0,e)}}),dB=e=>ma(e,{onFailure:dG,onSuccess:dV}),dJ=R(2,(e,t)=>{let r=Object.create(dH);return r[dm]=e,r[db]=t,r}),dH=dw({op:"OnSuccess",eval(e){return e._stack.push(this),this[dm]}}),dK=R(2,(e,t)=>dJ(e,e=>dE(t(e)))),dW=e=>X(e,f4),dV=dE,dG=dO,dY=dG(di()),dQ=e=>dG(dr(e)),dZ=e=>"Failure"===e._tag,dX=dV(void 0),d0=e=>{for(let t of e)if("Failure"===t._tag)return t;return dX},d1="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class d2{tasks=[];running=!1;scheduleTask(e,t){this.tasks.push(e),this.running||(this.running=!0,d1(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){let e=this.tasks;this.tasks=[];for(let t=0,r=e.length;t<r;t++)e[t]()}shouldYield(e){return e.currentOpCount>=e.getRef(d4)}flush(){for(;this.tasks.length>0;)this.runTasks()}}let d3=R(2,(e,t)=>dP(r=>{let n=r.context;return r.context=t(n),mc(e,()=>(r.context=n,dM))})),d5=R(2,(e,t)=>d3(e,sq(t)));class d4 extends sW()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class d6 extends sW()("effect/Micro/currentConcurrency",{defaultValue:()=>"unbounded"}){}class d8 extends sW()("effect/Micro/currentScheduler",{defaultValue:()=>new d2}){}let d7=R(2,(e,t)=>{let r=Object.create(d9);return r[dm]=e,r[dx]=t,r}),d9=dw({op:"OnFailure",eval(e){return e._stack.push(this),this[dm]}}),me=R(3,(e,t,r)=>d7(e,e=>t(e)?r(e):dO(e))),mt=R(2,(e,t)=>me(e,ds,e=>t(e.error))),mr=R(2,(e,t)=>mt(e,e=>dF(t))),mn=function(){let e=globalThis.Error.stackTraceLimit;globalThis.Error.stackTraceLimit=2;let t=new globalThis.Error;globalThis.Error.stackTraceLimit=e;let r=e=>r=>mh(r,r=>dO(function(e,r){let n=t.stack;if(!n)return r;let i=n.split("\n")[2]?.trim().replace(/^at /,"");if(!i)return r;let s=i.match(/\((.*)\)$/);return dl(r,`at ${e} (${s?s[1]:i})`)}(e,r)));return 2==arguments.length?r(arguments[1])(arguments[0]):r(arguments[0])},mi=R(2,(e,t)=>{let r=Object.create(ms);return r[dm]=e,r[db]=t.onSuccess,r[dx]=t.onFailure,r}),ms=dw({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[dm]}}),ma=null,mo=Symbol.for("effect/Micro/MicroScope");class ml{[mo];state={_tag:"Open",finalizers:new Set};constructor(){this[mo]=mo}unsafeAddFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.add(e)}addFinalizer(e){return dR(()=>"Open"===this.state._tag?(this.state.finalizers.add(e),dM):e(this.state.exit))}unsafeRemoveFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.delete(e)}close(e){return dR(()=>{if("Open"===this.state._tag){let t=Array.from(this.state.finalizers).reverse();return this.state={_tag:"Closed",exit:e},dJ(mg(t,t=>dB(t(e))),d0)}return dM})}get fork(){return dF(()=>{let e=new ml;if("Closed"===this.state._tag)return e.state=this.state,e;function t(t){return e.close(t)}return this.state.finalizers.add(t),e.unsafeAddFinalizer(e=>dF(()=>this.unsafeRemoveFinalizer(t))),e})}}let mc=R(2,(e,t)=>md(r=>mi(r(e),{onFailure:e=>dJ(t(dG(e)),()=>dO(e)),onSuccess:e=>dJ(t(dV(e)),()=>dE(e))}))),mu=R(3,(e,t,r)=>mc(e,e=>t(e)?r(e):dX)),mh=R(2,(e,t)=>mu(e,dZ,e=>t(e.cause))),mp=dk({op:"SetInterruptible",ensure(e){if(e.interruptible=this[dm],e._interrupted&&e.interruptible)return()=>dY}}),mf=e=>dP(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(mp(!1)),t._interrupted)?dY:e),md=e=>dP(t=>t.interruptible?(t.interruptible=!1,t._stack.push(mp(!0)),e(mf)):e(T)),mm=dk({op:"While",contA(e,t){return(this[dm].step(e),this[dm].while())?(t._stack.push(this),this[dm].body()):dX},eval(e){return this[dm].while()?(e._stack.push(this),this[dm].body()):dX}}),mg=(e,t,r)=>dP(n=>{let i=r?.concurrency==="inherit"?n.getRef(d6):r?.concurrency??1,s="unbounded"===i?Number.POSITIVE_INFINITY:Math.max(1,i),a=Arr.fromIterable(e),o=a.length;if(0===o)return r?.discard?dM:dE([]);let l=r?.discard?void 0:Array(o),c=0;return 1===s?(null)(mm({while:()=>c<a.length,body:()=>t(a[c],c),step:l?e=>l[c++]=e:e=>c++}),l):d$(e=>{let r;let i=new Set,u=0,h=0,p=!1,f=!1;return function d(){for(p=!0;u<s&&c<o;){let m=c,g=a[m];c++,u++;try{let a=mb(n,t(g,m),!0,!0);i.add(a),a.addObserver(t=>{i.delete(a),f||("Failure"===t._tag?void 0===r&&(r=t,o=c,i.forEach(e=>e.unsafeInterrupt())):void 0!==l&&(l[m]=t.value),h++,u--,h===o?e(r??dE(l)):!p&&u<s&&d())})}catch(e){r=dQ(e),o=c,i.forEach(e=>e.unsafeInterrupt())}}p=!1}(),dR(()=>(f=!0,c=o,df(i)))})}),mb=(e,t,r=!1,n=!1)=>{let i=new dh(e.context,e.interruptible);return n||(e.children().add(i),i.addObserver(()=>e.children().delete(i))),r?i.evaluate(t):e.getRef(d8).scheduleTask(()=>i.evaluate(t),0),i},mx=(e,t)=>{let r=new dh(d8.context(t?.scheduler??new d2));if(r.evaluate(e),t?.signal){if(t.signal.aborted)r.unsafeInterrupt();else{let e=()=>r.unsafeInterrupt();t.signal.addEventListener("abort",e,{once:!0}),r.addObserver(()=>t.signal.removeEventListener("abort",e))}}return r},my=function(){class e extends globalThis.Error{}return Object.assign(e.prototype,d_,ts,{[dd]:"Failure",[dg](){return dI(this)},toString(){return this.message?`${this.name}: ${this.message}`:this.name},toJSON(){return{...this}},[ez](){let e=this.stack;return e?`${this.toString()}
${e.split("\n").slice(1).join("\n")}`:this.toString()}}),e}(),mv=class extends my{constructor(e){super(),e&&Object.assign(this,e)}},m_=e=>{class t extends mv{_tag=e}return t.prototype.name=e,t},mS=Symbol.for("effect/Readable"),mw=Symbol.for("effect/Ref"),mk={_A:e=>e};class mC extends fp{ref;commit(){return this.get}[mw]=mk;[mS]=mS;constructor(e){super(),this.ref=e,this.get=cP(()=>aC(this.ref))}get;modify(e){return cP(()=>{let t=aC(this.ref),[r,n]=e(t);return t!==n&&aE(n)(this.ref),r})}}let mE=e=>new mC(aw(e)),mO=e=>cP(()=>mE(e)),mI=e=>e.get,mF=R(2,(e,t)=>e.modify(()=>[void 0,t])),mR=R(2,(e,t)=>e.modify(e=>[e,t])),mT=R(2,(e,t)=>e.modify(t)),mN=R(2,(e,t)=>e.modify(e=>[void 0,t(e)]));class mA{buckets=[];scheduleTask(e,t){let r;let n=this.buckets.length,i=0;for(;i<n;i++)if(this.buckets[i][0]<=t)r=this.buckets[i];else break;r&&r[0]===t?r[1].push(e):i===n?this.buckets.push([t,[e]]):this.buckets.splice(i,0,[t,[e]])}}class mM{maxNextTickBeforeTimer;running=!1;tasks=new mA;constructor(e){this.maxNextTickBeforeTimer=e}starveInternal(e){let t=this.tasks.buckets;for(let[e,r]of(this.tasks.buckets=[],t))for(let e=0;e<r.length;e++)r[e]();0===this.tasks.buckets.length?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(u_)&&e.getFiberRef(uv)}scheduleTask(e,t){this.tasks.scheduleTask(e,t),this.running||(this.running=!0,this.starve())}}let mj=$(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new mM(2048));class mz{tasks=new mA;deferred=!1;scheduleTask(e,t){this.deferred?mj.scheduleTask(e,t):this.tasks.scheduleTask(e,t)}shouldYield(e){return e.currentOpCount>e.getFiberRef(u_)&&e.getFiberRef(uv)}flush(){for(;this.tasks.buckets.length>0;){let e=this.tasks.buckets;for(let[t,r]of(this.tasks.buckets=[],e))for(let e=0;e<r.length;e++)r[e]()}this.deferred=!0}}let mP=$(Symbol.for("effect/FiberRef/currentScheduler"),()=>ud(mj)),mD=(e,t)=>({_tag:"Par",left:e,right:t}),mL=(e,t)=>({_tag:"Seq",left:e,right:t}),m$=e=>{let t=a9(e),r=a7();for(;;){let[e,n]=on(t,[mV(),a7()],([e,t],r)=>{let[n,i]=mU(r);return[mY(e,n),oe(t,i)]});if(r=mq(r,e),a4(n))return oi(r);t=n}throw Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},mU=e=>{let t=e,r=mV(),n=a7(),i=a7();for(;;)switch(t._tag){case"Empty":if(a4(n))return[r,i];t=n.head,n=n.tail;break;case"Par":n=a8(t.right,n),t=t.left;break;case"Seq":{let e=t.left,r=t.right;switch(e._tag){case"Empty":t=r;break;case"Par":{let n=e.left,i=e.right;t=mD(mL(n,r),mL(i,r));break}case"Seq":t=mL(e.left,mL(e.right,r));break;case"Single":t=e,i=a8(r,i)}break}case"Single":if(r=mG(r,t),a4(n))return[r,i];t=n.head,n=n.tail}throw Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},mq=(e,t)=>{if(a4(e))return a9(mX(t));if(mQ(t))return e;let r=m4(e.head),n=mZ(t);return 1===r.length&&1===n.length&&eN(r[0],n[0])?a8(m5(e.head,mX(t)),e.tail):a8(mX(t),e)},mB=Symbol.for("effect/RequestBlock/Entry"),mJ={_R:e=>e},mH=Symbol.for("effect/RequestBlock/RequestBlockParallel"),mK={_R:e=>e};class mW{map;[mH]=mK;constructor(e){this.map=e}}let mV=()=>new mW(n4()),mG=(e,t)=>new mW(io(e.map,t.dataSource,e=>tH(tY(e,np(t.blockedRequest)),()=>nn(t.blockedRequest)))),mY=(e,t)=>new mW(ip(e.map,t.map,(e,t,r)=>ie(e,r,tq(n8(e,r),{onNone:()=>t,onSome:e=>nb(t,e)})))),mQ=e=>aY(e.map),mZ=e=>Array.from(ir(e.map)),mX=e=>m3(iu(e.map,e=>nn(e))),m0=Symbol.for("effect/RequestBlock/RequestBlockSequential"),m1={_R:e=>e};class m2{map;[m0]=m1;constructor(e){this.map=e}}let m3=e=>new m2(e),m5=(e,t)=>new m2(ip(t.map,e.map,(e,t,r)=>ie(e,r,tq(n8(e,r),{onNone:()=>nt(),onSome:e=>nb(e,t)})))),m4=e=>Array.from(ir(e.map)),m6=e=>Array.from(e.map),m8=$(Symbol.for("effect/FiberRef/currentRequestMap"),()=>ud(new Map)),m7=(e,t,r,n)=>{switch(e){case void 0:return t();case"unbounded":return r();case"inherit":return ui(uE,e=>"unbounded"===e?r():e>1?n(e):t());default:return e>1?n(e):t()}},m9=(e,t,r)=>{switch(e){case void 0:return t();case"unbounded":return r();case"inherit":return ui(uE,e=>"unbounded"===e||e>1?r():t());default:return e>1?r():t()}},ge=e=>{let t=s2(e);return fn(e=>e.sleep(t))},gt=(e,t)=>({label:e,startTime:t}),gr=e=>t=>{let r=t.label.replace(/[\s="]/g,"_");return`${r}=${e-t.startTime}ms`},gn=e=>({_tag:"ExternalSpan",spanId:e.spanId,traceId:e.traceId,sampled:e.sampled??!0,context:e.context??sH()}),gi="effect/MetricLabel",gs=Symbol.for(gi);class ga{key;value;[gs]=gs;_hash;constructor(e,t){this.key=e,this.value=t,this._hash=eE(gi+this.key+this.value)}[ey](){return this._hash}[eT](e){return gl(e)&&this.key===e.key&&this.value===e.value}pipe(){return eV(this,arguments)}}let go=(e,t)=>new ga(e,t),gl=e=>X(e,gs),gc=R(e=>lQ(e[0]),function(){let e=arguments;return uf(e[0],uS,"string"==typeof e[1]?ie(e[1],e[2]):t=>Object.entries(e[1]).reduce((e,[t,r])=>ie(e,t,r),t))}),gu=e=>cE(e,ty),gh=e=>{let t,r;return"function"==typeof e?t=e:(t=e.try,r=e.catch),cP(()=>{try{return t()}catch(e){throw lB(iH(r?r(e):new u5(e)))}})},gp=R(2,(e,t)=>cb(e,{onFailure:e=>{let r=t(e);switch(r._tag){case"None":return cl(e);case"Some":return r.value}},onSuccess:cj})),gf=R(3,(e,t,r)=>l7(e,ee(t),r)),gd=R(2,(e,t)=>{let r;return l7(e,e=>(r??=Object.keys(t),X(e,"_tag")&&U(e._tag)&&r.includes(e._tag)),e=>t[e._tag](e))}),gm=e=>gD(e,gS,fL),gg=e=>gD(e,cY(gS,cM),([e,t],[r,n])=>[fL(e,r),lF(t,n)]),gb=R(3,(e,t,r)=>cp(e,e=>cE(r(e),r=>Object.assign({},e,{[t]:r})))),gx=R(2,(e,t)=>cE(e,e=>({[t]:e}))),gy=((e,t)=>cz(()=>{let r;let n=e[Symbol.iterator](),i=[],s=cj(!1),a=0;for(;(r=n.next())&&!r.done;){let e=r.value,n=a++;s=cp(s,r=>r?(i.push(e),cj(!0)):t(e,n))}return cE(s,()=>i)}),R(3,(e,t,r)=>cp(e,e=>t(e)?cj(e):r(e)))),gv=R(2,(e,t)=>cx(e,{onFailure:e=>cj(t.onFailure(e)),onSuccess:e=>cj(t.onSuccess(e))})),g_=e=>{let t=cp(cp(e,()=>cG()),()=>t);return t},gS=lZ(e=>cj(e.getFiberRefs())),gw=e=>(...t)=>{let r;let n=tK(e);for(let e=0,n=t.length;e<n;e++){let n=t[e];iY(n)&&(r=void 0!==r?iG(r,n):n,t=[...t.slice(0,e),...t.slice(e+1)],e--)}return void 0===r&&(r=iJ),lZ(e=>(e.log(t,r,n),cB))},gk=gw(),gC=gw(c8),gE=gw(c6),gO=gw(c4),gI=gw(c5),gF=R(2,(e,t)=>cp(fi,r=>uf(e,uk,ot(gt(t,r))))),gR=R(2,(e,t)=>cb(e,{onFailure:e=>cc(()=>t(e)),onSuccess:cj})),gT=e=>cE(e,e=>!e),gN=e=>cE(mO(!0),t=>l1(cH(e,mR(t,!1)))),gA=e=>gJ((t,r)=>z(e,fU(t,r))),gM=R(3,(e,t,r)=>hF(n=>hR(e,sz(n,t,r)))),gj=R(3,(e,t,r)=>hF(n=>cp(r,r=>hR(e,z(n,sz(t,r)))))),gz=R(3,(e,t,r)=>rc(e).reduce((e,t,n)=>cp(e,e=>r(e,t,n)),cj(t))),gP=cj(tU()),gD=R(3,(e,t,r)=>cp(t,n=>cp(e,e=>cE(t,t=>[r(n,t),e])))),gL=R(2,(e,{onFailure:t,onSuccess:r})=>cb(e,{onFailure:e=>{let r=i4(e);switch(r._tag){case"Left":return cZ(t(r.left),cl(e));case"Right":return cl(e)}},onSuccess:e=>l0(r(e),e)})),g$=R(2,(e,t)=>cb(e,{onFailure:e=>{let r=i4(e);switch(r._tag){case"Left":return cZ(t(r.left),cl(e));case"Right":return cl(e)}},onSuccess:cj})),gU=R(2,(e,t)=>cb(e,{onFailure:e=>cZ(t(e),cl(e)),onSuccess:cj})),gq=e=>{let t,r;return("function"==typeof e?t=e:(t=e.try,r=e.catch),t.length>=1)?l4((e,n)=>{try{t(n).then(t=>e(hu(t)),t=>e(r?co(()=>r(t)):ca(new u5(t))))}catch(t){e(r?co(()=>r(t)):ca(new u5(t)))}}):l4(e=>{try{t().then(t=>e(hu(t)),t=>e(r?co(()=>r(t)):ca(new u5(t))))}catch(t){e(r?co(()=>r(t)):ca(new u5(t)))}})},gB=R(2,(e,t)=>cp(e,e=>gh({try:()=>t.try(e),catch:t.catch}))),gJ=e=>lZ(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),cB)),gH=R(2,(e,t)=>cz(()=>t()?cE(e,ty):cj(tU()))),gK=BigInt(0),gW=tQ(e=>s$(e.context,p9)?"Span"===e._tag?gW(e.parent):tU():ty(e)),gV=(e,t,r)=>{let n;let i=!e.getFiberRef(uN)||r.context&&s$(r.context,p9),s=e.getFiberRef(uy),a=r.parent?ty(r.parent):r.root?tU():gW(sU(s,p4));if(i)n=hj({name:t,parent:a,context:sz(r.context??sH(),p9,!0)});else{let i=e.getFiberRef(ft),s=s$(i,p5),o=s$(i,hP),l=e.getFiberRef(uA),c=e.getFiberRefs(),u=fF(c,uM),h=fF(c,uj),p="Some"===h._tag?void 0!==r.links?[...na(h.value),...r.links??[]]:na(h.value):r.links??rU();n=s.span(t,a,r.context??sH(),p,l?o.unsafeCurrentTimeNanos():gK,r.kind??"internal"),"Some"===u._tag&&ih(u.value,(e,t)=>n.attribute(t,e)),void 0!==r.attributes&&Object.entries(r.attributes).forEach(([e,t])=>n.attribute(e,t))}return"function"==typeof r.captureStackTrace&&sy.set(n,r.captureStackTrace),n},gG=(e,t,r,n)=>cP(()=>{"Ended"!==e.status._tag&&(u6(t)&&sy.has(e)&&e.attribute("code.stacktrace",sy.get(e)()),e.end(n?r.unsafeCurrentTimeNanos():gK,t))}),gY=(e,...t)=>{let r=p7(1===t.length?void 0:t[0]),n=t[t.length-1];return lZ(t=>{let i=gV(t,e,r),s=t.getFiberRef(uA),a=s$(t.getFiberRef(ft),hP);return cF(n(i),e=>gG(i,e,a,s))})},gQ=R(2,(e,t)=>gM(e,p4,t)),gZ=e=>z(e,hi(T)),gX="InterruptSignal",g0="Stateful",g1="Resume",g2="YieldNow",g3=e=>({_tag:gX,cause:e}),g5=e=>({_tag:g0,onFiber:e}),g4=e=>({_tag:g1,effect:e}),g6=()=>({_tag:g2}),g8=Symbol.for("effect/FiberScope");class g7{[g8]=g8;fiberId=aH;roots=new Set;add(e,t){this.roots.add(t),t.addObserver(()=>{this.roots.delete(t)})}}class g9{fiberId;parent;[g8]=g8;constructor(e,t){this.fiberId=e,this.parent=t}add(e,t){this.parent.tell(g5(e=>{e.addChild(t),t.addObserver(()=>{e.removeChild(t)})}))}}let be=e=>new g9(e.id(),e),bt=$(Symbol.for("effect/FiberScope/Global"),()=>new g7),br=Symbol.for("effect/Fiber"),bn={_E:e=>e,_A:e=>e},bi={[br]:bn,pipe(){return eV(this,arguments)}},bs=Symbol.for("effect/Fiber"),ba=e=>e.await,bo=((e,t)=>e.interruptAsFork(t),e=>cQ(cm(e.await),e.inheritAll)),bl=((e,t)=>bl(e,e=>cP(()=>t(e))),R(2,(e,t)=>({...ta,commit(){return bo(this)},...bi,id:()=>e.id(),await:cp(e.await,hs(t)),children:e.children,inheritAll:e.inheritAll,poll:cp(e.poll,e=>{switch(e._tag){case"None":return cj(tU());case"Some":return z(hs(e.value,t),cE(ty))}}),interruptAsFork:t=>e.interruptAsFork(t)})));(e,t)=>({...ta,commit(){return bo(this)},...bi,id:()=>a$(e.id(),t.id()),await:cX(e.await,t.await,(e,t)=>u8(e)?e:t),children:e.children,inheritAll:cZ(t.inheritAll,e.inheritAll),poll:cX(e.poll,t.poll,(e,t)=>{switch(e._tag){case"None":return tU();case"Some":return u8(e.value)?e:t}}),interruptAsFork:r=>z(c1(e,r),cZ(z(t,c1(r))),l1)});let bc="effect/FiberCurrent",bu=Symbol.for("effect/Logger"),bh={_Message:e=>e,_Output:e=>e},bp=e=>({[bu]:bh,log:e,pipe(){return eV(this,arguments)}}),bf=R(2,(e,t)=>bp(r=>e.log({...r,message:t(r.message)}))),bd=R(2,(e,t)=>bp(r=>e.log(t(r)))),bm=R(2,(e,t)=>bp(r=>t(r.logLevel)?ty(e.log(r)):tU())),bg=R(2,(e,t)=>bp(r=>t(e.log(r)))),bb=e=>({[bu]:bh,log:({message:t})=>e(t),pipe(){return eV(this,arguments)}}),bx=R(2,(e,t)=>bp(r=>[e.log(r),t.log(r)])),by=R(2,(e,t)=>bg(bx(e,t),e=>e[0])),bv=R(2,(e,t)=>bg(bx(e,t),e=>e[1])),b_=bp(({annotations:e,cause:t,date:r,fiberId:n,logLevel:i,message:s,spans:a})=>{let o=r.getTime(),l=`timestamp=${r.toISOString()} level=${i.label} fiber=${aB(n)}`,c=ru(s);for(let e=0;e<c.length;e++){let t=eU(c[e]);t.length>0&&(l+=" message=",l=bk(t,l))}if(null!=t&&"Empty"!==t._tag&&(l+=" cause=",l=bk(sd(t,{renderErrorCause:!0}),l)),a6(a)){l+=" ";let e=!0;for(let t of a)e?e=!1:l+=" ",l+=z(t,gr(o))}if(ii(e)>0){l+=" ";let t=!0;for(let[r,n]of e)t?t=!1:l+=" ",l+=bF(r)+"=",l=bk(eU(n),l)}return l}),bS=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,bw=/^[^\s"=]+$/,bk=(e,t)=>t+(e.match(bw)?e:bS(e)),bC=bp(({annotations:e,cause:t,date:r,fiberId:n,logLevel:i,message:s,spans:a})=>{let o=r.getTime(),l=`timestamp=${r.toISOString()} level=${i.label} fiber=${aB(n)}`,c=ru(s);for(let e=0;e<c.length;e++){let t=eU(c[e],0);t.length>0&&(l+=" message=",l=bT(t,l))}if(null!=t&&"Empty"!==t._tag&&(l+=" cause=",l=bT(sd(t,{renderErrorCause:!0}),l)),a6(a)){l+=" ";let e=!0;for(let t of a)e?e=!1:l+=" ",l+=z(t,bN(o))}if(ii(e)>0){l+=" ";let t=!0;for(let[r,n]of e)t?t=!1:l+=" ",l+=bF(r)+"=",l=bT(eU(n,0),l)}return l}),bE=bp(({annotations:e,cause:t,date:r,fiberId:n,logLevel:i,message:s,spans:a})=>{let o=r.getTime(),l={},c={};if(ii(e)>0)for(let[t,r]of e)l[t]=bO(r);if(a6(a))for(let e of a)c[e.label]=o-e.startTime;let u=ru(s);return{message:1===u.length?bO(u[0]):u.map(bO),logLevel:i.label,timestamp:r.toISOString(),cause:iZ(t)?void 0:sd(t,{renderErrorCause:!0}),annotations:l,spans:c,fiberId:aB(n)}}),bO=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return eP(e)}},bI=bg(bE,eq),bF=e=>e.replace(/[\s="]/g,"_"),bR=e=>JSON.stringify(e),bT=(e,t)=>t+(e.match(bw)?e:bR(e)),bN=e=>t=>{let r=bF(t.label);return`${r}=${e-t.startTime}ms`},bA=(e,...t)=>{let r="";for(let e=0;e<t.length;e++)r+=`\x1b[${t[e]}m`;return r+e+"\x1b[0m"},bM=(e,...t)=>e,bj={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},bz={None:[],All:[],Trace:[bj.gray],Debug:[bj.blue],Info:[bj.green],Warning:[bj.yellow],Error:[bj.red],Fatal:[bj.bgBrightRed,bj.black]},bP={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},bD=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,bL="object"==typeof process&&null!==process&&"object"==typeof process.stdout&&null!==process.stdout,b$=bL&&!0===process.stdout.isTTY,bU=bL||"Deno"in globalThis,bq=e=>{let t=e?.mode??"auto",r="browser"===("auto"===t?bU?"tty":"browser":t),n="boolean"==typeof e?.colors?e.colors:b$||r,i=e?.formatDate??bD;return r?bJ({colors:n,formatDate:i}):bB({colors:n,formatDate:i,stderr:e?.stderr===!0})},bB=e=>{let t="object"==typeof process&&"isBun"in process&&!0===process.isBun,r=e.colors&&b$?bA:bM;return bp(({annotations:n,cause:i,context:s,date:a,fiberId:o,logLevel:l,message:c,spans:u})=>{let h=s$(fR(s,ft),pY).unsafe,p=!0===e.stderr?h.error:h.log,f=ru(c),d=r(`[${e.formatDate(a)}]`,bj.white)+` ${r(l.label,...bz[l._tag])}`+` (${aB(o)})`;if(a6(u)){let e=bN(a.getTime());for(let t of u)d+=" "+e(t)}d+=":";let m=0;if(f.length>0){let e=bO(f[0]);"string"==typeof e&&(d+=" "+r(e,bj.bold,bj.cyan),m++)}if(p(d),t||h.group(),iZ(i)||p(sd(i,{renderErrorCause:!0})),m<f.length)for(;m<f.length;m++)p(eW(f[m]));if(ii(n)>0)for(let[e,t]of n)p(r(`${e}:`,bj.bold,bj.white),eW(t));t||h.groupEnd()})},bJ=e=>{let t=e.colors?"%c":"";return bp(({annotations:r,cause:n,context:i,date:s,fiberId:a,logLevel:o,message:l,spans:c})=>{let u=s$(fR(i,ft),pY).unsafe,h=ru(l),p=`${t}[${e.formatDate(s)}]`,f=[];if(e.colors&&f.push("color:gray"),p+=` ${t}${o.label}${t} (${aB(a)})`,e.colors&&f.push(bP[o._tag],""),a6(c)){let e=bN(s.getTime());for(let t of c)p+=" "+e(t)}p+=":";let d=0;if(h.length>0){let r=bO(h[0]);"string"==typeof r&&(p+=` ${t}${r}`,e.colors&&f.push("color:deepskyblue"),d++)}if(u.groupCollapsed(p,...f),iZ(n)||u.error(sd(n,{renderErrorCause:!0})),d<h.length)for(;d<h.length;d++)u.log(eW(h[d]));if(ii(r)>0)for(let[t,n]of r){let r=eW(n);e.colors?u.log(`%c${t}:`,"color:gray",r):u.log(`${t}:`,r)}u.groupEnd()})},bH=$("effect/Logger/prettyLoggerDefault",()=>bq()),bK=Symbol.for("effect/MetricKeyType"),bW="effect/MetricKeyType/Counter",bV=Symbol.for(bW),bG=Symbol.for("effect/MetricKeyType/Frequency"),bY=Symbol.for("effect/MetricKeyType/Gauge"),bQ="effect/MetricKeyType/Histogram",bZ=Symbol.for(bQ),bX=Symbol.for("effect/MetricKeyType/Summary"),b0={_In:e=>e,_Out:e=>e};class b1{incremental;bigint;[bK]=b0;[bV]=bV;constructor(e,t){this.incremental=e,this.bigint=t,this._hash=eE(bW)}_hash;[ey](){return this._hash}[eT](e){return b5(e)}pipe(){return eV(this,arguments)}}class b2{boundaries;[bK]=b0;[bZ]=bZ;constructor(e){this.boundaries=e,this._hash=z(eE(bQ),eS(ev(this.boundaries)))}_hash;[ey](){return this._hash}[eT](e){return b8(e)&&eN(this.boundaries,e.boundaries)}pipe(){return eV(this,arguments)}}let b3=e=>new b1(e?.incremental??!1,e?.bigint??!1),b5=e=>X(e,bV),b4=e=>X(e,bG),b6=e=>X(e,bY),b8=e=>X(e,bZ),b7=e=>X(e,bX),b9=Symbol.for("effect/MetricKey"),xe={_Type:e=>e},xt=tL(eN);class xr{name;keyType;description;tags;[b9]=xe;constructor(e,t,r,n=[]){this.name=e,this.keyType=t,this.description=r,this.tags=n,this._hash=z(eE(this.name+this.description),eS(ev(this.keyType)),eS(eF(this.tags)))}_hash;[ey](){return this._hash}[eT](e){return xn(e)&&this.name===e.name&&eN(this.keyType,e.keyType)&&eN(this.description,e.description)&&xt(this.tags,e.tags)}pipe(){return eV(this,arguments)}}let xn=e=>X(e,b9),xi=(e,t)=>new xr(e,b3(t),tK(t?.description)),xs=R(2,(e,t)=>0===t.length?e:new xr(e.name,e.keyType,e.description,r$(e.tags,t))),xa=Symbol.for("effect/MutableHashMap"),xo={[xa]:xa,[Symbol.iterator](){return new xl(this)},toString(){return eD(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(eP)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}};class xl{self;referentialIterator;bucketIterator;constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(void 0!==this.bucketIterator)return this.bucketIterator.next();let e=this.referentialIterator.next();return e.done?(this.bucketIterator=new xc(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new xl(this.self)}}class xc{backing;constructor(e){this.backing=e}currentBucket;next(){if(void 0===this.currentBucket){let e=this.backing.next();if(e.done)return e;this.currentBucket=e.value[Symbol.iterator]()}let e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}let xu=()=>{let e=Object.create(xo);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},xh=R(2,(e,t)=>{if(!1===eM(t))return e.referential.has(t)?ty(e.referential.get(t)):tU();let r=t[ey](),n=e.buckets.get(r);return void 0===n?tU():xp(e,n,t)}),xp=(e,t,r,n=!1)=>{for(let i=0,s=t.length;i<s;i++)if(r[eT](t[i][0])){let r=t[i][1];return n&&(t.splice(i,1),e.bucketsSize--),ty(r)}return tU()},xf=R(2,(e,t)=>tb(xh(e,t))),xd=R(3,(e,t,r)=>{if(!1===eM(t))return e.referential.set(t,r),e;let n=t[ey](),i=e.buckets.get(n);return void 0===i?e.buckets.set(n,[[t,r]]):(xm(e,i,t),i.push([t,r])),e.bucketsSize++,e}),xm=(e,t,r)=>{for(let n=0,i=t.length;n<i;n++)if(r[eT](t[n][0])){t.splice(n,1),e.bucketsSize--;return}},xg=R(2,(e,t)=>{if(!1===eM(t))return e.referential.delete(t),e;let r=t[ey](),n=e.buckets.get(r);return void 0===n||(xm(e,n,t),0===n.length&&e.buckets.delete(r)),e}),xb=e=>e.referential.size+e.bucketsSize,xx=Symbol.for("effect/MetricState"),xy="effect/MetricState/Counter",xv=Symbol.for(xy),x_="effect/MetricState/Frequency",xS=Symbol.for(x_),xw="effect/MetricState/Gauge",xk=Symbol.for(xw),xC="effect/MetricState/Histogram",xE=Symbol.for(xC),xO="effect/MetricState/Summary",xI=Symbol.for(xO),xF={_A:e=>e};class xR{count;[xx]=xF;[xv]=xv;constructor(e){this.count=e}[ey](){return z(ev(xy),eS(ev(this.count)),eR(this))}[eT](e){return xU(e)&&this.count===e.count}pipe(){return eV(this,arguments)}}let xT=tL(eN);class xN{occurrences;[xx]=xF;[xS]=xS;constructor(e){this.occurrences=e}_hash;[ey](){return z(eE(x_),eS(eF(rc(this.occurrences.entries()))),eR(this))}[eT](e){return xq(e)&&xT(rc(this.occurrences.entries()),rc(e.occurrences.entries()))}pipe(){return eV(this,arguments)}}class xA{value;[xx]=xF;[xk]=xk;constructor(e){this.value=e}[ey](){return z(ev(xw),eS(ev(this.value)),eR(this))}[eT](e){return xB(e)&&this.value===e.value}pipe(){return eV(this,arguments)}}class xM{buckets;count;min;max;sum;[xx]=xF;[xE]=xE;constructor(e,t,r,n,i){this.buckets=e,this.count=t,this.min=r,this.max=n,this.sum=i}[ey](){return z(ev(xC),eS(ev(this.buckets)),eS(ev(this.count)),eS(ev(this.min)),eS(ev(this.max)),eS(ev(this.sum)),eR(this))}[eT](e){return xJ(e)&&eN(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eV(this,arguments)}}class xj{error;quantiles;count;min;max;sum;[xx]=xF;[xI]=xI;constructor(e,t,r,n,i,s){this.error=e,this.quantiles=t,this.count=r,this.min=n,this.max=i,this.sum=s}[ey](){return z(ev(xO),eS(ev(this.error)),eS(ev(this.quantiles)),eS(ev(this.count)),eS(ev(this.min)),eS(ev(this.max)),eS(ev(this.sum)),eR(this))}[eT](e){return xH(e)&&this.error===e.error&&eN(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eV(this,arguments)}}let xz=e=>new xR(e),xP=e=>new xN(e),xD=e=>new xA(e),xL=e=>new xM(e.buckets,e.count,e.min,e.max,e.sum),x$=e=>new xj(e.error,e.quantiles,e.count,e.min,e.max,e.sum),xU=e=>X(e,xv),xq=e=>X(e,xS),xB=e=>X(e,xk),xJ=e=>X(e,xE),xH=e=>X(e,xI),xK=Symbol.for("effect/MetricHook"),xW={_In:e=>e,_Out:e=>e},xV=e=>({[xK]:xW,pipe(){return eV(this,arguments)},...e}),xG=BigInt(0),xY=e=>{let t=e.keyType.bigint?xG:0,r=e.keyType.incremental?e.keyType.bigint?e=>e>=xG:e=>e>=0:e=>!0,n=e=>{r(e)&&(t+=e)};return xV({get:()=>xz(t),update:n,modify:n})},xQ=e=>{let t=new Map;for(let r of e.keyType.preregisteredWords)t.set(r,0);let r=e=>{let r=t.get(e)??0;t.set(e,r+1)};return xV({get:()=>xP(t),update:r,modify:r})},xZ=(e,t)=>{let r=t;return xV({get:()=>xD(r),update:e=>{r=e},modify:e=>{r+=e}})},xX=e=>{let t=e.keyType.boundaries.values,r=t.length,n=new Uint32Array(r+1),i=new Float32Array(r),s=0,a=0,o=Number.MAX_VALUE,l=Number.MIN_VALUE;z(t,rN(t8),rB((e,t)=>{i[t]=e}));let c=e=>{let t=0,c=r;for(;t!==c;){let r=Math.floor(t+(c-t)/2);e<=i[r]?c=r:t=r,c===t+1&&(e<=i[t]?c=t:t=c)}n[t]=n[t]+1,s+=1,a+=e,e<o&&(o=e),e>l&&(l=e)},u=()=>{let e=ro(r),t=0;for(let s=0;s<r;s++){let r=i[s];t+=n[s],e[s]=[r,t]}return e};return xV({get:()=>xL({buckets:u(),count:s,min:o,max:l,sum:a}),update:c,modify:c})},x0=e=>{let{error:t,maxAge:r,maxSize:n,quantiles:i}=e.keyType,s=z(i,rN(t8)),a=ro(n),o=0,l=0,c=0,u=Number.MAX_VALUE,h=Number.MIN_VALUE,p=e=>{let i=[],o=0;for(;o!==n-1;){let t=a[o];if(null!=t){let[n,s]=t,a=ar(e-n);ab(a,s9)&&a<=r&&i.push(s)}o+=1}return x1(t,s,rN(i,t8))},f=(e,t)=>{n>0&&(a[(o+=1)%n]=[t,e]),l+=1,c+=e,e<u&&(u=e),e>h&&(h=e)};return xV({get:()=>x$({error:t,quantiles:p(Date.now()),count:l,min:u,max:h,sum:c}),update:([e,t])=>f(e,t),modify:([e,t])=>f(e,t)})},x1=(e,t,r)=>{let n=r.length;if(!rx(t))return rU();let i=t[0],s=t.slice(1),a=x2(e,n,tU(),0,i,r),o=rq(a);return s.forEach(t=>{o.push(x2(e,n,a.value,a.consumed,t,a.rest))}),rB(o,e=>[e.quantile,e.value])},x2=(e,t,r,n,i,s)=>{let a=e,o=t,l=r,c=n,u=i,h=s,p=e,f=t,d=r,m=n,g=i,b=s;for(;;){if(!rx(h))return{quantile:u,value:tU(),consumed:c,rest:[]};if(1===u)return{quantile:u,value:ty(rE(h)),consumed:c+h.length,rest:[]};let e=rF(h,e=>e<=h[0]),t=u*o,r=a/2*t,n=c+e[0].length,i=Math.abs(n-t);if(n<t-r){p=a,f=o,d=rw(h),m=n,g=u,b=e[1],a=p,o=f,l=d,c=m,u=g,h=b;continue}if(n>t+r)return{quantile:u,value:l,consumed:c,rest:h};switch(l._tag){case"None":p=a,f=o,d=rw(h),m=n,g=u,b=e[1],a=p,o=f,l=d,c=m,u=g,h=b;continue;case"Some":if(i<Math.abs(t-l.value)){p=a,f=o,d=rw(h),m=n,g=u,b=e[1],a=p,o=f,l=d,c=m,u=g,h=b;continue}return{quantile:u,value:ty(l.value),consumed:c,rest:h}}}throw Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},x3=Symbol.for("effect/MetricPair"),x5={_Type:e=>e},x4=(e,t)=>({[x3]:x5,metricKey:e,metricState:t,pipe(){return eV(this,arguments)}}),x6=Symbol.for("effect/MetricRegistry");class x8{[x6]=x6;map=xu();snapshot(){let e=[];for(let[t,r]of this.map)e.push(x4(t,r.get()));return e}get(e){let t=z(this.map,xh(e),tW);if(null!=t)return t;if(b5(e.keyType))return this.getCounter(e);if(b6(e.keyType))return this.getGauge(e);if(b4(e.keyType))return this.getFrequency(e);if(b8(e.keyType))return this.getHistogram(e);if(b7(e.keyType))return this.getSummary(e);throw Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}getCounter(e){let t=z(this.map,xh(e),tW);if(null==t){let r=xY(e);z(this.map,xf(e))||z(this.map,xd(e,r)),t=r}return t}getFrequency(e){let t=z(this.map,xh(e),tW);if(null==t){let r=xQ(e);z(this.map,xf(e))||z(this.map,xd(e,r)),t=r}return t}getGauge(e){let t=z(this.map,xh(e),tW);if(null==t){let r=xZ(e,e.keyType.bigint?BigInt(0):0);z(this.map,xf(e))||z(this.map,xd(e,r)),t=r}return t}getHistogram(e){let t=z(this.map,xh(e),tW);if(null==t){let r=xX(e);z(this.map,xf(e))||z(this.map,xd(e,r)),t=r}return t}getSummary(e){let t=z(this.map,xh(e),tW);if(null==t){let r=x0(e);z(this.map,xf(e))||z(this.map,xd(e,r)),t=r}return t}}let x7=()=>new x8,x9=Symbol.for("effect/Metric"),ye={_Type:e=>e,_In:e=>e,_Out:e=>e},yt=$(Symbol.for("effect/Metric/globalMetricRegistry"),()=>x7()),yr=function(e,t,r,n){let i=Object.assign(e=>cD(e,e=>yo(i,e)),{[x9]:ye,keyType:e,unsafeUpdate:t,unsafeValue:r,unsafeModify:n,register(){return this.unsafeValue([]),this},pipe(){return eV(this,arguments)}});return i},yn=(e,t)=>yi(xi(e,t)),yi=e=>{let t;let r=new WeakMap,n=n=>{if(0===n.length)return void 0!==t?t:t=yt.get(e);let i=r.get(n);return void 0!==i||(i=yt.get(xs(e,n)),r.set(n,i)),i};return yr(e.keyType,(e,t)=>n(t).update(e),e=>n(e).get(),(e,t)=>n(t).modify(e))},ys=R(3,(e,t,r)=>ya(e,[go(t,r)])),ya=R(2,(e,t)=>yr(e.keyType,(r,n)=>e.unsafeUpdate(r,r$(t,n)),r=>e.unsafeValue(r$(t,r)),(r,n)=>e.unsafeModify(r,r$(t,n)))),yo=R(2,(e,t)=>ui(uF,r=>cP(()=>e.unsafeUpdate(t,r)))),yl="effect/MetricBoundaries",yc=Symbol.for(yl);class yu{values;[yc]=yc;constructor(e){this.values=e,this._hash=z(eE(yl),eS(eF(this.values)))}_hash;[ey](){return this._hash}[eT](e){return yh(e)&&eN(this.values,e.values)}pipe(){return eV(this,arguments)}}let yh=e=>X(e,yc),yp=R(2,(e,t)=>ui(m8,r=>cP(()=>{if(r.has(e)){let n=r.get(e);n.state.completed||(n.state.completed=!0,hC(n.result,t))}})));class yf{count=0;observers=new Set;interrupted=!1;addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}increment(){this.count++,this.observers.forEach(e=>e(this.count))}decrement(){this.count--,this.observers.forEach(e=>e(this.count))}}let yd=Symbol.for("effect/Supervisor"),ym={_T:e=>e};class yg{underlying;value0;[yd]=ym;constructor(e,t){this.underlying=e,this.value0=t}get value(){return this.value0}onStart(e,t,r,n){this.underlying.onStart(e,t,r,n)}onEnd(e,t){this.underlying.onEnd(e,t)}onEffect(e,t){this.underlying.onEffect(e,t)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new yg(this,z(this.value,cE(e)))}zip(e){return new yb(this,e)}}class yb{left;right;_tag="Zip";[yd]=ym;constructor(e,t){this.left=e,this.right=t}get value(){return cY(this.left.value,this.right.value)}onStart(e,t,r,n){this.left.onStart(e,t,r,n),this.right.onStart(e,t,r,n)}onEnd(e,t){this.left.onEnd(e,t),this.right.onEnd(e,t)}onEffect(e,t){this.left.onEffect(e,t),this.right.onEffect(e,t)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new yg(this,z(this.value,cE(e)))}zip(e){return new yb(this,e)}}let yx=e=>X(e,yd)&&ee(e,"Zip");class yy{[yd]=ym;fibers=new Set;get value(){return cP(()=>Array.from(this.fibers))}onStart(e,t,r,n){this.fibers.add(n)}onEnd(e,t){this.fibers.delete(t)}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new yg(this,z(this.value,cE(e)))}zip(e){return new yb(this,e)}onRun(e,t){return e()}}class yv{effect;[yd]=ym;constructor(e){this.effect=e}get value(){return this.effect}onStart(e,t,r,n){}onEnd(e,t){}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new yg(this,z(this.value,cE(e)))}zip(e){return new yb(this,e)}onRun(e,t){return e()}}let y_=cP(()=>new yy),yS=e=>new yv(e),yw=$("effect/Supervisor/none",()=>yS(cB)),yk="Empty",yC="AddSupervisor",yE="RemoveSupervisor",yO="AndThen",yI={_tag:yk},yF=(e,t)=>({_tag:yO,first:e,second:t}),yR=(e,t)=>{let r=e,n=t;for(;nk(n);){let e=nE(n);switch(e._tag){case yk:n=nT(n);break;case yC:r=r.zip(e.supervisor),n=nT(n);break;case yE:r=yT(r,e.supervisor),n=nT(n);break;case yO:n=nf(e.first)(nf(e.second)(nT(n)))}}return r},yT=(e,t)=>eN(e,t)?yw:yx(e)?yT(e.left,t).zip(yT(e.right,t)):e,yN=e=>eN(e,yw)?iv():yx(e)?z(yN(e.left),iR(yN(e.right))):iM(e),yA=lo({empty:yI,patch:(e,t)=>yR(t,nn(e)),combine:yF,diff:(e,t)=>{if(eN(e,t))return yI;let r=yN(e),n=yN(t),i=z(n,iF(r),iN(yI,(e,t)=>yF(e,{_tag:yC,supervisor:t}))),s=z(r,iF(n),iN(yI,(e,t)=>yF(e,{_tag:yE,supervisor:t})));return yF(i,s)}}),yM=yn("effect_fiber_started",{incremental:!0}),yj=yn("effect_fiber_active"),yz=yn("effect_fiber_successes",{incremental:!0}),yP=yn("effect_fiber_failures",{incremental:!0}),yD=ys(yi(new xr("effect_fiber_lifetimes",new b2(z(rl((s={start:.5,factor:2,count:35}).count-1,e=>s.start*Math.pow(s.factor,e)),nc,e=>new yu(z(e,rm(nn(Number.POSITIVE_INFINITY)),r1)))),tK(a))),"time_unit","milliseconds"),yL="Continue",y$="Yield",yU={_E:e=>e,_A:e=>e},yq=e=>{throw Error(`BUG: FiberRuntime - ${eU(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},yB=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),yJ=$("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),yH={[eX]:(e,t,r)=>em(()=>t.effect_instruction_i1(r)),OnStep:(e,t,r)=>hu(hu(r)),[e0]:(e,t,r)=>em(()=>t.effect_instruction_i2(r)),[e7]:(e,t,r)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),lS(e.currentRuntimeFlags)&&e.isInterrupted())?hn(e.getInterruptedCause()):hu(r),[e5]:(e,t,r)=>(em(()=>t.effect_instruction_i2(r)),em(()=>t.effect_instruction_i0()))?(e.pushStack(t),em(()=>t.effect_instruction_i1())):cB,[e4]:(e,t,r)=>{let n=em(()=>t.effect_instruction_i0.next(r));return n.done?hu(n.value):(e.pushStack(t),ef(n.value))}},yK={[gX]:(e,t,r,n)=>(e.processNewInterruptSignal(n.cause),lS(t)?hn(n.cause):r),[g1]:(e,t,r,n)=>{throw Error("It is illegal to have multiple concurrent run loops in a single fiber")},[g0]:(e,t,r,n)=>(n.onFiber(e,fX(t)),r),[g2]:(e,t,r,n)=>cp(cG(),()=>r)},yW=e=>cv(m$(e),e=>vn(m6(e),([e,t])=>{let r=new Map,n=[];for(let e of t)for(let t of(n.push(na(e)),e))r.set(t.request,t);let i=n.flat();return up(vD(e.runAll(n),i,()=>i.forEach(e=>{e.listeners.interrupted=!0})),m8,r)},!1,!1));class yV extends fp{[br]=bn;[bs]=yU;_fiberRefs;_fiberId;_queue=[];_children=null;_observers=[];_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(e,t,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=e,this._fiberRefs=t,lO(r)){let e=this.getFiberRef(uF);yM.unsafeUpdate(1,e),yj.unsafeUpdate(1,e)}this.refreshRefCache()}commit(){return bo(this)}id(){return this._fiberId}resume(e){this.tell(g4(e))}get status(){return this.ask((e,t)=>t)}get runtimeFlags(){return this.ask((e,t)=>f1(t)?e.currentRuntimeFlags:t.runtimeFlags)}scope(){return be(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return null===this._children&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(uT)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return cz(()=>{let t=hg(this._fiberId);return this.tell(g5((r,n)=>{hC(t,cP(()=>e(r,n)))})),hy(t)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return l4(e=>{let t=t=>e(cj(t));return this.tell(g5((e,r)=>{null!==e._exitValue?t(this._exitValue):e.addObserver(t)})),cP(()=>this.tell(g5((e,r)=>{e.removeObserver(t)})))},this.id())}get inheritAll(){return lZ((e,t)=>{let r=e.id(),n=e.getFiberRefs(),i=t.runtimeFlags,s=fC(n,r,this.getFiberRefs());return e.setFiberRefs(s),cJ(z(lF(i,e.getFiberRef(vT)),lb(1),lb(16)))})}get poll(){return cP(()=>tK(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return cP(()=>this.tell(g3(iW(e))))}unsafeInterruptAsFork(e){this.tell(g3(iW(e)))}addObserver(e){null!==this._exitValue?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(t=>t!==e)}getFiberRefs(){return this.setFiberRef(vT,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=fI(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,t){this._fiberRefs=fT(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:t}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(ft),this.currentTracer=this.currentDefaultServices.unsafeMap.get(p5.key),this.currentSupervisor=this.getFiberRef(vN),this.currentScheduler=this.getFiberRef(mP),this.currentContext=this.getFiberRef(uy),this.currentSpan=this.currentContext.unsafeMap.get(p4.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}transferChildren(e){let t=this._children;if(this._children=null,null!==t&&t.size>0)for(let r of t)null===r._exitValue&&e.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let t=yL,r=globalThis[bc];globalThis[bc]=this;try{for(;t===yL;)t=0===this._queue.length?"Done":this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[bc]=r}this._queue.length>0&&!this._running?(this._running=!0,t===y$?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(uv))}drainQueueWhileRunning(e,t){let r=t;for(;this._queue.length>0;){let t=this._queue.splice(0,1)[0];r=yK[t._tag](this,e,r,t)}return r}isInterrupted(){return!iZ(this.getFiberRef(uT))}addInterruptedCause(e){let t=this.getFiberRef(uT);this.setFiberRef(uT,iG(t,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(null===this._children||0===this._children.size)return!1;let e=!1;for(let t of this._children)t.tell(g3(iW(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){let e=this._children.values();this._children=null;let t=!1;return cK({while:()=>!t,body:()=>{let r=e.next();return r.done?cP(()=>{t=!0}):l1(r.value.await)},step:()=>{}})}return null}reportExitValue(e){if(lO(this.currentRuntimeFlags)){let t=this.getFiberRef(uF),r=this.id().startTimeMillis,n=Date.now();switch(yD.unsafeUpdate(n-r,t),yj.unsafeUpdate(-1,t),e._tag){case e1:yz.unsafeUpdate(1,t);break;case eQ:yP.unsafeUpdate(1,t)}}if("Failure"===e._tag){let t=this.getFiberRef(uI);i0(e.cause)||"Some"!==t._tag||this.log("Fiber terminated with an unhandled error",e.cause,t)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let t=this._observers.length-1;t>=0;t--)this._observers[t](e);this._observers=[]}getLoggers(){return this.getFiberRef(y3)}log(e,t,r){let n=tb(r)?r.value:this.getFiberRef(uw);if(f2(this.getFiberRef(yG),n))return;let i=this.getFiberRef(uk),s=this.getFiberRef(uS),a=this.getLoggers(),o=this.getFiberRefs();if(ij(a)>0){let r=new Date(s$(this.getFiberRef(ft),hP).unsafeCurrentTimeMillis());eK(o,()=>{for(let l of a)l.log({fiberId:this.id(),logLevel:n,message:e,cause:t,context:o,spans:i,annotations:s,date:r})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case g2:return y$;case gX:return this.processNewInterruptSignal(e.cause),null!==this._asyncInterruptor&&(this._asyncInterruptor(hn(e.cause)),this._asyncInterruptor=null),yL;case g1:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),yL;case g0:return e.onFiber(this,null!==this._exitValue?fQ:f0(this.currentRuntimeFlags,this._asyncBlockingOn)),yL;default:return yq(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let t=lS(this.currentRuntimeFlags)&&this.isInterrupted()?hn(this.getInterruptedCause()):e;for(;null!==t;){let e=t,r=this.runLoop(e);if(r===yB){let e=yJ.currentOp;yJ.currentOp=null,e._op===e8?lv(this.currentRuntimeFlags)?(this.tell(g6()),this.tell(g4(hh)),t=null):t=hh:e._op===eG&&(t=null)}else{this.currentRuntimeFlags=z(this.currentRuntimeFlags,l_(16));let e=this.interruptAllChildren();null!==e?t=cp(e,()=>r):(0===this._queue.length?this.setExitValue(r):this.tell(g4(r)),t=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(g4(e));else{this._running=!0;let t=globalThis[bc];globalThis[bc]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[bc]=t,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(g4(e))}patchRuntimeFlags(e,t){let r=lR(e,t);return globalThis[bc]=this,this.currentRuntimeFlags=r,r}initiateAsync(e,t){let r=!1,n=e=>{r||(r=!0,this.tell(g4(e)))};lS(e)&&(this._asyncInterruptor=n);try{t(n)}catch(e){n(cl(iK(e)))}}pushStack(e){this._stack.push(e),"OnStep"===e._op&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){let e=this._stack.pop();if(e)return"OnStep"===e._op&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==eZ)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==eX&&e._op!==e5&&e._op!==e4)return e;e=this.popStack()}}Tag(e){return cP(()=>s$(this.currentContext,e))}Left(e){return ca(e.left)}None(e){return ca(new uX)}Right(e){return hu(e.right)}Some(e){return hu(e.value)}Micro(e){return l3(t=>{let r=t,n=mx(d5(e,this.currentContext));return n.addObserver(e=>{if("Success"===e._tag)return r(hu(e.value));switch(e.cause._tag){case"Interrupt":return r(hn(iW(aH)));case"Fail":return r(ca(e.cause.error));case"Die":return r(cr(e.cause.defect))}}),l3(e=>{r=t=>{e(cB)},n.unsafeInterrupt()})})}[e2](e){let t=em(()=>e.effect_instruction_i0()),r=this.getNextSuccessCont();return void 0!==r?(r._op in yH||yq(r),yH[r._op](this,r,t)):(yJ.currentOp=hu(t),yB)}[e1](e){let t=this.getNextSuccessCont();return void 0!==t?(t._op in yH||yq(t),yH[t._op](this,t,e.effect_instruction_i0)):(yJ.currentOp=e,yB)}[eQ](e){let t=e.effect_instruction_i0,r=this.getNextFailCont();if(void 0===r)return yJ.currentOp=hn(t),yB;switch(r._op){case eZ:case e0:if(!(lS(this.currentRuntimeFlags)&&this.isInterrupted()))return em(()=>r.effect_instruction_i1(t));return hn(i7(t));case"OnStep":if(!(lS(this.currentRuntimeFlags)&&this.isInterrupted()))return hu(hn(t));return hn(i7(t));case e7:if(this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),lS(this.currentRuntimeFlags)&&this.isInterrupted())return hn(iG(t,this.getInterruptedCause()));return hn(t);default:yq(r)}}[e6](e){return em(()=>e.effect_instruction_i0(this,fX(this.currentRuntimeFlags)))}Blocked(e){let t=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){let n=[],i=this._steps[this._steps.length-1],s=this.popStack();for(;s&&"OnStep"!==s._op;)n.push(s),s=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;let a=fL(i.refs,t),o=lF(i.flags,r);return hu(lJ(e.effect_instruction_i0,lZ(t=>{for(;n.length>0;)t.pushStack(n.pop());return t.setFiberRefs(fU(t.id(),t.getFiberRefs())(a)),t.currentRuntimeFlags=lR(o)(t.currentRuntimeFlags),e.effect_instruction_i1})))}return cq(t=>cp(vs(lH(e.effect_instruction_i0)),()=>t(e.effect_instruction_i1)))}RunBlocked(e){return yW(e.effect_instruction_i0)}[e3](e){let t=e.effect_instruction_i0,r=this.currentRuntimeFlags,n=lR(r,t);if(lS(n)&&this.isInterrupted())return hn(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,t),!e.effect_instruction_i1)return hh;{let t=lF(n,r);return this.pushStack(new lW(t,e)),em(()=>e.effect_instruction_i1(r))}}[eX](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[eZ](e){return this.pushStack(e),e.effect_instruction_i0}[e0](e){return this.pushStack(e),e.effect_instruction_i0}[eG](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),yJ.currentOp=e,yB}[e8](e){return this._isYielding=!1,yJ.currentOp=e,yB}[e5](e){let t=e.effect_instruction_i0,r=e.effect_instruction_i1;return t()?(this.pushStack(e),r()):hh}[e4](e){return yH[e4](this,e,void 0)}[eY](e){return em(()=>e.commit())}runLoop(e){let t=e;for(this.currentOpCount=0;;){if((2&this.currentRuntimeFlags)!=0&&this.currentSupervisor.onEffect(this,t),this._queue.length>0&&(t=this.drainQueueWhileRunning(this.currentRuntimeFlags,t)),!this._isYielding){this.currentOpCount+=1;let e=this.currentScheduler.shouldYield(this);if(!1!==e){this._isYielding=!0,this.currentOpCount=0;let r=t;t=cp(cG({priority:e}),()=>r)}}try{if((t=this.currentTracer.context(()=>P()!==t[lK]._V?cn(`Cannot execute an Effect versioned ${t[lK]._V} with a Runtime of version ${P()}`):this[t._op](t),this))===yB){let e=yJ.currentOp;if(e._op===e8||e._op===eG)return yB;return yJ.currentOp=null,e._op===e1||e._op===eQ?e:hn(iK(e))}}catch(e){t=(t===yB||X(t,"_op"))&&t._op in this?lq(e)?hn(e.cause):uG(e)?hn(iG(iK(e),iW(aH))):cr(e):cn(`Not a valid effect: ${eU(t)}`)}}}run=()=>{this.drainQueueOnCurrentThread()}}let yG=$("effect/FiberRef/currentMinimumLogLevel",()=>ud(f3("Info"))),yY=e=>bp(t=>{s$(fR(t.context,ft),pY).unsafe.log(e.log(t))}),yQ=$(Symbol.for("effect/Logger/defaultLogger"),()=>yY(b_)),yZ=$(Symbol.for("effect/Logger/jsonLogger"),()=>yY(bI)),yX=$(Symbol.for("effect/Logger/logFmtLogger"),()=>yY(bC)),y0=$(Symbol.for("effect/Logger/prettyLogger"),()=>bH),y1=$(Symbol.for("effect/Logger/structuredLogger"),()=>yY(bE)),y2=$(Symbol.for("effect/Logger/tracerLogger"),()=>bp(({annotations:e,cause:t,context:r,fiberId:n,logLevel:i,message:s})=>{let a=sU(fR(r,uy),p4);if("None"===a._tag||"ExternalSpan"===a.value._tag)return;let o=s$(fR(r,ft),hP),l={};for(let[t,r]of e)l[t]=r;l["effect.fiberId"]=aB(n),l["effect.logLevel"]=i.label,null!==t&&"Empty"!==t._tag&&(l["effect.cause"]=sd(t,{renderErrorCause:!0})),a.value.event(eU(Array.isArray(s)?s[0]:s),o.unsafeCurrentTimeNanos(),l)})),y3=$(Symbol.for("effect/FiberRef/currentLoggers"),()=>um(iM(yQ,y2))),y5=R(3,(e,t,r)=>cp(vS,n=>{let i=[],s=cz(()=>{if(0===i.length)return cB;let e=i;return i=[],r(e)});return cq(r=>z(ge(t),cZ(s),g_,r,vs,cp(e=>uD(n,c0(e))),cZ(y6(()=>s)),l0(bp(t=>{i.push(e.log(t))}))))})),y4=R(e=>lQ(e[0]),(e,t)=>cU(cD(e,e=>y6(r=>t(e,r))))),y6=e=>lZ(t=>{let r=t.getFiberRefs(),n=t.currentRuntimeFlags;return cp(vS,t=>uL(t,t=>lZ(i=>{let s=i.getFiberRefs(),a=i.currentRuntimeFlags,o=fL(s,r),l=lF(a,n),c=fL(r,s);return i.setFiberRefs(fU(o,i.id(),r)),vP(cV(e(t),l),cP(()=>{i.setFiberRefs(fU(c,i.id(),i.getFiberRefs()))}))})))}),y8=(e=>ei(e[0])&&!lQ(e[0]),e=>{if(Array.isArray(e)||ei(e))return[e,tU()];let t=Object.keys(e),r=t.length;return[t.map(t=>e[t]),ty(e=>{let n={};for(let i=0;i<r;i++)n[t[i]]=e[i];return n})]}),y7=(e,t,r)=>{let n=[];for(let t of e)n.push(ci(t));return cp(vt(n,T,{concurrency:r?.concurrency,batching:r?.batching}),e=>{let n=tU(),i=e.length,s=Array(i),a=Array(i),o=!1;for(let t=0;t<i;t++){let r=e[t];"Left"===r._tag?(s[t]=ty(r.left),o=!0):(a[t]=r.right,s[t]=n)}return o?"Some"===t._tag?ca(t.value(s)):ca(s):r?.discard?cB:"Some"===t._tag?cj(t.value(a)):cj(a)})},y9=(e,t,r)=>{let n=[];for(let t of e)n.push(ci(t));return r?.discard?vt(n,T,{concurrency:r?.concurrency,batching:r?.batching,discard:!0}):cE(vt(n,T,{concurrency:r?.concurrency,batching:r?.batching}),e=>"Some"===t._tag?t.value(e):e)},ve=(e,t)=>{let[r,n]=y8(e);return t?.mode==="validate"?y7(r,n,t):t?.mode==="either"?y9(r,n,t):t?.discard!==!0&&"Some"===n._tag?cE(vt(r,T,t),n.value):vt(r,T,t)},vt=((e,t)=>Array.from({length:t},()=>e),R(e=>ei(e[0]),(e,t,r)=>lZ(n=>{let i=r?.batching===!0||r?.batching==="inherit"&&n.getFiberRef(uO);return r?.discard?m7(r.concurrency,()=>vp(fg,r?.concurrentFinalizers)(r=>i?vn(e,(e,n)=>r(t(e,n)),!0,!1,1):cv(e,(e,n)=>r(t(e,n)))),()=>vp(fy,r?.concurrentFinalizers)(r=>vn(e,(e,n)=>r(t(e,n)),i,!1)),n=>vp(fv(n),r?.concurrentFinalizers)(r=>vn(e,(e,n)=>r(t(e,n)),i,!1,n))):m7(r?.concurrency,()=>vp(fg,r?.concurrentFinalizers)(r=>i?vi(e,1,(e,n)=>r(t(e,n)),!0):cy(e,(e,n)=>r(t(e,n)))),()=>vp(fy,r?.concurrentFinalizers)(r=>vr(e,(e,n)=>r(t(e,n)),i)),n=>vp(fv(n),r?.concurrentFinalizers)(r=>vi(e,n,(e,n)=>r(t(e,n)),i)))}))),vr=(e,t,r)=>cz(()=>{let n=rc(e),i=Array(n.length);return cZ(vn(n,(e,r)=>cp(t(e,r),e=>cP(()=>i[r]=e)),r,!1),cj(i))}),vn=(e,t,r,n,i)=>cq(s=>cL(a=>lZ(o=>{let l=Array.from(e).reverse(),c=l.length;if(0===c)return cB;let u=0,h=!1,p=i?Math.min(l.length,i):l.length,f=new Set,d=[],m=()=>f.forEach(e=>{e.currentScheduler.scheduleTask(()=>{e.unsafeInterruptAsFork(o.id())},0)}),g=[],b=[],x=[],y=()=>{let e=d.filter(({exit:e})=>"Failure"===e._tag).sort((e,t)=>e.index<t.index?-1:e.index===t.index?0:1).map(({exit:e})=>e);return 0===e.length&&e.push(hh),e},v=(e,t=!1)=>{let r=cU(a(e)),n=vo(r,o,o.currentRuntimeFlags,bt);return o.currentScheduler.scheduleTask(()=>{t&&n.unsafeInterruptAsFork(o.id()),n.resume(r)},0),n},_=()=>{n||(c-=l.length,l=[]),h=!0,m()},S=r?cd:cs,w=v(l4(e=>{let n=(e,t)=>{"Blocked"===e._op?x.push(e):(d.push({index:t,exit:e}),"Failure"!==e._op||h||_())},a=()=>{if(l.length>0){let p=l.pop(),m=u++,_=()=>{let e=l.pop();return m=u++,cp(cG(),()=>cp(S(s(t(e,m))),w))},w=e=>l.length>0&&(n(e,m),l.length>0)?_():cj(e),k=v(cp(S(s(t(p,m))),w));g.push(k),f.add(k),h&&k.currentScheduler.scheduleTask(()=>{k.unsafeInterruptAsFork(o.id())},0),k.addObserver(t=>{let s;s="Failure"===t._op?t:t.effect_instruction_i0,b.push(k),f.delete(k),n(s,m),d.length===c?e(cj(tB(he(y(),{parallel:!0}),()=>hh))):x.length+d.length===c?e(cj(lJ(x.map(e=>e.effect_instruction_i0).reduce(mD),vn([tB(he(y(),{parallel:!0}),()=>hh),...x.map(e=>e.effect_instruction_i1)],e=>e,r,!0,i)))):a()})}};for(let e=0;e<p;e++)a()}));return l1(cF(cm(s(bo(w))),hl({onFailure:()=>{_();let e=x.length+1,t=Math.min("number"==typeof i?i:x.length,x.length),r=Array.from(x);return l4(n=>{let i=[],s=0,a=0,o=(t,a)=>o=>{i[t]=o,++s===e&&n(tG(he(i,{parallel:!0}))),r.length>0&&a&&l()},l=()=>{v(r.pop(),!0).addObserver(o(a,!0)),a++};w.addObserver(o(a,!1)),a++;for(let e=0;e<t;e++)l()})},onSuccess:()=>cy(b,e=>e.inheritAll)})))}))),vi=(e,t,r,n)=>cz(()=>{let i=rc(e),s=Array(i.length);return cZ(vn(i,(e,t)=>cE(r(e,t),e=>s[t]=e),n,!1,t),cj(s))}),vs=e=>vc(e,bt),va=(e,t,r,n=null)=>{let i=vl(e,t,r,n);return i.resume(e),i},vo=(e,t,r,n=null)=>vl(e,t,r,n),vl=(e,t,r,n=null)=>{let i=aV(),s=fE(t.getFiberRefs(),i),a=new yV(i,s,r),o=fR(s,uy),l=a.currentSupervisor;return l.onStart(o,e,ty(t),a),a.addObserver(e=>l.onEnd(e,a)),(null!==n?n:z(t.getFiberRef(uR),tB(()=>t.scope()))).add(r,a),a},vc=(e,t)=>lZ((r,n)=>cj(va(e,r,n.runtimeFlags,t))),vu=(e=>K(e[2]),e=>hF(t=>tq(sU(t,v_),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return cp(uU(t,fy),t=>vO(e,t))}}}))),vh=e=>t=>hF(r=>tq(sU(r,v_),{onNone:()=>t,onSome:r=>"ParallelN"===r.strategy._tag&&r.strategy.parallelism===e?t:cp(uU(r,fv(e)),e=>vO(t,e))})),vp=(e,t)=>r=>hF(n=>tq(sU(n,v_),{onNone:()=>r(T),onSome:n=>{if(!0!==t)return r(T);{let t="Parallel"===e._tag?vu:"Sequential"===e._tag?vm:vh(e.parallelism);switch(n.strategy._tag){case"Parallel":return t(r(vu));case"Sequential":return t(r(vm));case"ParallelN":return t(r(vh(n.strategy.parallelism)))}}}})),vf=e=>cp(v_,e),vd=e=>cp(vE(),t=>cF(e(t),e=>t.close(e))),vm=e=>hF(t=>tq(sU(t,v_),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return cp(uU(t,fg),t=>vO(e,t))}}})),vg=(e=>lQ(e[1]),e=>vR(ft,sz(py,e))),vb=R(e=>lQ(e[1]),(e,t,r)=>vv(e,t,(e,t)=>[e,t],r)),vx=R(e=>lQ(e[1]),(e,t,r)=>r?.concurrent!==!0&&(r?.batching===void 0||!1===r.batching)?cQ(e,t):vv(e,t,(e,t)=>e,r)),vy=R(e=>lQ(e[1]),(e,t,r)=>r?.concurrent!==!0&&(r?.batching===void 0||!1===r.batching)?cZ(e,t):vv(e,t,(e,t)=>t,r)),vv=R(e=>lQ(e[1]),(e,t,r,n)=>cE(ve([e,t],{concurrency:n?.concurrent?2:1,batching:n?.batching,concurrentFinalizers:n?.concurrentFinalizers}),([e,t])=>r(e,t))),v_=sB("effect/Scope"),vS=v_,vw=(e,t)=>{"Open"===e.state._tag&&e.state.finalizers.add(t)},vk={[uz]:uz,[uP]:uP,pipe(){return eV(this,arguments)},fork(e){return cP(()=>{let t=vC(e);if("Closed"===this.state._tag)return t.state=this.state,t;let r=e=>t.close(e);return this.state.finalizers.add(r),vw(t,e=>cP(()=>{"Open"===this.state._tag&&this.state.finalizers.delete(r)})),t})},close(e){return cz(()=>{if("Closed"===this.state._tag)return cB;let t=Array.from(this.state.finalizers.values()).reverse();return(this.state={_tag:"Closed",exit:e},0===t.length)?cB:fb(this.strategy)?z(cy(t,t=>cs(t(e))),cp(e=>z(he(e),tY(u9),tB(()=>hh)))):fx(this.strategy)?z(vr(t,t=>cs(t(e)),!1),cp(e=>z(he(e,{parallel:!0}),tY(u9),tB(()=>hh)))):z(vi(t,this.strategy.parallelism,t=>cs(t(e)),!1),cp(e=>z(he(e,{parallel:!0}),tY(u9),tB(()=>hh))))})},addFinalizer(e){return cz(()=>"Closed"===this.state._tag?e(this.state.exit):(this.state.finalizers.add(e),cB))}},vC=(e=fg)=>{let t=Object.create(vk);return t.strategy=e,t.state={_tag:"Open",finalizers:new Set},t},vE=(e=fg)=>cP(()=>vC(e)),vO=R(2,(e,t)=>hN(e,sq(sj(v_,t)))),vI=R(2,(e,t)=>z(e,vO(t),cF(e=>t.close(e)))),vF=R(2,(e,t)=>l1(y4(cp(un(e),r=>l0(us(e,t),r)),t=>us(e,t)))),vR=R(2,(e,t)=>ui(e,r=>vF(e,t(r)))),vT=ux(lE,{differ:lT,fork:lT.empty}),vN=ux(yw,{differ:yA,fork:yI}),vA=R(3,(e,t,r)=>vj(e,t,{onSelfWin:(e,t)=>cp(e.await,n=>{switch(n._tag){case e1:return cp(e.inheritAll,()=>r.onSelfDone(n,t));case eQ:return r.onSelfDone(n,t)}}),onOtherWin:(e,t)=>cp(e.await,n=>{switch(n._tag){case e1:return cp(e.inheritAll,()=>r.onOtherDone(n,t));case eQ:return r.onOtherDone(n,t)}})})),vM=R(2,(e,t)=>ch(r=>vA(e,t,{onSelfDone:(e,t)=>hc(e,{onFailure:e=>z(bo(t),gR(t=>iV(e,t))),onSuccess:e=>z(t,c1(r),l0(e))}),onOtherDone:(e,t)=>hc(e,{onFailure:e=>z(bo(t),gR(t=>iV(t,e))),onSuccess:e=>z(t,c1(r),l0(e))})}))),vj=R(3,(e,t,r)=>lZ((n,i)=>{let s=i.runtimeFlags,a=aw(!0),o=vl(e,n,s,r.selfScope),l=vl(t,n,s,r.otherScope);return l4(n=>{o.addObserver(()=>vz(o,l,r.onSelfWin,a,n)),l.addObserver(()=>vz(l,o,r.onOtherWin,a,n)),o.startFork(e),l.startFork(t)},aL(o.id(),l.id()))})),vz=(e,t,r,n,i)=>{ak(!0,!1)(n)&&i(r(e,t))},vP=R(2,(e,t)=>cq(r=>cb(r(e),{onFailure:e=>cb(t,{onFailure:t=>cl(iG(e,t)),onSuccess:()=>cl(e)}),onSuccess:e=>l0(t,e)}))),vD=(e,t,r)=>ch(n=>cp(cp(vs(ck(e)),e=>l4(n=>{let i=t.map(e=>e.listeners.count),s=()=>{i.every(e=>0===e)&&t.every(e=>"Pending"===e.result.state.current._tag||!!("Done"===e.result.state.current._tag&&u4(e.result.state.current.effect)&&"Failure"===e.result.state.current.effect._tag&&iX(e.result.state.current.effect.cause)))&&(a.forEach(e=>e()),r?.(),n(c0(e)))};e.addObserver(e=>{a.forEach(e=>e()),n(e)});let a=t.map((e,t)=>{let r=e=>{i[t]=e,s()};return e.listeners.addObserver(r),()=>e.listeners.removeObserver(r)});return s(),cP(()=>{a.forEach(e=>e())})})),()=>cz(()=>cv(t.flatMap(e=>e.state.completed?[]:[e]),e=>yp(e.request,ha(n)))))),vL=e=>e._tag===iz,v$=e=>sh(e,{onEmpty:ty(iJ),onFail:e=>z(e,tY(iH)),onDie:e=>ty(iK(e)),onInterrupt:e=>ty(iW(e)),onSequential:(e,t)=>tb(e)&&tb(t)?ty(iG(e.value,t.value)):tg(e)&&tb(t)?ty(t.value):tb(e)&&tg(t)?ty(e.value):tU(),onParallel:(e,t)=>tb(e)&&tb(t)?ty(iV(e.value,t.value)):tg(e)&&tb(t)?ty(t.value):tb(e)&&tg(t)?ty(e.value):tU()}),vU=e=>uq(T)(e),vq=e=>X(e,uZ),vB=e=>X(e,uH),vJ=Symbol.for("effect/DateTime"),vH=Symbol.for("effect/DateTime/TimeZone"),vK={[vJ]:vJ,pipe(){return eV(this,arguments)},[ez](){return this.toString()},toJSON(){return v4(this).toJSON()}},vW={...vK,_tag:"Utc",[ey](){return eR(this,eC(this.epochMillis))},[eT](e){return vX(e)&&"Utc"===e._tag&&this.epochMillis===e.epochMillis},toString(){return`DateTime.Utc(${v4(this).toJSON()})`}},vV={...vK,_tag:"Zoned",[ey](){return z(eC(this.epochMillis),eS(ev(this.zone)),eR(this))},[eT](e){return vX(e)&&"Zoned"===e._tag&&this.epochMillis===e.epochMillis&&eN(this.zone,e.zone)},toString(){return`DateTime.Zoned(${_h(this)})`}},vG={[vH]:vH,[ez](){return this.toString()}},vY={...vG,_tag:"Named",[ey](){return eR(this,eE(`Named:${this.id}`))},[eT](e){return v0(e)&&"Named"===e._tag&&this.id===e.id},toString(){return`TimeZone.Named(${this.id})`},toJSON(){return{_id:"TimeZone",_tag:"Named",id:this.id}}},vQ={...vG,_tag:"Offset",[ey](){return eR(this,eE(`Offset:${this.offset}`))},[eT](e){return v0(e)&&"Offset"===e._tag&&this.offset===e.offset},toString(){return`TimeZone.Offset(${v7(this.offset)})`},toJSON(){return{_id:"TimeZone",_tag:"Offset",offset:this.offset}}},vZ=(e,t,r)=>{let n=Object.create(vV);return n.epochMillis=e,n.zone=t,n.partsUtc=r,n},vX=e=>X(e,vJ),v0=e=>X(e,vH),v1=e=>{let t=Object.create(vW);return t.epochMillis=e,t},v2=(e=>vX(e[0]),$("effect/DateTime/validZoneCache",()=>new Map)),v3={day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"longOffset",fractionalSecondDigits:3,hourCycle:"h23"},v5=e=>{let t=e.resolvedOptions().timeZone;if(v2.has(t))return v2.get(t);let r=Object.create(vY);return r.id=t,r.format=e,v2.set(t,r),r},v4=(e=>{if(v2.has(e))return v2.get(e);try{return v5(new Intl.DateTimeFormat("en-US",{...v3,timeZone:e}))}catch(t){throw new uQ(`Invalid time zone: ${e}`)}},e=>new Date(e.epochMillis)),v6=e=>{if("Utc"===e._tag)return new Date(e.epochMillis);if("Offset"===e.zone._tag)return new Date(e.epochMillis+e.zone.offset);if(void 0!==e.adjustedEpochMillis)return new Date(e.adjustedEpochMillis);let t=e.zone.format.formatToParts(e.epochMillis).filter(e=>"literal"!==e.type),r=new Date(0);return r.setUTCFullYear(Number(t[2].value),Number(t[0].value)-1,Number(t[1].value)),r.setUTCHours(Number(t[3].value),Number(t[4].value),Number(t[5].value),Number(t[6].value)),e.adjustedEpochMillis=r.getTime(),r},v8=e=>v6(e).getTime()-_e(e),v7=e=>{let t=Math.abs(e);return`${e<0?"-":"+"}${String(Math.floor(t/36e5)).padStart(2,"0")}:${String(Math.round(t%36e5/6e4)).padStart(2,"0")}`},v9=e=>v7(v8(e)),_e=e=>e.epochMillis,_t=e=>({millis:e.getUTCMilliseconds(),seconds:e.getUTCSeconds(),minutes:e.getUTCMinutes(),hours:e.getUTCHours(),day:e.getUTCDate(),weekDay:e.getUTCDay(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}),_r=(e,t)=>{let r="Offset"===t._tag?t.offset:_s(e,t);return vZ(e-r,t)},_n=/([+-])(\d{2}):(\d{2})$/,_i=e=>{let t=_n.exec(e);if(null===t)return null;let[,r,n,i]=t;return("+"===r?1:-1)*(60*Number(n)+Number(i))*6e4},_s=(e,t)=>{let r=t.format.formatToParts(e).find(e=>"timeZoneName"===e.type)?.value??"";if("GMT"===r)return 0;let n=_i(r);return null===n?v8(vZ(e,t)):n},_a=R(2,(e,t)=>{if("Utc"===e._tag){let r=v4(e);return t(r),v1(r.getTime())}let r=new Date(v6(e).getTime());return t(r),_r(r.getTime(),e.zone)}),_o=((e,t)=>_o(e,e=>{let r=new Date(e);return t(r),r.getTime()}),R(2,(e,t)=>{let r=t(_e(e));return"Utc"===e._tag?v1(r):vZ(r,e.zone)})),_l=((e,t)=>t(v6(e)),R(2,(e,t)=>t(v4(e)))),_c=(e,t)=>{e.setTime(e.getTime()+t)},_u=((e,t)=>_a(e,e=>{if(t.millis&&_c(e,t.millis),t.seconds&&_c(e,1e3*t.seconds),t.minutes&&_c(e,6e4*t.minutes),t.hours&&_c(e,36e5*t.hours),t.days&&e.setUTCDate(e.getUTCDate()+t.days),t.weeks&&e.setUTCDate(e.getUTCDate()+7*t.weeks),t.months){let r=e.getUTCDate();e.setUTCMonth(e.getUTCMonth()+t.months+1,0),r<e.getUTCDate()&&e.setUTCDate(r)}if(t.years){let r=e.getUTCDate(),n=e.getUTCMonth();e.setUTCFullYear(e.getUTCFullYear()+t.years,n+1,0),r<e.getUTCDate()&&e.setUTCDate(r)}}),e=>{let t=v6(e);return"Utc"===e._tag?t.toISOString():`${t.toISOString().slice(0,-1)}${v9(e)}`}),_h=e=>"Offset"===e.zone._tag?_u(e):`${_u(e)}[${e.zone.id}]`;class _p{s;stripped;index;length;constructor(e,t=!1){this.s=e,this.stripped=t,this.index=0,this.length=e.length}next(){if(this.done)return{done:!0,value:void 0};let e=this.index;for(;!this.done&&!_f(this.s[this.index]);)this.index=this.index+1;let t=this.index;if(!this.done){let e=this.s[this.index];this.index=this.index+1,!this.done&&_d(e,this.s[this.index])&&(this.index=this.index+1),this.stripped||(t=this.index)}return{done:!1,value:this.s.substring(e,t)}}[Symbol.iterator](){return new _p(this.s,this.stripped)}get done(){return this.index>=this.length}}let _f=e=>{let t=e.charCodeAt(0);return 13===t||10===t},_d=(e,t)=>13===e.charCodeAt(0)&&10===t.charCodeAt(0),_m=((e,t)=>_g(e.seconds,t.seconds)&&_g(e.minutes,t.minutes)&&_g(e.hours,t.hours)&&_g(e.days,t.days)&&_g(e.months,t.months)&&_g(e.weekdays,t.weekdays),tL((e,t)=>e===t)),_g=(e,t)=>_m(rc(e),rc(t)),_b=Symbol.for("effect/ScheduleInterval"),_x={[_b]:_b,startMillis:0,endMillis:0},_y=(e,t)=>e>t?_x:{[_b]:_b,startMillis:e,endMillis:t},_v=R(2,(e,t)=>__(e,t)===e),__=R(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),_S=R(2,(e,t)=>_y(Math.max(e.startMillis,t.startMillis),Math.min(e.endMillis,t.endMillis))),_w=e=>e.startMillis>=e.endMillis,_k=e=>ar(e.endMillis-e.startMillis),_C=e=>_y(e,Number.POSITIVE_INFINITY),_E=Symbol.for("effect/ScheduleIntervals"),_O=e=>({[_E]:_E,intervals:e}),_I=R(2,(e,t)=>nk(t.intervals)?nk(e.intervals)?nE(e.intervals).startMillis<nE(t.intervals).startMillis?_F(nT(e.intervals),t.intervals,nE(e.intervals),nt()):_F(e.intervals,nT(t.intervals),nE(t.intervals),nt()):t:e),_F=(e,t,r,n)=>{let i=e,s=t,a=r,o=n;for(;nk(i)||nk(s);)if(!nk(i)&&nk(s))a.endMillis<nE(s).startMillis?(o=z(o,nf(a)),a=nE(s)):a=_y(a.startMillis,nE(s).endMillis),s=nT(s),i=nt();else if(nk(i)&&nw(s))a.endMillis<nE(i).startMillis?(o=z(o,nf(a)),a=nE(i)):a=_y(a.startMillis,nE(i).endMillis),s=nt(),i=nT(i);else if(nk(i)&&nk(s))nE(i).startMillis<nE(s).startMillis?(a.endMillis<nE(i).startMillis?(o=z(o,nf(a)),a=nE(i)):a=_y(a.startMillis,nE(i).endMillis),i=nT(i)):(a.endMillis<nE(s).startMillis?(o=z(o,nf(a)),a=nE(s)):a=_y(a.startMillis,nE(s).endMillis),s=nT(s));else throw Error(eo("Intervals.unionLoop"));return _O(z(o,nf(a),no))},_R=R(2,(e,t)=>_T(e.intervals,t.intervals,nt())),_T=(e,t,r)=>{let n=e,i=t,s=r;for(;nk(n)&&nk(i);){let e=z(nE(n),_S(nE(i))),t=_w(e)?s:z(s,nf(e));z(nE(n),_v(nE(i)))?n=nT(n):i=nT(i),s=t}return _O(no(s))},_N=e=>z(e.intervals,nC,tB(()=>_x)).startMillis,_A=R(2,(e,t)=>_N(e)<_N(t)),_M=((e,t)=>_A(e,t)?t:e,e=>z(e.intervals,nC,tB(()=>_x)).endMillis),_j=e=>nk(e.intervals),_z="Continue",_P="Done",_D=e=>({_tag:_z,intervals:e}),_L=e=>({_tag:_z,intervals:_O(nn(e))}),_$={_tag:_P},_U=e=>e._tag===_z,_q=e=>e._tag===_P,_B=Symbol.for("effect/Schedule"),_J=e=>X(e,_B),_H=Symbol.for("effect/ScheduleDriver"),_K={_Out:e=>e,_In:e=>e,_R:e=>e},_W={_Out:e=>e,_In:e=>e,_R:e=>e};class _V{initial;step;[_B]=_K;constructor(e,t){this.initial=e,this.step=t}pipe(){return eV(this,arguments)}}class _G{schedule;ref;[_H]=_W;constructor(e,t){this.schedule=e,this.ref=t}get state(){return cE(mI(this.ref),e=>e[1])}get last(){return cp(mI(this.ref),([e,t])=>{switch(e._tag){case"None":return co(()=>new uX);case"Some":return cj(e.value)}})}get reset(){return mF(this.ref,[tU(),this.schedule.initial])}next(e){return z(cE(mI(this.ref),e=>e[1]),cp(t=>z(fi,cp(r=>z(cz(()=>this.schedule.step(r,e,t)),cp(([e,t,n])=>{let i=mF(this.ref,[ty(t),e]);if(_q(n))return cZ(i,ca(tU()));let s=_N(n.intervals)-r;return s<=0?l0(i,t):z(i,cZ(ge(ar(s))),l0(t))}))))))}}let _Y=(e,t)=>new _V(e,t),_Q=((e,t)=>_Q(e,e=>cP(()=>t(e))),R(2,(e,t)=>_8(e,(e,r)=>cE(t(e),e=>am(r,s2(e)))))),_Z=((e,t)=>_Y([e.initial,t.initial,!0],(r,n,i)=>i[2]?cp(e.step(r,n,i[0]),([e,s,a])=>_q(a)?cE(t.step(r,n,i[1]),([t,r,n])=>[[e,t,!1],tI(r),n]):cj([[e,i[1],!0],tO(s),a])):cE(t.step(r,n,i[1]),([e,t,r])=>[[i[0],e,!1],tI(t),r])),R(2,(e,t)=>_X(e,(e,r)=>cP(()=>t(e,r))))),_X=R(2,(e,t)=>_Y(e.initial,(r,n,i)=>cp(e.step(r,n,i),([e,r,i])=>_q(i)?cj([e,r,_$]):cE(t(n,r),t=>t?[e,r,i]:[e,r,_$])))),_0=((e,t)=>_0(e,e=>cP(()=>t(e))),R(2,(e,t)=>_Y(e.initial,(r,n,i)=>cp(t(n),t=>e.step(r,t,i))))),_1=((e,t)=>_8(e,(e,r)=>t(r)),e=>z(mO([tU(),e.initial]),cE(t=>new _G(e,t)))),_2=R(2,(e,t)=>_3(e,t,_R)),_3=R(3,(e,t,r)=>_Y([e.initial,t.initial],(n,i,s)=>z(cX(e.step(n,i,s[0]),t.step(n,i,s[1]),(e,t)=>[e,t]),cp(([[n,s,a],[o,l,c]])=>_U(a)&&_U(c)?_5(e,t,i,n,s,a.intervals,o,l,c.intervals,r):cj([[n,o],[s,l],_$]))))),_5=(e,t,r,n,i,s,a,o,l,c)=>{let u=c(s,l);return _j(u)?cj([[n,a],[i,o],_D(u)]):z(s,_A(l))?cp(e.step(_M(s),r,n),([n,i,s])=>_q(s)?cj([[n,a],[i,o],_$]):_5(e,t,r,n,i,s.intervals,a,o,l,c)):cp(t.step(_M(l),r,a),([a,o,l])=>_q(l)?cj([[n,a],[i,o],_$]):_5(e,t,r,n,i,s,a,o,l.intervals,c))},_4=R(2,(e,t)=>_6(e,e=>cP(()=>t(e)))),_6=R(2,(e,t)=>_Y(e.initial,(r,n,i)=>cp(e.step(r,n,i),([e,r,n])=>cE(t(r),t=>[e,t,n])))),_8=R(2,(e,t)=>_Y(e.initial,(r,n,i)=>cp(e.step(r,n,i),([e,n,i])=>{if(_q(i))return cj([e,n,i]);let s=i.intervals;return cE(t(n,_k(_y(r,_N(s)))),t=>{let i=s2(t),a=_N(s),o=r+al(i),l=o-a;return[e,n,_L(_y(o,Math.max(0,_M(s)+l)))]})}))),_7=e=>_Y(e.initial,(t,r,n)=>z(e.step(t,r,n),cE(([e,t,n])=>[e,r,n]))),_9=e=>Sn(Sx,t=>t<e),Se=((e,t,r)=>_Y([e.initial,t],(t,n,[i,s])=>cp(e.step(t,n,i),([e,t,n])=>_q(n)?cj([[e,s],s,n]):cE(r(s,t),t=>[[e,t],s,n]))),R(3,(e,t,r)=>_Y([e.initial,t.initial],(n,i,s)=>cX(e.step(n,i,s[0]),t.step(n,i,s[1]),([e,t,n],[i,s,a])=>{if(_q(n)&&_q(a))return[[e,i],[t,s],_$];if(_q(n)&&_U(a))return[[e,i],[t,s],_D(a.intervals)];if(_U(n)&&_q(a))return[[e,i],[t,s],_D(n.intervals)];if(_U(n)&&_U(a))return[[e,i],[t,s],_D(r(n.intervals,a.intervals))];throw Error("BUG: Schedule.unionWith - please report an issue at https://github.com/Effect-TS/effect/issues")})))),St=R(2,(e,t)=>_X(e,(e,r)=>gT(t(e)))),Sr=R(2,(e,t)=>_X(e,(e,r)=>t(e))),Sn=R(2,(e,t)=>_Z(e,(e,r)=>t(r))),Si=((e,t)=>_4(_2(e,t),e=>e[0]),Symbol.for("effect/Schedule/ScheduleDefect"));class Ss{error;[Si];constructor(e){this.error=e,this[Si]=Si}}let Sa=e=>X(e,Si),So=e=>l8(e,e=>cr(new Ss(e))),Sl=e=>l6(e,e=>tq(sa(e,e=>iQ(e)&&Sa(e.defect)?ty(e.defect):tU()),{onNone:()=>cl(e),onSome:e=>ca(e.error)})),Sc=R(2,(e,t)=>Sh(e,t,(e,t)=>ca(e))),Su=R(2,(e,t)=>{if(_J(t))return Sc(e,t);let r=t.schedule??_7(Sx),n=t.while?Sr(r,e=>{let r=t.while(e);return"boolean"==typeof r?cj(r):So(r)}):r,i=t.until?St(n,e=>{let r=t.until(e);return"boolean"==typeof r?cj(r):So(r)}):n;return Sl(Sc(e,t.times?_2(i,_9(t.times)).pipe(_4(e=>e[0])):i))}),Sh=R(3,(e,t,r)=>cp(_1(t),t=>cx(e,{onFailure:e=>r(e,tU()),onSuccess:n=>Sp(e,t,r,n)}))),Sp=(e,t,r,n)=>cx(t.next(n),{onFailure:()=>cN(t.last),onSuccess:n=>cx(e,{onFailure:e=>r(e,ty(n)),onSuccess:n=>Sp(e,t,r,n)})}),Sf=R(2,(e,t)=>Sd(e,t,(e,t)=>ca(e))),Sd=((e,t)=>{if(_J(t))return Sf(e,t);let r=t.schedule??Sx,n=t.while?Sr(r,e=>{let r=t.while(e);return"boolean"==typeof r?cj(r):So(r)}):r,i=t.until?St(n,e=>{let r=t.until(e);return"boolean"==typeof r?cj(r):So(r)}):n;return Sl(Sf(e,t.times?_2(i,_9(t.times)):i))},R(3,(e,t,r)=>cp(_1(t),t=>Sm(e,t,r)))),Sm=(e,t,r)=>l8(e,n=>cx(t.next(n),{onFailure:()=>z(t.last,cN,cp(e=>r(n,e))),onSuccess:()=>Sm(e,t,r)})),Sg=((e,t)=>Sg(e,void 0,t),R(3,(e,t,r)=>cp(_1(r),r=>Sb(e,t,r)))),Sb=(e,t,r)=>cx(r.next(t),{onFailure:()=>cN(r.last),onSuccess:()=>cp(e,t=>Sb(e,t,r))}),Sx=(o=e=>e+1,_Y(0,(e,t,r)=>cP(()=>[o(r),r,_L(_C(e))])));class Sy{permits;waiters=new Set;taken=0;constructor(e){this.permits=e}get free(){return this.permits-this.taken}take=e=>l5(t=>{if(this.free<e){let r=()=>{this.free<e||(this.waiters.delete(r),this.taken+=e,t(cj(e)))};return this.waiters.add(r),cP(()=>{this.waiters.delete(r)})}return this.taken+=e,t(cj(e))});updateTaken=e=>lZ(t=>(this.taken=e(this.taken),this.waiters.size>0&&t.getFiberRef(mP).scheduleTask(()=>{let e=this.waiters.values(),t=e.next();for(;!1===t.done&&this.free>0;)t.value(),t=e.next()},t.getFiberRef(uv)),cj(this.free)));release=e=>this.updateTaken(t=>t-e);releaseAll=this.updateTaken(e=>0);withPermits=e=>t=>cq(r=>cp(r(this.take(e)),e=>vP(r(t),this.release(e))));withPermitsIfAvailable=e=>t=>cq(r=>cz(()=>this.free<e?gP:(this.taken+=e,vP(r(gu(t)),this.release(e)))))}let Sv=e=>new Sy(e),S_=((e,t)=>{let r=s2(t);return cp(hI(),t=>cE(SA(tU()),n=>[hR(SS(e,r,n),t),Sw(n)]))},(e,t,r)=>{let n=al(s2(t));return z(hb(),cD(t=>cC(e,t)),cE(e=>ty([r+n,e])))}),SS=(e,t,r)=>cq(n=>z(fn(e=>e.currentTimeMillis),cp(n=>Sj(r,r=>{switch(r._tag){case"None":return ty(S_(e,t,n));case"Some":{let[i]=r.value;return i-n<=0?ty(S_(e,t,n)):tU()}}})),cp(e=>tg(e)?cn("BUG: Effect.cachedInvalidate - please report an issue at https://github.com/Effect-TS/effect/issues"):n(hy(e.value[1]))))),Sw=e=>mF(e,tU()),Sk=((e,t)=>cp(y_,r=>z(SO(e,r),vP(cp(r.value,t)))),R(2,(e,t)=>cq(r=>cp(t.fork(fg),t=>z(r(e),cF(e=>t.close(e)),vs,cD(e=>t.addFinalizer(()=>ch(t=>eN(t,e.id())?cB:l1(c0(e)))))))))),SC=e=>vf(t=>Sk(e,t)),SE=R(2,(e,t)=>z(cs(e),vM(cs(t)),e=>cm(e))),SO=R(2,(e,t)=>uf(vN,e=>e.zip(t))(e)),SI=((e,{duration:t,onTimeout:r})=>cm(SF(e,{onTimeout:()=>co(r),onSuccess:cj,duration:t})),R(2,(e,{duration:t,onTimeout:r})=>cm(SF(e,{onTimeout:()=>cc(r),onSuccess:cj,duration:t})))),SF=R(2,(e,{duration:t,onSuccess:r,onTimeout:n})=>ch(i=>vj(e,ck(ge(t)),{onSelfWin:(e,t)=>cp(e.await,n=>"Success"===n._tag?cp(e.inheritAll,()=>l0(c1(t,i),r(n.value))):cp(c1(t,i),()=>hn(n.cause))),onOtherWin:(e,t)=>cp(e.await,r=>"Success"===r._tag?cp(e.inheritAll,()=>l0(c1(t,i),n())):cp(c1(t,i),()=>hn(r.cause))),otherScope:bt}))),SR=Symbol.for("effect/Ref/SynchronizedRef"),ST={_A:e=>e};class SN extends fp{ref;withLock;[SR]=ST;[mw]=mk;[mS]=mS;constructor(e,t){super(),this.ref=e,this.withLock=t,this.get=mI(this.ref)}get;commit(){return this.get}modify(e){return this.modifyEffect(t=>cj(e(t)))}modifyEffect(e){return this.withLock(z(cp(mI(this.ref),e),cp(([e,t])=>l0(mF(this.ref,t),e))))}}let SA=e=>cP(()=>SM(e)),SM=e=>new SN(mE(e),Sv(1).withPermits(1)),Sj=R(2,(e,t)=>e.modifyEffect(e=>{let r=t(e);switch(r._tag){case"None":return cj([e,e]);case"Some":return cE(r.value,e=>[e,e])}})),Sz=((e,t,r)=>({...ta,commit(){return bo(this)},[br]:bn,id:()=>z(e.id(),a$(t.id())),await:z(e.await,cm,vv(cm(t.await),r,{concurrent:!0}),cs),children:e.children,inheritAll:cZ(t.inheritAll,e.inheritAll),poll:cX(e.poll,t.poll,(e,t)=>z(e,tQ(e=>z(t,tY(t=>hd(e,t,{onSuccess:r,onFailure:iV})))))),interruptAsFork:r=>cZ(e.interruptAsFork(r),t.interruptAsFork(r)),pipe(){return eV(this,arguments)}}),Symbol.for("effect/ManagedRuntime")),SP="Fresh",SD="ProvideMerge",SL=e=>e.inheritAll,S$=e=>e.poll,SU=e=>(t,r)=>{let n=aV(),i=[[uy,[[n,e.context]]]];r?.scheduler&&i.push([mP,[[n,r.scheduler]]]);let s=fA(e.fiberRefs,{entries:i,forkAs:n});r?.updateRefs&&(s=r.updateRefs(s,n));let a=new yV(n,s,e.runtimeFlags),o=t;r?.scope&&(o=cp(uU(r.scope,fg),e=>cZ(uD(e,ch(e=>eN(e,a.id())?cB:c1(a,e))),cF(t,t=>u$(e,t)))));let l=a.currentSupervisor;return l!==yw&&(l.onStart(e.context,o,tU(),a),a.addObserver(e=>l.onEnd(e,a))),bt.add(e.runtimeFlags,a),r?.immediate===!1?a.resume(o):a.start(o),a},Sq=e=>(t,r={})=>{let n=SU(e)(t,r);return r.onExit&&n.addObserver(e=>{r.onExit(e)}),(t,r)=>Sq(e)(z(n,c1(t??aH)),{...r,onExit:r?.onExit?e=>r.onExit(gZ(e)):void 0})},SB=e=>t=>{let r=SQ(e)(t);if("Failure"!==r._tag)return r.effect_instruction_i0;throw SG(r.effect_instruction_i0)};class SJ extends Error{fiber;_tag="AsyncFiberException";constructor(e){super(`Fiber #${e.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this.fiber=e,this.name=this._tag,this.stack=this.message}}let SH=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let r=new SJ(e);return Error.stackTraceLimit=t,r},SK=Symbol.for("effect/Runtime/FiberFailure"),SW=Symbol.for("effect/Runtime/FiberFailure/Cause");class SV extends Error{[SK];[SW];constructor(e){super(),this[SK]=SK,this[SW]=e;let t=sS(e);if(t.length>0){let e=t[0];this.name=e.name,this.message=e.message,this.stack=e.stack}this.name=`(FiberFailure) ${this.name}`,(void 0===this.message||0===this.message.length)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[SW].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[ez](){return this.toString()}}let SG=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let r=new SV(e);return Error.stackTraceLimit=t,r},SY=e=>{switch(e._op){case"Failure":case"Success":return e;case"Left":return hr(e.left);case"Right":return hu(e.right);case"Some":return hu(e.value);case"None":return hr(uX())}},SQ=e=>t=>{let r=SY(t);if(r)return r;let n=new mz,i=SU(e)(t,{scheduler:n});return n.flush(),i.unsafePoll()||ht(ct(SH(i),hA(i)))},SZ=e=>(t,r)=>SX(e)(t,r).then(e=>{switch(e._tag){case e1:return e.effect_instruction_i0;case eQ:throw SG(e.effect_instruction_i0)}}),SX=e=>(t,r)=>new Promise(n=>{let i=SY(t);i&&n(i);let s=SU(e)(t);s.addObserver(e=>{n(e)}),r?.signal!==void 0&&(r.signal.aborted?s.unsafeInterruptAsFork(s.id()):r.signal.addEventListener("abort",()=>{s.unsafeInterruptAsFork(s.id())},{once:!0}))});class S0{context;runtimeFlags;fiberRefs;constructor(e,t,r){this.context=e,this.runtimeFlags=t,this.fiberRefs=r}pipe(){return eV(this,arguments)}}let S1=e=>new S0(e.context,e.runtimeFlags,e.fiberRefs),S2=()=>lZ((e,t)=>cj(new S0(e.getFiberRef(uy),t.runtimeFlags,e.getFiberRefs()))),S3=lC(1,32,4),S5=S1({context:sH(),runtimeFlags:S3,fiberRefs:f_()}),S4=((e,t)=>S1({context:e.context,runtimeFlags:t(e.runtimeFlags),fiberRefs:e.fiberRefs}),SU(S5)),S6=SZ(S5),S8=SX(S5),S7=SB(S5),S9=SQ(S5),we=R(2,(e,t)=>e.modifyEffect(t)),wt=Symbol.for("effect/Layer"),wr={[wt]:{_RIn:e=>e,_E:e=>e,_ROut:e=>e},pipe(){return eV(this,arguments)}},wn=Symbol.for("effect/Layer/MemoMap"),wi=e=>X(e,wt),ws=e=>e._op_layer===SP;class wa{ref;[wn];constructor(e){this.ref=e,this[wn]=wn}getOrElseMemoize(e,t){return z(we(this.ref,r=>{let n=r.get(e);if(void 0!==n){let[e,i]=n;return cj([z(e,cp(([e,t])=>z(gA(e),l0(t))),cF(hl({onFailure:()=>cB,onSuccess:()=>uL(t,i)}))),r])}return z(mO(0),cp(n=>z(hb(),cp(i=>z(mO(()=>cB),cE(s=>{let a=cq(a=>z(vE(),cp(o=>z(a(cp(wh(e,o,!0),e=>gm(e(this)))),cs,cp(a=>{switch(a._tag){case eQ:return z(hS(i,a.effect_instruction_i0),cZ(u$(o,a)),cZ(cl(a.effect_instruction_i0)));case e1:return z(mF(s,e=>z(u$(o,e),cH(mT(n,e=>[1===e,e-1])),l1)),cZ(mN(n,e=>e+1)),cZ(uL(t,t=>z(cP(()=>r.delete(e)),cZ(mI(s)),cp(e=>e(t))))),cZ(hk(i,a.effect_instruction_i0)),l0(a.effect_instruction_i0[1]))}}))))),o=[z(hy(i),cF(hc({onFailure:()=>cB,onSuccess:()=>mN(n,e=>e+1)}))),e=>z(mI(s),cp(t=>t(e)))];return[a,ws(e)?r:r.set(e,o)]}))))))}),cm)}}let wo=cz(()=>cE(SA(new Map),e=>new wa(e))),wl=()=>new wa(SM(new Map)),wc=R(2,(e,t)=>cp(wo,r=>cp(wh(e,t),e=>e(r)))),wu=R(3,(e,t,r)=>cp(wh(e,r),e=>e(t))),wh=(e,t,r=!1)=>{switch(e._op_layer){case"Locally":return cP(()=>r=>e.f(r.getOrElseMemoize(e.self,t)));case"ExtendScope":return cP(()=>t=>vf(r=>t.getOrElseMemoize(e.layer,r)));case"Fold":return cP(()=>r=>z(r.getOrElseMemoize(e.layer,t),cb({onFailure:n=>r.getOrElseMemoize(e.failureK(n),t),onSuccess:n=>r.getOrElseMemoize(e.successK(n),t)})));case"Fresh":return cP(()=>r=>z(e.layer,wc(t)));case"FromEffect":return r?cP(()=>t=>e.effect):cP(()=>r=>r.getOrElseMemoize(e,t));case"Provide":return cP(()=>r=>z(r.getOrElseMemoize(e.first,t),cp(n=>z(r.getOrElseMemoize(e.second,t),hR(n)))));case"Scoped":return r?cP(()=>r=>vO(e.effect,t)):cP(()=>r=>r.getOrElseMemoize(e,t));case"Suspend":return cP(()=>r=>r.getOrElseMemoize(e.evaluate(),t));case"ProvideMerge":return cP(()=>r=>z(r.getOrElseMemoize(e.first,t),cX(r.getOrElseMemoize(e.second,t),e.zipK)));case"ZipWith":return cP(()=>r=>z(r.getOrElseMemoize(e.first,t),vv(r.getOrElseMemoize(e.second,t),e.zipK,{concurrent:!0})))}},wp=((e,t)=>wy(e,{onFailure:t,onSuccess:wE}),()=>wb(hI())),wf=e=>wd(iH(e)),wd=e=>wb(cl(e)),wm=R(2,(e,t)=>wy(e,{onFailure:wf,onSuccess:t})),wg=R(2,(e,t)=>{let r=sJ(e),n=r?e:t;return wb(cE(r?t:e,e=>sj(n,e)))});function wb(e){let t=Object.create(wr);return t._op_layer="FromEffect",t.effect=e,t}(e,t)=>{let r=Object.create(wr);return r._op_layer="Locally",r.self=e,r.f=t,r};let wx=R(2,(e,{onFailure:t,onSuccess:r})=>{let n=Object.create(wr);return n._op_layer="Fold",n.layer=e,n.failureK=t,n.successK=r,n}),wy=R(2,(e,{onFailure:t,onSuccess:r})=>wx(e,{onFailure:e=>{let r=i4(e);switch(r._tag){case"Left":return t(r.left);case"Right":return wd(r.right)}},onSuccess:r})),wv=R(2,(e,t)=>wT(e,t,(e,t)=>sq(e,t))),w_=(...e)=>{let t=e[0];for(let r=1;r<e.length;r++)t=wv(t,e[r]);return t},wS=R(2,(e,t)=>{let r=sJ(e),n=r?e:t;return wk(cE(r?t:e,e=>sj(n,e)))}),ww=e=>wk(z(e,l0(sH()))),wk=e=>{let t=Object.create(wr);return t._op_layer="Scoped",t.effect=e,t},wC=R(2,(e,t)=>{let r=sJ(e);return wb(cj(sj(r?e:t,r?t:e)))}),wE=e=>wb(cj(e)),wO=e=>{let t=Object.create(wr);return t._op_layer="Suspend",t.evaluate=e,t},wI=R(2,(e,t)=>cp(vf(r=>wu(e,t,r)),e=>z(S2(),hR(e)))),wF=R(2,(e,t)=>wO(()=>{let r=Object.create(wr);return r._op_layer="Provide",r.first=Object.create(wr,{_op_layer:{value:SD,enumerable:!0},first:{value:wp(),enumerable:!0},second:{value:Array.isArray(t)?w_(...t):t},zipK:{value:(e,t)=>z(e,sq(t))}}),r.second=e,r})),wR=R(2,(e,t)=>{let r=Object.create(wr);return r._op_layer=SD,r.first=t,r.second=wF(e,t),r.zipK=(e,t)=>z(e,sq(t)),r}),wT=R(3,(e,t,r)=>wO(()=>{let n=Object.create(wr);return n._op_layer="ZipWith",n.first=e,n.second=t,n.zipK=r,n})),wN=e=>{let t=sB("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return wm(wg(t,e),e=>s$(e,t))},wA=e=>{let t=sB("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return wm(wS(t,e),e=>s$(e,t))},wM=R(2,(e,t)=>vd(r=>cp(wc(t,r),t=>hT(e,t)))),wj=R(2,(e,t)=>{let r=fL(S5.fiberRefs,t.fiberRefs),n=lF(S5.runtimeFlags,t.runtimeFlags);return cq(i=>lZ(s=>{let a=s.getFiberRef(uy),o=s.getFiberRefs(),l=fU(s.id(),o)(r),c=s.currentRuntimeFlags,u=lR(n)(c),h=fL(l,o),p=lF(u,c);return s.setFiberRefs(l),s.currentRuntimeFlags=u,vP(hT(i(e),sq(a,t.context)),lZ(e=>(e.setFiberRefs(fU(e.id(),e.getFiberRefs())(h)),e.currentRuntimeFlags=lR(p)(e.currentRuntimeFlags),cB)))}))}),wz=R(2,(e,t)=>Array.isArray(t)?wM(e,w_(...t)):wi(t)?wM(e,t):sN(t)?hT(e,t):Sz in t?cp(t.runtimeEffect,t=>wj(e,t)):wj(e,t)),wP=Symbol.for("effect/MutableList"),wD={[wP]:wP,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(null==t)return e=!0,this.return();let r=t.value;return t=t.next,{done:e,value:r}},return:t=>(e||(e=!0),{done:!0,value:t})}},toString(){return eD(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(eP)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},wL=e=>({value:e,removed:!1,prev:void 0,next:void 0}),w$=()=>{let e=Object.create(wD);return e.head=void 0,e.tail=void 0,e._length=0,e},wU=e=>0===wq(e),wq=e=>e._length,wB=R(2,(e,t)=>{let r=wL(t);return void 0===e.head&&(e.head=r),void 0===e.tail||(e.tail.next=r,r.prev=e.tail),e.tail=r,e._length+=1,e}),wJ=e=>{let t=e.head;if(void 0!==t)return wH(e,t),t.value},wH=(e,t)=>{!t.removed&&(t.removed=!0,void 0!==t.prev&&void 0!==t.next?(t.prev.next=t.next,t.next.prev=t.prev):void 0!==t.prev?(e.tail=t.prev,t.prev.next=void 0):void 0!==t.next?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},wK=Symbol.for("effect/MutableQueue"),wW=Symbol.for("effect/mutable/MutableQueue/Empty"),wV={[wK]:wK,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return eD(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(eP)}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},wG=e=>{let t=Object.create(wV);return t.queue=w$(),t.capacity=e,t},wY=e=>wG(e),wQ=()=>wG(void 0),wZ=e=>wq(e.queue),wX=e=>wU(e.queue),w0=e=>void 0===e.capacity?1/0:e.capacity,w1=R(2,(e,t)=>{let r=wq(e.queue);return(void 0===e.capacity||r!==e.capacity)&&(wB(t)(e.queue),!0)}),w2=R(2,(e,t)=>{let r;let n=t[Symbol.iterator](),i=nt(),s=!0;for(;s&&(r=n.next())&&!r.done;)s=w1(r.value)(e);for(;null!=r&&!r.done;)i=nf(r.value)(i),r=n.next();return no(i)}),w3=R(2,(e,t)=>wU(e.queue)?t:wJ(e.queue)),w5=R(2,(e,t)=>{let r=nt(),n=0;for(;n<t;){let t=w3(wW)(e);if(t===wW)break;r=nf(t)(r),n+=1}return no(r)}),w4=(e,t,r,n)=>oc({_tag:"Complete",key:e,exit:t,entryStats:r,timeToLiveMillis:n}),w6=(e,t)=>oc({_tag:"Pending",key:e,deferred:t}),w8=(e,t)=>oc({_tag:"Refreshing",deferred:e,complete:t}),w7=Symbol.for("effect/Cache/MapKey");class w9{current;[w7]=w7;previous=void 0;next=void 0;constructor(e){this.current=e}[ey](){return z(ev(this.current),eS(ev(this.previous)),eS(ev(this.next)),eR(this))}[eT](e){return this===e||kt(e)&&eN(this.current,e.current)&&eN(this.previous,e.previous)&&eN(this.next,e.next)}}let ke=e=>new w9(e),kt=e=>X(e,w7);class kr{head=void 0;tail=void 0;add(e){if(e!==this.tail){if(void 0===this.tail)this.head=e,this.tail=e;else{let t=e.previous,r=e.next;void 0!==r&&(e.next=void 0,void 0!==t?(t.next=r,r.previous=t):(this.head=r,this.head.previous=void 0)),this.tail.next=e,e.previous=this.tail,this.tail=e}}}remove(){let e=this.head;if(void 0!==e){let t=e.next;void 0!==t?(e.next=void 0,this.head=t,this.head.previous=void 0):(this.head=void 0,this.tail=void 0)}return e}}let kn=()=>new kr,ki=(e,t,r,n,i,s)=>({map:e,keys:t,accesses:r,updating:n,hits:i,misses:s}),ks=()=>ki(xu(),kn(),wQ(),aw(!1),0,0),ka=Symbol.for("effect/Cache"),ko={_Key:e=>e,_Error:e=>e,_Value:e=>e},kl=Symbol.for("effect/ConsumerCache"),kc={_Key:e=>e,_Error:e=>e,_Value:e=>e},ku=e=>e,kh=e=>({loadedMillis:e});class kp{capacity;context;fiberId;lookup;timeToLive;[ka]=ko;[kl]=kc;cacheState;constructor(e,t,r,n,i){this.capacity=e,this.context=t,this.fiberId=r,this.lookup=n,this.timeToLive=i,this.cacheState=ks()}get(e){return cE(this.getEither(e),tM)}get cacheStats(){return cP(()=>ku({hits:this.cacheState.hits,misses:this.cacheState.misses,size:xb(this.cacheState.map)}))}getOption(e){return cz(()=>tq(xh(this.cacheState.map,e),{onNone:()=>{let t=ke(e);return this.trackAccess(t),this.trackMiss(),cj(tU())},onSome:e=>this.resolveMapValue(e)}))}getOptionComplete(e){return cz(()=>tq(xh(this.cacheState.map,e),{onNone:()=>{let t=ke(e);return this.trackAccess(t),this.trackMiss(),cj(tU())},onSome:e=>this.resolveMapValue(e,!0)}))}contains(e){return cP(()=>xf(this.cacheState.map,e))}entryStats(e){return cP(()=>{let t=xh(this.cacheState.map,e);if(tb(t))switch(t.value._tag){case"Complete":return ty(kh(t.value.entryStats.loadedMillis));case"Pending":break;case"Refreshing":return ty(kh(t.value.complete.entryStats.loadedMillis))}return tU()})}getEither(e){return cz(()=>{let t,r;let n=tW(xh(this.cacheState.map,e));return(void 0===n&&(r=hg(this.fiberId),t=ke(e),xf(this.cacheState.map,e)?n=tW(xh(this.cacheState.map,e)):xd(this.cacheState.map,e,w6(t,r))),void 0===n)?(this.trackAccess(t),this.trackMiss(),cE(this.lookupValueOf(e,r),tI)):cp(this.resolveMapValue(n),tq({onNone:()=>this.getEither(e),onSome:e=>cj(tO(e))}))})}invalidate(e){return cP(()=>{xg(this.cacheState.map,e)})}invalidateWhen(e,t){return cP(()=>{let r=xh(this.cacheState.map,e);tb(r)&&"Complete"===r.value._tag&&"Success"===r.value.exit._tag&&t(r.value.exit.value)&&xg(this.cacheState.map,e)})}get invalidateAll(){return cP(()=>{this.cacheState.map=xu()})}refresh(e){return fn(t=>cz(()=>{let r=hg(this.fiberId),n=tW(xh(this.cacheState.map,e));if(void 0===n&&(xf(this.cacheState.map,e)?n=tW(xh(this.cacheState.map,e)):xd(this.cacheState.map,e,w6(ke(e),r))),void 0===n)return l1(this.lookupValueOf(e,r));switch(n._tag){case"Complete":if(this.hasExpired(t,n.timeToLiveMillis))return eN(tW(xh(this.cacheState.map,e)),n)&&xg(this.cacheState.map,e),l1(this.get(e));return z(this.lookupValueOf(e,r),gH(()=>{if(eN(tW(xh(this.cacheState.map,e)),n)){let t=w8(r,n);return xd(this.cacheState.map,e,t),!0}return!1}),l1);case"Pending":case"Refreshing":return hy(n.deferred)}}))}set(e,t){return fn(r=>cP(()=>{let n=r.unsafeCurrentTimeMillis(),i=hu(t),s=w4(ke(e),i,kh(n),n+al(s2(this.timeToLive(i))));xd(this.cacheState.map,e,s)}))}get size(){return cP(()=>xb(this.cacheState.map))}get values(){return cP(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[1].exit.value);return e})}get entries(){return cP(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push([t[0],t[1].exit.value]);return e})}get keys(){return cP(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[0]);return e})}resolveMapValue(e,t=!1){return fn(r=>{switch(e._tag){case"Complete":if(this.trackAccess(e.key),this.hasExpired(r,e.timeToLiveMillis))return xg(this.cacheState.map,e.key.current),cj(tU());return this.trackHit(),cE(e.exit,ty);case"Pending":if(this.trackAccess(e.key),this.trackHit(),t)return cj(tU());return cE(hy(e.deferred),ty);case"Refreshing":if(this.trackAccess(e.complete.key),this.trackHit(),this.hasExpired(r,e.complete.timeToLiveMillis)){if(t)return cj(tU());return cE(hy(e.deferred),ty)}return cE(e.complete.exit,ty)}})}trackHit(){this.cacheState.hits=this.cacheState.hits+1}trackMiss(){this.cacheState.misses=this.cacheState.misses+1}trackAccess(e){if(w1(this.cacheState.accesses,e),ak(this.cacheState.updating,!1,!0)){let e=!0;for(;e;){let t=w3(this.cacheState.accesses,wW);t===wW?e=!1:this.cacheState.keys.add(t)}let t=xb(this.cacheState.map);for(e=t>this.capacity;e;){let r=this.cacheState.keys.remove();void 0!==r?xf(this.cacheState.map,r.current)&&(xg(this.cacheState.map,r.current),t-=1,e=t>this.capacity):e=!1}aE(this.cacheState.updating,!1)}}hasExpired(e,t){return e.unsafeCurrentTimeMillis()>t}lookupValueOf(e,t){return fn(r=>cz(()=>z(this.lookup(e),hR(this.context),cs,cp(n=>{let i=r.unsafeCurrentTimeMillis(),s=kh(i),a=w4(ke(e),n,s,i+al(s2(this.timeToLive(n))));return xd(this.cacheState.map,e,a),cZ(h_(t,n),n)}),cR(()=>cZ(fl(t),cP(()=>{xg(this.cacheState.map,e)}))))))}}let kf=(e,t,r)=>new kp(e,sH(),az,t,e=>s2(r(e))),kd=(()=>ud(kf(65536,()=>cE(hb(),e=>({listeners:new yf,handle:e})),()=>an(60))),e=>z(hb(),cp(t=>z(gg(e),cC(t),gN,cE(e=>cZ(e,z(hy(t),cp(([e,t])=>l0(cY(gA(e[0]),cJ(e[1])),t))))))))),km=function(){let e=1==arguments.length?arguments[0]:arguments[1].bind(arguments[0]);return cW(()=>e(z))},kg=e=>e.length>=1?l4((t,r)=>{try{e(r).then(e=>t(hu(e)),e=>t(ht(e)))}catch(e){t(ht(e))}}):l4(t=>{try{e().then(e=>t(hu(e)),e=>t(ht(e)))}catch(e){t(ht(e))}}),kb=e=>gv(e,{onFailure:j,onSuccess:j}),kx=e=>cb(e,{onFailure:e=>gC(e,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>cB}),ky=e=>cp(vE(),t=>vI(e,t)),kv=(e,...t)=>gw(e)(...t),k_=e=>cP(()=>Sv(e)),kS=R(2,(e,t)=>vv(e,t,(e,t)=>e(t))),kw=function(){let e="string"!=typeof arguments[0],t=e?arguments[1]:arguments[0],r=p7(e?arguments[2]:arguments[1]);if(e){let e=arguments[0];return gY(t,r,t=>gQ(e,t))}return e=>gY(t,r,t=>gQ(e,t))},kk=function(e,...t){let r=Error.stackTraceLimit;Error.stackTraceLimit=2;let n=Error();if(Error.stackTraceLimit=r,"string"!=typeof e)return function(...r){let i=Error.stackTraceLimit;Error.stackTraceLimit=2;let s=Error();return Error.stackTraceLimit=i,kC({self:this,body:e,args:r,pipeables:t,spanName:"<anonymous>",spanOptions:{context:p9.context(!0)},errorDef:n,errorCall:s})};let i=t[0];return(t,...r)=>function(...s){let a=Error.stackTraceLimit;Error.stackTraceLimit=2;let o=Error();return Error.stackTraceLimit=a,kC({self:this,body:t,args:s,pipeables:r,spanName:e,spanOptions:i,errorDef:n,errorCall:o})}};function kC(e){let t,r;if(eb(e.body))t=cW(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(e){r=e,t=cr(e)}if(e.pipeables.length>0)try{for(let r of e.pipeables)t=r(t)}catch(e){t=r?cl(iG(iK(r),iK(e))):cr(e)}let n=!1,i=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:()=>{if(!1!==n)return n;if(e.errorCall.stack){let t=e.errorDef.stack.trim().split("\n"),r=e.errorCall.stack.trim().split("\n");return n=`${t.slice(2).join("\n").trim()}
${r.slice(2).join("\n").trim()}`}},...e.spanOptions};return kw(t,e.spanName,i)}let kE=function(){let e=Symbol.for("effect/Data/Error/plainArgs");return class extends uB{constructor(t){super(t?.message,t?.cause?{cause:t.cause}:void 0),t&&(Object.assign(this,t),Object.defineProperty(this,e,{value:t,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}(),kO=e=>{class t extends kE{_tag=e}return t.prototype.name=e,t},kI=Symbol.for("@effect/platform/Error/PlatformErrorTypeId"),kF=(l="BadArgument",e=>oc({[kI]:kI,_tag:l,...e})),kR=(e,t)=>{class r extends kE{_tag=t}return r.prototype[e]=e,r.prototype.name=t,r},kT=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return kT(e,t.from)}},kN=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),kA=e=>{let t,r=!1;return()=>(r||(t=e(),r=!0),t)},kM=e=>{try{return e.toISOString()}catch(t){return String(e)}},kj=e=>{if(U(e))return JSON.stringify(e);if(q(e)||null==e||B(e)||H(e))return String(e);if(en(e))return kM(e);if(J(e))return String(e)+"n";if(!rg(e)&&X(e,"toString")&&K(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{if(JSON.stringify(e),rg(e))return`[${e.map(kj).join(",")}]`;return`{${kN(e).map(t=>`${U(t)?JSON.stringify(t):String(t)}:${kj(e[t])}`).join(",")}}`}catch(t){return String(e)}},kz=e=>"string"==typeof e?JSON.stringify(e):String(e),kP=e=>Array.isArray(e),kD=e=>!Array.isArray(e),kL=e=>`[${kz(e)}]`,k$=e=>kP(e)?e.map(kL).join(""):kL(e),kU=(e,t,r,n)=>{let i=e;return r&&rx(r)&&(i+=`
at path: ${k$(r)}`),void 0!==t&&(i+=`
details: ${t}`),n&&(i+=`
schema (${n._tag}): ${n}`),i},kq=(e,t,r)=>kU("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,r),kB=e=>kU("Unsupported key schema",void 0,void 0,e),kJ=e=>kU("Unsupported literal",`literal value: ${kj(e)}`),kH=e=>kU("Duplicate index signature",`${e} index signature`),kK=kU("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),kW=kU("Invalid element","A required element cannot follow an optional element. ts(1257)"),kV=e=>kU("Duplicate property signature transformation",`Duplicate key ${kj(e)}`),kG=e=>kU("Duplicate property signature",`Duplicate key ${kj(e)}`),kY=Symbol.for("effect/annotation/Brand"),kQ=Symbol.for("effect/annotation/SchemaId"),kZ=Symbol.for("effect/annotation/Message"),kX=Symbol.for("effect/annotation/MissingMessage"),k0=Symbol.for("effect/annotation/Identifier"),k1=Symbol.for("effect/annotation/Title"),k2=Symbol.for("effect/annotation/AutoTitle"),k3=Symbol.for("effect/annotation/Description"),k5=Symbol.for("effect/annotation/Examples"),k4=Symbol.for("effect/annotation/Default"),k6=Symbol.for("effect/annotation/JSONSchema"),k8=Symbol.for("effect/annotation/Arbitrary"),k7=Symbol.for("effect/annotation/Pretty"),k9=Symbol.for("effect/annotation/Equivalence"),Ce=Symbol.for("effect/annotation/Documentation"),Ct=Symbol.for("effect/annotation/Concurrency"),Cr=Symbol.for("effect/annotation/Batching"),Cn=Symbol.for("effect/annotation/ParseIssueTitle"),Ci=Symbol.for("effect/annotation/ParseOptions"),Cs=Symbol.for("effect/annotation/DecodingFallback"),Ca=Symbol.for("effect/annotation/Surrogate"),Co=Symbol.for("effect/annotation/StableFilter"),Cl=R(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?ty(e.annotations[t]):tU()),Cc=Cl(kY),Cu=Cl(kZ),Ch=Cl(kX),Cp=Cl(k1),Cf=Cl(k2),Cd=Cl(k0),Cm=Cl(k3),Cg=Cl(Ct),Cb=Cl(Cr),Cx=Cl(Cn),Cy=Cl(Ci),Cv=Cl(Cs),C_=Cl(Ca),CS=Cl(Co),Cw=e=>t3(CS(e),e=>!0===e),Ck=Symbol.for("effect/annotation/JSONIdentifier"),CC=Cl(Ck),CE=e=>tJ(CC(e),()=>Cd(e)),CO=Symbol.for("effect/schema/ParseJson");class CI{typeParameters;decodeUnknown;encodeUnknown;annotations;_tag="Declaration";constructor(e,t,r,n={}){this.typeParameters=e,this.decodeUnknown=t,this.encodeUnknown=r,this.annotations=n}toString(){return tB(Eq(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(e=>e.toJSON()),annotations:EP(this.annotations)}}}let CF=e=>t=>t._tag===e;class CR{literal;annotations;_tag="Literal";constructor(e,t={}){this.literal=e,this.annotations=t}toString(){return tB(Eq(this),()=>kj(this.literal))}toJSON(){return{_tag:this._tag,literal:J(this.literal)?String(this.literal):this.literal,annotations:EP(this.annotations)}}}let CT=CF("Literal"),CN=new CR(null);class CA{symbol;annotations;_tag="UniqueSymbol";constructor(e,t={}){this.symbol=e,this.annotations=t}toString(){return tB(Eq(this),()=>kj(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:EP(this.annotations)}}}class CM{annotations;_tag="UndefinedKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let Cj=new CM({[k1]:"undefined"});class Cz{annotations;_tag="NeverKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CP=new Cz({[k1]:"never"});class CD{annotations;_tag="UnknownKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CL=new CD({[k1]:"unknown"});class C${annotations;_tag="AnyKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CU=new C$({[k1]:"any"});class Cq{annotations;_tag="StringKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CB=new Cq({[k1]:"string",[k3]:"a string"}),CJ=CF("StringKeyword");class CH{annotations;_tag="NumberKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CK=new CH({[k1]:"number",[k3]:"a number"}),CW=CF("NumberKeyword");class CV{annotations;_tag="BooleanKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CG=new CV({[k1]:"boolean",[k3]:"a boolean"}),CY=CF("BooleanKeyword");class CQ{annotations;_tag="BigIntKeyword";constructor(e={}){this.annotations=e}toString(){return E$(this)}toJSON(){return{_tag:this._tag,annotations:EP(this.annotations)}}}let CZ=CF("SymbolKeyword"),CX=e=>{switch(e._tag){case"Literal":case"NumberKeyword":case"StringKeyword":case"TemplateLiteral":return!0;case"Union":return e.types.every(CX)}return!1},C0=e=>{switch(e._tag){case"Literal":return JSON.stringify(String(e.literal));case"StringKeyword":return"string";case"NumberKeyword":return"number";case"TemplateLiteral":return String(e);case"Union":return e.types.map(C0).join(" | ")}};class C1{type;annotations;constructor(e,t={}){this.type=e,this.annotations=t}toJSON(){return{type:this.type.toJSON(),annotations:EP(this.annotations)}}toString(){return String(this.type)}}class C2 extends C1{isOptional;constructor(e,t,r={}){super(e,r),this.isOptional=t}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:EP(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}let C3=e=>e.map(e=>e.type);class C5{elements;rest;isReadonly;annotations;_tag="TupleType";constructor(e,t,r,n={}){this.elements=e,this.rest=t,this.isReadonly=r,this.annotations=n;let i=!1,s=!1;for(let t of e)if(t.isOptional)i=!0;else if(i){s=!0;break}if(s||i&&t.length>1)throw Error(kW)}toString(){return tB(Eq(this),()=>C4(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(e=>e.toJSON()),rest:this.rest.map(e=>e.toJSON()),isReadonly:this.isReadonly,annotations:EP(this.annotations)}}}let C4=e=>{let t=e.elements.map(String).join(", ");return rp(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(r,n)=>{let i=String(r),s=i.includes(" | ")?`(${i})`:i;if(n.length>0){let r=n.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${s}[], ${r}]`:`readonly [...${s}[], ${r}]`}return e.elements.length>0?`readonly [${t}, ...${s}[]]`:`ReadonlyArray<${i}>`}})};class C6 extends C2{name;isReadonly;constructor(e,t,r,n,i){super(t,r,i),this.name=e,this.isReadonly=n}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:EP(this.annotations)}}}let C8=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return C8(e.from)}return!1};class C7{type;isReadonly;parameter;constructor(e,t,r){if(this.type=t,this.isReadonly=r,C8(e))this.parameter=e;else throw Error(kK)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class C9{annotations;_tag="TypeLiteral";propertySignatures;indexSignatures;constructor(e,t,r={}){this.annotations=r;let n={};for(let t=0;t<e.length;t++){let r=e[t].name;if(Object.prototype.hasOwnProperty.call(n,r))throw Error(kG(r));n[r]=null}let i={string:!1,symbol:!1};for(let e=0;e<t.length;e++){let r=ED(t[e].parameter);if(CJ(r)){if(i.string)throw Error(kH("string"));i.string=!0}else if(CZ(r)){if(i.symbol)throw Error(kH("symbol"));i.symbol=!0}}this.propertySignatures=e,this.indexSignatures=t}toString(){return tB(Eq(this),()=>Et(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(e=>e.toJSON()),indexSignatures:this.indexSignatures.map(e=>e.toJSON()),annotations:EP(this.annotations)}}}let Ee=e=>e.map(String).join("; "),Et=e=>{if(e.propertySignatures.length>0){let t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${Ee(e.indexSignatures)} }`:`{ ${t} }`}return e.indexSignatures.length>0?`{ ${Ee(e.indexSignatures)} }`:"{}"},Er=CF("TypeLiteral"),En=rN(t7(t8,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Ei={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},Es=e=>rJ(e,e=>Eu(e)?Es(e.types):[e]),Ea=e=>{let t=En(e),r=[],n={},i=[];for(let e of t)switch(e._tag){case"NeverKeyword":break;case"AnyKeyword":return[CU];case"UnknownKeyword":return[CL];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":n[e._tag]||(n[e._tag]=e,r.push(e));break;case"Literal":{let t=typeof e.literal;switch(t){case"string":case"number":case"bigint":case"boolean":n[Ei[t]]||i.includes(e.literal)||(i.push(e.literal),r.push(e));break;case"object":i.includes(e.literal)||(i.push(e.literal),r.push(e))}break}case"UniqueSymbol":n.SymbolKeyword||i.includes(e.symbol)||(i.push(e.symbol),r.push(e));break;case"TupleType":n.ObjectKeyword||r.push(e);break;case"TypeLiteral":0===e.propertySignatures.length&&0===e.indexSignatures.length?n["{}"]||(n["{}"]=e,r.push(e)):n.ObjectKeyword||r.push(e);break;default:r.push(e)}return r};class Eo{types;annotations;static make=(e,t)=>Ec(e)?new Eo(e,t):1===e.length?e[0]:CP;static unify=(e,t)=>Eo.make(Ea(Es(e)),t);_tag="Union";constructor(e,t={}){this.types=e,this.annotations=t}toString(){return tB(Eq(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(e=>e.toJSON()),annotations:EP(this.annotations)}}}let El=(e,t)=>e.map(t),Ec=e=>e.length>1,Eu=CF("Union"),Eh=$(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class Ep{f;annotations;_tag="Suspend";constructor(e,t={}){this.f=e,this.annotations=t,this.f=kA(e)}toString(){return Eq(this).pipe(tJ(()=>tQ(tV(this.f)(),e=>Eq(e))),tB(()=>"<suspended schema>"))}toJSON(){let e=this.f(),t=Eh.get(e);return t||(Eh.set(e,{_tag:this._tag}),t={_tag:this._tag,ast:e.toJSON(),annotations:EP(this.annotations)},Eh.set(e,t)),t}}class Ef{from;filter;annotations;_tag="Refinement";constructor(e,t,r={}){this.from=e,this.filter=t,this.annotations=r}toString(){return Cd(this).pipe(tB(()=>tq(EU(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:e=>Ed(this.from)?String(this.from)+" & "+e:e})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:EP(this.annotations)}}}let Ed=CF("Refinement"),Em={};class Eg{from;to;transformation;annotations;_tag="Transformation";constructor(e,t,r,n={}){this.from=e,this.to=t,this.transformation=r,this.annotations=n}toString(){return tB(Eq(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:EP(this.annotations)}}}class Eb{decode;encode;_tag="FinalTransformation";constructor(e,t){this.decode=e,this.encode=t}}class Ex{_tag="ComposeTransformation"}let Ey=new Ex;class Ev{from;to;decode;encode;constructor(e,t,r,n){this.from=e,this.to=t,this.decode=r,this.encode=n}}class E_{propertySignatureTransformations;_tag="TypeLiteralTransformation";constructor(e){this.propertySignatureTransformations=e;let t={},r={};for(let n of e){let e=n.from;if(t[e])throw Error(kV(e));t[e]=!0;let i=n.to;if(r[i])throw Error(kV(i));r[i]=!0}}}let ES=(c="TypeLiteralTransformation",e=>e._tag===c),Ew=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),n={...e.annotations,...t},i=C_(e);return tb(i)&&(n[Ca]=Ew(i.value,t)),r.annotations.value=n,Object.create(Object.getPrototypeOf(e),r)},Ek=(e,t)=>{switch(e._tag){case"Literal":return hH(String(e.literal));case"StringKeyword":return".*";case"NumberKeyword":return"[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?";case"TemplateLiteral":return EE(e,t,!1);case"Union":return e.types.map(e=>Ek(e,t)).join("|")}},EC=(e,t,r,n)=>{if(Eu(e)){if(r&&!n)return`(?:${t})`}else if(!r||!n)return t;return`(${t})`},EE=(e,t,r)=>{let n="";if(""!==e.head){let i=hH(e.head);n+=t&&r?`(${i})`:i}for(let i of e.spans){let e=Ek(i.type,t);if(n+=EC(i.type,e,t,r),""!==i.literal){let e=hH(i.literal);n+=t&&r?`(${e})`:e}}return n},EO=e=>RegExp(`^${EE(e,!1,!0)}$`),EI=e=>{switch(e._tag){case"TupleType":{let t=!1,r=[];for(let n of e.elements)n.isOptional&&(t=!0),r.push(n.type);return t&&r.push(Cj),r=r.concat(C3(e.rest)),Eo.make(r)}case"Refinement":return EI(e.from);case"Union":return Eo.make(e.types.map(EI));case"Suspend":return EI(e.f())}throw Error(errors_.getASTUnsupportedSchemaErrorMessage(e))},EF=(e,t)=>{let r=[],n=[],i=e=>{switch(e._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":n.push(new C7(e,t,!0));break;case"Literal":if(U(e.literal)||q(e.literal))r.push(new C6(e.literal,t,!1,!0));else throw Error(kJ(e.literal));break;case"Enums":for(let[n,i]of e.enums)r.push(new C6(i,t,!1,!0));break;case"UniqueSymbol":r.push(new C6(e.symbol,t,!1,!0));break;case"Union":e.types.forEach(i);break;default:throw Error(kB(e))}};return i(e),{propertySignatures:r,indexSignatures:n}},ER=e=>{switch(e._tag){case"TupleType":return!1===e.isReadonly?e:new C5(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{let t=EA(e.propertySignatures,e=>!1===e.isReadonly?e:new C6(e.name,e.type,e.isOptional,!1,e.annotations)),r=EA(e.indexSignatures,e=>!1===e.isReadonly?e:new C7(e.parameter,e.type,!1));return t===e.propertySignatures&&r===e.indexSignatures?e:new C9(t,r,e.annotations)}case"Union":{let t=EA(e.types,ER);return t===e.types?e:Eo.make(t,e.annotations)}case"Suspend":return new Ep(()=>ER(e.f()),e.annotations);case"Refinement":{let t=ER(e.from);return t===e.from?e:new Ef(t,e.filter,e.annotations)}case"Transformation":{let t=ER(e.from),r=ER(e.to);return t===e.from&&r===e.to?e:new Eg(t,r,e.transformation,e.annotations)}}return e},ET=e=>{switch(e._tag){case"Declaration":{let t=EA(e.typeParameters,ET);return t===e.typeParameters?e:new CI(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let t=EA(e.elements,e=>{let t=ET(e.type);return t===e.type?e:new C2(t,e.isOptional)}),r=C3(e.rest),n=EA(r,ET);return t===e.elements&&n===r?e:new C5(t,n.map(e=>new C1(e)),e.isReadonly,e.annotations)}case"TypeLiteral":{let t=EA(e.propertySignatures,e=>{let t=ET(e.type);return t===e.type?e:new C6(e.name,t,e.isOptional,e.isReadonly)}),r=EA(e.indexSignatures,e=>{let t=ET(e.type);return t===e.type?e:new C7(e.parameter,t,e.isReadonly)});return t===e.propertySignatures&&r===e.indexSignatures?e:new C9(t,r,e.annotations)}case"Union":{let t=EA(e.types,ET);return t===e.types?e:Eo.make(t,e.annotations)}case"Suspend":return new Ep(()=>ET(e.f()),e.annotations);case"Refinement":{let t=ET(e.from);return t===e.from?e:new Ef(t,e.filter,e.annotations)}case"Transformation":return ET(e.to)}return e},EN=e=>tq(CE(e),{onNone:()=>void 0,onSome:e=>({[Ck]:e})});function EA(e,t){let r=!1,n=ro(e.length);for(let i=0;i<e.length;i++){let s=e[i],a=t(s);a!==s&&(r=!0),n[i]=a}return r?n:e}let EM=e=>{switch(e._tag){case"Transformation":return e.from;case"Refinement":return EM(e.from);case"Suspend":return EM(e.f())}},Ej=(e,t)=>{switch(e._tag){case"Declaration":{let r=EA(e.typeParameters,e=>Ej(e,t));return r===e.typeParameters?e:new CI(r,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let r=EA(e.elements,e=>{let r=Ej(e.type,t);return r===e.type?e:new C2(r,e.isOptional)}),n=C3(e.rest),i=EA(n,e=>Ej(e,t));return r===e.elements&&i===n?e:new C5(r,i.map(e=>new C1(e)),e.isReadonly,EN(e))}case"TypeLiteral":{let r=EA(e.propertySignatures,e=>{let r=Ej(e.type,t);return r===e.type?e:new C6(e.name,r,e.isOptional,e.isReadonly)}),n=EA(e.indexSignatures,e=>{let r=Ej(e.type,t);return r===e.type?e:new C7(e.parameter,r,e.isReadonly)});return r===e.propertySignatures&&n===e.indexSignatures?e:new C9(r,n,EN(e))}case"Union":{let r=EA(e.types,e=>Ej(e,t));return r===e.types?e:Eo.make(r,EN(e))}case"Suspend":return new Ep(()=>Ej(e.f(),t),EN(e));case"Refinement":{let r=Ej(e.from,t);if(t){if(r===e.from)return e;if(void 0===EM(e.from)&&Cw(e))return new Ef(r,e.filter,e.annotations)}let n=EN(e);return n?Ew(r,n):r}case"Transformation":{let r=EN(e);return Ej(r?Ew(e.from,r):e.from,t)}}return e},Ez=e=>Ej(e,!1),EP=e=>{let t={};for(let r of Object.getOwnPropertySymbols(e))t[String(r)]=e[r];return t},ED=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return ED(e.from)}},EL=(e,t)=>new Eg(e,t,Ey),E$=e=>tB(Eq(e),()=>e._tag),EU=e=>Cp(e).pipe(tJ(()=>Cm(e)),tJ(()=>Cf(e)),tY(t=>t+tq(Cc(e),{onNone:()=>"",onSome:e=>e.map(e=>` & Brand<${kj(e)}>`).join("")}))),Eq=e=>tJ(Cd(e),()=>EU(e));class EB{path;actual;issue;_tag="Pointer";constructor(e,t,r){this.path=e,this.actual=t,this.issue=r}}class EJ{actual;message;_tag="Unexpected";constructor(e,t){this.actual=e,this.message=t}}class EH{ast;message;_tag="Missing";actual=void 0;constructor(e,t){this.ast=e,this.message=t}}class EK{ast;actual;issues;output;_tag="Composite";constructor(e,t,r,n){this.ast=e,this.actual=t,this.issues=r,this.output=n}}class EW{ast;actual;kind;issue;_tag="Refinement";constructor(e,t,r,n){this.ast=e,this.actual=t,this.kind=r,this.issue=n}}class EV{ast;actual;kind;issue;_tag="Transformation";constructor(e,t,r,n){this.ast=e,this.actual=t,this.kind=r,this.issue=n}}class EG{ast;actual;message;_tag="Type";constructor(e,t,r){this.ast=e,this.actual=t,this.message=r}}class EY{ast;actual;message;_tag="Forbidden";constructor(e,t,r){this.ast=e,this.actual=t,this.message=r}}let EQ=Symbol.for("effect/Schema/ParseErrorTypeId"),EZ=e=>X(e,EQ);class EX extends kO("ParseError"){[EQ]=EQ;get message(){return this.toString()}toString(){return O_.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[ez](){return this.toJSON()}}let E0=e=>new EX({issue:e}),E1=R(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?t(e.right):cp(e,t)),E2=R(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?tI(t(e.right)):cE(e,t)),E3=R(2,(e,t)=>"Left"===e._tag?tO(t(e.left)):"Right"===e._tag?e:cI(e,t)),E5=e=>{if("Left"===e._tag||"Right"===e._tag)return e},E4=R(2,(e,t)=>"Left"===e._tag?tO(t.onFailure(e.left)):"Right"===e._tag?tI(t.onSuccess(e.right)):cO(e,t)),E6=R(2,(e,t)=>"Left"===e._tag?t(e.left):"Right"===e._tag?e:l8(e,t)),E8=(e,t)=>void 0===t||q(t)?e:void 0===e?t:{...e,...t},E7=(e,t,r)=>{let n=Ol(e,t);return(e,t)=>n(e,E8(r,t))},E9=(e,t,r)=>{let n=E7(e,t,r);return(e,t)=>tj(n(e,t),E0)},Oe=(e,t,r)=>{let n=Ol(e,t);return(e,t)=>n(e,{...E8(r,t),isEffectAllowed:!0})},Ot=(e,t)=>E7(e.ast,!0,t),Or=(e,t)=>Oe(e.ast,!0,t),On=(e,t)=>Oe(e.ast,!1,t),Oi=(e,t)=>E9(ET(e.ast),!0,t),Os=(e,t)=>{let r=Ol(ET(e.ast),!0);return(e,n)=>tE(r(e,{exact:!0,...E8(t,n)}))},Oa=$(Symbol.for("effect/Schema/Parser/decodeMemoMap"),()=>new WeakMap),Oo=$(Symbol.for("effect/Schema/Parser/encodeMemoMap"),()=>new WeakMap),Ol=(e,t)=>{let r=t?Oa:Oo,n=r.get(e);if(n)return n;let i=Oh(e,t),s=Cy(e),a=tb(s)?(e,t)=>i(e,E8(t,s.value)):i,o=Cv(e),l=t&&tb(o)?(t,r)=>Og(E6(a(t,r),o.value),e,t,r):a;return r.set(e,l),l},Oc=e=>tW(Cg(e)),Ou=e=>tW(Cb(e)),Oh=(e,t)=>{switch(e._tag){case"Refinement":if(t){let t=Ol(e.from,!0);return(r,n)=>{n=n??Em;let i=n?.errors==="all";return Og(E1(E6(t(r,n),t=>{let s=new EW(e,r,"From",t);return i&&Cw(e)&&OF(t)?tq(e.filter(r,n,e),{onNone:()=>tO(s),onSome:t=>tO(new EK(e,r,[s,new EW(e,r,"Predicate",t)]))}):tO(s)}),t=>tq(e.filter(t,n,e),{onNone:()=>tI(t),onSome:t=>tO(new EW(e,r,"Predicate",t))})),e,r,n)}}{let t=Ol(ET(e),!0),r=Ol(Om(e.from),!1);return(n,i)=>Og(E1(t(n,i),e=>r(e,i)),e,n,i)}case"Transformation":{let r=Oy(e.transformation,t),n=t?Ol(e.from,!0):Ol(e.to,!1),i=t?Ol(e.to,!0):Ol(e.from,!1);return(s,a)=>Og(E1(E3(n(s,a),r=>new EV(e,s,t?"Encoded":"Type",r)),n=>E1(E3(r(n,a??Em,e,s),t=>new EV(e,s,"Transformation",t)),r=>E3(i(r,a),r=>new EV(e,s,t?"Type":"Encoded",r)))),e,s,a)}case"Declaration":{let r=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(t,n)=>Og(r(t,n??Em,e),e,t,n)}case"Literal":return Op(e,t=>t===e.literal);case"UniqueSymbol":return Op(e,t=>t===e.symbol);case"UndefinedKeyword":return Op(e,W);case"NeverKeyword":return Op(e,Y);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return tI;case"StringKeyword":return Op(e,U);case"NumberKeyword":return Op(e,q);case"BooleanKeyword":return Op(e,B);case"BigIntKeyword":return Op(e,J);case"SymbolKeyword":return Op(e,H);case"ObjectKeyword":return Op(e,Z);case"Enums":return Op(e,t=>e.enums.some(([e,r])=>r===t));case"TemplateLiteral":{let t=EO(e);return Op(e,e=>U(e)&&t.test(e))}case"TupleType":{let r=e.elements.map(e=>Ol(e.type,t)),n=e.rest.map(e=>Ol(e.type,t)),i=e.elements.filter(e=>!e.isOptional);e.rest.length>0&&(i=i.concat(e.rest.slice(1)));let s=i.length,a=e.elements.length>0?e.elements.map((e,t)=>t).join(" | "):"never",o=Oc(e),l=Ou(e);return(t,c)=>{let u;if(!rg(t))return tO(new EG(e,t));let h=c?.errors==="all",p=[],f=0,d=[],m=t.length;for(let r=m;r<=s-1;r++){let n=new EB(r,t,new EH(i[r-m]));if(!h)return tO(new EK(e,t,n,d));p.push([f++,n])}if(0===e.rest.length)for(let r=e.elements.length;r<=m-1;r++){let n=new EB(r,t,new EJ(t[r],`is unexpected, expected: ${a}`));if(!h)return tO(new EK(e,t,n,d));p.push([f++,n])}let g=0;for(;g<r.length;g++)if(m<g+1){if(e.elements[g].isOptional)continue}else{let n=(0,r[g])(t[g],c),i=E5(n);if(i){if(tC(i)){let r=new EB(g,t,i.left);if(!h)return tO(new EK(e,t,r,Ox(d)));p.push([f++,r]);continue}d.push([f++,i.right])}else{let r=f++,i=g;u||(u=[]),u.push(({es:s,output:a})=>cp(ci(n),n=>{if(tC(n)){let o=new EB(i,t,n.left);return h?(s.push([r,o]),cB):tO(new EK(e,t,o,Ox(a)))}return a.push([r,n.right]),cB}))}}if(rx(n)){let[r,...i]=n;for(;g<m-i.length;g++){let n=r(t[g],c),i=E5(n);if(i){if(tC(i)){let r=new EB(g,t,i.left);if(!h)return tO(new EK(e,t,r,Ox(d)));p.push([f++,r]);continue}d.push([f++,i.right])}else{let r=f++,i=g;u||(u=[]),u.push(({es:s,output:a})=>cp(ci(n),n=>{if(!tC(n))return a.push([r,n.right]),cB;{let o=new EB(i,t,n.left);return h?(s.push([r,o]),cB):tO(new EK(e,t,o,Ox(a)))}}))}}for(let r=0;r<i.length;r++)if(!(m<(g+=r)+1)){let n=i[r](t[g],c),s=E5(n);if(s){if(tC(s)){let r=new EB(g,t,s.left);if(!h)return tO(new EK(e,t,r,Ox(d)));p.push([f++,r]);continue}d.push([f++,s.right])}else{let r=f++,i=g;u||(u=[]),u.push(({es:s,output:a})=>cp(ci(n),n=>{if(tC(n)){let o=new EB(i,t,n.left);return h?(s.push([r,o]),cB):tO(new EK(e,t,o,Ox(a)))}return a.push([r,n.right]),cB}))}}}let b=({es:r,output:n})=>t$(r)?tO(new EK(e,t,Ox(r),Ox(n))):tI(Ox(n));if(u&&u.length>0){let e=u;return cz(()=>{let t={es:rD(p),output:rD(d)};return cp(vt(e,e=>e(t),{concurrency:o,batching:l,discard:!0}),()=>b(t))})}return b({output:d,es:p})}}case"TypeLiteral":{if(0===e.propertySignatures.length&&0===e.indexSignatures.length)return Op(e,er);let r=[],n={},i=[];for(let s of e.propertySignatures)r.push([Ol(s.type,t),s]),n[s.name]=null,i.push(s.name);let s=e.indexSignatures.map(e=>[Ol(e.parameter,t),Ol(e.type,t),e.parameter]),a=Eo.make(e.indexSignatures.map(e=>e.parameter).concat(i.map(e=>H(e)?new CA(e):new CR(e)))),o=Ol(a,t),l=Oc(e),c=Ou(e);return(t,u)=>{let h,p;if(!es(t))return tO(new EG(e,t));let f=u?.errors==="all",d=[],m=0,g=u?.onExcessProperty==="error",b=u?.onExcessProperty==="preserve",x={};if(g||b){for(let r of h=kN(t))if(tC(E5(o(r,u)))){if(g){let n=new EB(r,t,new EJ(t[r],`is unexpected, expected: ${String(a)}`));if(!f)return tO(new EK(e,t,n,x));d.push([m++,n]);continue}x[r]=t[r]}}let y=u?.exact===!0;for(let n=0;n<r.length;n++){let i=r[n][1],s=i.name,a=Object.prototype.hasOwnProperty.call(t,s);if(!a){if(i.isOptional)continue;if(y){let r=new EB(s,t,new EH(i));if(!f)return tO(new EK(e,t,r,x));d.push([m++,r]);continue}}let o=(0,r[n][0])(t[s],u),l=E5(o);if(l){if(tC(l)){let r=new EB(s,t,a?l.left:new EH(i));if(!f)return tO(new EK(e,t,r,x));d.push([m++,r]);continue}x[s]=l.right}else{let r=m++;p||(p=[]),p.push(({es:n,output:l})=>cp(ci(o),o=>{if(tC(o)){let c=new EB(s,t,a?o.left:new EH(i));return f?(n.push([r,c]),cB):tO(new EK(e,t,c,l))}return l[s]=o.right,cB}))}}for(let r=0;r<s.length;r++){let i=s[r],a=i[0],o=i[1];for(let r of kT(t,i[2])){let i=E5(a(r,u));if(i&&tE(i)){let i=o(t[r],u),s=E5(i);if(s){if(tC(s)){let n=new EB(r,t,s.left);if(!f)return tO(new EK(e,t,n,x));d.push([m++,n]);continue}Object.prototype.hasOwnProperty.call(n,r)||(x[r]=s.right)}else{let s=m++,a=r;p||(p=[]),p.push(({es:o,output:l})=>cp(ci(i),i=>{if(!tC(i))return Object.prototype.hasOwnProperty.call(n,r)||(l[r]=i.right),cB;{let r=new EB(a,t,i.left);return f?(o.push([s,r]),cB):tO(new EK(e,t,r,l))}}))}}}}let v=({es:r,output:n})=>{if(t$(r))return tO(new EK(e,t,Ox(r),n));if(u?.propertyOrder==="original"){let e=h||kN(t);for(let t of i)-1===e.indexOf(t)&&e.push(t);let r={};for(let t of e)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t]);return tI(r)}return tI(n)};if(p&&p.length>0){let e=p;return cz(()=>{let t={es:rD(d),output:Object.assign({},x)};return cp(vt(e,e=>e(t),{concurrency:l,batching:c,discard:!0}),()=>v(t))})}return v({es:d,output:x})}}case"Union":{let r=Od(e.types,t),n=kN(r.keys),i=n.length,s=new Map;for(let r=0;r<e.types.length;r++)s.set(e.types[r],Ol(e.types[r],t));let a=Oc(e)??1,o=Ou(e);return(t,l)=>{let c;let u=[],h=0,p=[];if(i>0){if(Q(t))for(let e=0;e<i;e++){let i=n[e],s=r.keys[i].buckets;if(Object.prototype.hasOwnProperty.call(t,i)){let e=String(t[i]);if(Object.prototype.hasOwnProperty.call(s,e))p=p.concat(s[e]);else{let e=Eo.make(r.keys[i].literals);u.push([h++,new EK(new C9([new C6(i,e,!1,!0)],[]),t,new EB(i,t,new EG(e,t[i])))])}}else{let e=Eo.make(r.keys[i].literals),n=new C6(i,e,!1,!0);u.push([h++,new EK(new C9([n],[]),t,new EB(i,t,new EH(n)))])}}else u.push([h++,new EG(e,t)])}r.otherwise.length>0&&(p=p.concat(r.otherwise));for(let e=0;e<p.length;e++){let r=p[e],n=s.get(r)(t,l),i=c&&0!==c.length?void 0:E5(n);if(i){if(tE(i))return i;u.push([h++,i.left])}else{let e=h++;c||(c=[]),c.push(t=>cz(()=>"finalResult"in t?cB:cp(ci(n),r=>(tE(r)?t.finalResult=r:t.es.push([e,r.left]),cB))))}}let f=r=>t$(r)?1===r.length&&"Type"===r[0][1]._tag?tO(r[0][1]):tO(new EK(e,t,Ox(r))):tO(new EG(e,t));if(c&&c.length>0){let e=c;return cz(()=>{let t={es:rD(u)};return cp(vt(e,e=>e(t),{concurrency:a,batching:o,discard:!0}),()=>"finalResult"in t?t.finalResult:f(t.es))})}return f(u)}}case"Suspend":{let r=kA(()=>Ol(Ew(e.f(),e.annotations),t));return(e,t)=>r()(e,t)}}},Op=(e,t)=>r=>t(r)?tI(r):tO(new EG(e,r)),Of=(e,t)=>{switch(e._tag){case"Declaration":{let r=C_(e);if(tb(r))return Of(r.value,t);break}case"TypeLiteral":{let r=[];for(let n=0;n<e.propertySignatures.length;n++){let i=e.propertySignatures[n],s=t?Ez(i.type):ET(i.type);CT(s)&&!i.isOptional&&r.push([i.name,s])}return r}case"TupleType":{let r=[];for(let n=0;n<e.elements.length;n++){let i=e.elements[n],s=t?Ez(i.type):ET(i.type);CT(s)&&!i.isOptional&&r.push([n,s])}return r}case"Refinement":return Of(e.from,t);case"Suspend":return Of(e.f(),t);case"Transformation":return Of(t?e.from:e.to,t)}return[]},Od=(e,t)=>{let r={},n=[];for(let i=0;i<e.length;i++){let s=e[i],a=Of(s,t);if(a.length>0)for(let e=0;e<a.length;e++){let[t,n]=a[e],i=String(n.literal);r[t]=r[t]||{buckets:{},literals:[]};let o=r[t].buckets;if(Object.prototype.hasOwnProperty.call(o,i)){if(e<a.length-1)continue;o[i].push(s),r[t].literals.push(n)}else{o[i]=[s],r[t].literals.push(n);break}}else n.push(s)}return{keys:r,otherwise:n}},Om=e=>Ed(e)?Om(e.from):e,Og=(e,t,r,n)=>{let i=E5(e);if(i)return i;if(n?.isEffectAllowed===!0)return e;try{return S7(ci(e))}catch(e){return tO(new EY(t,r,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},Ob=([e],[t])=>e>t?1:e<t?-1:0;function Ox(e){return e.sort(Ob).map(e=>e[1])}let Oy=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return tI;case"TypeLiteralTransformation":return r=>{let n=tI(r);for(let r of e.propertySignatureTransformations){let[e,i]=t?[r.from,r.to]:[r.to,r.from],s=t?r.decode:r.encode;n=E2(n,t=>{let r=s(Object.prototype.hasOwnProperty.call(t,e)?ty(t[e]):tU());return delete t[e],tb(r)&&(t[i]=r.value),t})}return n}}},Ov=(e,t=[])=>({value:e,forest:t}),O_={formatIssue:e=>cE(O$(e),OS),formatIssueSync:e=>S7(O_.formatIssue(e)),formatError:e=>O_.formatIssue(e.issue),formatErrorSync:e=>O_.formatIssueSync(e.issue)},OS=e=>e.value+Ow("\n",e.forest),Ow=(e,t)=>{let r,n="",i=t.length;for(let s=0;s<i;s++){r=t[s];let a=s===i-1;n+=e+(a?"":"")+" "+r.value+Ow(e+(i>1&&!a?"  ":"   "),r.forest)}return n},Ok=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},OC=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},OE=e=>"ast"in e?ty(e.ast):tU(),OO=e=>OE(e).pipe(tQ(Cu),cp(t=>{let r=t(e);return U(r)?cj({message:r,override:!1}):lQ(r)?cE(r,e=>({message:e,override:!1})):U(r.message)?cj({message:r.message,override:r.override}):cE(r.message,e=>({message:e,override:r.override}))})),OI=e=>t=>t._tag===e,OF=OI("Composite"),OR=OI("Refinement"),OT=OI("Transformation"),ON=e=>OO(e).pipe(cp(t=>!t.override&&(OF(e)||OR(e)&&"From"===e.kind||OT(e)&&"Transformation"!==e.kind)?OT(e)||OR(e)?ON(e.issue):tU():cj(t.message))),OA=e=>OE(e).pipe(tQ(Cx),tX(t=>tK(t(e)))),OM=e=>ON(e).pipe(cT(()=>OA(e)),l8(()=>cj(function(e){var t;if(void 0!==e.message)return e.message;let r=Ed(e.ast)?Cm(t=e.ast).pipe(tJ(()=>Cp(t)),tJ(()=>Cf(t)),tJ(()=>Cd(t)),tB(()=>`{ ${t.from} | filter }`)):String(e.ast);return`Expected ${r}, actual ${kj(e.actual)}`}(e)))),Oj=e=>tB(OA(e),()=>String(e.ast)),Oz=e=>e.message??"is forbidden",OP=e=>e.message??"is unexpected",OD=e=>Ch(e.ast).pipe(cp(e=>{let t=e();return U(t)?cj(t):t}),l8(()=>cj(e.message??"is missing"))),OL=(e,t)=>cx(ON(e),{onFailure:t,onSuccess:e=>cj(Ov(e))}),O$=e=>{switch(e._tag){case"Type":return cE(OM(e),Ov);case"Forbidden":return cj(Ov(Oj(e),[Ov(Oz(e))]));case"Unexpected":return cj(Ov(OP(e)));case"Missing":return cE(OD(e),Ov);case"Transformation":return OL(e,()=>cE(O$(e.issue),t=>Ov(Oj(e),[Ov(Ok(e.kind),[t])])));case"Refinement":return OL(e,()=>cE(O$(e.issue),t=>Ov(Oj(e),[Ov(OC(e.kind),[t])])));case"Pointer":return cE(O$(e.issue),t=>Ov(k$(e.path),[t]));case"Composite":{let t=Oj(e);return OL(e,()=>kP(e.issues)?cE(vt(e.issues,O$),e=>Ov(t,e)):cE(O$(e.issues),e=>Ov(t,[e])))}}},OU=e=>cj([e]),Oq=Symbol.for("effect/QueueEnqueue"),OB=Symbol.for("effect/QueueDequeue"),OJ=Symbol.for("effect/QueueStrategy"),OH=Symbol.for("effect/BackingQueue"),OK={_A:e=>e},OW={_A:e=>e},OV={_In:e=>e},OG={_Out:e=>e};class OY extends fp{queue;takers;shutdownHook;shutdownFlag;strategy;[Oq]=OV;[OB]=OG;constructor(e,t,r,n,i){super(),this.queue=e,this.takers=t,this.shutdownHook=r,this.shutdownFlag=n,this.strategy=i}pipe(){return eV(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return cz(()=>l8(this.unsafeSize(),()=>cS))}unsafeSize(){return aC(this.shutdownFlag)?tU():ty(this.queue.length()-wZ(this.takers)+this.strategy.surplusSize())}get isEmpty(){return cE(this.size,e=>e<=0)}get isFull(){return cE(this.size,e=>e>=this.capacity())}get shutdown(){return cU(lZ(e=>(z(this.shutdownFlag,aE(!0)),z(vn(Ia(this.takers),t=>hw(t,e.id()),!1,!1),cZ(this.strategy.shutdown),cH(hk(this.shutdownHook,void 0)),l1))))}get isShutdown(){return cP(()=>aC(this.shutdownFlag))}get awaitShutdown(){return hy(this.shutdownHook)}isActive(){return!aC(this.shutdownFlag)}unsafeOffer(e){let t;if(aC(this.shutdownFlag))return!1;if(0===this.queue.length()){let r=z(this.takers,w3(wW));r!==wW?(Ii(r,e),t=!0):t=!1}else t=!1;if(t)return!0;let r=this.queue.offer(e);return Ic(this.strategy,this.queue,this.takers),r}offer(e){return cz(()=>{let t;if(aC(this.shutdownFlag))return cS;if(0===this.queue.length()){let r=z(this.takers,w3(wW));r!==wW?(Ii(r,e),t=!0):t=!1}else t=!1;if(t)return cj(!0);let r=this.queue.offer(e);return Ic(this.strategy,this.queue,this.takers),r?cj(!0):this.strategy.handleSurplus([e],this.queue,this.takers,this.shutdownFlag)})}offerAll(e){return cz(()=>{if(aC(this.shutdownFlag))return cS;let t=rc(e),r=0===this.queue.length()?rc(Io(this.takers,t.length)):rU,[n,i]=z(t,rz(r.length));for(let e=0;e<r.length;e++)Ii(r[e],n[e]);if(0===i.length)return cj(!0);let s=this.queue.offerAll(i);return Ic(this.strategy,this.queue,this.takers),nw(s)?cj(!0):this.strategy.handleSurplus(s,this.queue,this.takers,this.shutdownFlag)})}get take(){return lZ(e=>{if(aC(this.shutdownFlag))return cS;let t=this.queue.poll(wW);if(t!==wW)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),cj(t);{let t=hg(e.id());return z(cz(()=>(z(this.takers,w1(t)),Ic(this.strategy,this.queue,this.takers),aC(this.shutdownFlag)?cS:hy(t))),cR(()=>cP(()=>Il(this.takers,t))))}})}get takeAll(){return cz(()=>aC(this.shutdownFlag)?cS:cP(()=>{let e=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ni(e)}))}takeUpTo(e){return cz(()=>aC(this.shutdownFlag)?cS:cP(()=>{let t=this.queue.pollUpTo(e);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ni(t)}))}takeBetween(e,t){return cz(()=>OQ(this,e,t,nt()))}}let OQ=(e,t,r,n)=>r<t?cj(n):z(O4(e,r),cp(i=>{let s=t-i.length;return 1===s?z(O5(e),cE(e=>z(n,nb(i),np(e)))):s>1?z(O5(e),cp(t=>OQ(e,s-1,r-i.length-1,z(n,nb(i),np(t))))):cj(z(n,nb(i)))})),OZ=(e,t,r,n,i)=>new OY(e,t,r,n,i),OX=(e,t)=>z(hb(),cE(r=>OZ(e,wQ(),r,aw(!1),t)));class O0{mutable;[OH]=OW;constructor(e){this.mutable=e}poll(e){return w3(this.mutable,e)}pollUpTo(e){return w5(this.mutable,e)}offerAll(e){return w2(this.mutable,e)}offer(e){return w1(this.mutable,e)}capacity(){return w0(this.mutable)}length(){return wZ(this.mutable)}}let O1=e=>new O0(e),O2=R(2,(e,t)=>e.offer(t)),O3=R(2,(e,t)=>e.offerAll(t)),O5=e=>e.take,O4=R(2,(e,t)=>e.takeUpTo(t)),O6=R(3,(e,t,r)=>e.takeBetween(t,r)),O8=R(2,(e,t)=>e.takeBetween(t,t)),O7=()=>new It,O9=()=>new Ir,Ie=()=>new In;class It{[OJ]=OK;putters=wQ();surplusSize(){return wZ(this.putters)}onCompleteTakersWithEmptyQueue(e){for(;!wX(this.putters)&&!wX(e);){let t=w3(e,void 0),r=w3(this.putters,void 0);r[2]&&Ii(r[1],!0),Ii(t,r[0])}}get shutdown(){return z(cu,cp(e=>z(cP(()=>Ia(this.putters)),cp(t=>vn(t,([t,r,n])=>n?z(hw(r,e),l1):cB,!1,!1)))))}handleSurplus(e,t,r,n){return lZ(i=>{let s=hg(i.id());return z(cz(()=>(this.unsafeOffer(e,s),this.unsafeOnQueueEmptySpace(t,r),Ic(this,t,r),aC(n)?cS:hy(s))),cR(()=>cP(()=>this.unsafeRemove(s))))})}unsafeOnQueueEmptySpace(e,t){let r=!0;for(;r&&(e.capacity()===Number.POSITIVE_INFINITY||e.length()<e.capacity());){let n=z(this.putters,w3(wW));if(n===wW)r=!1;else{let r=e.offer(n[0]);r&&n[2]?Ii(n[1],!0):r||Is(this.putters,z(Ia(this.putters),nf(n))),Ic(this,e,t)}}}unsafeOffer(e,t){let r=rc(e);for(let e=0;e<r.length;e++){let n=r[e];e===r.length-1?z(this.putters,w1([n,t,!0])):z(this.putters,w1([n,t,!1]))}}unsafeRemove(e){Is(this.putters,z(Ia(this.putters),ny(([,t])=>t!==e)))}}class Ir{[OJ]=OK;surplusSize(){return 0}get shutdown(){return cB}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,r,n){return cj(!1)}unsafeOnQueueEmptySpace(e,t){}}class In{[OJ]=OK;surplusSize(){return 0}get shutdown(){return cB}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,r,n){return cP(()=>(this.unsafeOffer(t,e),Ic(this,t,r),!0))}unsafeOnQueueEmptySpace(e,t){}unsafeOffer(e,t){let r;let n=t[Symbol.iterator](),i=!0;for(;!(r=n.next()).done&&i;){if(0===e.capacity())return;e.poll(wW),i=e.offer(r.value)}}}let Ii=(e,t)=>hC(e,cj(t)),Is=(e,t)=>z(e,w2(t)),Ia=e=>z(e,w5(Number.POSITIVE_INFINITY)),Io=(e,t)=>z(e,w5(t)),Il=(e,t)=>{Is(e,z(Ia(e),ny(e=>t!==e)))},Ic=(e,t,r)=>{let n=!0;for(;n&&0!==t.length();){let i=z(r,w3(wW));if(i!==wW){let s=t.poll(wW);s!==wW?(Ii(i,s),e.unsafeOnQueueEmptySpace(t,r)):Is(r,z(Ia(r),nf(i))),n=!0}else n=!1}n&&0===t.length()&&!wX(r)&&e.onCompleteTakersWithEmptyQueue(r)},Iu=e=>z(cP(()=>wY(e)),cp(e=>OX(O1(e),O7()))),Ih=e=>z(cP(()=>wY(e)),cp(e=>OX(O1(e),O9()))),Ip=e=>z(cP(()=>wY(e)),cp(e=>OX(O1(e),Ie()))),If=()=>z(cP(()=>wQ()),cp(e=>OX(O1(e),O9()))),Id=e=>e.capacity(),Im=e=>e.size,Ig=e=>e.isEmpty,Ib=e=>e.isFull,Ix=e=>e.isShutdown,Iy=e=>e.awaitShutdown,Iv=e=>e.shutdown,I_=e=>cE(e.takeUpTo(1),nC),IS=e=>e.takeAll,Iw=R(2,(e,t)=>up(yG,t)(e)),Ik=e=>ww(vR(y3,iO(e))),IC=e=>wN(cE(e,Ik)),IE=e=>wA(cE(e,Ik)),IO=e=>ww(vR(y3,iI(e))),II=R(2,(e,t)=>wm(IO(e),()=>Ik(t))),IF=R(2,(e,t)=>wm(IO(e),()=>IC(t))),IR=R(2,(e,t)=>wm(IO(e),()=>IE(t))),IT=e=>wb(cE(e,()=>sH())),IN=e=>ww(vg(e)),IA=Symbol.for("effect/PubSub/AbsentValue"),IM=(e,t)=>r=>{r.has(e)||r.set(e,new Set),r.get(e).add(t)},Ij=(e,t)=>r=>{if(!r.has(e))return;let n=r.get(e);n.delete(t),0===n.size&&r.delete(e)},Iz=e=>{let t="number"==typeof e?{capacity:e}:e;IX(t.capacity);let r=t.replay&&t.replay>0?new Fr(Math.ceil(t.replay)):void 0;return 1===t.capacity?new IJ(r):hB(t.capacity)===t.capacity?new Iq(t.capacity,r):new I$(t.capacity,r)},IP=e=>new IK(e?.replay?new Fr(e.replay):void 0),ID=(e,t,r)=>cE(hb(),n=>IL(e,t,e.subscribe(),wQ(),n,aw(!1),r)),IL=(e,t,r,n,i,s,a)=>new IV(e,t,r,n,i,s,a,e.replayWindow());class I${capacity;replayBuffer;array;publisherIndex=0;subscribers;subscriberCount=0;subscribersIndex=0;constructor(e,t){this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Fn(this.replayBuffer):Fi}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex%this.capacity;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),nt();let t=ni(e),r=t.length,n=this.publisherIndex-this.subscribersIndex,i=Math.min(r,this.capacity-n);if(0===i)return t;let s=0,a=this.publisherIndex+i;for(;this.publisherIndex!==a;){let e=nh(t,s++),r=this.publisherIndex%this.capacity;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return nm(t,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex%this.capacity;this.array[e]=IA,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IU(this,this.publisherIndex,!1)}}class IU{self;subscriberIndex;unsubscribed;constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return nt();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return nt();let r=[],n=this.subscriberIndex+t;for(;this.subscriberIndex!==n;){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return ni(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex%this.self.capacity;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class Iq{capacity;replayBuffer;array;mask;publisherIndex=0;subscribers;subscriberCount=0;subscribersIndex=0;constructor(e,t){this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.mask=e-1,this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Fn(this.replayBuffer):Fi}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex&this.mask;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),nt();let t=ni(e),r=t.length,n=this.publisherIndex-this.subscribersIndex,i=Math.min(r,this.capacity-n);if(0===i)return t;let s=0,a=this.publisherIndex+i;for(;this.publisherIndex!==a;){let e=nh(t,s++),r=this.publisherIndex&this.mask;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return nm(t,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex&this.mask;this.array[e]=IA,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IB(this,this.publisherIndex,!1)}}class IB{self;subscriberIndex;unsubscribed;constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return nt();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return nt();let r=[],n=this.subscriberIndex+t;for(;this.subscriberIndex!==n;){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return ni(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex&this.self.mask;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IA,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class IJ{replayBuffer;publisherIndex=0;subscriberCount=0;subscribers=0;value=IA;capacity=1;constructor(e){this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Fn(this.replayBuffer):Fi}pipe(){return eV(this,arguments)}isEmpty(){return 0===this.subscribers}isFull(){return!this.isEmpty()}size(){return this.isEmpty()?0:1}publish(e){return!this.isFull()&&(0!==this.subscriberCount&&(this.value=e,this.subscribers=this.subscriberCount,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0)}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),nt();let t=ni(e);return nw(t)?t:this.publish(nE(t))?nm(t,1):t}slide(){this.isFull()&&(this.subscribers=0,this.value=IA),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IH(this,this.publisherIndex,!1)}}class IH{self;subscriberIndex;unsubscribed;constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||0===this.self.subscribers||this.subscriberIndex===this.self.publisherIndex}size(){return this.isEmpty()?0:1}poll(e){if(this.isEmpty())return e;let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=IA),this.subscriberIndex+=1,t}pollUpTo(e){if(this.isEmpty()||e<1)return nt();let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=IA),this.subscriberIndex+=1,nn(t)}unsubscribe(){this.unsubscribed||(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex===this.self.publisherIndex||(this.self.subscribers-=1,0!==this.self.subscribers||(this.self.value=IA)))}}class IK{replayBuffer;publisherHead={value:IA,subscribers:0,next:null};publisherTail=this.publisherHead;publisherIndex=0;subscribersIndex=0;capacity=Number.MAX_SAFE_INTEGER;constructor(e){this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Fn(this.replayBuffer):Fi}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(e){let t=this.publisherTail.subscribers;return 0!==t&&(this.publisherTail.next={value:e,subscribers:t,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0!==this.publisherTail.subscribers)for(let t of e)this.publish(t);else this.replayBuffer&&this.replayBuffer.offerAll(e);return nt()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=IA,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new IW(this,this.publisherTail,this.publisherIndex,!1)}}class IW{self;subscriberHead;subscriberIndex;unsubscribed;constructor(e,t,r,n){this.self=e,this.subscriberHead=t,this.subscriberIndex=r,this.unsubscribed=n}isEmpty(){if(this.unsubscribed)return!0;let e=!0,t=!0;for(;t;)this.subscriberHead===this.self.publisherTail?t=!1:this.subscriberHead.next.value!==IA?(e=!1,t=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return e}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;let t=!0,r=e;for(;t;)if(this.subscriberHead===this.self.publisherTail)t=!1;else{let e=this.subscriberHead.next.value;e!==IA&&(r=e,this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=IA,this.self.subscribersIndex+=1),t=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(e){let t=[],r=0;for(;r!==e;){let n=this.poll(IA);n===IA?r=e:(t.push(n),r+=1)}return ni(t)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==IA&&(this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=IA,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class IV extends fp{pubsub;subscribers;subscription;pollers;shutdownHook;shutdownFlag;strategy;replayWindow;[OB]=OG;constructor(e,t,r,n,i,s,a,o){super(),this.pubsub=e,this.subscribers=t,this.subscription=r,this.pollers=n,this.shutdownHook=i,this.shutdownFlag=s,this.strategy=a,this.replayWindow=o}commit(){return this.take}pipe(){return eV(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!aC(this.shutdownFlag)}get size(){return cz(()=>aC(this.shutdownFlag)?cS:cj(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return aC(this.shutdownFlag)?tU():ty(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return cz(()=>aC(this.shutdownFlag)?cS:cj(this.subscription.size()===this.capacity()))}get isEmpty(){return cE(this.size,e=>0===e)}get shutdown(){return cU(lZ(e=>(aE(this.shutdownFlag,!0),z(vr(I2(this.pollers),t=>hw(t,e.id()),!1),cZ(cP(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),cH(hk(this.shutdownHook,void 0)),l1))))}get isShutdown(){return cP(()=>aC(this.shutdownFlag))}get awaitShutdown(){return hy(this.shutdownHook)}get take(){return lZ(e=>{if(aC(this.shutdownFlag))return cS;if(this.replayWindow.remaining>0)return cj(this.replayWindow.take());let t=wX(this.pollers)?this.subscription.poll(wW):wW;if(t!==wW)return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),cj(t);{let t=hg(e.id());return z(cz(()=>(z(this.pollers,w1(t)),z(this.subscribers,IM(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),aC(this.shutdownFlag)?cS:hy(t))),cR(()=>cP(()=>I6(this.pollers,t))))}})}get takeAll(){return cz(()=>{if(aC(this.shutdownFlag))return cS;let e=wX(this.pollers)?I3(this.subscription):nt();return(this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0)?cj(nb(this.replayWindow.takeAll(),e)):cj(e)})}takeUpTo(e){return cz(()=>{let t;if(aC(this.shutdownFlag))return cS;if(this.replayWindow.remaining>=e)return cj(this.replayWindow.takeN(e));this.replayWindow.remaining>0&&(t=this.replayWindow.takeAll(),e-=t.length);let r=wX(this.pollers)?I5(this.subscription,e):nt();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),t?cj(nb(t,r)):cj(r)})}takeBetween(e,t){return cz(()=>IG(this,e,t,nt()))}}let IG=(e,t,r,n)=>r<t?cj(n):z(e.takeUpTo(r),cp(i=>{let s=t-i.length;return 1===s?z(e.take,cE(e=>z(n,nb(i),np(e)))):s>1?z(e.take,cp(t=>IG(e,s-1,r-i.length-1,z(n,nb(i),np(t))))):cj(z(n,nb(i)))}));class IY{pubsub;subscribers;scope;shutdownHook;shutdownFlag;strategy;[Oq]=OV;[OB]=OG;constructor(e,t,r,n,i,s){this.pubsub=e,this.subscribers=t,this.scope=r,this.shutdownHook=n,this.shutdownFlag=i,this.strategy=s}capacity(){return this.pubsub.capacity}get size(){return cz(()=>aC(this.shutdownFlag)?cS:cP(()=>this.pubsub.size()))}unsafeSize(){return aC(this.shutdownFlag)?tU():ty(this.pubsub.size())}get isFull(){return cE(this.size,e=>e===this.capacity())}get isEmpty(){return cE(this.size,e=>0===e)}get awaitShutdown(){return hy(this.shutdownHook)}get isShutdown(){return cP(()=>aC(this.shutdownFlag))}get shutdown(){return cU(lZ(e=>(z(this.shutdownFlag,aE(!0)),z(this.scope.close(ha(e.id())),cZ(this.strategy.shutdown),cH(hk(this.shutdownHook,void 0)),l1))))}publish(e){return cz(()=>aC(this.shutdownFlag)?cS:this.pubsub.publish(e)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),cj(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,nn(e),this.shutdownFlag))}isActive(){return!aC(this.shutdownFlag)}unsafeOffer(e){return!aC(this.shutdownFlag)&&!!this.pubsub.publish(e)&&(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0)}publishAll(e){return cz(()=>{if(aC(this.shutdownFlag))return cS;let t=I4(this.pubsub,e);return(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),nw(t))?cj(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,t,this.shutdownFlag)})}get subscribe(){return cE(y4(cD(ve([this.scope.fork(fg),ID(this.pubsub,this.subscribers,this.strategy)]),e=>e[0].addFinalizer(()=>e[1].shutdown)),(e,t)=>e[0].close(t)),e=>e[1])}offer(e){return this.publish(e)}offerAll(e){return this.publishAll(e)}pipe(){return eV(this,arguments)}}let IQ=(e,t)=>cp(vE(),r=>cE(hb(),n=>IZ(e,new Map,r,n,aw(!1),t))),IZ=(e,t,r,n,i,s)=>new IY(e,t,r,n,i,s),IX=e=>{if(e<=0)throw new u1(`Cannot construct PubSub with capacity of ${e}`)},I0=(e,t)=>{hC(e,cj(t))},I1=(e,t)=>z(e,w2(t)),I2=e=>z(e,w5(Number.POSITIVE_INFINITY)),I3=e=>e.pollUpTo(Number.POSITIVE_INFINITY),I5=(e,t)=>e.pollUpTo(t),I4=(e,t)=>e.publishAll(t),I6=(e,t)=>{I1(e,z(I2(e),ny(e=>e!==t)))};class I8{publishers=wQ();get shutdown(){return cp(cu,e=>cp(cP(()=>I2(this.publishers)),t=>vn(t,([t,r,n])=>n?z(hw(r,e),l1):cB,!1,!1)))}handleSurplus(e,t,r,n){return lZ(i=>{let s=hg(i.id());return z(cz(()=>(this.unsafeOffer(r,s),this.unsafeOnPubSubEmptySpace(e,t),this.unsafeCompleteSubscribers(e,t),aC(n)?cS:hy(s))),cR(()=>cP(()=>this.unsafeRemove(s))))})}unsafeOnPubSubEmptySpace(e,t){let r=!0;for(;r&&!e.isFull();){let n=z(this.publishers,w3(wW));if(n===wW)r=!1;else{let r=e.publish(n[0]);r&&n[2]?I0(n[1],!0):r||I1(this.publishers,z(I2(this.publishers),nf(n))),this.unsafeCompleteSubscribers(e,t)}}}unsafeCompletePollers(e,t,r,n){return Fe(this,e,t,r,n)}unsafeCompleteSubscribers(e,t){return Ft(this,e,t)}unsafeOffer(e,t){let r=e[Symbol.iterator](),n=r.next();if(!n.done)for(;;){let e=n.value;if((n=r.next()).done){z(this.publishers,w1([e,t,!0]));break}z(this.publishers,w1([e,t,!1]))}}unsafeRemove(e){I1(this.publishers,z(I2(this.publishers),ny(([t,r])=>r!==e)))}}class I7{get shutdown(){return cB}handleSurplus(e,t,r,n){return cj(!1)}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,r,n){return Fe(this,e,t,r,n)}unsafeCompleteSubscribers(e,t){return Ft(this,e,t)}}class I9{get shutdown(){return cB}handleSurplus(e,t,r,n){return cP(()=>(this.unsafeSlidingPublish(e,r),this.unsafeCompleteSubscribers(e,t),!0))}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,r,n){return Fe(this,e,t,r,n)}unsafeCompleteSubscribers(e,t){return Ft(this,e,t)}unsafeSlidingPublish(e,t){let r=t[Symbol.iterator](),n=r.next();if(!n.done&&e.capacity>0){let t=n.value,i=!0;for(;i;){e.slide();let s=e.publish(t);s&&(n=r.next())&&!n.done?t=n.value:s&&(i=!1)}}}}let Fe=(e,t,r,n,i)=>{let s=!0;for(;s&&!n.isEmpty();){let a=z(i,w3(wW));if(a===wW)z(r,Ij(n,i)),wX(i)?s=!1:z(r,IM(n,i));else{let s=n.poll(wW);s===wW?I1(i,z(I2(i),nf(a))):(I0(a,s),e.unsafeOnPubSubEmptySpace(t,r))}}},Ft=(e,t,r)=>{for(let[n,i]of r)for(let s of i)e.unsafeCompletePollers(t,r,n,s)};class Fr{capacity;constructor(e){this.capacity=e}head={value:IA,next:null};tail=this.head;size=0;index=0;slide(){this.index++}offer(e){this.tail.value=e,this.tail.next={value:IA,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(e){for(let t of e)this.offer(t)}}class Fn{buffer;head;index;remaining;constructor(e){this.buffer=e,this.index=e.index,this.remaining=e.size,this.head=e.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(0===this.remaining)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;let e=this.head.value;return this.head=this.head.next,e}takeN(e){if(0===this.remaining)return nt();this.index<this.buffer.index&&this.fastForward();let t=Math.min(e,this.remaining),r=Array(t);for(let e=0;e<t;e++){let t=this.head.value;this.head=this.head.next,r[e]=t}return this.remaining-=t,nc(r)}takeAll(){return this.takeN(this.remaining)}}let Fi={remaining:0,take:()=>void 0,takeN:()=>nt(),takeAll:()=>nt()},Fs=e=>cz(()=>IQ(Iz(e),new I8)),Fa=e=>cz(()=>IQ(Iz(e),new I7)),Fo=e=>cz(()=>IQ(Iz(e),new I9)),Fl=e=>cz(()=>IQ(IP(e),new I7)),Fc=e=>e.shutdown,Fu=e=>e.subscribe,Fh="Continue",Fp=Symbol.for("effect/ChannelChildExecutorDecision"),Ff={[Fp]:Fp},Fd=e=>{let t=Object.create(Ff);return t._tag=Fh,t},Fm="ContinuationK",Fg=Symbol.for("effect/ChannelContinuation"),Fb={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class Fx{onSuccess;onHalt;_tag=Fm;[Fg]=Fb;constructor(e,t){this.onSuccess=e,this.onHalt=t}onExit(e){return u6(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}class Fy{finalizer;_tag="ContinuationFinalizer";[Fg]=Fb;constructor(e){this.finalizer=e}}let Fv="PullAfterNext",F_={[Symbol.for("effect/ChannelUpstreamPullStrategy")]:{_A:e=>e}},FS=e=>{let t=Object.create(F_);return t._tag=Fv,t.emitSeparator=e,t},Fw="BracketOut",Fk="Bridge",FC="ConcatAll",FE="Emit",FO="Ensuring",FI="Fail",FF="Fold",FR="FromEffect",FT="PipeTo",FN="Provide",FA="Read",FM="Succeed",Fj="SucceedNow",Fz="Suspend",FP=Symbol.for("effect/Channel"),FD={[FP]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},pipe(){return eV(this,arguments)}},FL=e=>X(e,FP)||lQ(e),F$=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=Fw,r.acquire=()=>e,r.finalizer=t,r}),FU=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FF,r.channel=e,r.k=new Fx(F5,t),r}),Fq=e=>F6(()=>{let t=[];return FQ(F0(e,FB(t)),e=>F8(()=>[ni(t),e]))}),FB=e=>F2({onInput:t=>FQ(F8(()=>{e.push(t)}),()=>FB(e)),onFailure:FV,onDone:F4}),FJ=(e,t,r)=>{let n=Object.create(FD);return n._tag=FC,n.combineInners=t,n.combineAll=r,n.onPull=()=>FS(tU()),n.onEmit=()=>Fd,n.value=()=>e,n.k=T,n},FH=R(4,(e,t,r,n)=>{let i=Object.create(FD);return i._tag=FC,i.combineInners=r,i.combineAll=n,i.onPull=()=>FS(tU()),i.onEmit=()=>Fd,i.value=()=>e,i.k=t,i}),FK=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=Fk,r.input=t,r.channel=e,r}),FW=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FO,r.channel=e,r.finalizer=t,r}),FV=e=>FG(iH(e)),FG=e=>FY(()=>e),FY=e=>{let t=Object.create(FD);return t._tag=FI,t.error=e,t},FQ=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FF,r.channel=e,r.k=new Fx(t,FG),r}),FZ=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FF,r.channel=e,r.k=new Fx(t.onSuccess,t.onFailure),r}),FX=e=>{let t=Object.create(FD);return t._tag=FR,t.effect=()=>e,t},F0=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FT,r.left=()=>e,r.right=()=>t,r}),F1=R(2,(e,t)=>{let r=Object.create(FD);return r._tag=FN,r.context=()=>t,r.inner=e,r}),F2=e=>F3({onInput:e.onInput,onFailure:t=>tA(i4(t),{onLeft:e.onFailure,onRight:FG}),onDone:e.onDone}),F3=e=>{let t=Object.create(FD);return t._tag=FA,t.more=e.onInput,t.done=new Fx(e.onDone,e.onFailure),t},F5=e=>F8(()=>e),F4=e=>{let t=Object.create(FD);return t._tag=Fj,t.terminal=e,t},F6=e=>{let t=Object.create(FD);return t._tag=Fz,t.channel=e,t},F8=e=>{let t=Object.create(FD);return t._tag=FM,t.evaluate=e,t},F7=F4(void 0),F9=e=>{let t=Object.create(FD);return t._tag=FE,t.out=e,t},Re="Done",Rt="Emit",Rr="FromEffect",Rn="Read",Ri={[Symbol.for("effect/ChannelState")]:{_E:e=>e,_R:e=>e}},Rs=()=>{let e=Object.create(Ri);return e._tag=Re,e},Ra=()=>{let e=Object.create(Ri);return e._tag=Rt,e},Ro=e=>{let t=Object.create(Ri);return t._tag=Rr,t.effect=e,t},Rl=(e,t,r,n)=>{let i=Object.create(Ri);return i._tag=Rn,i.upstream=e,i.onEffect=t,i.onEmit=r,i.onDone=n,i},Rc=e=>e._tag===Rr,Ru=e=>Rc(e)?e.effect:cB,Rh=e=>Rc(e)?kb(e.effect):void 0,Rp="PullFromChild",Rf="PullFromUpstream",Rd="DrainChildExecutors",Rm="Emit";class Rg{childExecutor;parentSubexecutor;onEmit;_tag=Rp;constructor(e,t,r){this.childExecutor=e,this.parentSubexecutor=t,this.onEmit=r}close(e){let t=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return void 0!==t&&void 0!==r?vv(cs(t),cs(r),(e,t)=>z(e,hf(t))):void 0!==t?t:void 0!==r?r:void 0}enqueuePullFromChild(e){return this}}class Rb{upstreamExecutor;createChild;lastDone;activeChildExecutors;combineChildResults;combineWithChildResult;onPull;onEmit;_tag=Rf;constructor(e,t,r,n,i,s,a,o){this.upstreamExecutor=e,this.createChild=t,this.lastDone=r,this.activeChildExecutors=n,this.combineChildResults=i,this.combineWithChildResult=s,this.onPull=a,this.onEmit=o}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?vv(e,cs(t),(e,t)=>hf(e,t)):void 0!==e?e:void 0!==t?cs(t):void 0,void 0)}enqueuePullFromChild(e){return new Rb(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Rx{upstreamExecutor;lastDone;activeChildExecutors;upstreamDone;combineChildResults;combineWithChildResult;onPull;_tag=Rd;constructor(e,t,r,n,i,s,a){this.upstreamExecutor=e,this.lastDone=t,this.activeChildExecutors=r,this.upstreamDone=n,this.combineChildResults=i,this.combineWithChildResult=s,this.onPull=a}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?vv(e,cs(t),(e,t)=>hf(e,t)):void 0!==e?e:void 0!==t?cs(t):void 0,void 0)}enqueuePullFromChild(e){return new Rx(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class Ry{value;next;_tag=Rm;constructor(e,t){this.value=e,this.next=t}close(e){return this.next.close(e)}enqueuePullFromChild(e){return this}}let Rv={[Symbol.for("effect/ChannelUpstreamPullRequest")]:{_A:e=>e}},R_=e=>{let t=Object.create(Rv);return t._tag="Pulled",t.value=e,t},RS=e=>{let t=Object.create(Rv);return t._tag="NoUpstream",t.activeDownstreamCount=e,t};class Rw{_activeSubexecutor=void 0;_cancelled=void 0;_closeLastSubstream=void 0;_currentChannel;_done=void 0;_doneStack=[];_emitted=void 0;_executeCloseLastSubstream;_input=void 0;_inProgressFinalizer=void 0;_providedEnv;constructor(e,t,r){this._currentChannel=e,this._executeCloseLastSubstream=r,this._providedEnv=t}run(){let e;for(;void 0===e;)if(void 0!==this._cancelled)e=this.processCancellation();else if(void 0!==this._activeSubexecutor)e=this.runSubexecutor();else try{if(void 0===this._currentChannel)e=Rs();else switch(lQ(this._currentChannel)&&(this._currentChannel=FX(this._currentChannel)),this._currentChannel._tag){case Fw:e=this.runBracketOut(this._currentChannel);break;case Fk:{let t=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,void 0!==this._input){let r=this._input;this._input=void 0;let n=()=>cp(t.awaitRead(),()=>cz(()=>{let e=r.run();switch(e._tag){case Re:return hl(r.getDone(),{onFailure:e=>t.error(e),onSuccess:e=>t.done(e)});case Rt:return cp(t.emit(r.getEmit()),()=>n());case Rr:return cb(e.effect,{onFailure:e=>t.error(e),onSuccess:()=>n()});case Rn:return RE(e,()=>n(),e=>t.error(e))}}));e=Ro(cp(vs(ck(n())),e=>cP(()=>this.addFinalizer(t=>cp(c0(e),()=>cz(()=>{let e=this.restorePipe(t,r);return void 0!==e?e:cB}))))))}break}case FC:{let e=new Rw(this._currentChannel.value(),this._providedEnv,e=>cP(()=>{let t=void 0===this._closeLastSubstream?cB:this._closeLastSubstream;this._closeLastSubstream=z(t,vy(e))}));e._input=this._input;let t=this._currentChannel;this._activeSubexecutor=new Rb(e,e=>t.k(e),void 0,[],(e,r)=>t.combineInners(e,r),(e,r)=>t.combineAll(e,r),e=>t.onPull(e),e=>t.onEmit(e)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case FE:this._emitted=this._currentChannel.out,this._currentChannel=void 0!==this._activeSubexecutor?void 0:F7,e=Ra();break;case FO:this.runEnsuring(this._currentChannel);break;case FI:e=this.doneHalt(this._currentChannel.error());break;case FF:this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break;case FR:{let t=void 0===this._providedEnv?this._currentChannel.effect():z(this._currentChannel.effect(),wz(this._providedEnv));e=Ro(cb(t,{onFailure:e=>{let t=this.doneHalt(e);return void 0!==t&&Rc(t)?t.effect:cB},onSuccess:e=>{let t=this.doneSucceed(e);return void 0!==t&&Rc(t)?t.effect:cB}}));break}case FT:{let e=this._input,t=new Rw(this._currentChannel.left(),this._providedEnv,e=>this._executeCloseLastSubstream(e));t._input=e,this._input=t,this.addFinalizer(t=>{let r=this.restorePipe(t,e);return void 0!==r?r:cB}),this._currentChannel=this._currentChannel.right();break}case FN:{let e=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>cP(()=>{this._providedEnv=e}));break}case FA:{let t=this._currentChannel;e=Rl(this._input,T,e=>{try{this._currentChannel=t.more(e)}catch(e){this._currentChannel=t.done.onExit(ht(e))}},e=>{let r=e=>t.done.onExit(e);this._currentChannel=r(e)});break}case FM:e=this.doneSucceed(this._currentChannel.evaluate());break;case Fj:e=this.doneSucceed(this._currentChannel.terminal);break;case Fz:this._currentChannel=this._currentChannel.channel();break;default:this._currentChannel._tag}}catch(e){this._currentChannel=FG(iK(e))}return e}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){let t=[],r=this._doneStack.pop();for(;r;)"ContinuationFinalizer"===r._tag&&t.push(r.finalizer),r=this._doneStack.pop();let n=0===t.length?cB:RC(t,e);return this.storeInProgressFinalizer(n),n}popNextFinalizers(){let e=[];for(;0!==this._doneStack.length;){let t=this._doneStack[this._doneStack.length-1];if(t._tag===Fm)break;e.push(t),this._doneStack.pop()}return e}restorePipe(e,t){let r=this._input;return(this._input=t,void 0!==r)?r.close(e):cB}close(e){let t,r;let n=this._inProgressFinalizer;void 0!==n&&(t=z(n,vP(cP(()=>this.clearInProgressFinalizer()))));let i=this.popAllFinalizers(e);void 0!==i&&(r=z(i,vP(cP(()=>this.clearInProgressFinalizer()))));let s=void 0===this._activeSubexecutor?void 0:this._activeSubexecutor.close(e);if(void 0!==s||void 0!==t||void 0!==r)return z(cs(Rk(s)),vb(cs(Rk(t))),vb(cs(Rk(r))),cE(([[e,t],r])=>z(e,hf(t),hf(r))),cU,cp(e=>cz(()=>e)))}doneSucceed(e){if(0===this._doneStack.length)return this._done=hu(e),this._currentChannel=void 0,Rs();let t=this._doneStack[this._doneStack.length-1];if(t._tag===Fm){this._doneStack.pop(),this._currentChannel=t.onSuccess(e);return}let r=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=r.reverse(),this._done=hu(e),this._currentChannel=void 0,Rs();let n=RC(r.map(e=>e.finalizer),hu(e));return this.storeInProgressFinalizer(n),Ro(z(n,vP(cP(()=>this.clearInProgressFinalizer())),cU,cp(()=>cP(()=>this.doneSucceed(e)))))}doneHalt(e){if(0===this._doneStack.length)return this._done=hn(e),this._currentChannel=void 0,Rs();let t=this._doneStack[this._doneStack.length-1];if(t._tag===Fm){this._doneStack.pop(),this._currentChannel=t.onHalt(e);return}let r=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=r.reverse(),this._done=hn(e),this._currentChannel=void 0,Rs();let n=RC(r.map(e=>e.finalizer),hn(e));return this.storeInProgressFinalizer(n),Ro(z(n,vP(cP(()=>this.clearInProgressFinalizer())),cU,cp(()=>cP(()=>this.doneHalt(e)))))}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Rs()}runBracketOut(e){return Ro(cU(cb(this.provide(e.acquire()),{onFailure:e=>cP(()=>{this._currentChannel=FG(e)}),onSuccess:t=>cP(()=>{this.addFinalizer(r=>this.provide(e.finalizer(t,r))),this._currentChannel=F9(t)})})))}provide(e){return void 0===this._providedEnv?e:z(e,wz(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new Fy(e))}runSubexecutor(){let e=this._activeSubexecutor;switch(e._tag){case Rp:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case Rf:return this.pullFromUpstream(e);case Rd:return this.drainChildExecutors(e);case Rm:return this._emitted=e.value,this._activeSubexecutor=e.next,Ra()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){let t=hl(e,{onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)});return this._activeSubexecutor=void 0,void 0===t?cB:Ru(t)}finishSubexecutorWithCloseEffect(e,...t){this.addFinalizer(()=>z(t,vt(t=>z(cP(()=>t(e)),cp(e=>void 0!==e?e:cB)),{discard:!0})));let r=z(e,hl({onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(e,t,r){switch(r._tag){case Fv:{let n=!e||t.some(e=>void 0!==e);return[r.emitSeparator,n?[void 0,...t]:t]}case"PullAfterAllEnqueued":{let n=!e||t.some(e=>void 0!==e);return[r.emitSeparator,n?[...t,void 0]:t]}}}pullFromChild(e,t,r,n){return Rl(e,T,i=>{let s=r(i);switch(s._tag){case Fh:break;case"Close":this.finishWithDoneValue(e,t,s.value);break;case"Yield":{let e=t.enqueuePullFromChild(n);this.replaceSubexecutor(e)}}this._activeSubexecutor=new Ry(i,this._activeSubexecutor)},hl({onFailure:r=>{let n=this.handleSubexecutorFailure(e,t,r);return void 0===n?void 0:Rh(n)},onSuccess:r=>{this.finishWithDoneValue(e,t,r)}}))}finishWithDoneValue(e,t,r){switch(t._tag){case Rf:{let n=new Rb(t.upstreamExecutor,t.createChild,void 0!==t.lastDone?t.combineChildResults(t.lastDone,r):r,t.activeChildExecutors,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);this._closeLastSubstream=e.close(hu(r)),this.replaceSubexecutor(n);break}case Rd:{let n=new Rx(t.upstreamExecutor,void 0!==t.lastDone?t.combineChildResults(t.lastDone,r):r,t.activeChildExecutors,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this._closeLastSubstream=e.close(hu(r)),this.replaceSubexecutor(n)}}}handleSubexecutorFailure(e,t,r){return this.finishSubexecutorWithCloseEffect(hn(r),e=>t.close(e),t=>e.close(t))}pullFromUpstream(e){if(0===e.activeChildExecutors.length)return this.performPullFromUpstream(e);let t=e.activeChildExecutors[0],r=new Rb(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(void 0===t)return this.performPullFromUpstream(r);this.replaceSubexecutor(new Rg(t.childExecutor,r,t.onEmit))}performPullFromUpstream(e){return Rl(e.upstreamExecutor,e=>{let t=void 0===this._closeLastSubstream?cB:this._closeLastSubstream;return this._closeLastSubstream=void 0,z(this._executeCloseLastSubstream(t),vy(e))},t=>{if(void 0!==this._closeLastSubstream){let r=this._closeLastSubstream;return this._closeLastSubstream=void 0,z(this._executeCloseLastSubstream(r),cE(()=>{let r=new Rw(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;let[n,i]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(R_(t)));this._activeSubexecutor=new Rg(r,new Rb(e.upstreamExecutor,e.createChild,e.lastDone,i,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),tb(n)&&(this._activeSubexecutor=new Ry(n.value,this._activeSubexecutor))}))}let r=new Rw(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;let[n,i]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(R_(t)));this._activeSubexecutor=new Rg(r,new Rb(e.upstreamExecutor,e.createChild,e.lastDone,i,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),tb(n)&&(this._activeSubexecutor=new Ry(n.value,this._activeSubexecutor))},t=>{if(e.activeChildExecutors.some(e=>void 0!==e)){let t=new Rx(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(void 0!==this._closeLastSubstream){let e=this._closeLastSubstream;return this._closeLastSubstream=void 0,z(this._executeCloseLastSubstream(e),cE(()=>this.replaceSubexecutor(t)))}return void this.replaceSubexecutor(t)}let r=this._closeLastSubstream,n=this.finishSubexecutorWithCloseEffect(z(t,ho(t=>e.combineWithChildResult(e.lastDone,t))),()=>r,t=>e.upstreamExecutor.close(t));return void 0===n?void 0:Rh(n)})}drainChildExecutors(e){if(0===e.activeChildExecutors.length){let t=this._closeLastSubstream;return void 0!==t&&this.addFinalizer(()=>cj(t)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>t,t=>e.upstreamExecutor.close(t))}let t=e.activeChildExecutors[0],r=e.activeChildExecutors.slice(1);if(void 0===t){let[t,n]=this.applyUpstreamPullStrategy(!0,r,e.onPull(RS(r.reduce((e,t)=>void 0!==t?e+1:e,0))));return(this.replaceSubexecutor(new Rx(e.upstreamExecutor,e.lastDone,n,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),tb(t))?(this._emitted=t.value,Ra()):void 0}let n=new Rx(e.upstreamExecutor,e.lastDone,r,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new Rg(t.childExecutor,n,t.onEmit))}}let Rk=e=>void 0!==e?e:cB,RC=(e,t)=>z(vt(e,e=>cs(e(t))),cE(e=>z(he(e),tB(()=>hh))),cp(e=>cz(()=>e))),RE=(e,t,r)=>{let n=[e],i=()=>{let e=n.pop();if(void 0===e||void 0===e.upstream)return cn("Unexpected end of input for channel execution");let s=e.upstream.run();switch(s._tag){case Rt:{let s=e.onEmit(e.upstream.getEmit());if(0===n.length){if(void 0===s)return cz(t);return z(s,cb({onFailure:r,onSuccess:t}))}if(void 0===s)return cz(()=>i());return z(s,cb({onFailure:r,onSuccess:()=>i()}))}case Re:{let s=e.onDone(e.upstream.getDone());if(0===n.length){if(void 0===s)return cz(t);return z(s,cb({onFailure:r,onSuccess:t}))}if(void 0===s)return cz(()=>i());return z(s,cb({onFailure:r,onSuccess:()=>i()}))}case Rr:return n.push(e),z(e.onEffect(s.effect),l6(t=>cz(()=>{let r=e.onDone(hn(t));return void 0===r?cB:r})),cb({onFailure:r,onSuccess:()=>i()}));case Rn:return n.push(e),n.push(s),cz(()=>i())}};return i()},RO=R(2,(e,t)=>{let r=(t,r,n)=>lX(cP(()=>new Rw(e,void 0,T)),e=>cz(()=>RI(e.run(),e).pipe(cC(t),vy(hy(t)),vx(hy(r)))),(e,t)=>{let r=e.close(t);return void 0===r?cB:gU(r,e=>uD(n,cl(e)))});return cq(e=>ve([uU(t,fg),hb(),hb()]).pipe(cp(([n,i,s])=>e(r(i,s,n)).pipe(Sk(t),cp(r=>t.addFinalizer(()=>fc(i).pipe(cp(e=>e?hk(s,void 0).pipe(vy(ba(r)),vy(SL(r))):hk(s,void 0).pipe(vy(c0(r)),vy(SL(r)))))).pipe(vy(e(hy(i)))))))))}),RI=(e,t)=>{switch(e._tag){case Rr:return z(e.effect,cp(()=>RI(t.run(),t)));case Rt:return RI(t.run(),t);case Re:return cz(()=>t.getDone());case Rn:return RE(e,()=>RI(t.run(),t),cl)}},RF="Done",RR={[Symbol.for("effect/ChannelMergeDecision")]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},RT=e=>{let t=Object.create(RR);return t._tag=RF,t.effect=e,t},RN=e=>{let t=Object.create(RR);return t._tag="Await",t.f=e,t},RA="BothRunning",RM="LeftDone",Rj="RightDone",Rz=Symbol.for("effect/ChannelMergeState"),RP={[Rz]:Rz},RD=(e,t)=>{let r=Object.create(RP);return r._tag=RA,r.left=e,r.right=t,r},RL=e=>{let t=Object.create(RP);return t._tag=RM,t.f=e,t},R$=e=>{let t=Object.create(RP);return t._tag=Rj,t.f=e,t},RU="BackPressure",Rq="BufferSliding",RB=Symbol.for("effect/ChannelMergeStrategy"),RJ={[RB]:RB},RH=e=>{let t=Object.create(RJ);return t._tag=RU,t},RK=e=>{let t=Object.create(RJ);return t._tag=Rq,t},RW=R(2,(e,{onBackPressure:t,onBufferSliding:r})=>{switch(e._tag){case RU:return t();case Rq:return r()}}),RV="Empty",RG="Emit",RY="Error",RQ="Done",RZ=e=>({_tag:RV,notifyProducer:e}),RX=e=>({_tag:RG,notifyConsumers:e}),R0=e=>({_tag:RY,cause:e}),R1=e=>({_tag:RQ,done:e});class R2{ref;constructor(e){this.ref=e}awaitRead(){return cm(mT(this.ref,e=>e._tag===RV?[hy(e.notifyProducer),e]:[cB,e]))}get close(){return ch(e=>this.error(iW(e)))}done(e){return cm(mT(this.ref,t=>{switch(t._tag){case RV:return[hy(t.notifyProducer),t];case RG:return[vt(t.notifyConsumers,t=>hk(t,tO(e)),{discard:!0}),R1(e)];case RY:case RQ:return[cS,t]}}))}emit(e){return cp(hb(),t=>cm(mT(this.ref,r=>{switch(r._tag){case RV:return[hy(r.notifyProducer),r];case RG:{let n=r.notifyConsumers[0],i=r.notifyConsumers.slice(1);if(void 0!==n)return[hk(n,tI(e)),0===i.length?RZ(t):RX(i)];throw Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case RY:case RQ:return[cS,r]}})))}error(e){return cm(mT(this.ref,t=>{switch(t._tag){case RV:return[hy(t.notifyProducer),t];case RG:return[vt(t.notifyConsumers,t=>hS(t,e),{discard:!0}),R0(e)];case RY:case RQ:return[cS,t]}}))}get take(){return this.takeWith(e=>hn(st(e,tO)),e=>hu(e),e=>hr(tI(e)))}takeWith(e,t,r){return cp(hb(),n=>cm(mT(this.ref,i=>{switch(i._tag){case RV:return[vy(hk(i.notifyProducer,void 0),cg(hy(n),{onFailure:e,onSuccess:tA({onLeft:r,onRight:t})})),RX([n])];case RG:return[cg(hy(n),{onFailure:e,onSuccess:tA({onLeft:r,onRight:t})}),RX([...i.notifyConsumers,n])];case RY:return[cj(e(i.cause)),i];case RQ:return[cj(r(i.done)),i]}})))}}let R3=()=>z(hb(),cp(e=>mO(RZ(e))),cE(e=>new R2(e))),R5=R(2,(e,t)=>Tu(e,()=>t)),R4=R(2,(e,t)=>FU(e,e=>tA(i4(e),{onLeft:t,onRight:FG}))),R6=R(2,(e,t)=>FH(e,t,()=>void 0,()=>void 0)),R8=e=>F2({onInput:t=>FQ(F8(()=>{e.push(t)}),()=>R8(e)),onFailure:FV,onDone:F5}),R7=e=>{let t=F3({onInput:()=>t,onFailure:FG,onDone:F5});return F0(e,t)},R9=R(2,(e,t)=>FW(e,()=>t)),Te=()=>FX(hI()),Tt=e=>FQ(Te(),e),Tr=e=>FQ(e,T),Tn=R(2,(e,t)=>FZ(e,{onFailure:e=>{let r=i4(e);switch(r._tag){case"Left":return t.onFailure(r.left);case"Right":return FG(r.right)}},onSuccess:t.onSuccess})),Ti=e=>TM(e.takeWith(FG,t=>FQ(F9(t),()=>Ti(e)),F5)),Ts=e=>F6(()=>Ta(e)),Ta=e=>z(FX(O5(e)),FQ(tA({onLeft:hl({onFailure:FG,onSuccess:F4}),onRight:t=>FQ(F9(t),()=>Ta(e))}))),To=()=>F2({onInput:e=>FQ(F9(e),()=>To()),onFailure:FV,onDone:F4}),Tl=R(2,(e,t)=>Tv(e,{other:FX(t),onSelfDone:e=>RT(cz(()=>e)),onOtherDone:e=>RT(cz(()=>e))})),Tc=R(2,(e,t)=>Tl(e,hy(t))),Tu=R(2,(e,t)=>FQ(e,e=>F8(()=>t(e)))),Th=R(2,(e,t)=>FQ(e,e=>FX(t(e)))),Tp=R(2,(e,t)=>Tf(e,st(t))),Tf=R(2,(e,t)=>FU(e,e=>FG(t(e)))),Td=R(2,(e,t)=>{let r=F2({onInput:e=>FQ(F9(t(e)),()=>r),onFailure:FV,onDone:F4});return F0(e,r)}),Tm=R(2,(e,t)=>{let r=F3({onInput:e=>z(FX(t(e)),FQ(F9),FQ(()=>r)),onFailure:FG,onDone:F4});return F0(e,r)}),Tg=R(3,(e,t,r)=>Tz(n=>km(function*(){let i=yield*R3(),s=Ti(i),a=yield*Iu(r);yield*uD(n,Iv(a));let o=yield*hb(),l=r===Number.POSITIVE_INFINITY?e=>T:(yield*k_(r)).withPermits,c=yield*s.pipe(F0(e),TR(n));yield*c.pipe(cb({onFailure:e=>O2(a,cl(e)),onSuccess:tA({onLeft:e=>vy(ck(l(r)(cB)),l1(O2(a,cj(tO(e))))),onRight:e=>km(function*(){let r=yield*hb(),i=yield*hb();yield*O2(a,cE(hy(r),tI)),yield*hk(i,void 0).pipe(vy(cq(r=>cs(r(hy(o))).pipe(SE(cs(r(t(e)))),cp(T))).pipe(gU(e=>hS(o,e)),cC(r))),l(1),Sk(n)),yield*hy(i)})})}),g_,ck,Sk(n));let u=TM(cg(cm(O5(a)),{onFailure:FG,onSuccess:tA({onLeft:F4,onRight:e=>FQ(F9(e),()=>u)})}));return FK(u,i)}))),Tb=e=>t=>Tx(e)(t,j),Tx=({bufferSize:e=16,concurrency:t,mergeStrategy:r=RH()})=>(n,i)=>Tz(s=>km(function*(){let a="unbounded"===t?Number.MAX_SAFE_INTEGER:t,o=yield*R3(),l=Ti(o),c=yield*Iu(e);yield*uD(s,Iv(c));let u=yield*If();yield*uD(s,Iv(u));let h=yield*mO(tU()),p=yield*hb(),f=(yield*k_(a)).withPermits,d=yield*TR(F0(l,n),s);function m(e){return e.pipe(cp(tA({onLeft:e=>cj(ty(e)),onRight:e=>l0(O2(c,cj(tI(e))),tU())})),Su({until:e=>tb(e)}),cp(e=>mN(h,tq({onNone:()=>ty(e.value),onSome:t=>ty(i(t,e.value))}))),l6(e=>iX(e)?cl(e):O2(c,cl(e)).pipe(vy(hk(p,void 0)),l1)))}yield*d.pipe(cb({onFailure:e=>O2(c,cl(e)).pipe(vy(cj(!1))),onSuccess:tA({onLeft:e=>vA(ck(hy(p)),ck(f(a)(cB)),{onSelfDone:(e,t)=>l0(c0(t),!1),onOtherDone:(t,r)=>vy(c0(r),mI(h).pipe(cp(tq({onNone:()=>O2(c,cj(tO(e))),onSome:t=>O2(c,cj(tO(i(t,e))))})),l0(!1)))}),onRight:e=>RW(r,{onBackPressure:()=>km(function*(){let t=yield*hb(),r=vd(t=>TR(F0(l,e),t).pipe(cp(e=>vM(cs(m(e)),cs(ck(hy(p))))),cp(T)));return yield*hk(t,void 0).pipe(vy(r),f(1),Sk(s)),yield*hy(t),!(yield*fc(p))}),onBufferSliding:()=>km(function*(){let t=yield*hb(),r=yield*hb(),n=yield*Im(u);yield*O5(u).pipe(cp(e=>hk(e,void 0)),gH(()=>n>=a)),yield*O2(u,t);let i=vd(r=>TR(F0(l,e),r).pipe(cp(e=>cs(m(e)).pipe(vM(cs(ck(hy(p)))),vM(cs(ck(hy(t)))))),cp(T)));return yield*hk(r,void 0).pipe(vy(i),f(1),Sk(s)),yield*hy(r),!(yield*fc(p))})})})}),Su({while:e=>e}),Sk(s));let g=z(O5(c),cm,cg({onFailure:FG,onSuccess:tA({onLeft:F4,onRight:e=>FQ(F9(e),()=>g)})}),TM);return FK(g,o)})),Ty=R(3,(e,t,r)=>Tb(r)(Td(e,t))),Tv=R(2,(e,t)=>Tz(function(r){return km(function*(){let n=yield*R3(),i=Ti(n),s=yield*TR(F0(i,e),r),a=yield*TR(F0(i,t.other),r);function o(e,t,n){return(i,s,a)=>{function o(e){return e._tag===RF?cj(FX(vy(c0(t),e.effect))):cE(ba(t),hl({onFailure:t=>FX(e.f(hn(t))),onSuccess:tA({onLeft:t=>FX(e.f(hu(t))),onRight:t=>Tq(F9(t),l(a(e.f)))})}))}return hl(e,{onFailure:e=>o(i(hn(e))),onSuccess:tA({onLeft:e=>o(i(hu(e))),onRight:e=>cj(FQ(F9(e),()=>FQ(FX(Sk(ck(n),r)),e=>l(s(e,t)))))})})}}function l(e){switch(e._tag){case RA:return TM(vA(ck(bo(e.left)),ck(bo(e.right)),{onSelfDone:(r,n)=>vy(c0(n),o(r,e.right,s)(t.onSelfDone,RD,e=>RL(e))),onOtherDone:(r,n)=>vy(c0(n),o(r,e.left,a)(t.onOtherDone,(e,t)=>RD(t,e),e=>R$(e)))}));case RM:return TM(cE(cs(a),hl({onFailure:t=>FX(e.f(hn(t))),onSuccess:tA({onLeft:t=>FX(e.f(hu(t))),onRight:t=>FQ(F9(t),()=>l(RL(e.f)))})})));case Rj:return TM(cE(cs(s),hl({onFailure:t=>FX(e.f(hn(t))),onSuccess:tA({onLeft:t=>FX(e.f(hu(t))),onRight:t=>FQ(F9(t),()=>l(R$(e.f)))})})))}}return FX(lZ(e=>{let t=lZ(t=>(t.transferChildren(e.scope()),cB));return vv(ck(s).pipe(vP(t),Sk(r)),ck(a).pipe(vP(t),Sk(r)),(e,t)=>RD(e,t))})).pipe(FQ(l),FK(n))})})),T_=((e,t)=>R4(e,e=>{throw t(e)}),R(2,(e,t)=>R4(e,t))),TS=R(2,(e,t)=>F6(()=>{let r;let n=F2({onInput:e=>FQ(F9(e),()=>n),onFailure:e=>FG(iK(r=TJ(e))),onDone:F4}),i=F3({onInput:e=>z(F9(e),FQ(()=>i)),onFailure:e=>iQ(e)&&TH(e.defect)&&eN(e.defect,r)?FV(e.defect.error):FG(e),onDone:F4});return F0(F0(F0(e,n),t),i)})),Tw=e=>vd(t=>RO(e,t)),Tk=e=>Tw(R7(e)),TC=e=>vf(t=>RO(e,t)),TE=e=>TM(cq(t=>cE(vE(),r=>F$(gU(t(vO(e,r)),e=>u$(r,hn(e))),(e,t)=>u$(r,t))))),TO=e=>Tj(cE(vS,t=>FQ(FX(e(t)),F9))),TI=e=>TN(e),TF=e=>cp(vS,t=>TR(e,t)),TR=R(2,(e,t)=>vb(cP(()=>new Rw(e,void 0,T)),S2()).pipe(cD(([e,r])=>uL(t,t=>{let n=e.close(t);return void 0!==n?wz(n,r):cB})),cU,cE(([e])=>cz(()=>TT(e.run(),e))))),TT=(e,t)=>{switch(e._tag){case Re:return hl(t.getDone(),{onFailure:cl,onSuccess:e=>cj(tO(e))});case Rt:return cj(tI(t.getEmit()));case Rr:return z(e.effect,cp(()=>TT(t.run(),t)));case Rn:return RE(e,()=>TT(t.run(),t),e=>cl(e))}},TN=e=>F6(()=>TA(e)),TA=e=>F3({onInput:t=>FQ(FX(O2(e,tI(t))),()=>TA(e)),onFailure:t=>FX(z(O2(e,tO(hn(t))))),onDone:t=>FX(z(O2(e,tO(hu(t)))))}),TM=e=>Tr(FX(e)),Tj=e=>FJ(TE(e),(e,t)=>e,(e,t)=>e),Tz=e=>FJ(TO(e),(e,t)=>e,(e,t)=>e),TP=(...e)=>TD(ni(e)),TD=e=>TL(0,e.length,e),TL=(e,t,r)=>e===t?F7:z(F9(z(r,nh(e))),FQ(()=>TL(e+1,t,r))),T$=R(e=>FL(e[1]),(e,t,r)=>r?.concurrent?Tv(e,{other:t,onSelfDone:e=>RN(t=>cz(()=>hp(e,t))),onOtherDone:e=>RN(t=>cz(()=>hp(t,e)))}):FQ(e,e=>Tu(t,t=>[e,t]))),TU=R(e=>FL(e[1]),(e,t,r)=>r?.concurrent?Tu(T$(e,t,{concurrent:!0}),e=>e[0]):FQ(e,e=>R5(t,e))),Tq=R(e=>FL(e[1]),(e,t,r)=>r?.concurrent?Tu(T$(e,t,{concurrent:!0}),e=>e[1]):FQ(e,()=>t)),TB=Symbol.for("effect/Channel/ChannelException"),TJ=e=>({_tag:"ChannelException",[TB]:TB,error:e}),TH=e=>X(e,TB),TK=Symbol.for("effect/RcRef"),TW={_tag:"Empty"},TV={_A:T,_E:T},TG=e=>cq(t=>cz(()=>{switch(e.state._tag){case"Closed":return cS;case"Acquired":return e.state.refCount++,e.state.fiber?l0(c0(e.state.fiber),e.state):cj(e.state);case"Empty":return vE().pipe(gx("scope"),gb("value",({scope:r})=>t(up(e.acquire,uy,sz(e.context,v_,r)))),cE(({scope:t,value:r})=>{let n={_tag:"Acquired",value:r,scope:t,fiber:void 0,refCount:1};return e.state=n,n}))}})).pipe(e.semaphore.withPermits(1),gx("state"),gb("scope",()=>v_),cD(({scope:t,state:r})=>t.addFinalizer(()=>cz(()=>(r.refCount--,r.refCount>0)?cB:void 0===e.idleTimeToLive?(e.state=TW,u$(r.scope,hh)):ge(e.idleTimeToLive).pipe(ck,cZ(cz(()=>"Acquired"===e.state._tag&&0===e.state.refCount?(e.state=TW,u$(r.scope,hh)):cB)),vP(cP(()=>{r.fiber=void 0})),Sk(e.scope),cD(e=>{r.fiber=e}),e.semaphore.withPermits(1))))),cE(({state:e})=>e.value)),TY={_tag:"Left"},TQ={_tag:"Right"},TZ={_tag:"Both"},TX={_tag:"Either"},T0=e=>{switch(e){case"left":return TY;case"right":return TQ;case"both":return TZ;case"either":return TX;default:return e}},T1=Symbol.for("effect/Sink"),T2={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class T3{channel;[T1]=T2;constructor(e){this.channel=e}pipe(){return eV(this,arguments)}}let T5=e=>X(e,T1),T4=e=>new T3(F6(()=>Ng(e()))),T6=((e,t)=>z(e,T6(nI(t))),R(2,(e,t)=>{let r=F2({onInput:e=>z(F9(t(e)),FQ(()=>r)),onFailure:FV,onDone:F5});return new T3(z(r,F0(Ng(e))))})),T8=R(2,(e,t)=>{let r=F2({onInput:e=>z(FX(t(e)),FQ(F9),FQ(()=>r)),onFailure:FV,onDone:F5});return new T3(z(r,TS(Ng(e))))}),T7=new T3(R7(To())),T9=e=>new T3(FV(e)),Ne=(e,t,r)=>T4(()=>new T3(Nt(e,t,r))),Nt=(e,t,r)=>t(e)?F2({onInput:n=>{let[i,s]=Nr(e,n,t,r,0,n.length);return nk(s)?z(F9(s),R5(i)):Nt(i,t,r)},onFailure:FV,onDone:()=>F4(e)}):F4(e),Nr=(e,t,r,n,i,s)=>{if(i===s)return[e,nt()];let a=n(e,z(t,nh(i)));return r(a)?Nr(a,t,r,n,i+1,s):[a,z(t,nm(i+1))]},Nn=R(2,(e,t)=>new T3(z(Ng(e),Fq,Tn({onFailure:e=>Ng(t.onFailure(e)),onSuccess:([e,r])=>F6(()=>{let n={ref:z(e,ny(nk))},i=z(F8(()=>{let e=n.ref;return n.ref=nt(),e}),FQ(e=>TD(e)));return FQ(Fq(z(i,Tq(To()),F0(Ng(t.onSuccess(r))))),([e,t])=>z(F5(n.ref),FQ(TD),Tq(TD(e)),R5(t)))})})))),Ni=(e,t,r)=>t(e)?F2({onInput:n=>Ni(r(e,n),t,r),onFailure:FV,onDone:()=>F4(e)}):F4(e),Ns=(e,t,r)=>T4(()=>new T3(Na(e,t,r))),Na=(e,t,r)=>t(e)?F2({onInput:n=>z(FX(No(e,n,t,r)),FQ(([e,n])=>z(n,tq({onNone:()=>Na(e,t,r),onSome:t=>z(F9(t),R5(e))})))),onFailure:FV,onDone:()=>F4(e)}):F4(e),No=(e,t,r,n)=>Nl(e,t,0,t.length,r,n),Nl=(e,t,r,n,i,s)=>r===n?cj([e,tU()]):z(s(e,z(t,nh(r))),cp(e=>i(e)?Nl(e,t,r+1,n,i,s):cj([e,ty(z(t,nm(r+1)))]))),Nc=R(2,(e,t)=>Nn(e,{onFailure:T9,onSuccess:t})),Nu=e=>{let t=F3({onInput:r=>z(FX(vt(r,t=>e(t),{discard:!0})),FQ(()=>t)),onFailure:FG,onDone:()=>F7});return new T3(t)},Nh=e=>{let t=F3({onInput:r=>z(FX(e(r)),FQ(()=>t)),onFailure:FG,onDone:()=>F7});return new T3(t)},Np=e=>new T3(FX(e)),Nf=(e,t)=>t?.shutdown?Nb(cE(y4(cj(e),Iv),Nf)):Nh(t=>z(O3(e,t))),Nd=R(2,(e,t)=>new T3(z(Ng(e),Tu(t)))),Nm=((e,t)=>new T3(z(Ng(e),Th(t))),R(2,(e,t)=>Nx(function(r){return km(function*(){let n=yield*Fs(t?.capacity??16),i=yield*vO(Fu(n),r),s=yield*vO(Fu(n),r),a=TI(n),o=Ts(i).pipe(F0(Ng(e)),TU(FX(Iv(i))),Tv({other:Ts(s).pipe(F0(Ng(t.other)),TU(FX(Iv(s)))),onSelfDone:t.onSelfDone,onOtherDone:t.onOtherDone}));return new T3(Tv(a,{other:o,onSelfDone:()=>RN(T),onOtherDone:e=>RT(e)}))})}))),Ng=((e,t,r)=>new T3(z(FX(t),FQ(n=>z(e,Ng,FQ(e=>z(FX(t),Tu(t=>[e,r(n,t)]))))))),e=>lQ(e)?Ng(Np(e)):e.channel),Nb=e=>new T3(Tj(e.pipe(cE(e=>Ng(e))))),Nx=e=>new T3(Tz(t=>e(t).pipe(cE(e=>Ng(e))))),Ny=(e=>T5(e[1]),R(e=>T5(e[1]),(e,t,r,n)=>n?.concurrent?Nm(e,{other:t,onSelfDone:hl({onFailure:e=>RT(cl(e)),onSuccess:e=>RN(hl({onFailure:cl,onSuccess:t=>cj(r(e,t))}))}),onOtherDone:hl({onFailure:e=>RT(cl(e)),onSuccess:e=>RN(hl({onFailure:cl,onSuccess:t=>cj(r(t,e))}))})}):Nc(e,e=>Nd(t,t=>r(e,t))))),Nv="WithSTMRuntime",N_="OnFailure",NS="OnRetry",Nw="OnSuccess",Nk="Sync",NC="Succeed",NE="Fail",NO="Fail",NI="Interrupt",NF="Succeed",NR="Retry",NT="Done",NN="Suspend";class NA{value;constructor(e){this.value=e}}let NM=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),Nj=e=>e.newValue,Nz=(e,t)=>{e.isChanged=!0,e.newValue=t},NP=e=>{e.ref.versioned=new NA(e.newValue)},ND=e=>e.ref.versioned!==e.expected,NL=e=>e.isChanged,N$="Invalid",NU="ReadWrite",Nq=e=>{for(let t of e)NP(t[1])},NB=e=>{let t="ReadOnly";for(let[,r]of e)if((t=ND(r)?N$:NL(r)?NU:t)===N$)break;return t},NJ=e=>{let t=new Map;for(let[,r]of e){for(let e of r.ref.todos)t.set(e[0],e[1]);r.ref.todos=new Map}return t},NH=e=>{for(let[t,r]of Array.from(e.entries()).sort((e,t)=>e[0]-t[0]))r()},NK=(e,t,r)=>{let n=!1;for(let[,i]of t)i.ref.todos.has(e)||(i.ref.todos.set(e,r),n=!0);return n},NW="Done",NV="Interrupted",NG="Running",NY="effect/STM/State",NQ=Symbol.for(NY),NZ=e=>X(e,NQ),NX=e=>e._tag===NG,N0=e=>e._tag===NW,N1=e=>({[NQ]:NQ,_tag:NW,exit:e,[ey](){return z(ev(NY),eS(ev(NW)),eS(ev(e)),eR(this))},[eT]:t=>NZ(t)&&t._tag===NW&&eN(e,t.exit)}),N2=z(ev(NY),eS(ev(NV)),eS(ev("interrupted"))),N3={[NQ]:NQ,_tag:NV,[ey]:()=>N2,[eT]:e=>NZ(e)&&e._tag===NV},N5=z(ev(NY),eS(ev(NG)),eS(ev("running"))),N4={[NQ]:NQ,_tag:NG,[ey]:()=>N5,[eT]:e=>NZ(e)&&e._tag===NG},N6=e=>{switch(e._tag){case NO:return N1(hr(e.error));case"Die":return N1(ht(e.defect));case NI:return N1(ha(e.fiberId));case NF:return N1(hu(e.value));case NR:throw Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},N8="effect/TExit",N7=Symbol.for(N8),N9={_A:e=>e,_E:e=>e},Ae=e=>X(e,N7),At=e=>e._tag===NF,Ar=e=>e._tag===NR,An=e=>({[N7]:N9,_tag:NO,error:e,[ey](){return z(ev(N8),eS(ev(NO)),eS(ev(e)),eR(this))},[eT]:t=>Ae(t)&&t._tag===NO&&eN(e,t.error)}),Ai=e=>({[N7]:N9,_tag:"Die",defect:e,[ey](){return z(ev(N8),eS(ev("Die")),eS(ev(e)),eR(this))},[eT]:t=>Ae(t)&&"Die"===t._tag&&eN(e,t.defect)}),As=e=>({[N7]:N9,_tag:NI,fiberId:e,[ey](){return z(ev(N8),eS(ev(NI)),eS(ev(e)),eR(this))},[eT]:t=>Ae(t)&&t._tag===NI&&eN(e,t.fiberId)}),Aa=e=>({[N7]:N9,_tag:NF,value:e,[ey](){return z(ev(N8),eS(ev(NF)),eS(ev(e)),eR(this))},[eT]:t=>Ae(t)&&t._tag===NF&&eN(e,t.value)}),Ao=z(ev(N8),eS(ev(NR)),eS(ev("retry"))),Al={[N7]:N9,_tag:NR,[ey]:()=>Ao,[eT]:e=>Ae(e)&&Ar(e)},Ac=e=>({_tag:NT,exit:e}),Au=e=>({_tag:NN,journal:e}),Ah={ref:0},Ap=()=>{let e=Ah.ref+1;return Ah.ref=e,e},Af=Symbol.for("effect/STM"),Ad={_R:e=>e,_E:e=>e,_A:e=>e};class Am{effect_instruction_i0;_op=eY;effect_instruction_i1=void 0;effect_instruction_i2=void 0;[lK];[te];[T1];[FP];get[Af](){return Ad}constructor(e){this.effect_instruction_i0=e,this[lK]=tn,this[te]=Ad,this[T1]=Ad,this[FP]=Ad}[eT](e){return this===e}[ey](){return eR(this,e_(this))}[Symbol.iterator](){return new l$(new ep(this))}commit(){return Ag(this,j,j)}pipe(){return eV(this,arguments)}}let Ag=(e,t,r)=>lZ(n=>{let i=n.id(),s=n.getFiberRef(uy),a=n.getFiberRef(mP),o=n.getFiberRef(uv),l=Ax(i,e,s,a,o);switch(l._tag){case NT:return t(l.exit),l.exit;case NN:{let n=Ap(),l={value:N4},c=l4(t=>Ay(i,e,n,l,s,a,o,t));return cq(e=>z(e(c),l6(e=>{let n=l.value;return(NX(n)&&(l.value=N3),N0(n=l.value))?(t(n.exit),n.exit):(r(),cl(e))})))}}}),Ab=(e,t,r,n,i,s)=>{let a=new Map,o=new AS(t,a,e,n).run(),l=NB(a);if(l===NU)Nq(a);else if(l===N$)throw Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(o._tag){case NF:return r.value=N6(o),Av(hu(o.value),a,i,s);case NO:return r.value=N6(o),Av(hn(iH(o.error)),a,i,s);case"Die":return r.value=N6(o),Av(hn(iK(o.defect)),a,i,s);case NI:return r.value=N6(o),Av(hn(iW(e)),a,i,s);case NR:return Au(a)}},Ax=(e,t,r,n,i)=>{let s=new Map,a=new AS(t,s,e,r).run(),o=NB(s);if(o===NU&&At(a))Nq(s);else if(o===N$)throw Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case NF:return Av(hu(a.value),s,n,i);case NO:return Av(hn(iH(a.error)),s,n,i);case"Die":return Av(hn(iK(a.defect)),s,n,i);case NI:return Av(hn(iW(e)),s,n,i);case NR:return Au(s)}},Ay=(e,t,r,n,i,s,a,o)=>{if(NX(n.value)){let l=Ab(e,t,n,i,s,a);switch(l._tag){case NT:A_(l.exit,o);break;case NN:NK(r,l.journal,()=>Ay(e,t,r,n,i,s,a,o))}}},Av=(e,t,r,n)=>{let i=NJ(t);return i.size>0&&r.scheduleTask(()=>NH(i),n),Ac(e)},A_=(e,t)=>{t(e)};class AS{self;journal;fiberId;contStack=[];env;constructor(e,t,r,n){this.self=e,this.journal=t,this.fiberId=r,this.env=n}getEnv(){return this.env}pushStack(e){this.contStack.push(e)}popStack(){return this.contStack.pop()}nextSuccess(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==Nw;)e=this.popStack();return e}nextFailure(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==N_;)e=this.popStack();return e}nextRetry(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==NS;)e=this.popStack();return e}run(){let e,t=this.self;for(;void 0===e&&void 0!==t;)try{let r=t;if(r)switch(r._op){case"Tag":t=AE((e,t,n)=>s$(n,r));break;case"Left":t=AI(r.left);break;case"None":t=AI(new uX);break;case"Right":t=AM(r.right);break;case"Some":t=AM(r.value);break;case"Commit":switch(r.effect_instruction_i0){case"Die":e=Ai(em(()=>r.effect_instruction_i1()));break;case NE:{let n=this.nextFailure();void 0===n?e=An(em(()=>r.effect_instruction_i1())):t=em(()=>n.effect_instruction_i2(em(()=>r.effect_instruction_i1())));break}case"Retry":{let r=this.nextRetry();void 0===r?e=Al:t=em(()=>r.effect_instruction_i2());break}case"Interrupt":e=As(this.fiberId);break;case Nv:t=em(()=>r.effect_instruction_i1(this));break;case Nw:case N_:case NS:this.pushStack(r),t=r.effect_instruction_i1;break;case"Provide":{let e=this.env;this.env=em(()=>r.effect_instruction_i2(e)),t=z(r.effect_instruction_i1,AO(Aj(()=>this.env=e)));break}case NC:{let n=r.effect_instruction_i1,i=this.nextSuccess();void 0===i?e=Aa(n):t=em(()=>i.effect_instruction_i2(n));break}case Nk:{let n=em(()=>r.effect_instruction_i1()),i=this.nextSuccess();void 0===i?e=Aa(n):t=em(()=>i.effect_instruction_i2(n))}}}}catch(e){t=Ak(e)}return e}}let Aw=R(2,(e,t)=>{let r=new Am(N_);return r.effect_instruction_i1=e,r.effect_instruction_i2=t,r}),Ak=e=>AC(()=>e),AC=e=>{let t=new Am("Die");return t.effect_instruction_i1=e,t},AE=e=>AN(t=>AM(e(t.journal,t.fiberId,t.getEnv()))),AO=R(2,(e,t)=>AT(e,{onFailure:e=>Az(t,AI(e)),onSuccess:e=>Az(t,AM(e))})),AI=e=>AF(()=>e),AF=e=>{let t=new Am(NE);return t.effect_instruction_i1=e,t},AR=R(2,(e,t)=>{let r=new Am(Nw);return r.effect_instruction_i1=e,r.effect_instruction_i2=t,r}),AT=R(2,(e,{onFailure:t,onSuccess:r})=>z(e,AA(tI),Aw(e=>z(t(e),AA(tO))),AR(e=>{switch(e._tag){case"Left":return AM(e.left);case"Right":return r(e.right)}}))),AN=e=>{let t=new Am(Nv);return t.effect_instruction_i1=e,t},AA=R(2,(e,t)=>z(e,AR(e=>Aj(()=>t(e))))),AM=e=>{let t=new Am(NC);return t.effect_instruction_i1=e,t},Aj=e=>{let t=new Am(Nk);return t.effect_instruction_i1=e,t},Az=R(2,(e,t)=>z(e,AR(()=>t))),AP=R(3,(e,t,r)=>z(e,AR(e=>z(t,AA(t=>r(e,t)))))),AD=((e,t)=>z(e,AA(()=>t)),e=>AR(e,T)),AL=(e=>ei(e[0]),e=>AD(Aj(e))),A$=AM(void 0),AU=(e,t)=>{if(t.has(e))return t.get(e);let r=NM(e,!1);return t.set(e,r),r};class Aq{capacity;array;size=0;current=0;constructor(e){this.capacity=e,this.array=Array.from({length:e},j)}head(){return tK(this.array[this.current])}lastOrNull(){if(0===this.size)return;let e=0===this.current?this.array.length-1:this.current-1;return this.array[e]??void 0}put(e){this.array[this.current]=e,this.increment()}dropLast(){this.size>0&&(this.decrement(),this.array[this.current]=void 0)}toChunk(){let e=this.current-this.size;return ni(e<0?[...this.array.slice(this.capacity+e,this.capacity),...this.array.slice(0,this.current)]:this.array.slice(e,this.current))}increment(){this.size<this.capacity&&(this.size+=1),this.current=(this.current+1)%this.capacity}decrement(){this.size-=1,this.current>0?this.current-=1:this.current=this.capacity-1}}let AB=Symbol.for("effect/Stream/Handoff"),AJ="Empty",AH="Full",AK=e=>({_tag:AJ,notifyConsumer:e}),AW=(e,t)=>({_tag:AH,value:e,notifyProducer:t}),AV=(e,t)=>r=>{switch(r._tag){case AJ:return e(r.notifyConsumer);case AH:return t(r.value,r.notifyProducer)}},AG={_A:e=>e},AY=()=>z(hb(),cp(e=>mO(AK(e))),cE(e=>({[AB]:AG,ref:e}))),AQ=R(2,(e,t)=>cp(hb(),r=>cm(mT(e.ref,n=>z(n,AV(e=>[vy(hk(e,void 0),hy(r)),AW(t,r)],(r,i)=>[cp(hy(i),()=>z(e,AQ(t))),n])))))),AZ=e=>cp(hb(),t=>cm(mT(e.ref,r=>z(r,AV(t=>[cp(hy(t),()=>AZ(e)),r],(e,r)=>[l0(hk(r,void 0),e),AK(t)]))))),AX="Emit",A0="Halt",A1=e=>({_tag:AX,elements:e}),A2=e=>({_tag:A0,cause:e}),A3=e=>({_tag:"End",reason:e}),A5=()=>ca(tU()),A4=e=>cI(cl(e),ty),A6="ScheduleEnd",A8="UpstreamEnd",A7={_tag:A6},A9={_tag:A8},Me="DrainLeft",Mt="DrainRight",Mr="PullBoth",Mn="PullLeft",Mi="PullRight",Ms={_tag:Me},Ma={_tag:Mt},Mo={_tag:Mr},Ml=e=>({_tag:Mn,rightChunk:e}),Mc=e=>({_tag:Mi,leftChunk:e}),Mu="PullBoth",Mh="PullLet",Mp="PullRight",Mf={_tag:Mu},Md=e=>({_tag:Mh,rightChunk:e}),Mm=e=>({_tag:Mp,leftChunk:e}),Mg=Symbol.for("effect/Take"),Mb={_A:e=>e,_E:e=>e};class Mx{exit;[Mg]=Mb;constructor(e){this.exit=e}pipe(){return eV(this,arguments)}}let My=e=>new Mx(hu(e)),Mv=e=>cz(()=>e.exit),M_=new Mx(hr(tU())),MS=e=>new Mx(hn(z(e,st(ty)))),Mw=R(2,(e,{onEnd:t,onFailure:r,onSuccess:n})=>hl(e.exit,{onFailure:e=>tq(v$(e),{onNone:t,onSome:r}),onSuccess:n})),Mk=e=>new Mx(hu(nn(e))),MC=Symbol.for("effect/Stream"),ME={_R:e=>e,_E:e=>e,_A:e=>e};class MO{channel;[MC]=ME;constructor(e){this.channel=e}pipe(){return eV(this,arguments)}}let MI=e=>X(e,MC)||lQ(e),MF=4096,MR=((e,t,r)=>MG(MR(e,t,r),e=>tA(e,{onLeft:tU,onRight:ty})),R(3,(e,t,r)=>M6(ve([AY(),mO(A7),mO(nt()),_1(r),mO(!1),mO(!1)])).pipe(MY(([r,n,i,s,a,o])=>{let l=F3({onInput:e=>FQ(FX(z(r,AQ(A1(e)),gH(()=>nk(e)))),()=>l),onFailure:e=>FX(AQ(r,A2(e))),onDone:()=>FX(AQ(r,A3(A9)))}),c=z(mR(i,nt()),cp(e=>nk(e)?z(mF(a,!0),vy(cj(z(F9(e),FQ(()=>c))))):z(AZ(r),cE(e=>{switch(e._tag){case AX:return z(FX(mF(a,!0)),Tq(F9(e.elements)),Tq(FX(mI(o))),FQ(e=>e?F7:c));case A0:return FG(e.cause);case"End":if(e.reason._tag===A6)return z(mI(a),cE(e=>e?FX(z(mF(n,A7),vy(mF(o,!0)))):z(FX(z(mF(n,A7),vy(mF(o,!0)))),FQ(()=>c))),TM);return z(mF(n,e.reason),vy(mF(o,!0)),FX)}}))),TM),u=e=>s.next(e),h=(e,s,l)=>{let p=z(mF(a,!1),vy(mF(o,!1)),vy(z(c,TS(Ng(t)),Fq,Tw,Sk(l)))),f=(e,t,r)=>z(mF(i,nS(e)),vy(cE(mI(n),e=>{switch(e._tag){case A6:return z(ve([mI(a),p,z(u(ty(t)),Sk(l))]),cE(([e,n,i])=>{let s=z(r,tq({onNone:()=>nn(tI(t)),onSome:e=>nr(tI(t),tO(e))}));return e?z(F9(s),FQ(()=>h(n,i,l))):h(n,i,l)}),TM);case A8:return z(mI(a),cE(e=>e?F9(nn(tI(t))):F7),TM)}})),TM);return TM(vA(bo(e),bo(s),{onSelfDone:(e,t)=>z(c0(s),vy(z(cz(()=>e),cE(([e,t])=>f(e,t,tU()))))),onOtherDone:(t,n)=>cb(cz(()=>t),{onFailure:t=>tA(i4(t),{onLeft:()=>z(r,AQ(A3(A7)),vs,vy(z(bo(e),cE(([e,t])=>f(e,t,tU()))))),onRight:t=>z(r,AQ(A2(t)),vs,vy(z(bo(e),cE(([e,t])=>f(e,t,tU())))))}),onSuccess:t=>z(r,AQ(A3(A7)),vs,vy(z(bo(e),cE(([e,r])=>f(e,r,ty(t))))))})}))};return jU(r=>F0(M5(e),l).pipe(Tw,Sk(r),vy(TS(c,Ng(t)).pipe(Fq,Tw,Sk(r),cp(e=>u(tU()).pipe(Sk(r),cE(t=>new MO(h(e,t,r)))))))))})))),MT=R(2,(e,t)=>MN(e,e=>tA(i4(e),{onLeft:t,onRight:MV}))),MN=R(2,(e,t)=>new MO(z(M5(e),FU(e=>M5(t(e)))))),MA=R(2,(e,t)=>z(e,MN(e=>z(t(e),tB(()=>MV(e)))))),MM=e=>l8(gu(e),e=>"None"===e._tag?gP:ca(e.value)),Mj=R(4,(e,t,r,n)=>{let i=(e,t)=>Tq(FX(AZ(t)),F3({onInput:r=>FQ(FX(z(e,AQ(My(r)))),()=>i(e,t)),onFailure:t=>FX(AQ(e,MS(t))),onDone:()=>FX(AQ(e,M_))}));return new MO(Tz(s=>ve([AY(),AY(),AY(),AY()]).pipe(cD(([t,r,n])=>F0(M5(e),i(t,n)).pipe(RO(s),Sk(s))),cD(([e,r,n,a])=>F0(M5(t),i(r,a)).pipe(RO(s),Sk(s))),cE(([e,t,i,s])=>{let a=AQ(i,void 0).pipe(vy(AZ(e).pipe(cp(Mv)))),o=AQ(s,void 0).pipe(vy(AZ(t).pipe(cp(Mv))));return M5(jD(r,e=>cp(n(e,a,o),MM)))}))))}),Mz=R(2,(e,t)=>new MO(z(M5(e),Tq(M5(t))))),MP=((e,t)=>MY(e,()=>t),e=>M6(cr(e))),MD=R(2,(e,t)=>z(hb(),cp(r=>z(e,MU({maximumLag:t.maximumLag,decide:e=>cp(hy(r),t=>t(e))}),cp(e=>z(ve(nI(nz(0,t.size-1),t=>cE(e,([e,r])=>[[e,t],r]))),cE(nc),cp(e=>{let[n,i]=rZ(e,[new Map,nt()],([e,t],[r,n])=>[e.set(r[0],r[1]),z(t,nf(n))]);return z(hk(r,e=>cE(t.decide(e),e=>t=>z(e(n.get(t))))),l0(Array.from(i)))}))))))),ML={ref:0},M$=()=>{let e=ML.ref;return ML.ref=e+1,e},MU=R(2,(e,t)=>Mq(e,t.maximumLag,t.decide,()=>cB)),Mq=R(4,(e,t,r,n)=>z(y4(mO(new Map),(e,t)=>z(mI(e),cp(e=>z(e.values(),vt(Iv))))),cp(i=>km(function*(s){let a=yield*s(k_(1)),o=yield*s(mO(z(Iu(t),cp(e=>{let t=M$();return z(mN(i,r=>r.set(t,e)),l0([t,e]))})))),l=e=>a.withPermits(1)(z(mF(o,z(Iu(1),cD(t=>O2(t,e)),cp(e=>{let t=M$();return z(mN(i,r=>r.set(t,e)),l0(rs(t,e)))}))),vy(z(mI(i),cp(t=>z(ni(t.values()),vt(t=>z(O2(t,e),gp(e=>iX(e)?ty(cB):tU()))))))),vy(n(e)),l1));return yield*s(e,jw(e=>z(r(e),cp(t=>z(mI(i),cp(r=>z(r.entries(),gz(nt(),(r,[n,i])=>t(n)?z(O2(i,hu(e)),cb({onFailure:e=>iX(e)?cj(z(r,nf(n))):cl(e),onSuccess:()=>cj(r)})):cj(r)),cp(e=>nk(e)?z(mN(i,t=>{for(let r of e)t.delete(r);return t})):cB))))),l1)),cb({onFailure:e=>l(hn(z(e,st(ty)))),onSuccess:()=>l(hr(tU()))}),SC),a.withPermits(1)(cm(mI(o)))})))),MB=((e,t)=>{let r=e=>F2({onInput:t=>{let n=z(t,nm(e)),i=Math.max(0,e-t.length);return nw(t)||i>0?r(i):z(F9(n),Tq(To()))},onFailure:FV,onDone:()=>F7});return new MO(z(M5(e),TS(r(t))))},new MO(F7)),MJ=R(2,(e,t)=>new MO(z(M5(e),R9(t)))),MH=()=>M6(hI()),MK=e=>z(MH(),MY(e)),MW=e=>M8(ca(ty(e))),MV=e=>M6(cl(e)),MG=R(2,(e,t)=>js(e,nx(t))),MY=R(e=>MI(e[0]),(e,t,r)=>{let n=r?.bufferSize??16;return r?.switch?MQ(r?.concurrency,()=>MZ(e,1,n,t),r=>MZ(e,r,n,t)):MQ(r?.concurrency,()=>new MO(R6(M5(e),e=>z(e,nI(e=>M5(t(e))),rQ(F7,(e,t)=>z(e,Tq(t)))))),n=>new MO(z(M5(e),R6(TD),Ty(e=>M5(t(e)),r))))}),MQ=(e,t,r)=>{switch(e){case void 0:return t();case"unbounded":return r(Number.MAX_SAFE_INTEGER);default:return e>1?r(e):t()}},MZ=R(4,(e,t,r,n)=>new MO(z(M5(e),R6(TD),Ty(e=>M5(n(e)),{concurrency:t,mergeStrategy:RK(),bufferSize:r})))),MX=R(e=>MI(e[0]),(e,t)=>MY(e,T,t)),M0=e=>{let t=F3({onInput:e=>FQ(TD(e),()=>t),onFailure:FG,onDone:()=>F7});return new MO(z(M5(e),F0(t)))},M1=e=>{let t=(e,t)=>{let[r,n]=z(e,nR(e=>!u8(e))),i=z(nC(n),tq({onNone:()=>t,onSome:hl({onFailure:e=>tq(v$(e),{onNone:()=>F7,onSome:FG}),onSuccess:()=>F7})}));return z(F9(z(r,nx(e=>u8(e)?ty(e.value):tU()))),FQ(()=>i))},r=F3({onInput:e=>t(e,r),onFailure:e=>FG(e),onDone:()=>F7});return new MO(z(M5(e),F0(r)))},M2=e=>M0(M1(z(e,jn(e=>e.exit)))),M3=e=>new MO(e),M5=e=>{if("channel"in e)return e.channel;if(lQ(e))return M5(M6(e));throw TypeError("Expected a Stream.")},M4=e=>new MO(nw(e)?F7:F9(e)),M6=e=>z(e,cI(ty),M8),M8=e=>new MO(TM(gv(e,{onFailure:tq({onNone:()=>F7,onSome:FV}),onSuccess:e=>F9(nn(e))}))),M7=(e,t)=>{let r=t?.maxChunkSize??MF;if(t?.scoped){let n=cE(Fu(e),e=>jr(e,{maxChunkSize:r,shutdown:!0}));return t.shutdown?cE(n,MJ(Fc(e))):n}let n=MY(jI(Fu(e)),e=>jr(e,{maxChunkSize:r}));return t?.shutdown?MJ(n,Fc(e)):n},M9=e=>jR(()=>r9(e)?M4(e):je(e[Symbol.iterator]())),je=(e,t=MF)=>z(cP(()=>{let r=[],n=e=>z(cP(()=>{let i=e.next();if(1===t)return i.done?F7:z(F9(nn(i.value)),FQ(()=>n(e)));r=[];let s=0;for(;!1===i.done&&(r.push(i.value),!((s+=1)>=t));)i=e.next();return s>0?z(F9(nc(r)),FQ(()=>n(e))):F7}),TM);return new MO(n(e))}),jL),jt=e=>z(e,cE(jx),j$),jr=(e,t)=>z(O6(e,1,t?.maxChunkSize??MF),l6(t=>z(Ix(e),cp(e=>e&&iX(t)?A5():A4(t)))),jx,t?.shutdown?MJ(Iv(e)):T),jn=((e,t)=>{let r=e=>z(S$(e),cE(tq({onNone:()=>F2({onInput:t=>FQ(F9(t),()=>r(e)),onFailure:FV,onDone:()=>F7}),onSome:hl({onFailure:FG,onSuccess:()=>F7})})),TM);return new MO(Tz(n=>t.pipe(Sk(n),cE(t=>M5(e).pipe(F0(r(t)))))))},R(2,(e,t)=>new MO(z(M5(e),Td(nI(t)))))),ji=R(3,(e,t,r)=>jR(()=>{let n=e=>F2({onInput:t=>z(cz(()=>{let i=[],s=e=>cP(()=>{i.push(e)});return z(t,gz(e,(e,t)=>z(r(e,t),cp(([e,t])=>z(s(t),l0(e))))),gv({onFailure:e=>0!==i.length?Tq(F9(nc(i)),FV(e)):FV(e),onSuccess:e=>FQ(F9(nc(i)),()=>n(e))}))}),TM),onFailure:FV,onDone:()=>F7});return new MO(z(M5(e),TS(n(t))))})),js=R(2,(e,t)=>new MO(z(M5(e),Td(t)))),ja=((e,t)=>z(e,js(nv(t))),R(2,(e,t)=>{let r=e=>{let n=e.next();return n.done?F3({onInput:e=>r(e[Symbol.iterator]()),onFailure:FG,onDone:F5}):TM(cE(t(n.value),t=>FQ(F9(nn(t)),()=>r(e))))};return new MO(z(M5(e),F0(F6(()=>r(nt()[Symbol.iterator]())))))})),jo=R(3,(e,t,r)=>new MO(z(M5(e),R6(TD),Tg(r,t),Td(nn)))),jl=R(2,(e,t)=>new MO(z(M5(e),Tp(t)))),jc=(e=>MI(e[1]),R(2,(e,t)=>ju(e,t,{onSelf:tO,onOther:tI}))),ju=R(3,(e,t,r)=>{let n=r.haltStrategy?T0(r.haltStrategy):TZ,i=e=>t=>e||!u8(t)?RT(cz(()=>t)):RN(e=>cz(()=>e));return new MO(Tv(M5(jn(e,r.onSelf)),{other:M5(jn(t,r.onOther)),onSelfDone:i("Either"===n._tag||"Left"===n._tag),onOtherDone:i("Either"===n._tag||"Right"===n._tag)}))}),jh=((e,t)=>new MO(z(M5(e),T_(()=>M5(t())))),R(2,(e,t)=>{let r=F2({onInput:e=>nw(e)?F6(()=>r):z(F9(e),Tq(To())),onFailure:FV,onDone:()=>F6(()=>M5(t()))});return new MO(z(M5(e),F0(r)))})),jp=(e=>"function"==typeof e[1],R(2,(e,t)=>new MO(F0(M5(e),t)))),jf=R(2,(e,t)=>new MO(z(M5(e),F1(t)))),jd=((e,t)=>new MO(Tz(r=>wc(t,r).pipe(cE(t=>z(M5(e),F1(t)))))),R(3,(e,t,r)=>MK(n=>MY(r,r=>z(e,jf(sz(n,t,r))))))),jm=((e,t)=>MK(r=>z(e,jf(t(r)))),R(2,(e,t)=>jR(()=>{let r=Math.max(t,1),n=jg(new jb(r),r);return new MO(z(M5(e),F0(n)))}))),jg=(e,t)=>F3({onInput:r=>{if(r.length===t&&e.isEmpty())return FQ(F9(r),()=>jg(e,t));if(r.length>0){let n;let i=[],s=0;for(;s<r.length;){for(;s<r.length&&void 0===n;)n=e.write(z(r,nh(s))),s+=1;void 0!==n&&(i.push(n),n=void 0)}return FQ(TP(...i),()=>jg(e,t))}return F6(()=>jg(e,t))},onFailure:t=>Tq(e.emitIfNotEmpty(),FG(t)),onDone:()=>e.emitIfNotEmpty()});class jb{n;builder=[];pos=0;constructor(e){this.n=e}isEmpty(){return 0===this.pos}write(e){if(this.builder.push(e),this.pos+=1,this.pos===this.n){let e=nc(this.builder);return this.builder=[],this.pos=0,e}}emitIfNotEmpty(){return 0!==this.pos?F9(nc(this.builder)):F7}}let jx=e=>jD(e,e=>z(cE(e,t=>ty([t,e])),l8(tq({onNone:()=>cj(tU()),onSome:ca})))),jy=e=>jx(z(e,cE(nn))),jv=((e,t)=>jv(e,t,{onElement:e=>tI(e),onSchedule:tO}),R(3,(e,t,r)=>z(_1(t),cE(t=>{let n=z(t.last,cN,cE(r.onSchedule)),i=z(e,jn(r.onElement),M5),s=TM(gv(t.next(void 0),{onFailure:()=>F7,onSuccess:()=>z(i,Tq(z(n,cE(e=>z(F9(nn(e)),FQ(()=>s))),TM)))}));return new MO(z(i,Tq(s)))}),jL))),j_=R(2,(e,t)=>M5(e).pipe(TS(Ng(t)),Tk)),jS=((e,t,r,n)=>j_(e,Ne(t,r,n)),R(2,(e,t)=>j_(e,Nu(t)))),jw=R(2,(e,t)=>z(e,jO(Nu(t)))),jk=R(2,(e,t)=>z(e,jE(t))),jC=((e,t)=>z(e,jE(t),ky),R(2,(e,t)=>{let r=F3({onInput:e=>FQ(FX(O3(t,nI(e,hu))),()=>r),onFailure:e=>FX(O2(t,hn(st(e,ty)))),onDone:()=>FX(O2(t,hr(tU())))});return z(F0(M5(e),r),R7,TC,l1)})),jE=R(2,(e,t)=>{let r=F3({onInput:e=>FQ(F9(My(e)),()=>r),onFailure:e=>F9(MS(e)),onDone:()=>F9(M_)});return z(F0(M5(e),r),Tm(e=>O2(t,e)),R7,TC,l1)}),jO=R(2,(e,t)=>z(M5(e),TS(Ng(t)),R7,TC)),jI=((e,t)=>z(e,ji(tU(),(e,r)=>{switch(e._tag){case"None":return cj([ty(r),r]);case"Some":return z(t(e.value,r),cE(e=>[ty(e),e]))}})),e=>new MO(R9(TE(z(e,cE(nn))),cB))),jF=e=>new MO(TO(t=>e(t).pipe(cE(nn)))),jR=((e,t,r)=>t<=0||r<=0?MP(new uQ("Invalid bounds - `chunkSize` and `stepSize` must be greater than zero")):new MO(F6(()=>{let n=new Aq(t),i=(e,i)=>{if(e<t){let e=n.toChunk();return z(F9(nw(e)?nt():nn(e)),FQ(()=>i))}let s=e-(e-t)%r;if(s===e)return i;let a=z(n.toChunk(),nN(e-(s-t+r)));return z(F9(nw(a)?nt():nn(a)),FQ(()=>i))},s=e=>F3({onInput:i=>FQ(F9(nx(i,(i,s)=>{n.put(i);let a=e+s+1;return a<t||(a-t)%r>0?tU():ty(n.toChunk())})),()=>s(e+i.length)),onFailure:t=>i(e,FG(t)),onDone:()=>i(e,F7)});return z(M5(e),F0(s(0)))})),e=>new MO(F6(()=>M5(e())))),jT=((e,t)=>{let r=F2({onInput:e=>{let n=z(e,nA(t));return n.length===e.length?z(F9(n),FQ(()=>r)):F9(n)},onFailure:FV,onDone:F5});return new MO(z(M5(e),TS(r)))},(e,t,r,n,i)=>{let s=(e,a)=>F3({onInput:o=>z(t(o),vb(fi),cE(([t,l])=>{let c=e+(l-a)/al(n)*r,u=r+i<0?Number.POSITIVE_INFINITY:r+i,h=(c<0?u:Math.min(c,u))-t,p=ar(Math.max(0,(h>=0?0:-h/r)*al(n)));return ag(p,s9)?z(FX(ge(p)),Tq(F9(o)),FQ(()=>s(h,l))):FQ(F9(o),()=>s(h,l))}),TM),onFailure:FG,onDone:()=>F7}),a=z(fi,cE(e=>s(r,e)),TM);return new MO(z(M5(e),TS(a)))}),jN=R(3,(e,t,r)=>z(jj(e),cE(SI({onTimeout:()=>st(t(),ty),duration:r})),jt)),jA=((e,t,r)=>{let n=new uK("Stream Timeout");return z(e,jN(()=>iK(n),t),MA(e=>iQ(e)&&vB(e.defect)&&void 0!==e.defect.message&&"Stream Timeout"===e.defect.message?ty(r):tU()))},e=>{if("number"==typeof e)return Fs(e);if("unbounded"===e.capacity)return Fl({replay:e.replay});switch(e.strategy){case"dropping":return Fa(e);case"sliding":return Fo(e);default:return Fs(e)}}),jM=R(2,(e,t)=>z(y4(jA(t),e=>Fc(e)),cD(t=>z(e,jk(t),SC)))),jj=e=>cE(TF(M5(e)),e=>z(e,cI(ty),cp(tA({onLeft:()=>ca(tU()),onRight:cj})))),jz=(e=>MI(e[0]),R(e=>MI(e[0]),(e,t)=>cE(S2(),r=>jP(e,r,t)))),jP=R(e=>MI(e[0]),(e,t,r)=>{let n,i;let s=SB(t),a=SU(t);return new ReadableStream({start(t){i=s(vE());let r=z(jj(e),vO(i),s,cp(e=>nw(e)?r:cj(e)));n=z(r,cD(e=>cP(()=>{nI(e,e=>{t.enqueue(e)})})),gU(()=>u$(i,hh)),gd({None:()=>cP(()=>{t.close()}),Some:e=>cP(()=>{t.error(e.value)})}),l1)},pull:()=>new Promise(e=>{a(n,{scope:i}).addObserver(t=>e())}),cancel:()=>new Promise(e=>{a(u$(i,hh)).addObserver(t=>e())})},r?.strategy)}),jD=(e,t)=>jR(()=>{let r=e=>TM(cE(t(e),tq({onNone:()=>F7,onSome:([e,t])=>FQ(F9(e),()=>r(t))})));return new MO(r(e))}),jL=e=>MX(M6(e)),j$=e=>MX(jI(e)),jU=e=>MX(jF(t=>e(t))),jq=((e,t)=>z(M6(t),MY(t=>t?e:MB)),R(3,(e,t,r)=>{let n=(e,t,r)=>{switch(e._tag){case Mu:return z(MM(t),vb(MM(r),{concurrent:!0}),cx({onFailure:e=>cj(hr(ty(e))),onSuccess:([e,s])=>tb(e)&&tb(s)?nw(e.value)&&nw(s.value)?n(Mf,t,r):nw(e.value)?n(Md(s.value),t,r):nw(s.value)?n(Mm(e.value),t,r):cj(hu(i(e.value,s.value))):cj(hr(tU()))}));case Mh:return cx(t,{onFailure:e=>cj(hr(e)),onSuccess:s=>nw(s)?n(Md(e.rightChunk),t,r):nw(e.rightChunk)?n(Mm(s),t,r):cj(hu(i(s,e.rightChunk)))});case Mp:return cx(r,{onFailure:e=>cj(hr(e)),onSuccess:s=>nw(s)?n(Mm(e.leftChunk),t,r):nw(e.leftChunk)?n(Md(s),t,r):cj(hu(i(e.leftChunk,s)))})}},i=(e,t)=>{let[n,i]=r(e,t);switch(i._tag){case"Left":if(nw(i.left))return[n,Mf];return[n,Mm(i.left)];case"Right":if(nw(i.right))return[n,Mf];return[n,Md(i.right)]}};return z(e,Mj(t,Mf,n))})),jB=(e,t,r)=>e.length>t.length?[z(e,nd(t.length),nM(t,r)),tO(z(e,nm(t.length)))]:[z(e,nM(z(t,nd(e.length)),r)),tI(z(t,nm(e.length)))],jJ=R(e=>MI(e[0]),(e,t="utf-8")=>jR(()=>{let r=new TextDecoder(t);return jn(e,e=>r.decode(e))})),jH=Symbol.for("effect/GroupBy"),jK={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},jW=e=>X(e,jH),jV=R(e=>jW(e[0]),(e,t,r)=>MY(e.grouped,([e,r])=>t(e,M2(jr(r,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:r?.bufferSize??16})),jG=e=>({[jH]:jK,pipe(){return eV(this,arguments)},grouped:e}),jY=R(e=>"function"!=typeof e[0],(e,t,r)=>r?.key?jV(jQ(e,r.key,{bufferSize:r.bufferSize}),(e,r)=>ja(r,t)):MQ(r?.concurrency,()=>ja(e,t),n=>r?.unordered?MY(e,e=>M6(t(e)),{concurrency:n}):jo(e,n,t))),jQ=R(e=>"function"!=typeof e[0],(e,t,r)=>{let n=(e,i)=>F3({onInput:s=>FQ(FX(vt(jZ(s,t),([t,n])=>{let s=e.get(t);return void 0===s?z(Iu(r?.bufferSize??16),cp(r=>z(cP(()=>{e.set(t,r)}),vy(O2(i,Mk([t,r]))),vy(z(O2(r,My(n)),gp(e=>i0(e)?ty(cB):tU())))))):gp(O2(s,My(n)),e=>i0(e)?ty(cB):tU())},{discard:!0})),()=>n(e,i)),onFailure:e=>FX(O2(i,MS(e))),onDone:()=>z(FX(z(vt(e.entries(),([e,t])=>z(O2(t,M_),gp(e=>i0(e)?ty(cB):tU())),{discard:!0}),vy(O2(i,M_)))))});return jG(jU(t=>km(function*(){let r=new Map,i=yield*If();return yield*uD(t,Iv(i)),yield*M5(e).pipe(F0(n(r,i)),R7,RO(t),Sk(t),l0(M2(jr(i,{shutdown:!0}))))})))}),jZ=R(2,(e,t)=>{let r;let n=[],i=e[Symbol.iterator](),s=new Map;for(;(r=i.next())&&!r.done;){let e=r.value,i=t(e);if(s.has(i))s.get(i).push(e);else{let t=[e];n.push([i,t]),s.set(i,t)}}return nc(n.map(e=>[e[0],nc(e[1])]))}),jX=(...e)=>{let t=1===e.length?e[0].evaluate:e[0],r=1===e.length?e[0].onError:e[1],n=1===e.length&&!0===e[0].releaseLockOnEnd;return j$(cE(y4(cP(()=>t().getReader()),e=>n?cP(()=>e.releaseLock()):kg(()=>e.cancel())),e=>jy(cp(gq({try:()=>e.read(),catch:e=>ty(r(e))}),({done:e,value:t})=>e?ca(tU()):cj(t)))))},j0=e=>j_(e,T7),j1=Symbol.for("@effect/platform/Cookies"),j2=e=>X(e,j1),j3=Symbol.for("@effect/platform/Cookies/Cookie"),j5=Symbol.for("@effect/platform/Cookies/CookieError");class j4 extends kR(j5,"CookieError"){get message(){return this.reason}}let j6={[j1]:j1,...eL,toJSON(){return{_id:"@effect/platform/Cookies",cookies:rr(this.cookies,e=>e.toJSON())}},pipe(){return eV(this,arguments)}},j8=e=>{let t=Object.create(j6);return t.cookies=e,t},j7=e=>{let t={};for(let r of e)t[r.name]=r;return j8(t)},j9=e=>{let t=[];for(let r of"string"==typeof e?[e]:e){let e=function(e){let t=e.split(";").map(e=>e.trim()).filter(e=>""!==e);if(0===t.length)return tU();let r=t[0].indexOf("=");if(-1===r)return tU();let n=t[0].slice(0,r);if(!zr.test(n))return tU();let i=t[0].slice(r+1),s=zc(i);if(1===t.length)return ty(Object.assign(Object.create(zn),{name:n,value:s,valueEncoded:i}));let a={};for(let e=1;e<t.length;e++){let r=t[e],n=r.indexOf("="),i=-1===n?r:r.slice(0,n).trim(),s=-1===n?void 0:r.slice(n+1).trim();switch(i.toLowerCase()){case"domain":{if(void 0===s)break;let e=s.trim().replace(/^\./,"");e&&(a.domain=e);break}case"expires":{if(void 0===s)break;let e=new Date(s);isNaN(e.getTime())||(a.expires=e);break}case"max-age":{if(void 0===s)break;let e=parseInt(s,10);isNaN(e)||(a.maxAge=an(e));break}case"path":if(void 0===s)break;"/"===s[0]&&(a.path=s);break;case"priority":if(void 0===s)break;switch(s.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high"}break;case"httponly":a.httpOnly=!0;break;case"secure":a.secure=!0;break;case"partitioned":a.partitioned=!0;break;case"samesite":if(void 0===s)break;switch(s.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none"}}}return ty(Object.assign(Object.create(zn),{name:n,value:s,valueEncoded:i,options:Object.keys(a).length>0?a:void 0}))}(r.trim());tb(e)&&t.push(e.value)}return j7(t)},ze=j7([]),zt=e=>t9(e.cookies),zr=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,zn={[j3]:j3,...eL,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}};function zi(e,t,r){if(!zr.test(e))return tO(new j4({reason:"InvalidName"}));let n=encodeURIComponent(t);if(n&&!zr.test(n))return tO(new j4({reason:"InvalidValue"}));if(void 0!==r){if(void 0!==r.domain&&!zr.test(r.domain))return tO(new j4({reason:"InvalidDomain"}));if(void 0!==r.path&&!zr.test(r.path))return tO(new j4({reason:"InvalidPath"}));if(void 0!==r.maxAge&&!s7(s2(r.maxAge)))return tO(new j4({reason:"InfinityMaxAge"}))}return tI(Object.assign(Object.create(zn),{name:e,value:t,valueEncoded:n,options:r}))}let zs=(e,t,r)=>tz(zi(e,t,r)),za=((e,t)=>j8({...e.cookies,...t.cookies}),R(2,(e,t)=>{let r={...e.cookies};for(let[e,n,i]of t){let t=zi(e,n,i);if(tC(t))return t;r[e]=t.right}return tI(j8(r))}));function zo(e){let t=e.name+"="+e.valueEncoded;if(void 0===e.options)return t;let r=e.options;if(void 0!==r.maxAge&&(t+="; Max-Age="+Math.trunc(ac(r.maxAge))),void 0!==r.domain&&(t+="; Domain="+r.domain),void 0!==r.path&&(t+="; Path="+r.path),void 0!==r.priority)switch(r.priority){case"low":t+="; Priority=Low";break;case"medium":t+="; Priority=Medium";break;case"high":t+="; Priority=High"}if(void 0!==r.expires&&(t+="; Expires="+r.expires.toUTCString()),r.httpOnly&&(t+="; HttpOnly"),r.secure&&(t+="; Secure"),r.partitioned&&(t+="; Partitioned"),void 0!==r.sameSite)switch(r.sameSite){case"lax":t+="; SameSite=Lax";break;case"strict":t+="; SameSite=Strict";break;case"none":t+="; SameSite=None"}return t}let zl=e=>Object.values(e.cookies).map(zo),zc=e=>{try{return decodeURIComponent(e)}catch(t){return e}},zu="effect/Redacted",zh=$("effect/Redacted/redactedRegistry",()=>new WeakMap),zp=Symbol.for(zu),zf={[zp]:{_A:e=>e},pipe(){return eV(this,arguments)},toString:()=>"<redacted>",toJSON:()=>"<redacted>",[ez]:()=>"<redacted>",[ey](){return z(ev(zu),eS(ev(zh.get(this))),eR(this))},[eT](e){return zd(e)&&eN(zh.get(this),zh.get(e))}},zd=e=>X(e,zp),zm=e=>{let t=Object.create(zf);return zh.set(t,e),t},zg=e=>{if(zh.has(e))return zh.get(e);throw Error("Unable to get redacted value")},zb=Symbol.for("effect/BigDecimal"),zx={[zb]:zb,[ey](){let e=zC(this);return z(ev(e.value),eS(eC(e.scale)),eR(this))},[eT](e){return zy(e)&&zF(this,e)},toString(){return`BigDecimal(${zR(this)})`},toJSON(){return{_id:"BigDecimal",value:String(this.value),scale:this.scale}},[ez](){return this.toJSON()},pipe(){return eV(this,arguments)}},zy=e=>X(e,zb),zv=(e,t)=>{let r=Object.create(zx);return r.value=e,r.scale=t,r},z_=(e,t)=>{if(e!==zS&&e%zw===zS)throw RangeError("Value must be normalized");let r=zv(e,t);return r.normalized=r,r},zS=BigInt(0),zw=BigInt(10),zk=z_(zS,0),zC=e=>{if(void 0===e.normalized){if(e.value===zS)e.normalized=zk;else{let t=`${e.value}`,r=0;for(let e=t.length-1;e>=0;e--)if("0"===t[e])r++;else break;0===r&&(e.normalized=e);let n=BigInt(t.substring(0,t.length-r)),i=e.scale-r;e.normalized=z_(n,i)}}return e.normalized},zE=R(2,(e,t)=>t>e.scale?zv(e.value*zw**BigInt(t-e.scale),t):t<e.scale?zv(e.value/zw**BigInt(e.scale-t),t):e),zO=e=>e.value<zS?zv(-e.value,e.scale):e,zI=tP((e,t)=>e.scale>t.scale?zE(t,e.scale).value===e.value:e.scale<t.scale?zE(e,t.scale).value===t.value:e.value===t.value),zF=R(2,(e,t)=>zI(e,t)),zR=e=>{let t,r;let n=zC(e);if(Math.abs(n.scale)>=16)return zT(n);let i=n.value<zS,s=i?`${n.value}`.substring(1):`${n.value}`;if(n.scale>=s.length)t="0",r="0".repeat(n.scale-s.length)+s;else{let e=s.length-n.scale;if(e>s.length){let n=e-s.length;t=`${s}${"0".repeat(n)}`,r=""}else r=s.slice(e),t=s.slice(0,e)}let a=""===r?t:`${t}.${r}`;return i?`-${a}`:a},zT=e=>{if(zN(e))return"0e+0";let t=zC(e),r=`${zO(t).value}`,n=r.slice(0,1),i=r.slice(1),s=`${zA(t)?"-":""}${n}`;""!==i&&(s+=`.${i}`);let a=i.length-t.scale;return`${s}e${a>=0?"+":""}${a}`},zN=e=>e.value===zS,zA=e=>e.value<zS,zM=e=>h6(e,void 0,h4),zj=Symbol.for("effect/Config"),zz={...ta,[zj]:{_A:e=>e},commit(){return fa(this)}},zP=R(2,(e,t)=>zL(e,e=>tI(t(e)))),zD=R(2,(e,t)=>zL(e,e=>{try{return tI(t(e))}catch(e){return tO(h0([],e instanceof Error?e.message:`${e}`))}})),zL=R(2,(e,t)=>{let r=Object.create(zz);return r._tag=pa,r.original=e,r.mapOrFail=t,r}),z$=R(2,(e,t)=>{let r=Object.create(zz);return r._tag=po,r.name=t,r.config=e,r}),zU=R(2,(e,t)=>{let r=Object.create(zz);return r._tag=pi,r.first=e,r.second=zH(t),r.condition=A,r}),zq=R(2,(e,t)=>{let r=Object.create(zz);return r._tag=pi,r.first=e,r.second=zH(t.orElse),r.condition=t.if,r}),zB=(e,t)=>{let r=Object.create(zz);return r._tag=pl,r.description=e,r.parse=t,r},zJ=e=>{let t=Object.create(zz);return t._tag=pn,t.value=e,t.parse=()=>tI(e),t},zH=e=>{let t=Object.create(zz);return t._tag=ps,t.config=e,t},zK=R(2,(e,t)=>zq(e,{orElse:()=>zJ(t),if:zM})),zW=((e,t,r)=>{let n=Object.create(zz);return n._tag=pc,n.left=e,n.right=t,n.zip=r,n},e=>{let t=zB("a text property",tI);return void 0===e?t:z$(t,e)}),zV=Symbol.for("effect/Encoding/errors/Decode"),zG=(e,t)=>{let r={_tag:"DecodeException",[zV]:zV,input:e};return U(t)&&(r.message=t),r},zY=new TextEncoder,zQ=e=>{let t;let r=e.length,n="";for(t=2;t<r;t+=3)n+=z1[e[t-2]>>2]+z1[(3&e[t-2])<<4|e[t-1]>>4]+z1[(15&e[t-1])<<2|e[t]>>6]+z1[63&e[t]];return t===r+1&&(n+=z1[e[t-2]>>2]+z1[(3&e[t-2])<<4]+"=="),t===r&&(n+=z1[e[t-2]>>2]+z1[(3&e[t-2])<<4|e[t-1]>>4]+z1[(15&e[t-1])<<2]+"="),n},zZ=e=>{let t=zX(e),r=t.length;if(r%4!=0)return tO(zG(t,`Length must be a multiple of 4, but is ${r}`));let n=t.indexOf("=");if(-1!==n&&(n<r-2||n===r-2&&"="!==t[r-1]))return tO(zG(t,"Found a '=' character, but it is not at the end"));try{let e=t.endsWith("==")?2:t.endsWith("=")?1:0,n=new Uint8Array(r/4*3-e);for(let e=0,i=0;e<r;e+=4,i+=3){let r=z0(t.charCodeAt(e))<<18|z0(t.charCodeAt(e+1))<<12|z0(t.charCodeAt(e+2))<<6|z0(t.charCodeAt(e+3));n[i]=r>>16,n[i+1]=r>>8&255,n[i+2]=255&r}return tI(n)}catch(e){return tO(zG(t,e instanceof Error?e.message:"Invalid input"))}},zX=e=>e.replace(/[\n\r]/g,"");function z0(e){if(e>=z2.length)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);let t=z2[e];if(255===t)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}let z1=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],z2=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],z3=e=>{let t="";for(let r=0;r<e.length;++r)t+=z4[e[r]];return t},z5=e=>{let t=new TextEncoder().encode(e);if(t.length%2!=0)return tO(zG(e,`Length must be a multiple of 2, but is ${t.length}`));try{let e=t.length/2,r=new Uint8Array(e);for(let n=0;n<e;n++){let e=z6(t[2*n]),i=z6(t[2*n+1]);r[n]=e<<4|i}return tI(r)}catch(t){return tO(zG(e,t instanceof Error?t.message:"Invalid input"))}},z4=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],z6=e=>{if(48<=e&&e<=57)return e-48;if(97<=e&&e<=102)return e-97+10;if(65<=e&&e<=70)return e-65+10;throw TypeError("Invalid input")},z8=e=>"string"==typeof e?z3(zY.encode(e)):z3(e),z7=e=>z5(e),z9=Symbol.for("effect/SchemaId/GreaterThanOrEqualTo"),Pe=Symbol.for("effect/SchemaId/Int"),Pt=Symbol.for("effect/SchemaId/Between"),Pr=Symbol.for("effect/SchemaId/MinLength"),Pn=R(e=>Z(e[0]),(e,...t)=>{let r={};for(let n of t)n in e&&(r[n]=e[n]);return r}),Pi=R(e=>Z(e[0]),(e,...t)=>{let r={...e};for(let e of t)delete r[e];return r}),Ps=Symbol.for("effect/Schema"),Pa=e=>class{[Ps]=Po;static Type;static Encoded;static Context;static [Ps]=Po;static ast=e;static annotations(e){return Pa(Pu(this.ast,e))}static pipe(){return eV(this,arguments)}static toString(){return String(e)}},Po={_A:e=>e,_I:e=>e,_R:e=>e},Pl={schemaId:kQ,message:kZ,missingMessage:kX,identifier:k0,title:k1,description:k3,examples:k5,default:k4,documentation:Ce,jsonSchema:k6,arbitrary:k8,pretty:k7,equivalence:k9,concurrency:Ct,batching:Cr,parseIssueTitle:Cn,parseOptions:Ci,decodingFallback:Cs},Pc=e=>{if(!e)return{};let t={...e};for(let r in Pl)r in e&&(t[Pl[r]]=e[r],delete t[r]);return t},Pu=(e,t)=>Ew(e,Pc(t)),Ph=e=>String(e.ast),Pp=e=>Pa(Ez(e.ast)),Pf=e=>Pa(ET(e.ast)),Pd=(e,t)=>{let r=Or(e,t);return(e,t)=>E3(r(e,t),E0)},Pm=(e,t)=>{let r=Pd(e,t);return(e,t)=>S6(r(e,t))},Pg=e=>X(e,Ps)&&Z(e[Ps]),Pb=e=>Ec(e)?Eo.make(El(e,e=>new CR(e))):new CR(e[0]),Px=(e,t=Pb(e))=>class extends Pa(t){static annotations(e){return Px(this.literals,Pu(this.ast,e))}static literals=[...e]};function Py(...e){return rx(e)?Px(e):PC}let Pv=(e,t,r)=>Pa(new CI(e.map(e=>e.ast),(...e)=>t.decode(...e.map(Pa)),(...e)=>t.encode(...e.map(Pa)),Pc(r))),P_=(e,t)=>{let r=()=>(t,r,n)=>e(t)?tI(t):tO(new EG(n,t));return Pa(new CI([],r,r,Pc(t)))},PS=function(){if(Array.isArray(arguments[0])){let e=arguments[0],t=arguments[1],r=arguments[2];return Pv(e,t,r)}let e=arguments[0],t=arguments[1];return P_(e,t)};class Pw extends Pa(Cj){}class Pk extends Pa(CN){}class PC extends Pa(CP){}class PE extends Pa(CL){}class PO extends Pa(CB){}class PI extends Pa(CK){}class PF extends Pa(CG){}let PR=e=>Eo.make(e.map(e=>e.ast)),PT=(e,t=PR(e))=>class extends Pa(t){static annotations(e){return PT(this.members,Pu(this.ast,e))}static members=[...e]};function PN(...e){return Ec(e)?PT(e):rx(e)?e[0]:PC}let PA=e=>PN(e,Pk),PM=e=>PN(e,Pw),Pj=e=>PN(e,Pk,Pw);class Pz{ast;from;[Ps];_Token;constructor(e,t){this.ast=e,this.from=t}annotations(e){return new Pz(new C2(this.ast.type,this.ast.isOptional,{...this.ast.annotations,...Pc(e)}),this.from)}toString(){return`${this.ast.type}${this.ast.isOptional?"?":""}`}}let PP=(e,t)=>new C5(e.map(e=>Pg(e)?new C2(e.ast,!1):e.ast),t.map(e=>Pg(e)?new C1(e.ast):e.ast),!0),PD=(e,t,r=PP(e,t))=>class extends Pa(r){static annotations(e){return PD(this.elements,this.rest,Pu(this.ast,e))}static elements=[...e];static rest=[...t]},PL=(e,t)=>class extends PD([],[e],t){static annotations(e){return PL(this.value,Pu(this.ast,e))}static value=e},P$=e=>PL(e),PU=(e,t)=>class extends PD([e],[e],t){static annotations(e){return PU(this.value,Pu(this.ast,e))}static value=e},Pq=e=>e?'"?:"':'":"';class PB extends C2{isReadonly;defaultValue;_tag="PropertySignatureDeclaration";constructor(e,t,r,n,i){super(e,t,n),this.isReadonly=r,this.defaultValue=i}toString(){let e=Pq(this.isOptional),t=String(this.type);return`PropertySignature<${e}, ${t}, never, ${e}, ${t}>`}}class PJ extends C2{isReadonly;fromKey;constructor(e,t,r,n,i){super(e,t,n),this.isReadonly=r,this.fromKey=i}}class PH extends C2{isReadonly;defaultValue;constructor(e,t,r,n,i){super(e,t,n),this.isReadonly=r,this.defaultValue=i}}let PK=e=>void 0===e?"never":U(e)?JSON.stringify(e):String(e);class PW{from;to;decode;encode;_tag="PropertySignatureTransformation";constructor(e,t,r,n){this.from=e,this.to=t,this.decode=r,this.encode=n}toString(){return`PropertySignature<${Pq(this.to.isOptional)}, ${this.to.type}, ${PK(this.from.fromKey)}, ${Pq(this.from.isOptional)}, ${this.from.type}>`}}let PV=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new PB(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new PW(new PJ(e.from.type,e.from.isOptional,e.from.isReadonly,e.from.annotations),new PH(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},PG=Symbol.for("effect/PropertySignature"),PY=e=>X(e,PG);class PQ{ast;[Ps];[PG]=null;_TypeToken;_Key;_EncodedToken;_HasDefault;constructor(e){this.ast=e}pipe(){return eV(this,arguments)}annotations(e){return new PQ(PV(this.ast,Pc(e)))}toString(){return String(this.ast)}}let PZ=e=>new PQ(e);class PX extends PQ{from;constructor(e,t){super(e),this.from=t}annotations(e){return new PX(PV(this.ast,Pc(e)),this.from)}}let P0=R(2,(e,t)=>{let r=e.ast;switch(r._tag){case"PropertySignatureDeclaration":return PZ(new PB(r.type,r.isOptional,r.isReadonly,r.annotations,t));case"PropertySignatureTransformation":return PZ(new PW(r.from,new PH(r.to.type,r.to.isOptional,r.to.isReadonly,r.to.annotations,t),r.decode,r.encode))}}),P1=e=>AST.pruneUndefined(e,P1,e=>{let t=P1(e.to);if(t)return new AST.Transformation(e.from,t,e.transformation)}),P2=(e,t,r)=>PZ(new PW(new PJ(e.ast,!0,!0,{},void 0),new PH(t.ast,!1,!0,{},void 0),e=>ty(r.decode(e)),tQ(r.encode))),P3=(e,t,r)=>PZ(new PW(new PJ(e.ast,!0,!0,{},void 0),new PH(t.ast,!0,!0,{},void 0),r.decode,r.encode)),P5=(e,t)=>{let r=t?.exact,n=t?.default,i=t?.nullable,s=t?.as=="Option",a=t?.onNoneEncoding?tJ(t.onNoneEncoding):T;return r?n?i?P0(P2(PA(e),Pf(e),{decode:tq({onNone:n,onSome:e=>null===e?n():e}),encode:ty}),n).ast:P0(P2(e,Pf(e),{decode:tq({onNone:n,onSome:T}),encode:ty}),n).ast:s?i?P2(PA(e),DP(Pf(e)),{decode:t0(G),encode:a}).ast:P2(e,DP(Pf(e)),{decode:T,encode:T}).ast:i?P3(PA(e),Pf(e),{decode:t0(G),encode:T}).ast:new PB(e.ast,!0,!0,{},void 0):n?i?P0(P2(Pj(e),Pf(e),{decode:tq({onNone:n,onSome:e=>null==e?n():e}),encode:ty}),n).ast:P0(P2(PM(e),Pf(e),{decode:tq({onNone:n,onSome:e=>void 0===e?n():e}),encode:ty}),n).ast:s?i?P2(Pj(e),DP(Pf(e)),{decode:t0(e=>null!=e),encode:a}).ast:P2(PM(e),DP(Pf(e)),{decode:t0(V),encode:a}).ast:i?P3(Pj(e),PM(Pf(e)),{decode:t0(G),encode:T}).ast:new PB(PM(e).ast,!0,!0,{},void 0)},P4=e=>new PX(new PB(e.ast===Cj||e.ast===CP?Cj:PM(e).ast,!0,!0,{},void 0),e),P6=R(e=>Pg(e[0]),(e,t)=>new PX(P5(e,t),e)),P8=(u=[kX],e=>{let t;for(let r of u)Object.prototype.hasOwnProperty.call(e.annotations,r)&&(void 0===t&&(t={}),t[r]=e.annotations[r]);return t}),P7=(e,t)=>{let r=kN(e),n=[];if(r.length>0){let i=[],s=[],a=[];for(let t=0;t<r.length;t++){let o=r[t],l=e[o];if(PY(l)){let e=l.ast;switch(e._tag){case"PropertySignatureDeclaration":{let t=e.type,r=e.isOptional,a=e.annotations;i.push(new C6(o,t,r,!0,P8(e))),s.push(new C6(o,ET(t),r,!0,a)),n.push(new C6(o,t,r,!0,a));break}case"PropertySignatureTransformation":{let t=e.from.fromKey??o;i.push(new C6(t,e.from.type,e.from.isOptional,!0,e.from.annotations)),s.push(new C6(o,e.to.type,e.to.isOptional,!0,e.to.annotations)),a.push(new Ev(t,o,e.decode,e.encode))}}}else i.push(new C6(o,l.ast,!1,!0)),s.push(new C6(o,ET(l.ast),!1,!0)),n.push(new C6(o,l.ast,!1,!0))}if(rx(a)){let e=[],r=[];for(let n of t){let{indexSignatures:t,propertySignatures:a}=EF(n.key.ast,n.value.ast);a.forEach(e=>{i.push(e),s.push(new C6(e.name,ET(e.type),e.isOptional,e.isReadonly,e.annotations))}),t.forEach(t=>{e.push(t),r.push(new C7(t.parameter,ET(t.type),t.isReadonly))})}return new Eg(new C9(i,e,{[k2]:"Struct (Encoded side)"}),new C9(s,r,{[k2]:"Struct (Type side)"}),new E_(a))}}let i=[];for(let e of t){let{indexSignatures:t,propertySignatures:r}=EF(e.key.ast,e.value.ast);r.forEach(e=>n.push(e)),t.forEach(e=>i.push(e))}return new C9(n,i)},P9=(e,t)=>{for(let r of kN(e)){let n=e[r];if(void 0===t[r]&&PY(n)){let e=n.ast,i="PropertySignatureDeclaration"===e._tag?e.defaultValue:e.to.defaultValue;void 0!==i&&(t[r]=i())}}return t},De=(e,t,r=P7(e,t))=>class extends Pa(r){static annotations(e){return De(this.fields,this.records,Pu(this.ast,e))}static fields={...e};static records=[...t];static make=(t,r)=>{let n=P9(e,{...t});return DH(r)?n:Oi(this)(n)};static pick(...t){return Dt(Pn(e,...t))}static omit(...t){return Dt(Pi(e,...t))}};function Dt(e,...t){return De(e,t)}let Dr=(e,t,r)=>class extends De({},[{key:e,value:t}],r){static annotations(r){return Dr(e,t,Pu(this.ast,r))}static key=e;static value=t},Dn=e=>Dr(e.key,e.value),Di=(e,t,r)=>{if(Er(e)&&Er(t)){let n=[...e.propertySignatures];for(let e of t.propertySignatures){let t=e.name,i=n.findIndex(e=>e.name===t);if(-1===i)n.push(e);else{let{isOptional:s,type:a}=n[i];n[i]=new C6(t,Do(a,e.type,r.concat(t)),s,!0)}}return new C9(n,e.indexSignatures.concat(t.indexSignatures))}throw Error(kq(e,t,r))},Ds=(h=[k0],e=>{let t={...e.annotations};for(let e of h)delete t[e];return t}),Da=(e,t)=>t.map(t=>new Ef(t,e.filter,Ds(e))),Do=(e,t,r)=>Eo.make(Dc([e],[t],r)),Dl=e=>Eu(e)?e.types:[e],Dc=(e,t,r)=>rJ(e,e=>rJ(t,t=>{switch(t._tag){case"Literal":if(U(t.literal)&&CJ(e)||q(t.literal)&&CW(e)||B(t.literal)&&CY(e))return[t];break;case"StringKeyword":if(t===CB){if(CJ(e)||CT(e)&&U(e.literal))return[e];if(Ed(e))return Da(e,Dc(Dl(e.from),[t],r))}else if(e===CB)return[t];break;case"NumberKeyword":if(t===CK){if(CW(e)||CT(e)&&q(e.literal))return[e];if(Ed(e))return Da(e,Dc(Dl(e.from),[t],r))}else if(e===CK)return[t];break;case"BooleanKeyword":if(t===CG){if(CY(e)||CT(e)&&B(e.literal))return[e];if(Ed(e))return Da(e,Dc(Dl(e.from),[t],r))}else if(e===CG)return[t];break;case"Union":return Dc(Dl(e),t.types,r);case"Suspend":return[new Ep(()=>Do(e,t.f(),r))];case"Refinement":return Da(t,Dc(Dl(e),Dl(t.from),r));case"TypeLiteral":switch(e._tag){case"Union":return Dc(e.types,[t],r);case"Suspend":return[new Ep(()=>Do(e.f(),t,r))];case"Refinement":return Da(e,Dc(Dl(e.from),[t],r));case"TypeLiteral":return[Di(e,t,r)];case"Transformation":if(ES(e.transformation))return[new Eg(Di(e.from,t,r),Di(e.to,ET(t),r),new E_(e.transformation.propertySignatureTransformations))]}break;case"Transformation":if(ES(t.transformation))switch(e._tag){case"Union":return Dc(e.types,[t],r);case"Suspend":return[new Ep(()=>Do(e.f(),t,r))];case"Refinement":return Da(e,Dc(Dl(e.from),[t],r));case"TypeLiteral":return[new Eg(Di(e,t.from,r),Di(ET(e),t.to,r),new E_(t.transformation.propertySignatureTransformations))];case"Transformation":if(ES(e.transformation))return[new Eg(Di(e.from,t.from,r),Di(e.to,t.to,r),new E_(t.transformation.propertySignatureTransformations.concat(e.transformation.propertySignatureTransformations)))]}}throw Error(kq(e,t,r))})),Du=R(2,(e,t)=>Pa(Do(e.ast,t.ast,[]))),Dh=R(e=>Pg(e[1]),(e,t)=>Pa(EL(e.ast,t.ast))),Dp=e=>Pa(new Ep(()=>e().ast)),Df=Symbol.for("effect/SchemaId/Refine"),Dd=(e,t,r)=>class extends Pa(r){static annotations(e){return Dd(this.from,this.filter,Pu(this.ast,e))}static [Df]=e;static from=e;static filter=t;static make=(e,t)=>DH(t)?e:Oi(this)(e)},Dm=(e,t,r)=>{if(B(e))return e?tU():ty(new EG(t,r));if(U(e))return ty(new EG(t,r,e));if(void 0!==e){if("_tag"in e)return ty(e);let n=new EG(t,r,e.message);return ty(rx(e.path)?new EB(e.path,r,n):n)}return tU()},Dg=(e,t,r)=>{if(kD(e))return Dm(e,t,r);if(rx(e)){let n=rK(e,e=>Dm(e,t,r));if(rx(n))return ty(1===n.length?n[0]:new EK(t,r,n))}return tU()};function Db(e,t){return r=>{function n(t,r,n){return Dg(e(t,r,n),n,t)}let i=new Ef(r.ast,n,Pc(t));return Dd(r,n,i)}}let Dx=(e,t,r)=>class extends Pa(r){static annotations(e){return Dx(this.from,this.to,Pu(this.ast,e))}static from=e;static to=t},Dy=R(e=>Pg(e[0])&&Pg(e[1]),(e,t,r)=>Dx(e,t,new Eg(e.ast,t.ast,new Eb(r.decode,r.encode)))),Dv=R(e=>Pg(e[0])&&Pg(e[1]),(e,t,r)=>Dy(e,t,{strict:!0,decode:(e,t,n,i)=>tI(r.decode(e,i)),encode:(e,t,n,i)=>tI(r.encode(e,i))})),D_=Symbol.for("effect/SchemaId/Trimmed"),DS=Symbol.for("effect/SchemaId/StartsWith"),Dw=PO.annotations({[k0]:"JsonString",[k1]:"JsonString",[k3]:"a string that will be parsed as JSON"}),Dk=e=>Dy(Dw,PE,{strict:!0,decode:(t,r,n)=>tR({try:()=>JSON.parse(t,e?.reviver),catch:e=>new EG(n,t,e.message)}),encode:(t,r,n)=>tR({try:()=>JSON.stringify(t,e?.replacer,e?.space),catch:e=>new EG(n,t,e.message)})}).annotations({schemaId:CO}),DC=(e,t)=>Pg(e)?Dh(DC(t),e):Dk(e),DE=(e,t)=>r=>r.pipe(Db(t=>t>=e,{schemaId:z9,title:`greaterThanOrEqualTo(${e})`,description:0===e?"a non-negative number":`a number greater than or equal to ${e}`,jsonSchema:{minimum:e},...t})),DO=e=>t=>t.pipe(Db(e=>Number.isSafeInteger(e),{schemaId:Pe,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e}));class DI extends PI.pipe(DO({identifier:"Int"})){}let DF=(e,t,r,n)=>E4(e,{onFailure:e=>new EK(r,n,e),onSuccess:t}),DR=e=>(t,r,n)=>zd(t)?DF(e(zg(t),r),zm,n,t):tO(new EG(n,t)),DT=PS(e=>e instanceof Uint8Array,{identifier:"Uint8ArrayFromSelf",pretty:()=>e=>`new Uint8Array(${JSON.stringify(Array.from(e))})`,arbitrary:()=>e=>e.uint8Array(),equivalence:()=>tL(eN)});p={identifier:"Uint8",description:"a 8-bit unsigned integer"},e=>e.pipe(Db(e=>e>=0&&e<=255,{schemaId:Pt,title:"between(0, 255)",description:"a number between 0 and 255",jsonSchema:{minimum:0,maximum:255},...p}));let DN=(f="Uint8ArrayFromBase64",d=e=>zZ(e),m=e=>"string"==typeof e?zQ(zY.encode(e)):zQ(e),Dy(PO.annotations({description:"a string that will be parsed into a Uint8Array"}),DT,{strict:!0,decode:(e,t,r)=>tT(d(e),t=>new EG(r,e,t.message)),encode:e=>tI(m(e))}).annotations({identifier:f})),DA=e=>"None"===e._tag?tU():ty(e.value),DM=(e,t)=>r=>r.oneof(t,r.record({_tag:r.constant("None")}),r.record({_tag:r.constant("Some"),value:e(r)})).map(DA),Dj=e=>tq({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),Dz=e=>(t,r,n)=>tm(t)?tg(t)?tI(tU()):DF(e(t.value,r),ty,n,t):tO(new EG(n,t)),DP=e=>PS([e],{decode:e=>Dz(Or(e)),encode:e=>Dz(On(e))},{description:`Option<${Ph(e)}>`,pretty:Dj,arbitrary:DM,equivalence:t1}),DD=e=>Pg(e)||PY(e),DL=e=>kN(e).every(t=>DD(e[t])),D$=e=>"fields"in e?e.fields:D$(e[Df]),DU=e=>DL(e)?Dt(e):Pg(e)?e:Dt(D$(e)),Dq=e=>DL(e)?e:D$(e),DB=e=>(t,r)=>DV({kind:"Class",identifier:e,schema:DU(t),fields:Dq(t),Base:ol,annotations:r}),DJ=(e,t)=>{let r={...e};for(let n of kN(t)){if(n in e)throw Error(kG(n));r[n]=t[n]}return r},DH=e=>B(e)?e:e?.disableValidation??!1,DK=$("effect/Schema/astCache",()=>new WeakMap),DW=e=>void 0===e?[]:Array.isArray(e)?e:[e],DV=({Base:e,annotations:t,disableToString:r,fields:n,identifier:i,kind:s,schema:a})=>{let o=Symbol.for(`effect/Schema/${s}/${i}`),[l,c,u]=DW(t),h=Pf(a),p=h.annotations({identifier:i,...l}),f=h.annotations({[k2]:`${i} (Type side)`,...l}),d=a.annotations({[k2]:`${i} (Constructor)`,...l}),m=a.annotations({[k2]:`${i} (Encoded side)`,...u}),g=a.annotations({[Ck]:i,...u,...l,...c}),b=e=>X(e,o)&&Os(f)(e),x=class extends e{constructor(e={},t=!1){e={...e},"Class"!==s&&delete e._tag,e=P9(n,e),DH(t)||(e=Oi(d)(e)),super(e,!0)}static [Ps]=Po;static get ast(){let e=DK.get(this);return e||(e=Dv(m,PS([f],{decode:()=>(e,t,r)=>e instanceof this||b(e)?tI(e):tO(new EG(r,e)),encode:()=>(e,t)=>e instanceof this?tI(e):E2(On(f)(e,t),e=>new this(e,!0))},{identifier:i,pretty:e=>t=>`${i}(${e(t)})`,arbitrary:e=>t=>e(t).map(e=>new this(e)),equivalence:T,[Ca]:p.ast,...l}),{strict:!0,decode:e=>new this(e,!0),encode:T}).annotations({[Ca]:g.ast,...c}).ast,DK.set(this,e)),e}static pipe(){return eV(this,arguments)}static annotations(e){return Pa(this.ast).annotations(e)}static toString(){return`(${String(m)} <-> ${i})`}static make(...e){return new this(...e)}static fields={...n};static identifier=i;static extend(e){return(t,r)=>{let i=Dq(t),o=DU(t),l=DJ(n,i);return DV({kind:s,identifier:e,schema:Du(a,o),fields:l,Base:this,annotations:r})}}static transformOrFail(e){return(t,r,i)=>{let o=DJ(n,t);return DV({kind:s,identifier:e,schema:Dy(a,Pf(Dt(o)),r),fields:o,Base:this,annotations:i})}}static transformOrFailFrom(e){return(t,r,i)=>{let o=DJ(n,t);return DV({kind:s,identifier:e,schema:Dy(Pp(a),Dt(o),r),fields:o,Base:this,annotations:i})}}get[o](){return o}};return!0!==r&&Object.defineProperty(x.prototype,"toString",{value(){return`${i}({ ${kN(n).map(e=>`${kz(e)}: ${kj(this[e])}`).join(", ")} })`},configurable:!0}),x},DG=PN(Dt({_tag:Py("None")}).annotations({identifier:"FiberIdNoneEncoded"}),Dt({_tag:Py("Runtime"),id:DI,startTimeMillis:DI}).annotations({identifier:"FiberIdRuntimeEncoded"}),Dt({_tag:Py("Composite"),left:Dp(()=>DG),right:Dp(()=>DG)}).annotations({identifier:"FiberIdCompositeEncoded"})).annotations({identifier:"FiberIdEncoded"}),DY=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(DZ),DQ=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${DQ(e.right)}, ${DQ(e.left)})`}},DZ=e=>{switch(e._tag){case"None":return aH;case"Runtime":return aK(e.id,e.startTimeMillis);case"Composite":return aW(DZ(e.left),DZ(e.right))}},DX=e=>Dt({_tag:Py("Die"),defect:e}),D0=Dt({_tag:Py("Empty")}),D1=e=>Dt({_tag:Py("Fail"),error:e}),D2=Dt({_tag:Py("Interrupt"),fiberId:DG}),D3=e=>Dt({_tag:Py("Parallel"),left:e,right:e}),D5=e=>Dt({_tag:Py("Sequential"),left:e,right:e}),D4=(e,t)=>{let r=Dp(()=>n),n=PN(D0,D1(e),DX(t),D2,D5(r),D3(r)).annotations({title:`CauseEncoded<${Ph(e)}>`});return n},D6=(e,t)=>r=>r.letrec(n=>({Empty:r.record({_tag:r.constant("Empty")}),Fail:r.record({_tag:r.constant("Fail"),error:e(r)}),Die:r.record({_tag:r.constant("Die"),defect:t(r)}),Interrupt:r.record({_tag:r.constant("Interrupt"),fiberId:DY(r)}),Sequential:r.record({_tag:r.constant("Sequential"),left:n("Cause"),right:n("Cause")}),Parallel:r.record({_tag:r.constant("Parallel"),left:n("Cause"),right:n("Cause")}),Cause:r.oneof(n("Empty"),n("Fail"),n("Die"),n("Interrupt"),n("Sequential"),n("Parallel"))})).Cause.map(Le),D8=e=>t=>{let r=t=>{switch(t._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(t.error)})`;case"Die":return`Cause.die(${cause_.pretty(t)})`;case"Interrupt":return`Cause.interrupt(${DQ(t.fiberId)})`;case"Sequential":return`Cause.sequential(${r(t.left)}, ${r(t.right)})`;case"Parallel":return`Cause.parallel(${r(t.left)}, ${r(t.right)})`}};return r(t)},D7=e=>(t,r,n)=>cause_.isCause(t)?DF(e(function e(t){switch(t._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:t.error};case"Die":return{_tag:"Die",defect:t.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:t.fiberId};case"Sequential":return{_tag:"Sequential",left:e(t.left),right:e(t.right)};case"Parallel":return{_tag:"Parallel",left:e(t.left),right:e(t.right)}}}(t),r),Le,n,t):ParseResult.fail(new ParseResult.Type(n,t)),D9=({defect:e,error:t})=>PS([t,e],{decode:(e,t)=>D7(ParseResult.decodeUnknown(D4(e,t))),encode:(e,t)=>D7(ParseResult.encodeUnknown(D4(e,t)))},{title:`Cause<${t.ast}>`,pretty:D8,arbitrary:D6});function Le(e){switch(e._tag){case"Empty":return cause_.empty;case"Fail":return cause_.fail(e.error);case"Die":return cause_.die(e.defect);case"Interrupt":return cause_.interrupt(DZ(e.fiberId));case"Sequential":return cause_.sequential(Le(e.left),Le(e.right));case"Parallel":return cause_.parallel(Le(e.left),Le(e.right))}}let Lt=(e,t)=>Dt({_tag:Py("Failure"),cause:D4(e,t)}),Lr=e=>Dt({_tag:Py("Success"),value:e}),Ln=e=>{switch(e._tag){case"Failure":return exit_.failCause(Le(e.cause));case"Success":return exit_.succeed(e.value)}},Li=(e,t,r)=>n=>n.oneof(n.record({_tag:n.constant("Failure"),cause:D6(t,r)(n)}),n.record({_tag:n.constant("Success"),value:e(n)})).map(Ln),Ls=(e,t)=>r=>"Failure"===r._tag?`Exit.failCause(${D8(t)(r.cause)})`:`Exit.succeed(${e(r.value)})`,La=(e,t)=>(r,n,i)=>exit_.isExit(r)?exit_.match(r,{onFailure:e=>DF(t(e,n),exit_.failCause,i,r),onSuccess:t=>DF(e(t,n),exit_.succeed,i,r)}):ParseResult.fail(new ParseResult.Type(i,r)),Lo=Symbol.for("@effect/platform/Headers"),Ll=Object.assign(Object.create(null),{[Lo]:Lo,[eB](e){return Lg(this,fR(e,Lb))}}),Lc=e=>Object.assign(Object.create(Ll),e),Lu=Object.create(Ll),Lh=e=>{if(void 0===e)return Lu;if(Symbol.iterator in e){let t=Object.create(Ll);for(let[r,n]of e)t[r.toLowerCase()]=n;return t}let t=Object.create(Ll);for(let[r,n]of Object.entries(e))Array.isArray(n)?t[r.toLowerCase()]=n.join(", "):void 0!==n&&(t[r.toLowerCase()]=n);return t},Lp=e=>Object.setPrototypeOf(e,Ll),Lf=R(3,(e,t,r)=>{let n=Lc(e);return n[t.toLowerCase()]=r,n}),Ld=R(2,(e,t)=>Lc({...e,...Lh(t)})),Lm=R(2,(e,t)=>{let r=Lc(e);return delete r[t.toLowerCase()],r}),Lg=R(2,(e,t)=>{let r={...e},n=t=>{if("string"==typeof t){let n=t.toLowerCase();n in e&&(r[n]=zm(e[n]))}else for(let n in e)t.test(n)&&(r[n]=zm(e[n]))};if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else n(t);return r}),Lb=$("@effect/platform/Headers/currentRedactedNames",()=>ud(["authorization","cookie","set-cookie","x-api-key"]));function Lx(e){if(Array.isArray(e))return e.map(Lx).join("");switch(typeof e){case"string":return e;case"number":case"bigint":return e.toString();case"boolean":return e?"true":"false";default:return""}}let Ly=e=>{let t=Symbol.iterator in e?rc(e):Object.entries(e),r=[];for(let[e,n]of t)if(Array.isArray(n))for(let t=0;t<n.length;t++)void 0!==n[t]&&r.push([e,String(n[t])]);else void 0!==n&&r.push([e,String(n)]);return r},Lv=((e,t,r)=>rd(rY(e,([e])=>e!==t),[t,String(r)]),R(2,(e,t)=>{let r=Ly(t),n=r.map(([e])=>e);return rm(rY(e,([e])=>n.includes(e)),r)})),L_=R(3,(e,t,r)=>rd(e,[t,String(r)])),LS=((e,t)=>rm(e,Ly(t)),(e,t,r)=>{try{let n=new URL(e,Lw());for(let e=0;e<t.length;e++){let[r,i]=t[e];void 0!==i&&n.searchParams.append(r,i)}return"Some"===r._tag&&(n.hash=r.value),tI(n)}catch(e){return tO(e)}}),Lw=()=>{if("location"in globalThis&&void 0!==globalThis.location&&void 0!==globalThis.location.origin&&void 0!==globalThis.location.pathname)return location.origin+location.pathname},Lk=(e,t,r)=>FQ(FX(mO(()=>cB)),n=>z(FX(cU(cD(e,e=>mF(n,t=>r(e,t))))),FQ(t),FW(e=>cp(mI(n),t=>t(e))))),LC=sB("@effect/platform/FileSystem"),LE=e=>"bigint"==typeof e?e:BigInt(e),LO=Symbol.for("@effect/platform/HttpBody"),LI=Symbol.for("@effect/platform/HttpBody/HttpBodyError"),LF=(g="HttpBodyError",e=>{let t=void 0===e?Object.create(ts):oc(e);return t._tag=g,t}),LR=e=>LF({[LI]:LI,reason:e});class LT{[LO];constructor(){this[LO]=LO}[ez](){return this.toJSON()}toString(){return eD(this)}}class LN extends LT{_tag="Empty";toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}let LA=new LN;class LM extends LT{body;contentType;_tag="Uint8Array";constructor(e,t){super(),this.body=e,this.contentType=t}get contentLength(){return this.body.length}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Uint8Array",body:this.contentType.startsWith("text/")||this.contentType.endsWith("json")?new TextDecoder().decode(this.body):`Uint8Array(${this.body.length})`,contentType:this.contentType,contentLength:this.contentLength}}}let Lj=(e,t)=>new LM(e,t??"application/octet-stream"),Lz=new TextEncoder,LP=(e,t)=>Lj(Lz.encode(e),t??"text/plain"),LD=e=>LP(JSON.stringify(e),"application/json"),LL=e=>gh({try:()=>LD(e),catch:e=>LR({_tag:"JsonError",error:e})});class L$ extends LT{stream;contentType;contentLength;_tag="Stream";constructor(e,t,r){super(),this.stream=e,this.contentType=t,this.contentLength=r}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Stream",contentType:this.contentType,contentLength:this.contentLength}}}let LU=Symbol.for("@effect/platform/HttpServerResponse"),Lq=Symbol.for("@effect/platform/HttpServerRespondable");class LB extends ff{status;statusText;cookies;body;[LU];headers;constructor(e,t,r,n,i){if(super(),this.status=e,this.statusText=t,this.cookies=n,this.body=i,this[LU]=LU,i.contentType||i.contentLength){let e={...r};i.contentType&&(e["content-type"]=i.contentType),i.contentLength&&(e["content-length"]=i.contentLength.toString()),this.headers=e}else this.headers=r}commit(){return cj(this)}[Lq](){return cj(this)}[ez](){return this.toJSON()}toString(){return eD(this)}toJSON(){return{_id:"@effect/platform/HttpServerResponse",status:this.status,statusText:this.statusText,headers:eW(this.headers),cookies:this.cookies.toJSON(),body:this.body.toJSON()}}}let LJ=e=>"object"==typeof e&&null!==e&&LU in e,LH=e=>new LB(e?.status??204,e?.statusText,e?.headers?Lh(e.headers):Lu,e?.cookies??ze,LA),LK=R(3,(e,t,r)=>new LB(e.status,e.statusText,Lf(e.headers,t,r),e.cookies,e.body)),LW=(e,t)=>cE(LL(e),e=>new LB(t?.status??200,t?.statusText,t?.headers?Lh(t.headers):Lu,t?.cookies??ze,e)),LV=(e,t)=>{let r=new globalThis.Headers(e.headers);if(!zt(e.cookies))for(let t of zl(e.cookies))r.append("set-cookie",t);if(t?.withoutBody)return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});let n=e.body;switch(n._tag){case"Empty":return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});case"Uint8Array":case"Raw":return new Response(n.body,{status:e.status,statusText:e.statusText,headers:r});case"FormData":return new Response(n.formData,{status:e.status,statusText:e.statusText,headers:r});case"Stream":return new Response(jP(n.stream,t?.runtime??S5),{status:e.status,statusText:e.statusText,headers:r})}},LG=Symbol.for("@effect/platform/HttpServerRespondable"),LY=e=>X(e,LG),LQ=LH({status:400}),LZ=LH({status:404}),LX=e=>LJ(e)?cj(e):cN(e[LG]()),L0=(e,t)=>LJ(e)?cj(e):LY(e)?l6(e[LG](),()=>cj(t)):EZ(e)?cj(LQ):vq(e)?cj(LZ):cj(t),L1=Symbol.for("@effect/platform/HttpServerError"),L2=$("@effect/platform/HttpServerError/clientAbortFiberId",()=>aK(-499,0)),L3=e=>{let t;let r=se(e,e=>LJ(e)?(t=e,ty(iJ)):tU());return[t??L5,r]},L5=LH({status:500}),L4=LH({status:499}),L6=LH({status:503}),L8=L1;class L7 extends kR(L8,"RequestError"){[LG](){return LH({status:400})}get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class L9 extends kR(L8,"RouteNotFound"){constructor(e){super(e),this.stack=`${this.name}: ${this.message}`}[LG](){return LH({status:404})}get message(){return`${this.request.method} ${this.request.url} not found`}}let $e=e=>{let[t,r]=sp(e,[cj(L5),iJ],(e,t)=>{switch(t._tag){case"Empty":return ty(e);case"Fail":return ty([L0(t.error,L5),t]);case"Die":return ty([L0(t.defect,L5),t]);case"Interrupt":if("Empty"!==e[1]._tag)return tU();return ty([cj(t.fiberId===L2?L4:L6),t]);default:return tU()}});return cE(t,e=>vL(r)?[e,iK(e)]:[e,iG(r,iK(e))])},$t=e=>"Success"===e._tag?e.value:L3(e.cause)[0],$r=Symbol.for("@effect/platform/HttpIncomingMessage"),$n=(e,t)=>{let r=Pd(e,t);return e=>cp(e.json,r)},$i=(e,t)=>{let r=Pd(e,t);return e=>r(e.headers)},$s=$("@effect/platform/HttpIncomingMessage/maxBodySize",()=>ud(tU())),$a=(e,t)=>{let r;let n=e.headers["content-type"]??"";if(n.includes("application/json"))try{r=S7(e.json)}catch(e){}else if(n.includes("text/")||n.includes("urlencoded"))try{r=S7(e.text)}catch(e){}let i={...t,headers:eW(e.headers),remoteAddress:e.remoteAddress.toJSON()};return void 0!==r&&(i.body=r),i},$o=Symbol.for("effect/Mailbox"),$l=Symbol.for("effect/Mailbox/ReadonlyMailbox"),$c=nt(),$u=hu($c),$h=hu(!1),$p=hu(!0),$f=[$c,!0];class $d extends fp{scheduler;capacity;strategy;[$o]=$o;[$l]=$l;state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set};messages=[];messagesChunk=nt();constructor(e,t,r){super(),this.scheduler=e,this.capacity=t,this.strategy=r}offer(e){return cz(()=>{if("Open"!==this.state._tag)return $h;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return $h;case"suspend":if(this.capacity<=0&&this.state.takers.size>0)return this.messages.push(e),this.releaseTaker(),$p;return this.offerRemainingSingle(e);case"sliding":return this.unsafeTake(),this.messages.push(e),$p}return this.messages.push(e),this.scheduleReleaseTaker(),$p})}unsafeOffer(e){return"Open"===this.state._tag&&(this.messages.length+this.messagesChunk.length>=this.capacity?"sliding"===this.strategy?(this.unsafeTake(),this.messages.push(e),!0):this.capacity<=0&&this.state.takers.size>0&&(this.messages.push(e),this.releaseTaker(),!0):(this.messages.push(e),this.scheduleReleaseTaker(),!0))}offerAll(e){return cz(()=>{if("Open"!==this.state._tag)return cj(ni(e));let t=this.unsafeOfferAllArray(e);return 0===t.length?$u:"dropping"===this.strategy?cj(nc(t)):this.offerRemainingArray(t)})}unsafeOfferAll(e){return nc(this.unsafeOfferAllArray(e))}unsafeOfferAllArray(e){if("Open"!==this.state._tag)return rc(e);if(this.capacity===Number.POSITIVE_INFINITY||"sliding"===this.strategy)return this.messages.length>0&&(this.messagesChunk=nb(this.messagesChunk,nc(this.messages))),"sliding"===this.strategy?this.messagesChunk=this.messagesChunk.pipe(nb(ni(e)),nN(this.capacity)):r9(e)?this.messagesChunk=nb(this.messagesChunk,e):this.messages=rc(e),this.scheduleReleaseTaker(),[];let t=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(0===t)return rc(e);let r=[],n=0;for(let i of e)n<t?this.messages.push(i):r.push(i),n++;return this.scheduleReleaseTaker(),r}fail(e){return this.done(hr(e))}failCause(e){return this.done(hn(e))}unsafeDone(e){return"Open"===this.state._tag&&(0===this.state.offers.size&&0===this.messages.length&&0===this.messagesChunk.length?this.finalize(e):this.state={...this.state,_tag:"Closing",exit:e},!0)}shutdown=cP(()=>{if("Done"===this.state._tag)return!0;this.messages=[],this.messagesChunk=$c;let e=this.state.offers;if(this.finalize("Open"===this.state._tag?hh:this.state.exit),e.size>0){for(let t of e)"Single"===t._tag?t.resume($h):t.resume(hu(nc(t.remaining.slice(t.offset))));e.clear()}return!0});done(e){return cP(()=>this.unsafeDone(e))}end=this.done(hh);clear=cz(()=>{if("Done"===this.state._tag)return u7(this.state.exit,$c);let e=this.unsafeTakeAll();return this.releaseCapacity(),cj(e)});takeAll=cz(()=>{if("Done"===this.state._tag)return u7(this.state.exit,$f);let e=this.unsafeTakeAll();return 0===e.length?cZ(this.awaitTake,this.takeAll):cj([e,this.releaseCapacity()])});takeN(e){return cz(()=>{let t;if("Done"===this.state._tag)return u7(this.state.exit,$f);if(e<=0)return cj([$c,!1]);if((e=Math.min(e,this.capacity))<=this.messagesChunk.length)t=nd(this.messagesChunk,e),this.messagesChunk=nm(this.messagesChunk,e);else{if(!(e<=this.messages.length+this.messagesChunk.length))return cZ(this.awaitTake,this.takeN(e));this.messagesChunk=nb(this.messagesChunk,nc(this.messages)),this.messages=[],t=nd(this.messagesChunk,e),this.messagesChunk=nm(this.messagesChunk,e)}return cj([t,this.releaseCapacity()])})}unsafeTake(){let e;if("Done"===this.state._tag)return hf(this.state.exit,hr(new uX));if(this.messagesChunk.length>0)e=nE(this.messagesChunk),this.messagesChunk=nm(this.messagesChunk,1);else if(this.messages.length>0)e=this.messages[0],this.messagesChunk=nm(nc(this.messages),1),this.messages=[];else if(this.capacity<=0&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?hu(this.messages.pop()):void 0;else return;return this.releaseCapacity(),hu(e)}take=cz(()=>this.unsafeTake()??cZ(this.awaitTake,this.take));await=l5(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.awaiters.add(e),cP(()=>{"Done"!==this.state._tag&&this.state.awaiters.delete(e)})));unsafeSize(){let e=this.messages.length+this.messagesChunk.length;return"Done"===this.state._tag?tU():ty(e)}size=cP(()=>this.unsafeSize());commit(){return this.takeAll}pipe(){return eV(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return eD(this)}[ez](){return eD(this)}offerRemainingSingle(e){return l5(t=>{if("Open"!==this.state._tag)return t($h);let r={_tag:"Single",message:e,resume:t};return this.state.offers.add(r),cP(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}offerRemainingArray(e){return l5(t=>{if("Open"!==this.state._tag)return t(hu(nc(e)));let r={_tag:"Array",remaining:e,offset:0,resume:t};return this.state.offers.add(r),cP(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}releaseCapacity(){if("Done"===this.state._tag)return"Success"===this.state.exit._tag;if(0===this.state.offers.size)return"Closing"===this.state._tag&&0===this.messages.length&&0===this.messagesChunk.length&&(this.finalize(this.state.exit),"Success"===this.state.exit._tag);let e=this.capacity-this.messages.length-this.messagesChunk.length;for(let t of this.state.offers){if(0===e)break;if("Single"===t._tag)this.messages.push(t.message),e--,t.resume($p),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(0===e)return!1;this.messages.push(t.remaining[t.offset]),e--}t.resume($u),this.state.offers.delete(t)}}return!1}awaitTake=l5(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.takers.add(e),cP(()=>{"Done"!==this.state._tag&&this.state.takers.delete(e)})));scheduleRunning=!1;scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}releaseTaker=()=>{if(this.scheduleRunning=!1,"Done"===this.state._tag||0===this.state.takers.size)return;let e=t5(this.state.takers);this.state.takers.delete(e),e(hh)};unsafeTakeAll(){if(this.messagesChunk.length>0){let e=this.messages.length>0?nb(this.messagesChunk,nc(this.messages)):this.messagesChunk;return this.messagesChunk=$c,this.messages=[],e}if(this.messages.length>0){let e=nc(this.messages);return this.messages=[],e}return"Done"!==this.state._tag&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,nn(this.messages.pop())):$c}finalize(e){if("Done"===this.state._tag)return;let t=this.state;for(let r of(this.state={_tag:"Done",exit:e},t.takers))r(e);for(let r of(t.takers.clear(),t.awaiters))r(e);t.awaiters.clear()}}let $m=e=>lZ(t=>cj(new $d(t.currentScheduler,"number"==typeof e?e:e?.capacity??Number.POSITIVE_INFINITY,"number"==typeof e?"suspend":e?.strategy??"suspend"))),$g=((e,t)=>cq(r=>cb(r(e),{onFailure:e=>t.failCause(e),onSuccess:e=>t.end})),/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu),$b=/\\([\v\u0020-\u00ff])/gu,$x=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,$y=/^[!#$%&'*+.^\w|~-]+$/u,$v={value:"",parameters:Object.create(null)};function $_(e,t=!1){let r,n,i;if("string"!=typeof e)return $v;let s=e.indexOf(";"),a=-1!==s?e.slice(0,s).trim():e.trim();if(!1===(t?$y:$x).test(a))return $v;let o={value:a.toLowerCase(),parameters:Object.create(null)};if(-1===s)return o;for($g.lastIndex=s;n=$g.exec(e);){if(n.index!==s)return $v;s+=n[0].length,r=n[1].toLowerCase(),'"'===(i=n[2])[0]&&(i=i.slice(1,i.length-1),!t&&$b.test(i)&&(i=i.replace($b,"$1"))),o.parameters[r]=i}return s!==e.length?$v:o}!function(e){e[e.key=0]="key",e[e.whitespace=1]="whitespace",e[e.value=2]="value"}(w||(w={}));let $S={_tag:"Continue"},$w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],$k=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];!function(e){e[e.headers=0]="headers",e[e.body=1]="body"}(k||(k={}));let $C={_tag:"InvalidDisposition"},$E={_tag:"EndNotReached"},$O={_tag:"ReachedLimit",limit:"MaxParts"},$I={_tag:"ReachedLimit",limit:"MaxTotalSize"},$F={_tag:"ReachedLimit",limit:"MaxPartSize"},$R={_tag:"ReachedLimit",limit:"MaxFieldSize"},$T=new TextEncoder().encode("\r\n");function $N(e){return void 0!==e.filename||"application/octet-stream"===e.contentType}function $A(e){}let $M=new TextDecoder("utf-8"),$j=function({headers:e,onFile:t,onField:r,onError:n,onDone:i,isFile:s=$N,maxParts:a=1/0,maxTotalSize:o=1/0,maxPartSize:l=1/0,maxFieldSize:c=1048576}){let u=$_(e["content-type"]).parameters.boundary;if(void 0===u)return n({_tag:"InvalidBoundary"}),{write:$A,end(){}};let h={state:k.headers,index:0,parts:0,onChunk:$A,info:void 0,headerSkip:0,partSize:0,totalSize:0,isFile:!1,fieldChunks:[],fieldSize:0};function p(){h.state=k.body,h.isFile=!0,h.onChunk=$A}let f=function(){let e=new TextDecoder,t={state:w.key,headers:Object.create(null),key:"",value:void 0,crlf:0,previousChunk:void 0,pairs:0,size:0};function r(e){return t.state=w.key,t.headers=Object.create(null),t.key="",t.value=void 0,t.crlf=0,t.previousChunk=void 0,t.pairs=0,t.size=0,e}function n(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function i(e){return r({_tag:"Failure",reason:e,headers:t.headers})}return function(s,a){let o,l=0;if(void 0!==t.previousChunk){o=l=t.previousChunk.length;let e=new Uint8Array(s.length+l);e.set(t.previousChunk),e.set(s,l),t.previousChunk=void 0,s=e}let c=s.length;e:for(;a<c;){if(t.state===w.key){let r=a;for(;r<c;r++){if(t.size++>16384)return i("HeaderTooLarge");if(58===s[r]){if(t.key+=e.decode(s.subarray(a,r)).toLowerCase(),0===t.key.length)return i("InvalidHeaderName");32===s[r+1]&&32!==s[r+2]&&9!==s[r+2]?(a=r+2,t.state=w.value,t.size++):32!==s[r+1]&&9!==s[r+1]?(a=r+1,t.state=w.value):(a=r+1,t.state=w.whitespace);break}if(1!==$w[s[r]])return i("InvalidHeaderName")}if(r===c)return t.key+=e.decode(s.subarray(a,c)).toLowerCase(),$S}if(t.state===w.whitespace){for(;a<c;a++){if(t.size++>16384)return i("HeaderTooLarge");if(32!==s[a]&&9!==s[a]){t.state=w.value;break}}if(a===c)return $S}if(t.state===w.value){let u=a;for(void 0!==o&&(u=o,o=void 0);u<c;u++){if(t.size++>16384)return i("HeaderTooLarge");if(13===s[u]||t.crlf>0){let o=s[u];if(13===o&&0===t.crlf&&(t.crlf=1,u++,t.size++,o=s[u]),10===o&&1===t.crlf&&(t.crlf=2,u++,t.size++,o=s[u]),13===o&&2===t.crlf&&(t.crlf=3,u++,t.size++,o=s[u]),10===o&&3===t.crlf&&(t.crlf=4,u++,t.size++),t.crlf<4&&u>=c)return t.previousChunk=s.subarray(a),$S;if(t.crlf>=2){t.value=void 0===t.value?s.subarray(a,u-t.crlf):n(t.value,s.subarray(a,u-t.crlf));let o=e.decode(t.value);if(void 0===t.headers[t.key]?t.headers[t.key]=o:"string"==typeof t.headers[t.key]?t.headers[t.key]=[t.headers[t.key],o]:t.headers[t.key].push(o),a=u,t.size--,4!==t.crlf&&100===t.pairs)return i("TooManyHeaders");if(3===t.crlf)return i("InvalidHeaderValue");if(4===t.crlf)return r({_tag:"Headers",headers:t.headers,endPosition:a-l});t.pairs++,t.key="",t.value=void 0,t.crlf=0,t.state=w.key;continue e}}else if(1!==$k[s[u]])return i("InvalidHeaderValue")}if(u===c)return t.value=void 0===t.value?s.subarray(a,c):n(t.value,s.subarray(a,c)),$S}}return a>c&&(t.size+=c-a),$S}}(),d=function(e,t,r){let n=function(e){let t=new TextEncoder().encode(e),r=t.length,n={};for(let e=0;e<r;e++){let r=t[e];void 0===n[r]&&(n[r]=[]),n[r].push(e)}return{needle:t,needleLength:r,indexes:n,firstByte:t[0],previousChunk:void 0,previousChunkLength:0,matchIndex:0}}(e);void 0!==r&&(n.previousChunk=r,n.previousChunkLength=r.length);let i=function(){if("Buffer"in globalThis&&!("Bun"in globalThis||"Deno"in globalThis))return function(e,t,r){return Buffer.prototype.indexOf.call(e,t,r)};let e=new Uint8Array(256).fill(n.needle.length);for(let t=0,r=n.needle.length-1;t<r;++t)e[n.needle[t]]=r-t;return function(t,r,i){let s=t.length,a=i+n.needleLength-1;for(;a<s;){for(let e=n.needleLength-1,i=a;e>=0&&t[i]===r[e];e--,i--)if(0===e)return i;a+=e[t[a]]}return -1}}();return{write:function(e){let r=e.length;if(void 0!==n.previousChunk){let t=new Uint8Array(n.previousChunkLength+r);t.set(n.previousChunk),t.set(e,n.previousChunkLength),e=t,r=n.previousChunkLength+r,n.previousChunk=void 0}if(r<n.needleLength){n.previousChunk=e,n.previousChunkLength=r;return}let s=0;for(;s<r;){let a=i(e,n.needle,s);if(a>-1){a>s&&t(n.matchIndex,e.subarray(s,a)),n.matchIndex+=1,s=a+n.needleLength;continue}if(e[r-1]in n.indexes){let i=n.indexes[e[r-1]],a=-1;for(let t=0,s=i.length;t<s;t++){let s=i[t];e[r-1-s]===n.firstByte&&t>a&&(a=s)}-1===a?0===s?t(n.matchIndex,e):t(n.matchIndex,e.subarray(s)):(r-1-a>s&&t(n.matchIndex,e.subarray(s,r-1-a)),n.previousChunk=e.subarray(r-1-a),n.previousChunkLength=a+1)}else 0===s?t(n.matchIndex,e):t(n.matchIndex,e.subarray(s));break}},end:function(){void 0!==n.previousChunk&&n.previousChunk!==r&&t(n.matchIndex,n.previousChunk),n.previousChunk=r,n.previousChunkLength=r?.length??0,n.matchIndex=0}}}(`\r
--${u}`,function(e,o){if(0===e){p();return}if(e!==h.index){if(h.index>0){if(h.isFile)h.onChunk(null),h.partSize=0;else{if(1===h.fieldChunks.length)r(h.info,h.fieldChunks[0]);else{let e=new Uint8Array(h.fieldSize),t=0;for(let r=0;r<h.fieldChunks.length;r++){let n=h.fieldChunks[r];e.set(n,t),t+=n.length}r(h.info,e)}h.fieldSize=0,h.fieldChunks=[]}}if(h.state=k.headers,h.index=e,h.headerSkip=2,45===o[0]&&45===o[1])return i();h.parts++,h.parts>a&&n($O)}if((h.partSize+=o.length)>l&&n($F),h.state===k.headers){let e;let r=f(o,h.headerSkip);if(h.headerSkip=0,"Continue"===r._tag)return;if("Failure"===r._tag)return p(),n({_tag:"BadHeaders",error:r});let i=$_(r.headers["content-type"]),a=$_(r.headers["content-disposition"],!0);if("form-data"===a.value&&!("name"in a.parameters))return p(),n($C);if("filename*"in a.parameters){let t=a.parameters["filename*"].split("''");2===t.length&&(e=decodeURIComponent(t[1]))}if(h.info={name:a.parameters.name??"",filename:e??a.parameters.filename,contentType:""===i.value?void 0!==a.parameters.filename?"application/octet-stream":"text/plain":i.value,contentTypeParameters:i.parameters,contentDisposition:a.value,contentDispositionParameters:a.parameters,headers:r.headers},h.state=k.body,h.isFile=s(h.info),h.isFile&&(h.onChunk=t(h.info)),r.endPosition<o.length){if(h.isFile)h.onChunk(o.subarray(r.endPosition));else{let e=o.subarray(r.endPosition);(h.fieldSize+=e.length)>c&&n($R),h.fieldChunks.push(e)}}}else h.isFile?h.onChunk(o):((h.fieldSize+=o.length)>c&&n($R),h.fieldChunks.push(o))},$T);return{write:e=>(h.totalSize+=e.length)>o?n($I):d.write(e),end(){d.end(),h.state===k.body&&n($E),h.state=k.headers,h.index=0,h.parts=0,h.onChunk=$A,h.info=void 0,h.totalSize=0,h.partSize=0,h.fieldChunks=[],h.fieldSize=0}}},$z=Symbol.for("@effect/platform/Path"),$P=sB("@effect/platform/Path");function $D(e,t){let r,n="",i=0,s=-1,a=0;for(let o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(47===r)break;else r=47;if(47===r){if(s===o-1||1===a);else if(s!==o-1&&2===a){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2)){if(n.length>2){let e=n.lastIndexOf("/");if(e!==n.length-1){-1===e?(n="",i=0):i=(n=n.slice(0,e)).length-1-n.lastIndexOf("/"),s=o,a=0;continue}}else if(2===n.length||1===n.length){n="",i=0,s=o,a=0;continue}}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(s+1,o):n=e.slice(s+1,o),i=o-s-1;s=o,a=0}else 46===r&&-1!==a?++a:a=-1}return n}let $L=function(){let e,t="",r=!1;for(let n=arguments.length-1;n>=-1&&!r;n--){let i;if(n>=0)i=arguments[n];else{let t=globalThis.process;void 0===e&&"process"in globalThis&&"object"==typeof t&&null!==t&&"function"==typeof t.cwd&&(e=t.cwd()),i=e}0!==i.length&&(t=i+"/"+t,r=47===i.charCodeAt(0))}return(t=$D(t,!r),r)?t.length>0?"/"+t:"/":t.length>0?t:"."},$$=/%/g,$U=/\\/g,$q=/\n/g,$B=/\r/g,$J=/\t/g,$H=$P.of({[$z]:$z,resolve:$L,normalize(e){if(0===e.length)return".";let t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return(0!==(e=$D(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t)?"/"+e:e},isAbsolute:e=>e.length>0&&47===e.charCodeAt(0),join(){let e;if(0==arguments.length)return".";for(let t=0;t<arguments.length;++t){let r=arguments[t];r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":$H.normalize(e)},relative(e,t){if(e===t||(e=$H.resolve(e),t=$H.resolve(t),e===t))return"";let r=1;for(;r<e.length&&47===e.charCodeAt(r);++r);let n=e.length,i=n-r,s=1;for(;s<t.length&&47===t.charCodeAt(s);++s);let a=t.length-s,o=i<a?i:a,l=-1,c=0;for(;c<=o;++c){if(c===o){if(a>o){if(47===t.charCodeAt(s+c))return t.slice(s+c+1);if(0===c)return t.slice(s+c)}else i>o&&(47===e.charCodeAt(r+c)?l=c:0===c&&(l=0));break}let n=e.charCodeAt(r+c);if(n!==t.charCodeAt(s+c))break;47===n&&(l=c)}let u="";for(c=r+l+1;c<=n;++c)(c===n||47===e.charCodeAt(c))&&(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(s+l):(s+=l,47===t.charCodeAt(s)&&++s,t.slice(s))},dirname(e){if(0===e.length)return".";let t=e.charCodeAt(0),r=47===t,n=-1,i=!0;for(let r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!i){n=r;break}}else i=!1;return -1===n?r?"/":".":r&&1===n?"//":e.slice(0,n)},basename(e,t){let r,n=0,i=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,o=-1;for(r=e.length-1;r>=0;--r){let l=e.charCodeAt(r);if(47===l){if(!s){n=r+1;break}}else -1===o&&(s=!1,o=r+1),a>=0&&(l===t.charCodeAt(a)?-1==--a&&(i=r):(a=-1,i=o))}return n===i?i=o:-1===i&&(i=e.length),e.slice(n,i)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!s){n=r+1;break}}else -1===i&&(s=!1,i=r+1);return -1===i?"":e.slice(n,i)},extname(e){let t=-1,r=0,n=-1,i=!0,s=0;for(let a=e.length-1;a>=0;--a){let o=e.charCodeAt(a);if(47===o){if(!i){r=a+1;break}continue}-1===n&&(i=!1,n=a+1),46===o?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1)}return -1===t||-1===n||0===s||1===s&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){let r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+"/"+n:n}(0,e)},parse(e){let t;let r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;let n=e.charCodeAt(0),i=47===n;i?(r.root="/",t=1):t=0;let s=-1,a=0,o=-1,l=!0,c=e.length-1,u=0;for(;c>=t;--c){if(47===(n=e.charCodeAt(c))){if(!l){a=c+1;break}continue}-1===o&&(l=!1,o=c+1),46===n?-1===s?s=c:1!==u&&(u=1):-1!==s&&(u=-1)}return -1===s||-1===o||0===u||1===u&&s===o-1&&s===a+1?-1!==o&&(0===a&&i?r.base=r.name=e.slice(1,o):r.base=r.name=e.slice(a,o)):(0===a&&i?(r.name=e.slice(1,s),r.base=e.slice(1,o)):(r.name=e.slice(a,s),r.base=e.slice(a,o)),r.ext=e.slice(s,o)),a>0?r.dir=e.slice(0,a-1):i&&(r.dir="/"),r},sep:"/",fromFileUrl:function(e){if("file:"!==e.protocol)return ca(kF({module:"Path",method:"fromFileUrl",message:"URL must be of scheme file"}));if(""!==e.hostname)return ca(kF({module:"Path",method:"fromFileUrl",message:"Invalid file URL host"}));let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let r=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===r)return ca(kF({module:"Path",method:"fromFileUrl",message:"must not include encoded / characters"}))}return cj(decodeURIComponent(t))},toFileUrl:function(e){var t;let r=new URL("file://"),n=$L(e);return 47===e.charCodeAt(e.length-1)&&"/"!==n[n.length-1]&&(n+="/"),r.pathname=((t=n).includes("%")&&(t=t.replace($$,"%25")),t.includes("\\")&&(t=t.replace($U,"%5C")),t.includes("\n")&&(t=t.replace($q,"%0A")),t.includes("\r")&&(t=t.replace($B,"%0D")),t.includes("	")&&(t=t.replace($J,"%09")),t),cj(r)},toNamespacedPath:T}),$K=Symbol.for("@effect/platform/Multipart"),$W=Symbol.for("@effect/platform/Multipart/MultipartError");class $V extends kR($W,"MultipartError"){get message(){return this.reason}}let $G=$("@effect/platform/Multipart/maxParts",()=>ud(tU())),$Y=$("@effect/platform/Multipart/maxFieldSize",()=>ud(LE(10485760))),$Q=$("@effect/platform/Multipart/maxFileSize",()=>ud(tU())),$Z=$("@effect/platform/Multipart/fieldMimeTypes",()=>ud(nr("application/json"))),$X=e=>lZ(t=>{let r=t.getFiberRef($Z);return cj({headers:e,maxParts:tW(t.getFiberRef($G)),maxFieldSize:Number(t.getFiberRef($Y)),maxPartSize:t.getFiberRef($Q).pipe(tY(Number),tW),maxTotalSize:t.getFiberRef($s).pipe(tY(Number),tW),isFile:0===r.length?void 0:e=>!nP(r,t=>e.contentType.includes(t))&&$N(e)})}),$0=e=>"Success"===e._tag?F7:FG(e.cause);class $1 extends e${[$K];constructor(){super(),this[$K]=$K}}class $2 extends $1{key;contentType;value;_tag="Field";constructor(e,t,r){super(),this.key=e,this.contentType=t,this.value=r}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"Field",key:this.key,contentType:this.contentType,value:this.value}}}class $3 extends $1{_tag="File";key;name;contentType;content;constructor(e,t){super(),this.key=e.name,this.name=e.filename??e.name,this.contentType=e.contentType,this.content=M3(t)}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"File",key:this.key,name:this.name,contentType:this.contentType}}}let $5=(e,t)=>cp(LC,r=>cI(j_(t.content,r.sink(e)),e=>new $V({reason:"InternalError",cause:e})));class $4 extends $1{key;name;contentType;path;_tag="PersistedFile";constructor(e,t,r,n){super(),this.key=e,this.name=t,this.contentType=r,this.path=n}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"PersistedFile",key:this.key,name:this.name,contentType:this.contentType,path:this.path}}}let $6=(e,t=16)=>Lk(ve([$X(e),$m(t)]),([e,t])=>{let r=[],n=tU(),i=$j({...e,onField(e,t){r.push(new $2(e.name,e.contentType,(function(e){if("utf-8"===e||"utf8"===e||""===e)return $M;try{return new TextDecoder(e)}catch(e){return $M}})(e.contentTypeParameters.charset??"utf-8").decode(t)))},onFile(e){let t=[],n=!1,i=F6(()=>{if(0===t.length)return n?F7:Tq(s,i);let e=nc(t);return t=[],n?F9(e):Tq(F9(e),Tq(s,i))});return r.push(new $3(e,i)),function(e){null===e?n=!0:t.push(e)}},onError(e){n=ty(hr(function(e){if("ReachedLimit"===e._tag)switch(e.limit){case"MaxParts":return new $V({reason:"TooManyParts",cause:e});case"MaxFieldSize":return new $V({reason:"FieldTooLarge",cause:e});case"MaxPartSize":return new $V({reason:"FileTooLarge",cause:e});case"MaxTotalSize":return new $V({reason:"BodyTooLarge",cause:e})}return new $V({reason:"Parse",cause:e})}(e)))},onDone(){n=ty(hh)}}),s=FQ(t.takeAll,([e,t])=>F8(()=>{n_(e,n_(i.write)),t&&i.end()})),a=FQ(s,()=>{if(0===r.length)return"None"===n._tag?a:$0(n.value);let e=nc(r);return r=[],Tq(F9(e),"None"===n._tag?a:$0(n.value))});return FK(a,{awaitRead:()=>cB,emit:e=>t.offer(e),error:e=>(n=ty(hn(e)),t.end),done:e=>t.end})},([,e])=>e.shutdown),$8=(e,t=$5)=>km(function*(){let r=yield*LC,n=yield*$P,i=yield*r.makeTempDirectoryScoped(),s=Object.create(null);return yield*jS(e,e=>{if("Field"===e._tag)return e.key in s?"string"==typeof s[e.key]?s[e.key]=[s[e.key],e.value]:s[e.key].push(e.value):s[e.key]=e.value,cB;if(""===e.name)return cB;let r=n.join(i,n.basename(e.name).slice(-128)),a=new $4(e.key,e.name,e.contentType,r);return Array.isArray(s[e.key])?s[e.key].push(a):s[e.key]=[a],t(r,e)}),s}).pipe(gd({SystemError:e=>ca(new $V({reason:"InternalError",cause:e})),BadArgument:e=>ca(new $V({reason:"InternalError",cause:e}))})),$7=Symbol.for("@effect/platform/HttpServerRequest"),$9=sB("@effect/platform/HttpServerRequest"),Ue=sB("@effect/platform/HttpServerRequest/ParsedSearchParams"),Ut=e=>{if("/"===e[0])return e;let t=e.indexOf("/",e.indexOf("//")+2);return -1===t?"/":e.slice(t)};class Ur extends e${source;url;headersOverride;remoteAddressOverride;[$7];[$r];constructor(e,t,r,n){super(),this.source=e,this.url=t,this.headersOverride=r,this.remoteAddressOverride=n,this[$7]=$7,this[$r]=$r}toJSON(){return $a(this,{_id:"@effect/platform/HttpServerRequest",method:this.method,url:this.originalUrl})}modify(e){return new Ur(this.source,e.url??this.url,e.headers??this.headersOverride,e.remoteAddress??this.remoteAddressOverride)}get method(){return this.source.method.toUpperCase()}get originalUrl(){return this.source.url}get remoteAddress(){return this.remoteAddressOverride?ty(this.remoteAddressOverride):tU()}get headers(){return this.headersOverride??=Lh(this.source.headers),this.headersOverride}cachedCookies;get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=function(e){let t={},r=e.length,n=0,i=0;for(;i!==r;){-1===(i=e.indexOf(";",n))&&(i=r);let s=e.indexOf("=",n);if(-1===s)break;if(s>i){n=i+1;continue}let a=e.substring(n,s++).trim();if(void 0===t[a]){let r=34===e.charCodeAt(s)?e.substring(s+1,i-1).trim():e.substring(s,i).trim();t[a]=-1!==r.indexOf("%")?zc(r):r}n=i+1}return t}(this.headers.cookie??"")}get stream(){return this.source.body?jX(()=>this.source.body,e=>new L7({request:this,reason:"Decode",cause:e})):MW(new L7({request:this,reason:"Decode",description:"can not create stream from empty body"}))}textEffect;get text(){return this.textEffect||(this.textEffect=S7(kd(gq({try:()=>this.source.text(),catch:e=>new L7({request:this,reason:"Decode",cause:e})})))),this.textEffect}get json(){return gB(this.text,{try:e=>JSON.parse(e),catch:e=>new L7({request:this,reason:"Decode",cause:e})})}get urlParamsBody(){return cp(this.text,e=>gh({try:()=>Ly(new URLSearchParams(e)),catch:e=>new L7({request:this,reason:"Decode",cause:e})}))}multipartEffect;get multipart(){return this.multipartEffect||(this.multipartEffect=S7(kd($8(this.multipartStream)))),this.multipartEffect}get multipartStream(){return jp(jl(this.stream,e=>new $V({reason:"InternalError",cause:e})),$6(this.headers))}arrayBufferEffect;get arrayBuffer(){return this.arrayBuffer?this.arrayBuffer:(this.arrayBufferEffect=S7(kd(gq({try:()=>this.source.arrayBuffer(),catch:e=>new L7({request:this,reason:"Decode",cause:e})}))),this.arrayBufferEffect)}get upgrade(){return ca(new L7({request:this,reason:"Decode",description:"Not an upgradeable ServerRequest"}))}}let Un=(e,t)=>cp($9,$i(e,t)),Ui=(e,t)=>cp($9,$n(e,t)),Us=e=>new Ur(e,Ut(e.url)),Ua=e=>{let t=e.headers.host??"localhost",r="https"===e.headers["x-forwarded-proto"]?"https":"http";try{return ty(new URL(e.url,`${r}://${t}`))}catch(e){return tU()}},Uo=$(Symbol.for("@effect/platform/HttpApp/preResponseHandlers"),()=>ud(tU())),Ul=e=>Lp({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${"Some"===e.parent._tag?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),Uc=e=>{let t=Ud(e);return"Some"===t._tag||"Some"===(t=Uu(e))._tag?t:Uh(e)},Uu=e=>{if(!("b3"in e))return tU();let t=e.b3.split("-");return t.length<2?tU():ty(gn({traceId:t[0],spanId:t[1],sampled:!t[2]||"1"===t[2]}))},Uh=e=>e["x-b3-traceid"]&&e["x-b3-spanid"]?ty(gn({traceId:e["x-b3-traceid"],spanId:e["x-b3-spanid"],sampled:!e["x-b3-sampled"]||"1"===e["x-b3-sampled"]})):tU(),Up=/^[0-9a-f]{32}$/gi,Uf=/^[0-9a-f]{16}$/gi,Ud=e=>{if(!e.traceparent)return tU();let t=e.traceparent.split("-");if(4!==t.length)return tU();let[r,n,i,s]=t;return"00"===r?!1===Up.test(n)||!1===Uf.test(i)?tU():ty(gn({traceId:n,spanId:i,sampled:(1&parseInt(s,16))==1})):tU()},Um=$(Symbol.for("@effect/platform/HttpMiddleware/tracerDisabledWhen"),()=>ud(M)),Ug=e=>lZ(t=>{let r=s$(t.currentContext,$9);if(t.getFiberRef(Um)(r))return e;let n=tW(Ua(r));void 0!==n&&(""!==n.username||""!==n.password)&&(n.username="REDACTED",n.password="REDACTED");let i=t.getFiberRef(Lb),s=Lg(r.headers,i);return gY(`http.server ${r.method}`,{parent:tW(Uc(r.headers)),kind:"server",captureStackTrace:!1},t=>{for(let e in t.attribute("http.request.method",r.method),void 0!==n&&(t.attribute("url.full",n.toString()),t.attribute("url.path",n.pathname),""!==n.search.slice(1)&&t.attribute("url.query",n.search.slice(1)),t.attribute("url.scheme",n.protocol.slice(0,-1))),void 0!==r.headers["user-agent"]&&t.attribute("user_agent.original",r.headers["user-agent"]),s)t.attribute(`http.request.header.${e}`,String(s[e]));return"Some"===r.remoteAddress._tag&&t.attribute("client.address",r.remoteAddress.value),cp(cs(gQ(e,t)),e=>{let r=$t(e);t.attribute("http.response.status_code",r.status);let n=Lg(r.headers,i);for(let e in n)t.attribute(`http.response.header.${e}`,String(n[e]));return e})})}),Ub=Symbol.for("@effect/platform/HttpApp/handled"),Ux=(e,t,r)=>{let n=l6(lZ(r=>cp(e,e=>{let n=s$(r.currentContext,$9),i=r.getFiberRef(Uy);return"None"===i._tag?(n[Ub]=!0,l0(t(n,e),e)):cD(i.value(n,e),e=>(n[Ub]=!0,t(n,e)))})),e=>lZ(r=>cp($e(e),([e,n])=>{let i=s$(r.currentContext,$9),s=r.getFiberRef(Uy);return"None"===s._tag?(i[Ub]=!0,vy(t(i,e),cl(n))):vy(cD(s.value(i,e),e=>(i[Ub]=!0,t(i,e))),cl(n))})));return cU(ky(T(void 0===r?Ug(n):cb(r(Ug(n)),{onFailure:e=>lZ(r=>{let n=s$(r.currentContext,$9);return Ub in n?cB:cb($e(e),{onFailure:e=>t(n,LH({status:500})),onSuccess:([e])=>t(n,e)})}),onSuccess:e=>lZ(r=>{let n=s$(r.currentContext,$9);return Ub in n?cB:t(n,e)})}))))},Uy=Uo,Uv=e=>{let t=SU(e);return(r,n)=>{let i=Symbol.for("@effect/platform/HttpApp/resolve"),s=Ux(r,(t,r)=>(t[i](LV(r,{withoutBody:"HEAD"===t.method,runtime:e})),cB),n);return(r,n)=>new Promise(a=>{let o=new Map(n?[...e.context.unsafeMap,...n.unsafeMap]:e.context.unsafeMap),l=Us(r);o.set($9.key,l),l[i]=a;let c=t(up(s,uy,sR(o)));r.signal?.addEventListener("abort",()=>{c.unsafeInterruptAsFork(L2)},{once:!0})})}},U_=/\+/g,US=function(){};US.prototype=Object.create(null);let Uw=Array.from({length:256},(e,t)=>"%"+((t<16?"0":"")+t.toString(16)).toUpperCase()),Uk=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]),UC=/^https?:\/\/.*?\//,UE=/(\/:[^/()]*?)\?(\/?)/;class UO{constructor(e={}){this.options={ignoreTrailingSlash:!0,ignoreDuplicateSlashes:!0,caseSensitive:!1,maxParamLength:100,...e}}options;routes=[];trees={};on(e,t,r){let n=t.match(UE);if(n&&void 0!==n.index){UM(t.length===n.index+n[0].length,"Optional Parameter needs to be the last parameter of the path");let i=t.replace(UE,"$1$2"),s=t.replace(UE,"$2");this.on(e,i,r),this.on(e,s,r);return}for(let n of(this.options.ignoreDuplicateSlashes&&(t=Uj(t)),this.options.ignoreTrailingSlash&&(t=Uz(t)),"string"==typeof e?[e]:e))this._on(n,t,r)}all(e,t){this.on(UL,e,t)}_on(e,t,r){void 0===this.trees[e]&&(this.trees[e]=new UT("/"));let n=t;if("*"===n&&0!==this.trees[e].prefix.length){let t=this.trees[e];this.trees[e]=new UT(""),this.trees[e].staticChildren["/"]=t}let i=this.trees[e].prefix.length,s=this.trees[e],a=[];for(let e=0;e<=n.length;e++){if(58===n.charCodeAt(e)&&58===n.charCodeAt(e+1)){e++;continue}let t=58===n.charCodeAt(e)&&58!==n.charCodeAt(e+1),r=42===n.charCodeAt(e);if(t||r||e===n.length&&e!==i){let t=n.slice(i,e);this.options.caseSensitive||(t=t.toLowerCase()),t=(t=t.split("::").join(":")).split("%").join("%25"),s=s.createStaticChild(t)}if(t){let t=!1,r=[],l=e+1;for(let c=l;;c++){let u=n.charCodeAt(c),h=40===u,p=45===u||46===u,f=47===u||c===n.length;if(h||p||f){let u=n.slice(l,c);if(a.push(u),t=t||h||p,h){var o;let e=function(e,t){let r=1;for(;t<e.length;){if("\\"===e[++t]){t++;continue}if(")"===e[t]?r--:"("===e[t]&&r++,!r)return t}throw TypeError('Invalid regexp expression in "'+e+'"')}(n,c),t=n.slice(c,e+1);r.push((94===(o=t).charCodeAt(1)&&(o=o.slice(0,1)+o.slice(2)),36===o.charCodeAt(o.length-2)&&(o=o.slice(0,o.length-2)+o.slice(o.length-1)),o)),c=e+1}else r.push("(.*?)");let d=c;for(;c<n.length;c++){let e=n.charCodeAt(c);if(47===e)break;if(58===e){if(58===n.charCodeAt(c+1))c++;else break}}let m=n.slice(d,c);if(m&&(m=(m=m.split("::").join(":")).split("%").join("%25"),r.push(m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),l=c+1,f||47===n.charCodeAt(c)||c===n.length){let a=t?"()"+m:m,o=n.slice(e,c);n=n.slice(0,e+1)+a+n.slice(c),e+=a.length;let l=t?RegExp("^"+r.join("")+"$"):void 0;s=s.createParametricChild(l,m,o),i=e+1;break}}}}else if(r&&(a.push("*"),s=s.createWildcardChild(),i=e+1,e!==n.length-1))throw Error("Wildcard must be the last character in the route")}for(let t of(this.options.caseSensitive||(n=n.toLowerCase()),"*"===n&&(n="/*"),this.routes))if(t.method===e&&t.pattern===n)throw Error(`Method '${e}' already declared for route '${n}'`);let l={method:e,path:t,pattern:n,params:a,handler:r};this.routes.push(l),s.addRoute(l)}has(e,t){let r=this.trees[e];if(void 0===r)return!1;let n=r.getStaticChild(t);return void 0!==n&&n.isLeafNode}find(e,t){let r,n,i,s=this.trees[e];if(void 0===s)return;47!==t.charCodeAt(0)&&(t=t.replace(UC,"/")),this.options.ignoreDuplicateSlashes&&(t=Uj(t));try{t=(r=function(e){let t=!1,r=!1,n="";for(let i=1;i<e.length;i++){let s=e.charCodeAt(i);if(37===s){let n=e.charCodeAt(i+1),s=e.charCodeAt(i+2);void 0===UP(n,s)?t=!0:(r=!0,50===n&&53===s&&(t=!0,e=e.slice(0,i+1)+"25"+e.slice(i+1),i+=2),i+=2)}else if(63===s||59===s||35===s){n=e.slice(i+1),e=e.slice(0,i);break}}return{path:t?decodeURI(e):e,querystring:n,shouldDecodeParam:r}}(t)).path,n=r.querystring,i=r.shouldDecodeParam}catch(e){return}this.options.ignoreTrailingSlash&&(t=Uz(t));let a=t;!1===this.options.caseSensitive&&(t=t.toLowerCase());let o=this.options.maxParamLength,l=s.prefix.length,c=[],u=t.length,h=[];for(;;){if(l===u&&s.isLeafNode){let e=s.handlerStorage?.find();if(void 0!==e)return{handler:e.handler,params:e.createParams(c),searchParams:function(e){let t=new US;if("string"!=typeof e)return t;let r=e.length,n="",i="",s=-1,a=-1,o=!1,l=!1,c=!1,u=!1,h=!1,p=0;for(let f=0;f<r+1;f++)if(38===(p=f!==r?e.charCodeAt(f):38)){if((h=a>s)||(a=f),n=e.slice(s+1,a),h||n.length>0){c&&(n=n.replace(U_," ")),o&&(n=decodeURIComponent(n)||n),h&&(i=e.slice(a+1,f),u&&(i=i.replace(U_," ")),l&&(i=decodeURIComponent(i)||i));let r=t[n];void 0===r?t[n]=i:r.pop?r.push(i):t[n]=[r,i]}i="",s=f,a=f,o=!1,l=!1,c=!1,u=!1}else 61===p?a<=s?a=f:l=!0:43===p?a>s?u=!0:c=!0:37===p&&(a>s?l=!0:o=!0);return t}(n)}}let e=s.getNextNode(t,l,h,c.length);if(void 0===e){if(0===h.length)return;let t=h.pop();l=t.brotherPathIndex,c.splice(t.paramsCount),e=t.brotherNode}if("StaticNode"===(s=e)._tag){l+=s.prefix.length;continue}if("WildcardNode"===s._tag){let e=a.slice(l);i&&(e=UD(e)),c.push(e),l=u;continue}if("ParametricNode"===s._tag){let e=a.indexOf("/",l);-1===e&&(e=u);let t=a.slice(l,e);if(i&&(t=UD(t)),void 0!==s.regex){let e=s.regex.exec(t);if(null===e)continue;for(let t=1;t<e.length;t++){let r=e[t];if(r.length>o)return;c.push(r)}}else{if(t.length>o)return;c.push(t)}l=e}}}}class UI{handlers=[];unconstrainedHandler;find(){return this.unconstrainedHandler}add(e){let t={params:e.params,handler:e.handler,createParams:function(e){let t=e.length;return function(r){let n={};for(let i=0;i<t;i++)n[e[i]]=r[i];return n}}(e.params)};this.handlers.push(t),this.unconstrainedHandler=this.handlers[0]}}class UF{isLeafNode=!1;routes;handlerStorage;addRoute(e){void 0===this.routes?this.routes=[e]:this.routes.push(e),void 0===this.handlerStorage&&(this.handlerStorage=new UI),this.isLeafNode=!0,this.handlerStorage.add(e)}}class UR extends UF{staticChildren={};findStaticMatchingChild(e,t){let r=this.staticChildren[e.charAt(t)];if(void 0!==r&&r.matchPrefix(e,t))return r}getStaticChild(e,t=0){if(e.length===t)return this;let r=this.findStaticMatchingChild(e,t);if(void 0!==r)return r.getStaticChild(e,t+r.prefix.length)}createStaticChild(e){if(0===e.length)return this;let t=this.staticChildren[e.charAt(0)];if(t){let r=1;for(;r<t.prefix.length;r++)if(e.charCodeAt(r)!==t.prefix.charCodeAt(r)){t=t.split(this,r);break}return t.createStaticChild(e.slice(r))}let r=e.charAt(0);return this.staticChildren[r]=new UT(e),this.staticChildren[r]}}class UT extends UR{_tag="StaticNode";constructor(e){super(),this.setPrefix(e)}prefix;matchPrefix;parametricChildren=[];wildcardChild;setPrefix(e){if(this.prefix=e,1===e.length)this.matchPrefix=(e,t)=>!0;else{let t=e.length;this.matchPrefix=function(e,r){for(let n=1;n<t;n++)if(e.charCodeAt(r+n)!==this.prefix.charCodeAt(n))return!1;return!0}}}getParametricChild(e){if(void 0===e)return this.parametricChildren.find(e=>!1===e.isRegex);let t=e.source;return this.parametricChildren.find(e=>void 0!==e.regex&&e.regex.source===t)}createParametricChild(e,t,r){let n=this.getParametricChild(e);return void 0!==n?n.nodePaths.add(r):(n=new UN(e,t,r),this.parametricChildren.push(n),this.parametricChildren.sort((e,t)=>e.isRegex?t.isRegex?void 0===e.staticSuffix?1:void 0===t.staticSuffix?-1:t.staticSuffix.endsWith(e.staticSuffix)?1:e.staticSuffix.endsWith(t.staticSuffix)?-1:0:-1:1)),n}createWildcardChild(){return void 0===this.wildcardChild&&(this.wildcardChild=new UA),this.wildcardChild}split(e,t){let r=this.prefix.slice(0,t),n=this.prefix.slice(t);this.setPrefix(n);let i=new UT(r);return i.staticChildren[n.charAt(0)]=this,e.staticChildren[r.charAt(0)]=i,i}getNextNode(e,t,r,n){let i=this.findStaticMatchingChild(e,t),s=0;if(void 0===i){if(0===this.parametricChildren.length)return this.wildcardChild;i=this.parametricChildren[0],s=1}void 0!==this.wildcardChild&&r.push({paramsCount:n,brotherPathIndex:t,brotherNode:this.wildcardChild});for(let e=this.parametricChildren.length-1;e>=s;e--)r.push({paramsCount:n,brotherPathIndex:t,brotherNode:this.parametricChildren[e]});return i}}class UN extends UR{regex;staticSuffix;_tag="ParametricNode";constructor(e,t,r){super(),this.regex=e,this.staticSuffix=t,this.isRegex=!!e,this.nodePaths=new Set([r])}isRegex;nodePaths;getNextNode(e,t){return this.findStaticMatchingChild(e,t)}}class UA extends UF{_tag="WildcardNode";getNextNode(e,t,r,n){}}let UM=(e,t)=>{if(!e)throw Error(t)};function Uj(e){return e.replace(/\/\/+/g,"/")}function Uz(e){return e.length>1&&47===e.charCodeAt(e.length-1)?e.slice(0,-1):e}function UP(e,t){return 50===e?53===t?"%":51===t?"#":52===t?"$":54===t?"&":66===t||98===t?"+":67===t||99===t?",":70===t||102===t?"/":void 0:51===e?65===t||97===t?":":66===t||98===t?";":68===t||100===t?"=":70===t||102===t?"?":void 0:52===e&&48===t?"@":void 0}function UD(e){let t=e.indexOf("%");if(-1===t)return e;let r="",n=t;for(let i=t;i<e.length;i++)if(37===e.charCodeAt(i)){let t=UP(e.charCodeAt(i+1),e.charCodeAt(i+2));r+=e.slice(n,i)+t,n=i+3}return e.slice(0,t)+r+e.slice(n)}let UL=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"],U$=(e={})=>new UO(e),UU=Symbol.for("@effect/platform/HttpRouter"),Uq=Symbol.for("@effect/platform/HttpRouter/Route"),UB=Symbol.for("@effect/platform/HttpRouter/RouteContext"),UJ=sB("@effect/platform/HttpRouter/RouteContext"),UH=e=>X(e,UU),UK=$("@effect/platform/HttpRouter/currentRouterConfig",()=>ud({}));class UW extends ff{routes;mounts;[UU];constructor(e,t){super(),this.routes=e,this.mounts=t,this[UU]=UU,this.httpApp=un(UK).pipe(cp(e=>this.httpApp=UV(this,e)))}httpApp;commit(){return this.httpApp}toJSON(){return{_id:"Router",routes:this.routes.toJSON(),mounts:this.mounts.toJSON()}}toString(){return eD(this)}[ez](){return this.toJSON()}}let UV=(e,t)=>{let r=U$(t),n=na(e.mounts).map(([e,t,r])=>[e,new UQ(new UY("*",r?.includePrefix?`${e}/*`:"/*",t,r?.includePrefix?tU():ty(e),!1),{}),r]),i=n.length;return n_(e.routes,e=>{"*"===e.method?r.all(e.path,e):r.on(e.method,e.path,e)}),lZ(e=>{let t=sR(new Map(e.getFiberRef(uy).unsafeMap)),s=s$(t,$9);if(i>0)for(let e=0;e<i;e++){let[r,i,a]=n[e];if(s.url.startsWith(r))return t.unsafeMap.set(UJ.key,i),a?.includePrefix!==!0&&t.unsafeMap.set($9.key,UG(s,r)),up(cp(i.route.handler,LX),uy,t)}let a=r.find(s.method,s.url);if(void 0===a&&"HEAD"===s.method&&(a=r.find("GET",s.url)),void 0===a)return ca(new L9({request:s}));let o=a.handler;"Some"===o.prefix._tag&&t.unsafeMap.set($9.key,UG(s,o.prefix.value)),t.unsafeMap.set(Ue.key,a.searchParams),t.unsafeMap.set(UJ.key,new UQ(o,a.params));let l=sU(t,p4);"Some"===l._tag&&"Span"===l.value._tag&&l.value.attribute("http.route",o.path);let c=cp(o.handler,LX);return up(o.uninterruptible?c:ck(c),uy,t)})};function UG(e,t){let r=t.length;return e.modify({url:e.url.length<=r?"/":e.url.slice(r)})}class UY extends e${method;path;handler;prefix;uninterruptible;[Uq];constructor(e,t,r,n=tU(),i=!1){super(),this.method=e,this.path=t,this.handler=r,this.prefix=n,this.uninterruptible=i,this[Uq]=Uq}toJSON(){return{_id:"@effect/platform/HttpRouter/Route",method:this.method,path:this.path,prefix:this.prefix.toJSON()}}}class UQ{route;params;[UB];constructor(e,t){this.route=e,this.params=t,this[UB]=UB}}let UZ=new UW(nt(),nt()),UX=e=>e.endsWith("/")?e.slice(0,-1):e,U0=((e,t)=>(t=UX(t),new UW(nI(e.routes,e=>new UY(e.method,"/"===e.path?t:t+e.path,e.handler,tJ(tY(e.prefix,e=>t+e),()=>ty(t)),e.uninterruptible)),nI(e.mounts,([e,r])=>["/"===e?t:t+e,r]))),e=>R(e=>UH(e[0]),(t,r,n,i)=>new UW(np(t.routes,new UY(e,r,n,tU(),i?.uninterruptible??!1)),t.mounts))),U1=U0("GET"),U2=U0("POST"),U3=R(2,(e,t)=>new UW(nI(e.routes,e=>new UY(e.method,e.path,t(cp(e.handler,LX)),e.prefix,e.uninterruptible)),nI(e.mounts,([e,r])=>[e,t(r)]))),U5=((e,t)=>new UW(nI(e.routes,e=>new UY(e.method,e.path,t(e.handler),e.prefix,e.uninterruptible)),nI(e.mounts,([e,r])=>[e,cp(t(r),LX)])),(e,t)=>{let r=Pd(e,t);return cp(hI(),e=>{let t=s$(e,Ue),n=s$(e,UJ);return r({...t,...n.params})})}),U4=Symbol.for("@effect/platform/HttpClientError"),U6=e=>X(e,U4);class U8 extends kR(U4,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class U7 extends kR(U4,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){let e=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${e})`:`${this.reason} error (${e})`}}let U9=Symbol.for("@effect/platform/HttpClientRequest"),qe={[U9]:U9,...eL,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:eW(this.headers),body:this.body.toJSON()}},pipe(){return eV(this,arguments)}};function qt(e,t,r,n,i,s){let a=Object.create(qe);return a.method=e,a.url=t,a.urlParams=r,a.hash=n,a.headers=i,a.body=s,a}let qr=qt("GET","",[],tU(),Lu,LA),qn=e=>(t,r)=>qh(qr,{method:e,url:t,...r??void 0}),qi=qn("GET"),qs=qn("POST"),qa=qn("PUT"),qo=qn("PATCH"),ql=qn("DELETE"),qc=qn("HEAD"),qu=qn("OPTIONS"),qh=R(2,(e,t)=>{let r=e;return t.method&&(r=qg(r,t.method)),t.url&&(r=qb(r,t.url)),t.headers&&(r=qf(r,t.headers)),t.urlParams&&(r=qv(r,t.urlParams)),t.hash&&(r=q_(r,t.hash)),t.body&&(r=qS(r,t.body)),t.accept&&(r=qd(r,t.accept)),t.acceptJson&&(r=qm(r)),r}),qp=R(3,(e,t,r)=>qt(e.method,e.url,e.urlParams,e.hash,Lf(e.headers,t,r),e.body)),qf=R(2,(e,t)=>qt(e.method,e.url,e.urlParams,e.hash,Ld(e.headers,t),e.body)),qd=R(2,(e,t)=>qp(e,"Accept",t)),qm=qd("application/json"),qg=R(2,(e,t)=>qt(t,e.url,e.urlParams,e.hash,e.headers,e.body)),qb=R(2,(e,t)=>{if("string"==typeof t)return qt(e.method,t,e.urlParams,e.hash,e.headers,e.body);let r=new URL(t.toString()),n=Ly(r.searchParams),i=r.hash?ty(r.hash.slice(1)):tU();return r.search="",r.hash="",qt(e.method,r.toString(),n,i,e.headers,e.body)}),qx=R(2,(e,t)=>qt(e.method,t.endsWith("/")&&e.url.startsWith("/")?t+e.url.slice(1):t+e.url,e.urlParams,e.hash,e.headers,e.body)),qy=R(3,(e,t,r)=>qt(e.method,e.url,L_(e.urlParams,t,r),e.hash,e.headers,e.body)),qv=R(2,(e,t)=>qt(e.method,e.url,Lv(e.urlParams,t),e.hash,e.headers,e.body)),q_=R(2,(e,t)=>qt(e.method,e.url,e.urlParams,ty(t),e.headers,e.body)),qS=R(2,(e,t)=>{let r=e.headers;if("Empty"===t._tag)r=Lm(Lm(r,"Content-Type"),"Content-length");else{let e=t.contentType;e&&(r=Lf(r,"content-type",e));let n=t.contentLength;n&&(r=Lf(r,"content-length",n.toString()))}return qt(e.method,e.url,e.urlParams,e.hash,r,t)}),qw=R(2,(e,t)=>cE(LL(t),t=>qS(e,t))),qk=Symbol.for("@effect/platform/HttpClientResponse"),qC=(e,t)=>new qE(e,t);class qE extends e${request;source;[$r];[qk];constructor(e,t){super(),this.request=e,this.source=t,this[$r]=$r,this[qk]=qk}toJSON(){return $a(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return Lh(this.source.headers)}cachedCookies;get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=j9(this.source.headers.getSetCookie())}get remoteAddress(){return tU()}get stream(){return this.source.body?jX(()=>this.source.body,e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})):MW(new U7({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return gB(this.text,{try:e=>""===e?null:JSON.parse(e),catch:e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})})}textBody;get text(){return this.textBody??=gq({try:()=>this.source.text(),catch:e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kd,S7)}get urlParamsBody(){return cp(this.text,e=>gh({try:()=>Ly(new URLSearchParams(e)),catch:e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})}))}formDataBody;get formData(){return this.formDataBody??=gq({try:()=>this.source.formData(),catch:e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kd,S7)}arrayBufferBody;get arrayBuffer(){return this.arrayBufferBody??=gq({try:()=>this.source.arrayBuffer(),catch:e=>new U7({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kd,S7)}}let qO=e=>e.status>=200&&e.status<300?cj(e):ca(new U7({response:e,request:e.request,reason:"StatusCode",description:"non 2xx status code"})),qI=Symbol.for("@effect/platform/HttpClient"),qF=sB("@effect/platform/HttpClient"),qR=$(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>ud(M)),qT=$(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>ud(!0)),qN={[qI]:qI,pipe(){return eV(this,arguments)},...eL,toJSON:()=>({_id:"@effect/platform/HttpClient"}),get(e,t){return this.execute(qi(e,t))},head(e,t){return this.execute(qc(e,t))},post(e,t){return this.execute(qs(e,t))},put(e,t){return this.execute(qa(e,t))},patch(e,t){return this.execute(qo(e,t))},del(e,t){return this.execute(ql(e,t))},options(e,t){return this.execute(qu(e,t))}},qA=(e,t)=>{let r=Object.create(qN);return r.preprocess=t,r.postprocess=e,r.execute=function(r){return e(t(r))},r},{del:qM,execute:qj,get:qz,head:qP,options:qD,patch:qL,post:q$,put:qU}=new Proxy({},{get:(e,t,r)=>(...e)=>cp(qF,r=>r[t](...e))}),qq=R(2,(e,t)=>qA(r=>t(e.postprocess(r)),e.preprocess)),qB=e=>qq(e,cp(qO)),qJ=e=>j$(cE(e,e=>e.stream)),qH={[Symbol.for("@effect/matcher/Matcher")]:{_input:T,_filters:T,_result:T,_return:T},_tag:"ValueMatcher",add(e){return"Right"===this.value._tag?this:"When"===e._tag&&!0===e.guard(this.provided)?qK(this.provided,tI(e.evaluate(this.provided))):"Not"===e._tag&&!1===e.guard(this.provided)?qK(this.provided,tI(e.evaluate(this.provided))):this},pipe(){return eV(this,arguments)}};function qK(e,t){let r=Object.create(qH);return r.provided=e,r.value=t,r}let qW=(e,t)=>({_tag:"When",guard:e,evaluate:t}),qV=e=>{if("function"==typeof e)return e;if(Array.isArray(e)){let t=e.map(qV),r=t.length;return e=>{if(!Array.isArray(e))return!1;for(let n=0;n<r;n++)if(!1===t[n](e[n]))return!1;return!0}}if(null!==e&&"object"==typeof e){let t=Object.entries(e).map(([e,t])=>[e,qV(t)]),r=t.length;return e=>{if("object"!=typeof e||null===e)return!1;for(let n=0;n<r;n++){let[r,i]=t[n];if(!(r in e)||!1===i(e[r]))return!1}return!0}}return t=>t===e},qG=e=>{if("ValueMatcher"===e._tag)return e.value;let t=e.cases.length;if(1===t){let t=e.cases[0];return e=>"When"===t._tag&&!0===t.guard(e)?tI(t.evaluate(e)):"Not"===t._tag&&!1===t.guard(e)?tI(t.evaluate(e)):tO(e)}return r=>{for(let n=0;n<t;n++){let t=e.cases[n];if("When"===t._tag&&!0===t.guard(r)||"Not"===t._tag&&!1===t.guard(r))return tI(t.evaluate(r))}return tO(r)}},qY=e=>qK(e,tO(e)),qQ=(e,t)=>r=>r.add(qW(qV(e),t)),qZ=e=>t=>{let r=qG(t);return tk(r)?"Right"===r._tag?r.right:e(r.left):t=>{let n=r(t);return"Right"===n._tag?n.right:e(n.left)}},qX={"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applixware":{source:"apache",extensions:["aw"]},"application/atom+xml":{source:"iana",extensions:["atom"]},"application/atomcat+xml":{source:"iana",extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",extensions:["atomdeleted"]},"application/atomsvc+xml":{source:"iana",extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",extensions:["dwd"]},"application/atsc-held+xml":{source:"iana",extensions:["held"]},"application/atsc-rsat+xml":{source:"iana",extensions:["rsat"]},"application/calendar+xml":{source:"iana",extensions:["xcs"]},"application/ccxml+xml":{source:"iana",extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cpl+xml":{source:"iana",extensions:["cpl"]},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/dash+xml":{source:"iana",extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",extensions:["mpp"]},"application/davmount+xml":{source:"iana",extensions:["davmount"]},"application/dicom":{source:"iana",extensions:["dcm"]},"application/docbook+xml":{source:"apache",extensions:["dbk"]},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",extensions:["xdssc"]},"application/ecmascript":{source:"iana",extensions:["es","ecma"]},"application/emma+xml":{source:"iana",extensions:["emma"]},"application/emotionml+xml":{source:"iana",extensions:["emotionml"]},"application/epub+zip":{source:"iana",extensions:["epub"]},"application/exi":{source:"iana",extensions:["exi"]},"application/express":{source:"iana",extensions:["exp"]},"application/fdt+xml":{source:"iana",extensions:["fdt"]},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/geo+json":{source:"iana",extensions:["geojson"]},"application/gml+xml":{source:"iana",extensions:["gml"]},"application/gpx+xml":{source:"apache",extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",extensions:["gz"]},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/inkml+xml":{source:"iana",extensions:["ink","inkml"]},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/its+xml":{source:"iana",extensions:["its"]},"application/java-archive":{source:"apache",extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",extensions:["ser"]},"application/java-vm":{source:"apache",extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",extensions:["js","mjs"]},"application/json":{source:"iana",charset:"UTF-8",extensions:["json","map"]},"application/jsonml+json":{source:"apache",extensions:["jsonml"]},"application/ld+json":{source:"iana",extensions:["jsonld"]},"application/lgr+xml":{source:"iana",extensions:["lgr"]},"application/lost+xml":{source:"iana",extensions:["lostxml"]},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/mads+xml":{source:"iana",extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",extensions:["mathml"]},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",extensions:["mpf"]},"application/mediaservercontrol+xml":{source:"iana",extensions:["mscml"]},"application/metalink+xml":{source:"apache",extensions:["metalink"]},"application/metalink4+xml":{source:"iana",extensions:["meta4"]},"application/mets+xml":{source:"iana",extensions:["mets"]},"application/mmt-aei+xml":{source:"iana",extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",extensions:["musd"]},"application/mods+xml":{source:"iana",extensions:["mods"]},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/msword":{source:"iana",extensions:["doc","dot"]},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/node":{source:"iana",extensions:["cjs"]},"application/octet-stream":{source:"iana",extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/oebps-package+xml":{source:"iana",extensions:["opf"]},"application/ogg":{source:"iana",extensions:["ogx"]},"application/omdoc+xml":{source:"apache",extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p2p-overlay+xml":{source:"iana",extensions:["relo"]},"application/patch-ops-error+xml":{source:"iana",extensions:["xer"]},"application/pdf":{source:"iana",extensions:["pdf"]},"application/pgp-encrypted":{source:"iana",extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",extensions:["pls"]},"application/postscript":{source:"iana",extensions:["ai","eps","ps"]},"application/provenance+xml":{source:"iana",extensions:["provx"]},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/pskc+xml":{source:"iana",extensions:["pskcxml"]},"application/rdf+xml":{source:"iana",extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/resource-lists+xml":{source:"iana",extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",extensions:["rld"]},"application/rls-services+xml":{source:"iana",extensions:["rs"]},"application/route-apd+xml":{source:"iana",extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",extensions:["sls"]},"application/route-usd+xml":{source:"iana",extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rsd+xml":{source:"apache",extensions:["rsd"]},"application/rss+xml":{source:"apache",extensions:["rss"]},"application/rtf":{source:"iana",extensions:["rtf"]},"application/sbml+xml":{source:"iana",extensions:["sbml"]},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/senml+xml":{source:"iana",extensions:["senmlx"]},"application/sensml+xml":{source:"iana",extensions:["sensmlx"]},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/shf+xml":{source:"iana",extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/smil+xml":{source:"iana",extensions:["smi","smil"]},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",extensions:["srx"]},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",extensions:["grxml"]},"application/sru+xml":{source:"iana",extensions:["sru"]},"application/ssdl+xml":{source:"apache",extensions:["ssdl"]},"application/ssml+xml":{source:"iana",extensions:["ssml"]},"application/swid+xml":{source:"iana",extensions:["swidtag"]},"application/tei+xml":{source:"iana",extensions:["tei","teicorpus"]},"application/thraud+xml":{source:"iana",extensions:["tfi"]},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",extensions:["ttml"]},"application/urc-ressheet+xml":{source:"iana",extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",extensions:["td"]},"application/vnd.1000minds.decision-model+xml":{source:"iana",extensions:["1km"]},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",extensions:["air"]},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.xdp+xml":{source:"iana",extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.android.package-archive":{source:"apache",extensions:["apk"]},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apple.installer+xml":{source:"iana",extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.balsamiq.bmml+xml":{source:"iana",extensions:["bmml"]},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.chemdraw+xml":{source:"iana",extensions:["cdxml"]},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.citationstyles.style+xml":{source:"iana",extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",extensions:["wbs"]},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.dart":{source:"iana",extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.eszigno3+xml":{source:"iana",extensions:["es3","et3"]},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-earth.kml+xml":{source:"iana",extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",extensions:["kmz"]},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+xml":{source:"iana",extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las.las+xml":{source:"iana",extensions:["lasxml"]},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",extensions:["lbe"]},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.mozilla.xul+xml":{source:"iana",extensions:["xul"]},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-excel":{source:"iana",extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-powerpoint":{source:"iana",extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",extensions:["xps"]},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma.dd2+xml":{source:"iana",extensions:["dd2"]},"application/vnd.openblox.game+xml":{source:"iana",extensions:["obgx"]},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",extensions:["osm"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",extensions:["musicxml"]},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",extensions:["link66"]},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.software602.filler.form+xml":{source:"iana",extensions:["fo"]},"application/vnd.solent.sdkm+xml":{source:"iana",extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.sun.wadl+xml":{source:"iana",extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",extensions:["xdm"]},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",extensions:["ddf"]},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",extensions:["uoml"]},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",extensions:["osfpvg"]},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",extensions:["zaz"]},"application/voicexml+xml":{source:"iana",extensions:["vxml"]},"application/wasm":{source:"iana",extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",extensions:["wif"]},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wsdl+xml":{source:"iana",extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",extensions:["bz"]},"application/x-bzip2":{source:"apache",extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",extensions:["res"]},"application/x-dvi":{source:"apache",extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",extensions:["jnlp"]},"application/x-latex":{source:"apache",extensions:["latex"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-rar-compressed":{source:"apache",extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",extensions:["xlf"]},"application/x-xpinstall":{source:"apache",extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/xaml+xml":{source:"apache",extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",extensions:["xel"]},"application/xcap-ns+xml":{source:"iana",extensions:["xns"]},"application/xenc+xml":{source:"iana",extensions:["xenc"]},"application/xhtml+xml":{source:"iana",extensions:["xhtml","xht"]},"application/xliff+xml":{source:"iana",extensions:["xlf"]},"application/xml":{source:"iana",extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",extensions:["dtd"]},"application/xop+xml":{source:"iana",extensions:["xop"]},"application/xproc+xml":{source:"apache",extensions:["xpl"]},"application/xslt+xml":{source:"iana",extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",extensions:["xspf"]},"application/xv+xml":{source:"iana",extensions:["mxml","xhvml","xvml","xvm"]},"application/yaml":{source:"iana",extensions:["yaml","yml"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yin+xml":{source:"iana",extensions:["yin"]},"application/zip":{source:"iana",extensions:["zip"]},"audio/3gpp":{source:"iana",extensions:["3gpp"]},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/basic":{source:"iana",extensions:["au","snd"]},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp4":{source:"iana",extensions:["m4a","mp4a"]},"audio/mpeg":{source:"iana",extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/ogg":{source:"iana",extensions:["oga","ogg","spx","opus"]},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/silk":{source:"apache",extensions:["sil"]},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/webm":{source:"apache",extensions:["weba"]},"audio/x-aac":{source:"apache",extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/x-gsm":{source:"apache",extensions:["gsm"]},"audio/xm":{source:"apache",extensions:["xm"]},"image/aces":{source:"iana",extensions:["exr"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",extensions:["avif"]},"image/bmp":{source:"iana",extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",extensions:["jpeg","jpg","jpe","jfif","pjpeg","pjp"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",extensions:["jpm"]},"image/jpx":{source:"iana",extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/png":{source:"iana",extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.microsoft.icon":{source:"iana",extensions:["ico"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"text/cache-manifest":{source:"iana",extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/css":{source:"iana",charset:"UTF-8",extensions:["css"]},"text/csv":{source:"iana",extensions:["csv"]},"text/html":{source:"iana",extensions:["html","htm","shtml"]},"text/markdown":{source:"iana",extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/n3":{source:"iana",charset:"UTF-8",extensions:["n3"]},"text/plain":{source:"iana",extensions:["txt","text","conf","def","list","log","in","ini"]},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/richtext":{source:"iana",extensions:["rtx"]},"text/rtf":{source:"iana",extensions:["rtf"]},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shex":{source:"iana",extensions:["shex"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/tab-separated-values":{source:"iana",extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/uri-list":{source:"iana",extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",extensions:["vcard"]},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",extensions:["xml"]},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h264":{source:"iana",extensions:["h264"]},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",extensions:["mp4","mp4v","mpg4"]},"video/mpeg":{source:"iana",extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/ogg":{source:"iana",extensions:["ogv"]},"video/quicktime":{source:"iana",extensions:["qt","mov"]},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/webm":{source:"apache",extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",extensions:["otf"]},"font/ttf":{source:"iana",extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/rfc822":{source:"iana",extensions:["eml","mime"]},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/gltf+json":{source:"iana",extensions:["gltf"]},"model/gltf-binary":{source:"iana",extensions:["glb"]},"model/iges":{source:"iana",extensions:["igs","iges"]},"model/mesh":{source:"iana",extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana",extensions:[".p21",".stp",".step",".stpnc",".210"]},"model/step+xml":{source:"iana",extensions:["stpx"]},"model/step+zip":{source:"iana",extensions:["stpz"]},"model/step-xml+zip":{source:"iana",extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]}},q0={},q1={},q2=!1,q3={alphabet:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",minLength:0,blocklist:new Set(["0rgasm","1d10t","1d1ot","1di0t","1diot","1eccacu10","1eccacu1o","1eccacul0","1eccaculo","1mbec11e","1mbec1le","1mbeci1e","1mbecile","a11upat0","a11upato","a1lupat0","a1lupato","aand","ah01e","ah0le","aho1e","ahole","al1upat0","al1upato","allupat0","allupato","ana1","ana1e","anal","anale","anus","arrapat0","arrapato","arsch","arse","ass","b00b","b00be","b01ata","b0ceta","b0iata","b0ob","b0obe","b0sta","b1tch","b1te","b1tte","ba1atkar","balatkar","bastard0","bastardo","batt0na","battona","bitch","bite","bitte","bo0b","bo0be","bo1ata","boceta","boiata","boob","boobe","bosta","bran1age","bran1er","bran1ette","bran1eur","bran1euse","branlage","branler","branlette","branleur","branleuse","c0ck","c0g110ne","c0g11one","c0g1i0ne","c0g1ione","c0gl10ne","c0gl1one","c0gli0ne","c0glione","c0na","c0nnard","c0nnasse","c0nne","c0u111es","c0u11les","c0u1l1es","c0u1lles","c0ui11es","c0ui1les","c0uil1es","c0uilles","c11t","c11t0","c11to","c1it","c1it0","c1ito","cabr0n","cabra0","cabrao","cabron","caca","cacca","cacete","cagante","cagar","cagare","cagna","cara1h0","cara1ho","caracu10","caracu1o","caracul0","caraculo","caralh0","caralho","cazz0","cazz1mma","cazzata","cazzimma","cazzo","ch00t1a","ch00t1ya","ch00tia","ch00tiya","ch0d","ch0ot1a","ch0ot1ya","ch0otia","ch0otiya","ch1asse","ch1avata","ch1er","ch1ng0","ch1ngadaz0s","ch1ngadazos","ch1ngader1ta","ch1ngaderita","ch1ngar","ch1ngo","ch1ngues","ch1nk","chatte","chiasse","chiavata","chier","ching0","chingadaz0s","chingadazos","chingader1ta","chingaderita","chingar","chingo","chingues","chink","cho0t1a","cho0t1ya","cho0tia","cho0tiya","chod","choot1a","choot1ya","chootia","chootiya","cl1t","cl1t0","cl1to","clit","clit0","clito","cock","cog110ne","cog11one","cog1i0ne","cog1ione","cogl10ne","cogl1one","cogli0ne","coglione","cona","connard","connasse","conne","cou111es","cou11les","cou1l1es","cou1lles","coui11es","coui1les","couil1es","couilles","cracker","crap","cu10","cu1att0ne","cu1attone","cu1er0","cu1ero","cu1o","cul0","culatt0ne","culattone","culer0","culero","culo","cum","cunt","d11d0","d11do","d1ck","d1ld0","d1ldo","damn","de1ch","deich","depp","di1d0","di1do","dick","dild0","dildo","dyke","encu1e","encule","enema","enf01re","enf0ire","enfo1re","enfoire","estup1d0","estup1do","estupid0","estupido","etr0n","etron","f0da","f0der","f0ttere","f0tters1","f0ttersi","f0tze","f0utre","f1ca","f1cker","f1ga","fag","fica","ficker","figa","foda","foder","fottere","fotters1","fottersi","fotze","foutre","fr0c10","fr0c1o","fr0ci0","fr0cio","fr0sc10","fr0sc1o","fr0sci0","fr0scio","froc10","froc1o","froci0","frocio","frosc10","frosc1o","frosci0","froscio","fuck","g00","g0o","g0u1ne","g0uine","gandu","go0","goo","gou1ne","gouine","gr0gnasse","grognasse","haram1","harami","haramzade","hund1n","hundin","id10t","id1ot","idi0t","idiot","imbec11e","imbec1le","imbeci1e","imbecile","j1zz","jerk","jizz","k1ke","kam1ne","kamine","kike","leccacu10","leccacu1o","leccacul0","leccaculo","m1erda","m1gn0tta","m1gnotta","m1nch1a","m1nchia","m1st","mam0n","mamahuev0","mamahuevo","mamon","masturbat10n","masturbat1on","masturbate","masturbati0n","masturbation","merd0s0","merd0so","merda","merde","merdos0","merdoso","mierda","mign0tta","mignotta","minch1a","minchia","mist","musch1","muschi","n1gger","neger","negr0","negre","negro","nerch1a","nerchia","nigger","orgasm","p00p","p011a","p01la","p0l1a","p0lla","p0mp1n0","p0mp1no","p0mpin0","p0mpino","p0op","p0rca","p0rn","p0rra","p0uff1asse","p0uffiasse","p1p1","p1pi","p1r1a","p1rla","p1sc10","p1sc1o","p1sci0","p1scio","p1sser","pa11e","pa1le","pal1e","palle","pane1e1r0","pane1e1ro","pane1eir0","pane1eiro","panele1r0","panele1ro","paneleir0","paneleiro","patakha","pec0r1na","pec0rina","pecor1na","pecorina","pen1s","pendej0","pendejo","penis","pip1","pipi","pir1a","pirla","pisc10","pisc1o","pisci0","piscio","pisser","po0p","po11a","po1la","pol1a","polla","pomp1n0","pomp1no","pompin0","pompino","poop","porca","porn","porra","pouff1asse","pouffiasse","pr1ck","prick","pussy","put1za","puta","puta1n","putain","pute","putiza","puttana","queca","r0mp1ba11e","r0mp1ba1le","r0mp1bal1e","r0mp1balle","r0mpiba11e","r0mpiba1le","r0mpibal1e","r0mpiballe","rand1","randi","rape","recch10ne","recch1one","recchi0ne","recchione","retard","romp1ba11e","romp1ba1le","romp1bal1e","romp1balle","rompiba11e","rompiba1le","rompibal1e","rompiballe","ruff1an0","ruff1ano","ruffian0","ruffiano","s1ut","sa10pe","sa1aud","sa1ope","sacanagem","sal0pe","salaud","salope","saugnapf","sb0rr0ne","sb0rra","sb0rrone","sbattere","sbatters1","sbattersi","sborr0ne","sborra","sborrone","sc0pare","sc0pata","sch1ampe","sche1se","sche1sse","scheise","scheisse","schlampe","schwachs1nn1g","schwachs1nnig","schwachsinn1g","schwachsinnig","schwanz","scopare","scopata","sexy","sh1t","shit","slut","sp0mp1nare","sp0mpinare","spomp1nare","spompinare","str0nz0","str0nza","str0nzo","stronz0","stronza","stronzo","stup1d","stupid","succh1am1","succh1ami","succhiam1","succhiami","sucker","t0pa","tapette","test1c1e","test1cle","testic1e","testicle","tette","topa","tr01a","tr0ia","tr0mbare","tr1ng1er","tr1ngler","tring1er","tringler","tro1a","troia","trombare","turd","twat","vaffancu10","vaffancu1o","vaffancul0","vaffanculo","vag1na","vagina","verdammt","verga","w1chsen","wank","wichsen","x0ch0ta","x0chota","xana","xoch0ta","xochota","z0cc01a","z0cc0la","z0cco1a","z0ccola","z1z1","z1zi","ziz1","zizi","zocc01a","zocc0la","zocco1a","zoccola"])};class q5{constructor(e){var t,r,n;let i=null!==(t=null==e?void 0:e.alphabet)&&void 0!==t?t:q3.alphabet,s=null!==(r=null==e?void 0:e.minLength)&&void 0!==r?r:q3.minLength,a=null!==(n=null==e?void 0:e.blocklist)&&void 0!==n?n:q3.blocklist;if(new Blob([i]).size!==i.length)throw Error("Alphabet cannot contain multibyte characters");if(i.length<3)throw Error("Alphabet length must be at least 3");if(new Set(i).size!==i.length)throw Error("Alphabet must contain unique characters");if("number"!=typeof s||s<0||s>255)throw Error("Minimum length has to be between 0 and 255");let o=new Set,l=i.toLowerCase().split("");for(let e of a)if(e.length>=3){let t=e.toLowerCase(),r=t.split("");r.filter(e=>l.includes(e)).length===r.length&&o.add(t)}this.alphabet=this.shuffle(i),this.minLength=s,this.blocklist=o}encode(e){if(0===e.length)return"";if(e.filter(e=>e>=0&&e<=this.maxValue()).length!==e.length)throw Error(`Encoding supports numbers between 0 and ${this.maxValue()}`);return this.encodeNumbers(e)}decode(e){let t=[];if(""===e)return t;let r=this.alphabet.split("");for(let n of e.split(""))if(!r.includes(n))return t;let n=e.charAt(0),i=this.alphabet.indexOf(n),s=this.alphabet.slice(i)+this.alphabet.slice(0,i);s=s.split("").reverse().join("");let a=e.slice(1);for(;a.length>0;){let e=s.slice(0,1),r=a.split(e);if(r.length>0){if(""===r[0])return t;t.push(this.toNumber(r[0],s.slice(1))),r.length>1&&(s=this.shuffle(s))}a=r.slice(1).join(e)}return t}encodeNumbers(e,t=0){if(t>this.alphabet.length)throw Error("Reached max attempts to re-generate the ID");let r=e.reduce((e,t,r)=>this.alphabet[t%this.alphabet.length].codePointAt(0)+r+e,e.length)%this.alphabet.length;r=(r+t)%this.alphabet.length;let n=this.alphabet.slice(r)+this.alphabet.slice(0,r),i=n.charAt(0);n=n.split("").reverse().join("");let s=[i];for(let t=0;t!==e.length;t++){let r=e[t];s.push(this.toId(r,n.slice(1))),t<e.length-1&&(s.push(n.slice(0,1)),n=this.shuffle(n))}let a=s.join("");if(this.minLength>a.length)for(a+=n.slice(0,1);this.minLength-a.length>0;)n=this.shuffle(n),a+=n.slice(0,Math.min(this.minLength-a.length,n.length));return this.isBlockedId(a)&&(a=this.encodeNumbers(e,t+1)),a}shuffle(e){let t=e.split("");for(let e=0,r=t.length-1;r>0;e++,r--){let n=(e*r+t[e].codePointAt(0)+t[r].codePointAt(0))%t.length;[t[e],t[n]]=[t[n],t[e]]}return t.join("")}toId(e,t){let r=[],n=t.split(""),i=e;do r.unshift(n[i%n.length]),i=Math.floor(i/n.length);while(i>0);return r.join("")}toNumber(e,t){let r=t.split("");return e.split("").reduce((e,t)=>e*r.length+r.indexOf(t),0)}isBlockedId(e){let t=e.toLowerCase();for(let e of this.blocklist)if(e.length<=t.length){if(t.length<=3||e.length<=3){if(t===e)return!0}else if(/\d/.test(e)){if(t.startsWith(e)||t.endsWith(e))return!0}else if(t.includes(e))return!0}return!1}maxValue(){return Number.MAX_SAFE_INTEGER}}class q4 extends m_("InvalidRouteConfig"){constructor(e,t){super({reason:t?`Expected route config to have a ${t} for key ${e} but none was found.`:`Encountered an invalid route config during backfilling. ${e} was not found.`})}}class q6 extends m_("UnknownFileType"){constructor(e){super({reason:`Could not determine type for ${e}`})}}class q8 extends m_("InvalidFileType"){constructor(e,t){super({reason:`File type ${e} not allowed for ${t}`})}}class q7 extends m_("InvalidFileSize"){constructor(e){super({reason:`Invalid file size: ${e}`})}}function q9(e){return{maxFileSize:"image"===e?"4MB":"video"===e?"16MB":"audio"===e||"blob"===e?"8MB":"pdf"===e?"4MB":"text"===e?"64KB":"4MB",maxFileCount:1,minFileCount:1,contentDisposition:"inline"}}let Be=e=>{if(Array.isArray(e))return dE(e.reduce((e,t)=>(e[t]=q9(t),e),{}));let t={};for(let r of Bs(e)){let n=e[r];if(!n)return dI(new q4(r));t[r]={...q9(r),...n}}return dE(JSON.parse(JSON.stringify(t,Ba)))},Bt=(e,t)=>{let r=e.type||function(e){if(!e||"string"!=typeof e)return!1;let t=(function(e){let t=e.lastIndexOf(".");return t<0?"":e.substring(t)})("x."+e).toLowerCase().substring(1);return!!t&&((function(e,t){if(q2)return;q2=!0;let r=["nginx","apache",void 0,"iana"];Object.keys(qX).forEach(n=>{let i=qX[n],s=i.extensions;if(s?.length)for(let a of(e[n]=s,s)){if(t[a]){let e=r.indexOf(qX[t[a]].source),n=r.indexOf(i.source);if("application/octet-stream"!==t[a]&&(e>n||e===n&&t[a].startsWith("application/")))continue}t[a]=n}})}(q0,q1),q1)[t]||!1)}(e.name);if(!r)return t.includes("blob")?dE("blob"):dI(new q6(e.name));if(t.some(e=>e.includes("/"))&&t.includes(r))return dE(r);let n="application/pdf"===r.toLowerCase()?"pdf":r.split("/")[0];return t.includes(n)?dE(n):t.includes("blob")?dE("blob"):dI(new q8(n,e.name))},Br=["B","KB","MB","GB","TB"],Bn=e=>{let t=RegExp(`^(\\d+)(\\.\\d+)?\\s*(${Br.join("|")})$`,"i"),r=e.match(t);if(!r?.[1]||!r[3])return dI(new q7(e));let n=parseFloat(r[1]),i=r[3].toUpperCase();return dE(Math.floor(n*Math.pow(1024,Br.indexOf(i))))},Bi=e=>{if(0===e||-1===e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)}${Br[t]}`};function Bs(e){return Object.keys(e)}let Ba=(e,t)=>"number"!=typeof t||Number.isSafeInteger(t)||t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?t:t===1/0?Number.MAX_SAFE_INTEGER:t===-1/0?Number.MIN_SAFE_INTEGER:Number.isNaN(t)?0:void 0,Bo={BAD_REQUEST:400,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_SERVER_ERROR:500,INTERNAL_CLIENT_ERROR:500,TOO_LARGE:413,TOO_SMALL:400,TOO_MANY_FILES:400,KEY_TOO_LONG:400,URL_GENERATION_FAILED:500,UPLOAD_FAILED:500,MISSING_ENV:500,INVALID_SERVER_CONFIG:500,FILE_LIMIT_EXCEEDED:500};class Bl extends mv{constructor(e){let t="string"==typeof e?{code:"INTERNAL_SERVER_ERROR",message:e}:e;super({message:t.message??function(e,t){return"string"==typeof e?e:e instanceof Error||e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:t??"An unknown error occurred"}(t.cause,t.code)}),this._tag="UploadThingError",this.name="UploadThingError",this.code=t.code,this.data=t.data,t.cause instanceof Error?this.cause=t.cause:es(t.cause)&&q(t.cause.status)&&U(t.cause.statusText)?this.cause=Error(`Response ${t.cause.status} ${t.cause.statusText}`):U(t.cause)?this.cause=Error(t.cause):this.cause=t.cause}static toObject(e){return{code:e.code,message:e.message,data:e.data}}static serialize(e){return JSON.stringify(Bl.toObject(e))}}let Bc="hmac-sha256=",Bu={name:"HMAC",hash:"SHA-256"},Bh=new TextEncoder,Bp=(e,t)=>dU(function*(){let r=yield*dz({try:()=>crypto.subtle.importKey("raw",Bh.encode(zg(t)),Bu,!1,["sign"]),catch:e=>new Bl({code:"BAD_REQUEST",message:"Invalid signing secret",cause:e})}),n=yield*dK(dz({try:()=>crypto.subtle.sign(Bu,r,Bh.encode(e)),catch:e=>new Bl({code:"BAD_REQUEST",cause:e})}),e=>z8(new Uint8Array(e)));return`${Bc}${n}`}).pipe(mn("signPayload")),Bf=(e,t,r)=>dU(function*(){let n=t?.slice(Bc.length);if(!n)return!1;let i=Bh.encode(zg(r)),s=yield*dj(()=>crypto.subtle.importKey("raw",i,Bu,!1,["verify"])),a=yield*dA(z7(n)),o=Bh.encode(e);return yield*dj(()=>crypto.subtle.verify(Bu,s,a,o))}).pipe(mn("verifySignature"),mr(()=>!1)),Bd=(e,t,r)=>dF(()=>{let n=JSON.stringify(r?.(e)??[e.name,e.size,e.type,e.lastModified,Date.now()]),i=function(e,t){let r,n;let i=e.split(""),s=eE(t);for(let e=0;e<i.length;e++)n=(s%(e+1)+e)%i.length,r=i[e],i[e]=i[n],i[n]=r;return i.join("")}(q3.alphabet,t),s=new q5({alphabet:i,minLength:36}).encode([Math.abs(eE(n))]);return new q5({alphabet:i,minLength:12}).encode([Math.abs(eE(t))])+s}).pipe(mn("generateKey")),Bm=(e,t,r)=>dU(function*(){let n=new URL(e),i=r.ttlInSeconds?function(e){if("number"==typeof e)return e;let t=e.split(/(\d+)/).filter(Boolean);return Number(t[0])*({s:1,m:60,h:3600,d:86400})[(t[1]??"s").trim().slice(0,1)]}(r.ttlInSeconds):3600,s=Date.now()+1e3*i;n.searchParams.append("expires",s.toString()),r.data&&Object.entries(r.data).forEach(([e,t])=>{if(null==t)return;let r=encodeURIComponent(t);n.searchParams.append(e,r)});let a=yield*Bp(n.toString(),t);return n.searchParams.append("signature",a),n.href}).pipe(mn("generateSignedURL")),Bg=e=>pC(new Map(rB(pV(e),([e,t])=>[pW(e).join("\uFEFF"),t])),{pathDelim:"\uFEFF",seqDelim:"\uFEFF"});Py("inline","attachment"),Py("public-read","private");let Bb=Py("upload"),Bx=Py("callback","error"),By=Dv(DT,PO,{decode:e=>new TextDecoder().decode(e),encode:e=>new TextEncoder().encode(e)}),Bv=Dt({apiKey:Dv(x=PO.pipe(e=>{let t=JSON.stringify("sk_");return e.pipe(Db(e=>e.startsWith("sk_"),{schemaId:DS,[DS]:{startsWith:"sk_"},title:`startsWith(${t})`,description:`a string starting with ${t}`,jsonSchema:{pattern:"^sk_"},...b}))}),PS([Pf(x)],{decode:e=>DR(Or(e)),encode:e=>DR(On(e))},{description:"Redacted(<redacted>)",pretty:()=>()=>"Redacted(<redacted>)",arbitrary:e=>t=>e(t).map(zm),equivalence:e=>tP((t,r)=>e(zg(t),zg(r)))}),{strict:!0,decode:e=>zm(e),encode:e=>zg(e)}),appId:PO,regions:PU(PO),ingestHost:PO.pipe(P6({default:()=>"ingest.uploadthing.com"}))}),B_=DN.pipe(Dh(By),Dh(DC(Bv)));class BS extends DB("FileUploadData")({name:PO,size:PI,type:PO,lastModified:PI.pipe(P4)}){}class Bw extends BS.extend("FileUploadDataWithCustomId")({customId:PA(PO)}){}class Bk extends Bw.extend("UploadedFileData")({key:PO,url:PO,appUrl:PO,ufsUrl:PO,fileHash:PO}){}class BC extends DB("MetadataFetchStreamPart")({payload:PO,signature:PO,hook:Bx}){}class BE extends DB("MetadataFetchResponse")({ok:PF}){}class BO extends DB("CallbackResultResponse")({ok:PF}){}class BI extends DB("UploadActionPayload")({files:P$(BS),input:PE}){}let BF=pk().pipe(pA(()=>pC(new Map(Object.entries(Object.fromEntries(Object.entries({}).filter(e=>null!=e[1])))),{pathDelim:"_"})),pN("uploadthing"),e=>pR(e,pg)),BR=e=>Bg(e??{}).pipe(pA(()=>BF)),BT=(e=>{let t=zB("a boolean property",e=>{switch(e){case"true":case"yes":case"on":case"1":return tI(!0);case"false":case"no":case"off":case"0":return tI(!1);default:return tO(h0([],`Expected a boolean value but received ${e}`))}});return void 0===e?t:z$(t,e)})("isDev").pipe(zU(()=>zJ("undefined"!=typeof process?"production":void 0).pipe(zP(e=>"development"===e))),zK(!1)),BN=((e,t)=>{let r=Ot(t);return zW(e).pipe(zL(e=>r(e).pipe(tT(e=>h0([],O_.formatIssueSync(e))))))})("token",B_).pipe(gd({ConfigError:e=>new Bl({code:"InvalidData"===e._op?"INVALID_SERVER_CONFIG":"MISSING_ENV",message:"InvalidData"===e._op?"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.":"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.",cause:e})}));zW("apiUrl").pipe(zK("https://api.uploadthing.com"),zD(e=>new URL(e)),zP(e=>e.href.replace(/\/$/,"")));let BA=km(function*(){let{regions:e,ingestHost:t}=yield*BN,r=e[0];return yield*zW("ingestUrl").pipe(zK(`https://${r}.${t}`),zD(e=>new URL(e)),zP(e=>e.href.replace(/\/$/,"")))});zW("utfsHost").pipe(zK("utfs.io")),zW("ufsHost").pipe(zK("ufs.sh"));let BM=e=>{console.warn(` [uploadthing][deprecated] ${e}`)};function Bj(e){return{message:e.message}}function Bz(e,t){let r=Object.keys(t)[0];return(r?t[r]?.errorFormatter??Bj:Bj)(e)}let BP=(e,t)=>r=>{let n="";return r.pipe(jJ(),jY(e=>km(function*(){let t=(n+=e).split("\n"),r=[];for(let e of t)try{r.push(JSON.parse(e)),n=n.slice(e.length+1)}catch{}return yield*gC("Received chunks").pipe(gc("chunk",e),gc("parsedChunks",r),gc("buf",n)),r})),jY(Pd(P$(e))),jY(vt(e=>t(e))),j0,gF("handleJsonLineStream"))},BD=R(2,(e,t)=>e.log({fiberId:az,logLevel:c6,message:t,cause:iJ,context:f_(),spans:a7(),annotations:n4(),date:new Date})),BL=bu,B$=bp,BU=Ik,Bq=IC,BB=IE,BJ=bf,BH=bd,BK=bm,BW=bg,BV=y5,BG=yY,BY=e=>bp(t=>{let r=s$(fR(t.context,ft),pY).unsafe;switch(t.logLevel._tag){case"Debug":return r.debug(e.log(t));case"Info":return r.info(e.log(t));case"Trace":return r.trace(e.log(t));case"Warning":return r.warn(e.log(t));case"Error":case"Fatal":return r.error(e.log(t));default:return r.log(e.log(t))}}),BQ=e=>bp(t=>{s$(fR(t.context,ft),pY).unsafe.error(e.log(t))}),BZ={[bu]:bh,log:j,pipe(){return eV(this,arguments)}},BX=IO,B0=II,B1=IF,B2=IR,B3=bb,B5=e=>bb(()=>e),B4=e=>bb(e),B6=BD,B8=Iw,B7=e=>bd(e,e=>{let t=tQ(fF(e.context,uy),sU(p4));return"None"===t._tag?e:{...e,annotations:z(e.annotations,ie("effect.traceId",t.value.traceId),ie("effect.spanId",t.value.spanId),"Span"===t.value._tag?ie("effect.spanName",t.value.name):T)}}),B9=bx,Je=by,Jt=bv,Jr=yQ,Jn=bI,Ji=bC,Js=b_,Ja=bq,Jo=bH,Jl=bE,Jc=y2,Ju=B0(yQ,yZ),Jh=B0(yQ,yX),Jp=B0(yQ,y0),Jf=B0(yQ,y1),Jd=e=>ww(vF(yG,e)),Jm=e=>"object"==typeof e&&null!=e&&bu in e,Jg=(e=>{let t=zL(zW(),e=>{let t=ue.find(t=>t._tag===e);return void 0===t?tO(h0([],`Expected a log level but received ${e}`)):tI(t)});return void 0===e?t:z$(t,e)})("logLevel").pipe(zK(c6),cf(e=>Jd(e)),g$(e=>gI("Invalid log level").pipe(gc("error",e))),gf("ConfigError",e=>new Bl({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),wN),Jb=((...e)=>t=>{let r=e.map(String).join(", "),n=zB(`one of (${r})`,t=>{let n=e.find(e=>String(e)===t);return void 0===n?tO(h0([],`Expected one of (${r}) but received ${t}`)):tI(n)});return void 0===t?n:z$(n,t)})("json","logFmt","structured","pretty")("logFormat"),Jx=km(function*(){let e=yield*BT;return C[yield*Jb.pipe(zK(e?"pretty":"json"))]}).pipe(gf("ConfigError",e=>new Bl({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),wN),Jy=(e,t)=>{let r=t?.mixin??"json",n=f3(t?.level??"Debug");return t=>cp("None"!==r?t[r]:cB,()=>kv(n,`${e} (${t.status})`).pipe(gc("response",t)))},Jv=e=>t=>"ResponseError"===t._tag?Jy(e,{level:"Error"})(t.response):gI(e).pipe(gc("error",t));class J_ extends kO("ParserError"){constructor(...e){super(...e),this.message="Input validation failed. The original error with it's validation issues is in the error cause."}}class JS extends kE{constructor(e,t,r){super({reason:`You uploaded a ${e} file that was ${Bi(r)}, but the limit for that type is ${t}`}),this._tag="FileSizeMismatch",this.name="FileSizeMismatchError"}}class Jw extends kE{constructor(e,t,r,n){super({reason:`You uploaded ${n} file(s) of type '${e}', but the ${t} for that type is ${r}`}),this._tag="FileCountMismatch",this.name="FileCountMismatchError"}}let Jk=(e,t)=>km(function*(){let r={};for(let n of e){let e=yield*Bt(n,Bs(t));r[e]=(r[e]??0)+1;let i=t[e]?.maxFileSize;if(!i)return yield*new q4(e,"maxFileSize");let s=yield*Bn(i);if(n.size>s)return yield*new JS(e,i,n.size)}for(let e in r){let n=t[e];if(!n)return yield*new q4(e);let i=r[e],s=n.minFileCount,a=n.maxFileCount;if(s>a)return yield*new Bl({code:"BAD_REQUEST",message:"Invalid config during file count - minFileCount > maxFileCount",cause:`minFileCount must be less than maxFileCount for key ${e}. got: ${s} > ${a}`});if(null!=i&&i<s)return yield*new Jw(e,"minimum",s,i);if(null!=i&&i>a)return yield*new Jw(e,"maximum",a,i)}return null}),JC=e=>vt(Bs(e),t=>cE(Be(e[t].routerConfig),e=>({slug:t,config:e}))),JE="@effect/platform/FetchHttpClient/Fetch",JO=(y=(e,t,r,n)=>{let i=n.getFiberRef(uy),s=i.unsafeMap.get(JE)??globalThis.fetch,a=i.unsafeMap.get("@effect/platform/FetchHttpClient/FetchOptions")??{},o=new globalThis.Headers(e.headers),l=n=>cE(gq({try:()=>s(t,{...a,method:e.method,headers:o,body:n,duplex:"Stream"===e.body._tag?"half":void 0,signal:r}),catch:t=>new U8({request:e,reason:"Transport",cause:t})}),t=>qC(e,t));switch(e.body._tag){case"Raw":case"Uint8Array":return l(e.body.body);case"FormData":return l(e.body.formData);case"Stream":return cp(jz(e.body.stream),l)}return l(void 0)},qA(e=>cp(e,e=>lZ(t=>{let r=s$(t.getFiberRef(uy),v_),n=new AbortController,i=uD(r,cP(()=>n.abort())),s=LS(e.url,e.urlParams,e.hash);if("Left"===s._tag)return ca(new U8({request:e,reason:"InvalidUrl",cause:s.left}));let a=s.right;return vy(i,!t.getFiberRef(uN)||t.getFiberRef(qR)(e)?y(e,a,n.signal,t):gY(`http.client ${e.method}`,{kind:"client",captureStackTrace:!1},r=>{r.attribute("http.request.method",e.method),r.attribute("server.address",a.origin),""!==a.port&&r.attribute("server.port",+a.port),r.attribute("url.full",a.toString()),r.attribute("url.path",a.pathname),r.attribute("url.scheme",a.protocol.slice(0,-1));let i=a.search.slice(1);""!==i&&r.attribute("url.query",i);let s=t.getFiberRef(Lb),o=Lg(e.headers,s);for(let e in o)r.attribute(`http.request.header.${e}`,String(o[e]));return cD(gQ(y(e=t.getFiberRef(qT)?qf(e,Ul(r)):e,a,n.signal,t),r),e=>{r.attribute("http.response.status_code",e.status);let t=Lg(e.headers,s);for(let e in t)r.attribute(`http.response.header.${e}`,String(t[e]))})}))})),cj)),JI=(v=cj(JO),wg(qF,cp(hI(),e=>cE(v,t=>qq(t,hN(t=>sq(e,t)))))));class JF extends sK(JE)(){}function JR(e,t){return cp(e.runtimeEffect,e=>lZ(r=>(r.setFiberRefs(e.fiberRefs),r.currentRuntimeFlags=e.runtimeFlags,hR(t,e.context))))}let JT={...ta,[Sz]:Sz,pipe(){return eV(this,arguments)},commit(){return this.runtimeEffect}},JN=(e,t)=>{let r;t=t??wl();let n=S7(vE()),i=lZ(i=>(r||(r=S4(cD(vO(wI(e,t),n),e=>{s.cachedRuntime=e}),{scope:n,scheduler:i.currentScheduler})),cm(r.await))),s=Object.assign(Object.create(JT),{memoMap:t,scope:n,runtimeEffect:i,cachedRuntime:void 0,runtime:()=>void 0===s.cachedRuntime?S6(s.runtimeEffect):Promise.resolve(s.cachedRuntime),dispose:()=>S6(s.disposeEffect),disposeEffect:cz(()=>(s.runtimeEffect=cr("ManagedRuntime disposed"),s.cachedRuntime=void 0,u$(s.scope,hh))),runFork:(e,t)=>void 0===s.cachedRuntime?S4(JR(s,e),t):SU(s.cachedRuntime)(e,t),runSyncExit:e=>void 0===s.cachedRuntime?S9(JR(s,e)):SQ(s.cachedRuntime)(e),runSync:e=>void 0===s.cachedRuntime?S7(JR(s,e)):SB(s.cachedRuntime)(e),runPromiseExit:(e,t)=>void 0===s.cachedRuntime?S8(JR(s,e),t):SX(s.cachedRuntime)(e,t),runCallback:(e,t)=>void 0===s.cachedRuntime?Sq(S5)(JR(s,e),t):Sq(s.cachedRuntime)(e,t),runPromise:(e,t)=>void 0===s.cachedRuntime?S6(JR(s,e),t):SZ(s.cachedRuntime)(e,t)});return s},JA=(e,t)=>JN(wF(w_(Jx,Jg,wR(JI,wC(JF,e)),IT(uo(Lb,e=>e.concat(["x-uploadthing-api-key"])))),IN(BR(t)))),JM=Symbol("uploadthing-custom-id-symbol");var Jj="7.6.0";class Jz extends sK("uploadthing/AdapterArguments")(){}let JP=(e,t,r,n)=>{let i=JA(r.config?.fetch,r.config),s=kg(()=>i.runtime().then(Uv)),a=(...t)=>cE(kg(()=>i.runPromise(JD(r,n??"custom"))),gj(Jz,e(...t)));return async(...e)=>await s.pipe(kS(a(...e)),kS(t(...e)),gF("requestHandler"),i.runPromise)},JD=(e,t)=>km(function*(){let r=yield*BT,n=yield*JC(e.router),i=e.config?.handleDaemonPromise?e.config.handleDaemonPromise:r?"void":"await";if(r&&"await"===i)return yield*new Bl({code:"INVALID_SERVER_CONFIG",message:'handleDaemonPromise: "await" is forbidden in development.'});let s=km(function*(){return yield*LW(n)}),a=km(function*(){let{"uploadthing-hook":r,"x-uploadthing-package":n,"x-uploadthing-version":s}=yield*Un(Dt({"uploadthing-hook":Bx.pipe(P4),"x-uploadthing-package":PO.pipe(P6({default:()=>"unknown"})),"x-uploadthing-version":PO.pipe(P6({default:()=>Jj}))}));s!==Jj&&(yield*gO("Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.").pipe(gc({clientVersion:s,serverVersion:Jj})));let{slug:a,actionType:o}=yield*U5(Dt({actionType:Bb.pipe(P4),slug:PO})),l=e.router[a];if(!l){let e=`No file route found for slug ${a}`;return yield*gI(e),yield*new Bl({code:"NOT_FOUND",message:e})}let{body:c,fiber:u}=yield*qY({actionType:o,uploadthingHook:r}).pipe(qQ({actionType:"upload",uploadthingHook:void 0},()=>Jq({uploadable:l,fePackage:n,beAdapter:t,slug:a})),qQ({actionType:void 0,uploadthingHook:"callback"},()=>J$({uploadable:l,fePackage:n,beAdapter:t})),qQ({actionType:void 0,uploadthingHook:"error"},()=>JL({uploadable:l})),qZ(()=>cj({body:null,fiber:null})));return u&&(yield*gC("Running fiber as daemon").pipe(gc("handleDaemon",i)),"void"===i||("await"===i?yield*u.await:"function"==typeof i&&i(S6(u.await)))),yield*gC("Sending response").pipe(gc("body",c)),yield*LW(c)}).pipe(gd({ParseError:t=>LW(Bz(new Bl({code:"BAD_REQUEST",message:"Invalid input",cause:t.message}),e.router),{status:400}),UploadThingError:t=>LW(Bz(t,e.router),{status:Bo[t.code]})})),o=cE(LK("x-uploadthing-version",Jj));return UZ.pipe(U1("*",s),U2("*",a),U3(o))}).pipe(gF("createRequestHandler")),JL=e=>km(function*(){let{uploadable:t}=e,r=yield*$9,{apiKey:n}=yield*BN,i=yield*Bf((yield*r.text),r.headers["x-uploadthing-signature"]??null,n);if(yield*gC(`Signature verified: ${i}`),!i)return yield*gI("Invalid signature"),yield*new Bl({code:"BAD_REQUEST",message:"Invalid signature"});let s=yield*Ui(Dt({fileKey:PO,error:PO}));yield*gC("Handling error callback request with input:").pipe(gc("json",s));let a=yield*Jz;return{body:null,fiber:yield*gq({try:async()=>t.onUploadError({...a,error:new Bl({code:"UPLOAD_FAILED",message:`Upload failed for ${s.fileKey}: ${s.error}`}),fileKey:s.fileKey}),catch:e=>new Bl({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadError",cause:e})}).pipe(g$(e=>gI("Failed to run onUploadError. You probably shouldn't be throwing errors here.").pipe(gc("error",e)))).pipe(kx,vs)}}).pipe(gF("handleErrorRequest")),J$=e=>km(function*(){let{uploadable:t,fePackage:r,beAdapter:n}=e,i=yield*$9,{apiKey:s}=yield*BN,a=yield*Bf((yield*i.text),i.headers["x-uploadthing-signature"]??null,s);if(yield*gC(`Signature verified: ${a}`),!a)return yield*gI("Invalid signature"),yield*new Bl({code:"BAD_REQUEST",message:"Invalid signature"});let o=yield*Ui(Dt({status:PO,file:Bk,metadata:Dn({key:PO,value:PE})}));return yield*gC("Handling callback request with input:").pipe(gc("json",o)),{body:null,fiber:yield*km(function*(){let e=yield*Jz,i=yield*gq({try:async()=>t.onUploadComplete({...e,file:{...o.file,get url(){return BM("`file.url` is deprecated and will be removed in uploadthing v9. Use `file.ufsUrl` instead."),o.file.url},get appUrl(){return BM("`file.appUrl` is deprecated and will be removed in uploadthing v9. Use `file.ufsUrl` instead."),o.file.appUrl}},metadata:o.metadata}),catch:e=>new Bl({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.",cause:e})}),a={fileKey:o.file.key,callbackData:i??null};yield*gC("'onUploadComplete' callback finished. Sending response to UploadThing:").pipe(gc("callbackData",a));let l=yield*BA,c=(yield*qF).pipe(qB);yield*qs("/callback-result").pipe(qx(l),qf({"x-uploadthing-api-key":zg(s),"x-uploadthing-version":Jj,"x-uploadthing-be-adapter":n,"x-uploadthing-fe-package":r}),qw(a),cp(c.execute),g$(Jv("Failed to register callback result")),cp($n(BO)),cD(gk("Sent callback result to UploadThing")),ky)}).pipe(kx,vs)}}).pipe(gF("handleCallbackRequest")),JU=e=>km(function*(){let{json:{files:t,input:r},uploadable:n}=e;yield*gC("Running middleware");let i=yield*Jz,s=yield*gq({try:async()=>n.middleware({...i,input:r,files:t}),catch:e=>e instanceof Bl?e:new Bl({code:"INTERNAL_SERVER_ERROR",message:"Failed to run middleware",cause:e})});if(s[JM]&&s[JM].length!==t.length){let e=`Expected files override to have the same length as original files, got ${s[JM].length} but expected ${t.length}`;return yield*gI(e),yield*new Bl({code:"BAD_REQUEST",message:"Files override must have the same length as files",cause:e})}let a=yield*vt(t,(e,t)=>km(function*(){let r=s[JM]?.[t];return r&&r.size!==e.size&&(yield*gO("File size mismatch. Reverting to original size")),{name:r?.name??e.name,size:e.size,type:e.type,customId:r?.customId,lastModified:r?.lastModified??Date.now()}}));return{metadata:s,filesWithCustomIds:a}}).pipe(gF("runRouteMiddleware")),Jq=e=>km(function*(){let t=(yield*qF).pipe(qB),{uploadable:r,fePackage:n,beAdapter:i,slug:s}=e,a=yield*Ui(BI);yield*gC("Handling upload request").pipe(gc("json",a)),yield*gC("Parsing user input");let o=yield*gq({try:()=>(function(e){if("parseAsync"in e&&"function"==typeof e.parseAsync)return e.parseAsync;if(Pg(e))return t=>Pm(e)(t).catch(e=>{throw new J_({cause:vU(e[SW])})});if("~standard"in e)return async t=>{let r=await e["~standard"].validate(t);if(r.issues)throw new J_({cause:r.issues});return r.value};throw Error("Invalid parser")})(r.inputParser)(a.input),catch:e=>new Bl({code:"BAD_REQUEST",message:"Invalid input",cause:e})});yield*gC("Input parsed successfully").pipe(gc("input",o));let{metadata:l,filesWithCustomIds:c}=yield*JU({json:{input:o,files:a.files},uploadable:r});yield*gC("Parsing route config").pipe(gc("routerConfig",r.routerConfig));let u=yield*Be(r.routerConfig).pipe(gf("InvalidRouteConfig",e=>new Bl({code:"BAD_REQUEST",message:"Invalid route config",cause:e})));yield*gC("Route config parsed successfully").pipe(gc("routeConfig",u)),yield*gC("Validating files meet the config requirements").pipe(gc("files",a.files)),yield*Jk(a.files,u).pipe(cI(e=>new Bl({code:"BAD_REQUEST",message:`Invalid config: ${e._tag}`,cause:"reason"in e?e.reason:e.message}))),yield*gC("Files validated.");let h=yield*vt(c,e=>cE(Bt(e,Bs(u)),t=>({name:e.name,size:e.size,type:e.type||t,lastModified:e.lastModified,customId:e.customId,contentDisposition:u[t]?.contentDisposition??"inline",acl:u[t]?.acl}))).pipe(gd({InvalidFileType:e=>cr(e),UnknownFileType:e=>cr(e)})),p=r.routeOptions,{apiKey:f,appId:d}=yield*BN,m=yield*BA,g=yield*BT;yield*gC("Generating presigned URLs").pipe(gc("fileUploadRequests",h),gc("ingestUrl",m));let b=yield*vt(h,e=>km(function*(){let t=yield*Bd(e,d,p.getFileHashParts);return{url:yield*Bm(`${m}/${t}`,f,{ttlInSeconds:p.presignedURLTTL,data:{"x-ut-identifier":d,"x-ut-file-name":e.name,"x-ut-file-size":e.size,"x-ut-file-type":e.type,"x-ut-slug":s,"x-ut-custom-id":e.customId,"x-ut-content-disposition":e.contentDisposition,"x-ut-acl":e.acl}}),key:t}}),{concurrency:"unbounded"}),x=yield*$9,y=yield*Ua(x),v=yield*zW("callbackUrl").pipe(zK(y.origin+y.pathname),cE(e=>qs(e).pipe(qy("slug",s)))),_=qs("/route-metadata").pipe(qx(m),qf({"x-uploadthing-api-key":zg(f),"x-uploadthing-version":Jj,"x-uploadthing-be-adapter":i,"x-uploadthing-fe-package":n}),qw({fileKeys:b.map(({key:e})=>e),metadata:l,isDev:g,callbackUrl:v.url,callbackSlug:s,awaitServerData:p.awaitServerData??!0}),cp(t.execute)),S=kk("handleDevStreamError")(function*(e,r){let s=DC(Dt({file:Bk})),a=(yield*Pd(s)(r)).file.key;yield*gI("Failed to forward callback request from dev stream").pipe(gc({fileKey:a,error:e.message}));let o=yield*qs("/callback-result").pipe(qx(m),qf({"x-uploadthing-api-key":zg(f),"x-uploadthing-version":Jj,"x-uploadthing-be-adapter":i,"x-uploadthing-fe-package":n}),qw({fileKey:a,error:`Failed to forward callback request from dev stream: ${e.message}`}),cp(t.execute));yield*Jy("Reported callback error to UploadThing")(o)}),w=yield*c_(g,{onTrue:()=>_.pipe(gL({onSuccess:Jy("Registered metadata",{mixin:"None"}),onFailure:Jv("Failed to register metadata")}),qJ,BP(BC,e=>v.pipe(qf({"uploadthing-hook":e.hook,"x-uploadthing-signature":e.signature}),qS(LP(e.payload,"application/json")),t.execute,cD(Jy("Successfully forwarded callback request from dev stream")),gf("ResponseError",t=>S(t,e.payload)),gc(e),l1,kx,ky))),onFalse:()=>_.pipe(gL({onSuccess:Jy("Registered metadata"),onFailure:Jv("Failed to register metadata")}),cp($n(BE)),ky)}).pipe(vs),k=b.map((e,t)=>({url:e.url,key:e.key,name:h[t].name,customId:h[t].customId??null}));return yield*gE("Sending presigned URLs to client").pipe(gc("presignedUrls",k)),{body:k,fiber:w}}).pipe(gF("handleUploadAction")),JB=e=>({id:"fakeId"}),{GET:JJ,POST:JH}=(e=>{let t=JP(e=>cj({req:e}),e=>cj(e),e,"nextjs-app");return{POST:t,GET:t}})({router:{imageUploader:(function e(t={}){let r={$types:{},routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:{awaitServerData:!0},inputParser:{parseAsync:()=>Promise.resolve(void 0),_input:void 0,_output:void 0},middleware:()=>({}),onUploadError:()=>{},onUploadComplete:()=>void 0,errorFormatter:t.errorFormatter??Bj,...t};return{input:t=>e({...r,inputParser:t}),middleware:t=>e({...r,middleware:t}),onUploadComplete:e=>({...r,onUploadComplete:e}),onUploadError:t=>e({...r,onUploadError:t})}})({routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:(void 0)??{},...S}).middleware(async({req:e})=>{let t=await JB(e);if(!t)throw new Bl("Unauthorized");return{userId:t.id}}).onUploadComplete(async({metadata:e,file:t})=>(console.log("Upload complete for userId:",e.userId),console.log("file url",t.url),{uploadedBy:e.userId}))}}),JK=new O.AppRouteRouteModule({definition:{kind:I.x.APP_ROUTE,page:"/api/uploadthing/route",pathname:"/api/uploadthing",filename:"route",bundlePath:"app/api/uploadthing/route"},resolvedPagePath:"/Users/christianaguilar/Downloads/project/src/app/api/uploadthing/route.ts",nextConfigOutput:"",userland:E}),{requestAsyncStorage:JW,staticGenerationAsyncStorage:JV,serverHooks:JG}=JK,JY="/api/uploadthing/route";function JQ(){return(0,F.patchFetch)({serverHooks:JG,staticGenerationAsyncStorage:JV})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948],()=>r(928));module.exports=n})();